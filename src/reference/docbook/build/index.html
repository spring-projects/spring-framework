<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spring Framework Reference Documentation</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Framework Reference Documentation</h1>
<span id="author" class="author">Rod Johnson, Juergen Hoeller</span><br>
<span id="revnumber">version 3.2.0.CI-SNAPSHOT</span>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#spring-introduction">Overview of Spring Framework</a></li>
<li><a href="#introduction-to-spring-framework">Introduction to Spring Framework</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#dependency-injection-and-inversion-of-control">Dependency Injection and Inversion of Control</a></li>
<li><a href="#modules">Modules</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#core-container">Core Container</a></li>
<li><a href="#data-access-integration">Data Access/Integration</a></li>
<li><a href="#web">Web</a></li>
<li><a href="#aop-and-instrumentation">AOP and Instrumentation</a></li>
<li><a href="#test">Test</a></li>
</ul>
</li>
<li><a href="#usage-scenarios">Usage scenarios</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#dependency-management-and-naming-conventions">Dependency Management and Naming Conventions</a></li>
<li><a href="#logging">Logging</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-whats-new">What&#8217;s New in Spring 3</a></li>
<li><a href="#new-features-and-enhancements-in-spring-framework-3-0">New Features and Enhancements in Spring Framework 3.0</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#java-5">Java 5</a></li>
<li><a href="#improved-documentation">Improved documentation</a></li>
<li><a href="#new-articles-and-tutorials">New articles and tutorials</a></li>
<li><a href="#new-module-organization-and-build-system">New module organization and build system</a></li>
<li><a href="#overview-of-new-features">Overview of new features</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#core-apis-updated-for-java-5">Core APIs updated for Java 5</a></li>
<li><a href="#spring-expression-language">Spring Expression Language</a></li>
<li><a href="#the-inversion-of-control-ioc-container">The Inversion of Control (IoC) container</a></li>
<li><a href="#the-evaluationcontext-interface">The EvaluationContext interface</a></li>
</ul>
</li>
<li><a href="#expression-support-for-defining-bean-definitions">Expression support for defining bean definitions</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#xml-based-configuration">XML based configuration</a></li>
<li><a href="#annotation-based-configuration">Annotation-based configuration</a></li>
</ul>
</li>
<li><a href="#language-reference">Language Reference</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#literal-expressions">Literal expressions</a></li>
<li><a href="#properties-arrays-lists-maps-indexers">Properties, Arrays, Lists, Maps, Indexers</a></li>
<li><a href="#inline-lists">Inline lists</a></li>
<li><a href="#array-construction">Array construction</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#operators">Operators</a></li>
<li><a href="#custom-pointcuts">Custom pointcuts</a></li>
</ul>
</li>
<li><a href="#advice-api-in-spring">Advice API in Spring</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#advice-lifecycles">Advice lifecycles</a></li>
<li><a href="#advice-types-in-spring">Advice types in Spring</a></li>
</ul>
</li>
<li><a href="#advisor-api-in-spring">Advisor API in Spring</a></li>
<li><a href="#using-the-proxyfactorybean-to-create-aop-proxies">Using the ProxyFactoryBean to create AOP proxies</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#basics">Basics</a></li>
<li><a href="#javabean-properties">JavaBean properties</a></li>
<li><a href="#jdk-and-cglib-based-proxies">JDK- and CGLIB-based proxies</a></li>
<li><a href="#proxying-interfaces">Proxying interfaces</a></li>
<li><a href="#proxying-classes">Proxying classes</a></li>
<li><a href="#using-em-global-em-advisors">Using <em>global</em> advisors</a></li>
</ul>
</li>
<li><a href="#concise-proxy-definitions">Concise proxy definitions</a></li>
<li><a href="#creating-aop-proxies-programmatically-with-the-proxyfactory">Creating AOP proxies programmatically with the ProxyFactory</a></li>
<li><a href="#manipulating-advised-objects">Manipulating advised objects</a></li>
<li><a href="#using-the-auto-proxy-facility">Using the "auto-proxy" facility</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#autoproxy-bean-definitions">Autoproxy bean definitions</a></li>
<li><a href="#using-metadata-driven-auto-proxying">Using metadata-driven auto-proxying</a></li>
</ul>
</li>
<li><a href="#using-targetsources">Using TargetSources</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#hot-swappable-target-sources">Hot swappable target sources</a></li>
<li><a href="#pooling-target-sources">Pooling target sources</a></li>
<li><a href="#prototype-target-sources">Prototype target sources</a></li>
<li><a href="#code-class-class-threadlocal-code-target-sources"><code class="class">ThreadLocal</code> target sources</a></li>
</ul>
</li>
<li><a href="#defining-new-code-class-interface-advice-code-types">Defining new <code class="interface">Advice</code> types</a></li>
<li><a href="#further-resources">Further resources</a></li>
</ul>
</li>
<li><a href="#testing">Testing</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-to-spring-testing">Introduction to Spring Testing</a></li>
<li><a href="#unit-testing">Unit Testing</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#mock-objects">Mock Objects</a></li>
<li><a href="#unit-testing-support-classes">Unit Testing support Classes</a></li>
</ul>
</li>
<li><a href="#integration-testing">Integration Testing</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#overview">Overview</a></li>
<li><a href="#goals-of-integration-testing">Goals of Integration Testing</a></li>
<li><a href="#jdbc-testing-support">JDBC Testing Support</a></li>
<li><a href="#annotations">Annotations</a></li>
<li><a href="#spring-testcontext-framework">Spring TestContext Framework</a></li>
<li><a href="#code-class-class-namedparameterjdbctemplate-code"><code class="class">NamedParameterJdbcTemplate</code></a></li>
<li><a href="#code-class-interface-sqlexceptiontranslator-code"><code class="interface">SQLExceptionTranslator</code></a></li>
<li><a href="#executing-statements">Executing statements</a></li>
<li><a href="#running-queries">Running queries</a></li>
<li><a href="#updating-the-database">Updating the database</a></li>
<li><a href="#retrieving-auto-generated-keys">Retrieving auto-generated keys</a></li>
</ul>
</li>
<li><a href="#controlling-database-connections">Controlling database connections</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-interface-datasource-code"><code class="interface">DataSource</code></a></li>
<li><a href="#code-class-class-datasourceutils-code"><code class="class">DataSourceUtils</code></a></li>
<li><a href="#code-class-interface-smartdatasource-code"><code class="interface">SmartDataSource</code></a></li>
<li><a href="#code-class-class-abstractdatasource-code"><code class="class">AbstractDataSource</code></a></li>
<li><a href="#code-class-class-singleconnectiondatasource-code"><code class="class">SingleConnectionDataSource</code></a></li>
<li><a href="#code-class-class-drivermanagerdatasource-code"><code class="class">DriverManagerDataSource</code></a></li>
<li><a href="#code-class-class-transactionawaredatasourceproxy-code"><code class="class">TransactionAwareDataSourceProxy</code></a></li>
<li><a href="#code-class-class-datasourcetransactionmanager-code"><code class="class">DataSourceTransactionManager</code></a></li>
<li><a href="#nativejdbcextractor">NativeJdbcExtractor</a></li>
</ul>
</li>
<li><a href="#jdbc-batch-operations">JDBC batch operations</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#basic-batch-operations-with-the-jdbctemplate">Basic batch operations with the JdbcTemplate</a></li>
</ul>
</li>
<li><a href="#simplifying-jdbc-operations-with-the-simplejdbc-classes">Simplifying JDBC operations with the SimpleJdbc classes</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#inserting-data-using-simplejdbcinsert">Inserting data using SimpleJdbcInsert</a></li>
<li><a href="#retrieving-auto-generated-keys-using-simplejdbcinsert">Retrieving auto-generated keys using SimpleJdbcInsert</a></li>
<li><a href="#using-sqlparametersource-to-provide-parameter-values">Using SqlParameterSource to provide parameter values</a></li>
<li><a href="#calling-a-stored-procedure-with-simplejdbccall">Calling a stored procedure with SimpleJdbcCall</a></li>
<li><a href="#how-to-define-sqlparameters">How to define SqlParameters</a></li>
<li><a href="#calling-a-stored-function-using-simplejdbccall">Calling a stored function using SimpleJdbcCall</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#object-relational-mapping-orm-data-access">Object Relational Mapping (ORM) Data Access</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-to-orm-with-spring">Introduction to ORM with Spring</a></li>
<li><a href="#general-orm-integration-considerations">General ORM integration considerations</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#resource-and-transaction-management">Resource and transaction management</a></li>
<li><a href="#exception-translation">Exception translation</a></li>
</ul>
</li>
<li><a href="#hibernate">Hibernate</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-interface-sessionfactory-code-setup-in-a-spring-container"><code class="interface">SessionFactory</code> setup in a Spring container</a></li>
<li><a href="#implementing-daos-based-on-plain-hibernate-3-api">Implementing DAOs based on plain Hibernate 3 API</a></li>
<li><a href="#declarative-transaction-demarcation">Declarative transaction demarcation</a></li>
<li><a href="#programmatic-transaction-demarcation">Programmatic transaction demarcation</a></li>
<li><a href="#transaction-management-strategies">Transaction management strategies</a></li>
<li><a href="#comparing-container-managed-and-locally-defined-resources">Comparing container-managed and locally defined resources</a></li>
<li><a href="#spurious-application-server-warnings-with-hibernate">Spurious application server warnings with Hibernate</a></li>
</ul>
</li>
<li><a href="#jdo">JDO</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-interface-persistencemanagerfactory-code-setup"><code class="interface">PersistenceManagerFactory</code> setup</a></li>
<li><a href="#implementing-daos-based-on-the-plain-jdo-api">Implementing DAOs based on the plain JDO API</a></li>
<li><a href="#transaction-management-3">Transaction management</a></li>
<li><a href="#code-class-interface-jdodialect-code"><code class="interface">JdoDialect</code></a></li>
</ul>
</li>
<li><a href="#jpa">JPA</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#three-options-for-jpa-setup-in-a-spring-environment">Three options for JPA setup in a Spring environment</a></li>
<li><a href="#implementing-daos-based-on-plain-jpa">Implementing DAOs based on plain JPA</a></li>
<li><a href="#transaction-management-4">Transaction Management</a></li>
<li><a href="#code-class-interface-jpadialect-code"><code class="interface">JpaDialect</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#marshalling-xml-using-o-x-mappers">Marshalling XML using O/X Mappers</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#marshaller-and-unmarshaller">Marshaller and Unmarshaller</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#marshaller">Marshaller</a></li>
<li><a href="#xmlmappingexception">XmlMappingException</a></li>
</ul>
</li>
<li><a href="#using-marshaller-and-unmarshaller">Using Marshaller and Unmarshaller</a></li>
<li><a href="#xml-schema-based-configuration">XML Schema-based Configuration</a></li>
<li><a href="#jaxb">JAXB</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#jaxb2marshaller">Jaxb2Marshaller</a></li>
</ul>
</li>
<li><a href="#castor">Castor</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#castormarshaller">CastorMarshaller</a></li>
<li><a href="#mapping">Mapping</a></li>
</ul>
</li>
<li><a href="#xmlbeans">XMLBeans</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#xmlbeansmarshaller">XmlBeansMarshaller</a></li>
</ul>
</li>
<li><a href="#jibx">JiBX</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#jibxmarshaller">JibxMarshaller</a></li>
</ul>
</li>
<li><a href="#xstream">XStream</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#xstreammarshaller">XStreamMarshaller</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-web">The Web</a></li>
<li><a href="#web-mvc-framework">Web MVC framework</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-to-spring-web-mvc-framework">Introduction to Spring Web MVC framework</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#features-of-spring-web-mvc">Features of Spring Web MVC</a></li>
<li><a href="#pluggability-of-other-mvc-implementations">Pluggability of other MVC implementations</a></li>
</ul>
</li>
<li><a href="#the-code-class-class-dispatcherservlet-code">The <code class="class">DispatcherServlet</code></a></li>
<li>
<ul class="sectlevel2">
<li><a href="#special-bean-types-in-the-code-class-interface-webapplicationcontext-code">Special Bean Types In the <code class="interface">WebApplicationContext</code></a></li>
<li><a href="#default-dispatcherservlet-configuration">Default DispatcherServlet Configuration</a></li>
<li><a href="#dispatcherservlet-processing-sequence">DispatcherServlet Processing Sequence</a></li>
</ul>
</li>
<li><a href="#implementing-controllers">Implementing Controllers</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#defining-a-controller-with-code-class-interface-controller-code">Defining a controller with <code class="interface">@Controller</code></a></li>
<li><a href="#mapping-requests-with-code-class-interface-requestmapping-code">Mapping Requests With <code class="interface">@RequestMapping</code></a></li>
<li><a href="#defining-code-class-interface-requestmapping-code-handler-methods">Defining <code class="interface">@RequestMapping</code> handler methods</a></li>
<li><a href="#asynchronous-request-processing">Asynchronous Request Processing</a></li>
<li><a href="#testing-controllers">Testing Controllers</a></li>
</ul>
</li>
<li><a href="#handler-mappings">Handler mappings</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#intercepting-requests-with-a-code-class-interface-handlerinterceptor-code">Intercepting requests with a <code class="interface">HandlerInterceptor</code></a></li>
</ul>
</li>
<li><a href="#resolving-views">Resolving views</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#resolving-views-with-the-code-class-interface-viewresolver-code-interface">Resolving views with the <code class="interface">ViewResolver</code> interface</a></li>
<li><a href="#chaining-viewresolvers">Chaining ViewResolvers</a></li>
<li><a href="#redirecting-to-views">Redirecting to views</a></li>
<li><a href="#code-class-class-contentnegotiatingviewresolver-code"><code class="class">ContentNegotiatingViewResolver</code></a></li>
</ul>
</li>
<li><a href="#using-flash-attributes">Using flash attributes</a></li>
<li><a href="#building-uri-s">Building `URI`s</a></li>
<li><a href="#using-locales">Using locales</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-class-acceptheaderlocaleresolver-code"><code class="class">AcceptHeaderLocaleResolver</code></a></li>
<li><a href="#code-class-class-cookielocaleresolver-code"><code class="class">CookieLocaleResolver</code></a></li>
<li><a href="#code-class-class-sessionlocaleresolver-code"><code class="class">SessionLocaleResolver</code></a></li>
<li><a href="#code-class-class-localechangeinterceptor-code"><code class="class">LocaleChangeInterceptor</code></a></li>
</ul>
</li>
<li><a href="#using-themes">Using themes</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#overview-of-themes">Overview of themes</a></li>
<li><a href="#defining-themes">Defining themes</a></li>
<li><a href="#theme-resolvers">Theme resolvers</a></li>
</ul>
</li>
<li><a href="#spring-s-multipart-file-upload-support">Spring&#8217;s multipart (file upload) support</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#introduction-2">Introduction</a></li>
<li><a href="#using-a-code-class-interface-multipartresolver-code-with-em-commons-fileupload-em">Using a <code class="interface">MultipartResolver</code> with <em>Commons FileUpload</em></a></li>
<li><a href="#using-a-code-class-interface-multipartresolver-code-with-em-servlet-3-0-em">Using a <code class="interface">MultipartResolver</code> with <em>Servlet 3.0</em></a></li>
<li><a href="#handling-a-file-upload-in-a-form">Handling a file upload in a form</a></li>
<li><a href="#handling-a-file-upload-request-from-programmatic-clients">Handling a file upload request from programmatic clients</a></li>
</ul>
</li>
<li><a href="#handling-exceptions">Handling exceptions</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-interface-handlerexceptionresolver-code"><code class="interface">HandlerExceptionResolver</code></a></li>
<li><a href="#code-class-interface-exceptionhandler-code"><code class="interface">@ExceptionHandler</code></a></li>
<li><a href="#handling-standard-spring-mvc-exceptions">Handling Standard Spring MVC Exceptions</a></li>
<li><a href="#annotating-business-exceptions-with-code-class-interface-responsestatus-code">Annotating Business Exceptions With <code class="interface">@ResponseStatus</code></a></li>
<li><a href="#customizing-the-default-servlet-container-error-page">Customizing the Default Servlet Container Error Page</a></li>
</ul>
</li>
<li><a href="#convention-over-configuration-support">Convention over configuration support</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#the-controller-code-class-class-controllerclassnamehandlermapping-code">The Controller <code class="class">ControllerClassNameHandlerMapping</code></a></li>
<li><a href="#the-model-code-class-class-modelmap-code-code-class-class-modelandview-code">The Model <code class="class">ModelMap</code> (<code class="class">ModelAndView</code>)</a></li>
<li><a href="#the-view-code-class-interface-requesttoviewnametranslator-code">The View - <code class="interface">RequestToViewNameTranslator</code></a></li>
</ul>
</li>
<li><a href="#etag-support">ETag support</a></li>
<li><a href="#code-based-servlet-container-initialization">Code-based Servlet container initialization</a></li>
<li><a href="#configuring-spring-mvc">Configuring Spring MVC</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#enabling-the-mvc-java-config-or-the-mvc-xml-namespace">Enabling the MVC Java Config or the MVC XML Namespace</a></li>
<li><a href="#customizing-the-provided-configuration">Customizing the Provided Configuration</a></li>
<li><a href="#configuring-interceptors">Configuring Interceptors</a></li>
<li><a href="#configuring-content-negotiation">Configuring Content Negotiation</a></li>
<li><a href="#configuring-view-controllers">Configuring View Controllers</a></li>
<li><a href="#configuring-serving-of-resources">Configuring Serving of Resources</a></li>
<li><a href="#mvc-default-servlet-handler">mvc:default-servlet-handler</a></li>
<li><a href="#more-spring-web-mvc-resources">More Spring Web MVC Resources</a></li>
<li><a href="#advanced-customizations-with-mvc-java-config">Advanced Customizations with MVC Java Config</a></li>
<li><a href="#advanced-customizations-with-the-mvc-namespace">Advanced Customizations with the MVC Namespace</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#view-technologies">View technologies</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-3">Introduction</a></li>
<li><a href="#jsp-jstl">JSP &amp; JSTL</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#view-resolvers">View resolvers</a></li>
<li><a href="#em-plain-old-em-jsps-versus-jstl"><em>Plain-old</em> JSPs versus JSTL</a></li>
<li><a href="#additional-tags-facilitating-development">Additional tags facilitating development</a></li>
<li><a href="#using-spring-s-form-tag-library">Using Spring&#8217;s form tag library</a></li>
</ul>
</li>
<li><a href="#tiles">Tiles</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#how-to-integrate-tiles">How to integrate Tiles</a></li>
</ul>
</li>
<li><a href="#velocity-freemarker">Velocity &amp; FreeMarker</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#dependencies-2">Dependencies</a></li>
<li><a href="#context-configuration">Context configuration</a></li>
<li><a href="#creating-templates">Creating templates</a></li>
<li><a href="#advanced-configuration">Advanced configuration</a></li>
<li><a href="#bind-support-and-form-handling">Bind support and form handling</a></li>
</ul>
</li>
<li><a href="#xslt">XSLT</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#my-first-words">My First Words</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</li>
<li><a href="#document-views-pdf-excel">Document views (PDF/Excel)</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#introduction-4">Introduction</a></li>
<li><a href="#configuration-and-setup">Configuration and setup</a></li>
</ul>
</li>
<li><a href="#jasperreports">JasperReports</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#dependencies-3">Dependencies</a></li>
<li><a href="#configuration-2">Configuration</a></li>
<li><a href="#populating-the-code-class-class-modelandview-code">Populating the <code class="class">ModelAndView</code></a></li>
<li><a href="#working-with-sub-reports">Working with Sub-Reports</a></li>
<li><a href="#configuring-exporter-parameters">Configuring Exporter Parameters</a></li>
</ul>
</li>
<li><a href="#feed-views">Feed Views</a></li>
<li><a href="#xml-marshalling-view">XML Marshalling View</a></li>
<li><a href="#json-mapping-view">JSON Mapping View</a></li>
</ul>
</li>
<li><a href="#integrating-with-other-web-frameworks">Integrating with other web frameworks</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-5">Introduction</a></li>
<li><a href="#common-configuration">Common configuration</a></li>
<li><a href="#javaserver-faces-1-1-and-1-2">JavaServer Faces 1.1 and 1.2</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#delegatingvariableresolver-jsf-1-1-1-2">DelegatingVariableResolver (JSF 1.1/1.2)</a></li>
<li><a href="#springbeanvariableresolver-jsf-1-1-1-2">SpringBeanVariableResolver (JSF 1.1/1.2)</a></li>
<li><a href="#springbeanfaceselresolver-jsf-1-2">SpringBeanFacesELResolver (JSF 1.2+)</a></li>
<li><a href="#facescontextutils">FacesContextUtils</a></li>
</ul>
</li>
<li><a href="#apache-struts-1-x-and-2-x">Apache Struts 1.x and 2.x</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#contextloaderplugin">ContextLoaderPlugin</a></li>
<li><a href="#actionsupport-classes">ActionSupport Classes</a></li>
</ul>
</li>
<li><a href="#webwork-2-x">WebWork 2.x</a></li>
<li><a href="#tapestry-3-x-and-4-x">Tapestry 3.x and 4.x</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#injecting-spring-managed-beans">Injecting Spring-managed beans</a></li>
</ul>
</li>
<li><a href="#further-resources-2">Further Resources</a></li>
</ul>
</li>
<li><a href="#portlet-mvc-framework">Portlet MVC Framework</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-6">Introduction</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#controllers-the-c-in-mvc">Controllers - The C in MVC</a></li>
<li><a href="#views-the-v-in-mvc">Views - The V in MVC</a></li>
<li><a href="#web-scoped-beans">Web-scoped beans</a></li>
</ul>
</li>
<li><a href="#the-code-class-class-dispatcherportlet-code">The <code class="class">DispatcherPortlet</code></a></li>
<li><a href="#the-code-class-class-viewrendererservlet-code">The <code class="class">ViewRendererServlet</code></a></li>
<li><a href="#controllers">Controllers</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-class-abstractcontroller-code-and-code-class-class-portletcontentgenerator-code"><code class="class">AbstractController</code> and <code class="class">PortletContentGenerator</code></a></li>
<li><a href="#other-simple-controllers">Other simple controllers</a></li>
<li><a href="#command-controllers">Command Controllers</a></li>
<li><a href="#code-class-class-portletwrappingcontroller-code"><code class="class">PortletWrappingController</code></a></li>
</ul>
</li>
<li><a href="#handler-mappings-2">Handler mappings</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-class-portletmodehandlermapping-code"><code class="class">PortletModeHandlerMapping</code></a></li>
<li><a href="#code-class-class-parameterhandlermapping-code"><code class="class">ParameterHandlerMapping</code></a></li>
<li><a href="#code-class-class-portletmodeparameterhandlermapping-code"><code class="class">PortletModeParameterHandlerMapping</code></a></li>
<li><a href="#adding-interface-handlerinterceptor-s">Adding [interface]`HandlerInterceptor`s</a></li>
<li><a href="#code-class-class-handlerinterceptoradapter-code"><code class="class">HandlerInterceptorAdapter</code></a></li>
<li><a href="#code-class-class-parametermappinginterceptor-code"><code class="class">ParameterMappingInterceptor</code></a></li>
</ul>
</li>
<li><a href="#views-and-resolving-them">Views and resolving them</a></li>
<li><a href="#multipart-file-upload-support">Multipart (file upload) support</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#using-the-code-class-interface-portletmultipartresolver-code">Using the <code class="interface">PortletMultipartResolver</code></a></li>
<li><a href="#handling-a-file-upload-in-a-form-2">Handling a file upload in a form</a></li>
</ul>
</li>
<li><a href="#handling-exceptions-2">Handling exceptions</a></li>
<li><a href="#annotation-based-controller-configuration">Annotation-based controller configuration</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#setting-up-the-dispatcher-for-annotation-support">Setting up the dispatcher for annotation support</a></li>
<li><a href="#defining-a-controller-with-code-class-interface-controller-code-2">Defining a controller with <code class="interface">@Controller</code></a></li>
<li><a href="#mapping-requests-with-code-class-interface-requestmapping-code-2">Mapping requests with <code class="interface">@RequestMapping</code></a></li>
<li><a href="#supported-handler-method-arguments">Supported handler method arguments</a></li>
<li><a href="#binding-request-parameters-to-method-parameters-with-code-class-class-requestparam-code">Binding request parameters to method parameters with <code class="class">@RequestParam</code></a></li>
<li><a href="#providing-a-link-to-data-from-the-model-with-code-class-class-modelattribute-code">Providing a link to data from the model with <code class="class">@ModelAttribute</code></a></li>
<li><a href="#specifying-attributes-to-store-in-a-session-with-code-class-class-sessionattributes-code">Specifying attributes to store in a Session with <code class="class">@SessionAttributes</code></a></li>
<li><a href="#customizing-code-class-class-webdatabinder-code-initialization-2">Customizing <code class="class">WebDataBinder</code> initialization</a></li>
</ul>
</li>
<li><a href="#portlet-application-deployment">Portlet application deployment</a></li>
</ul>
</li>
<li><a href="#spring-integration">Integration</a></li>
<li><a href="#remoting-and-web-services-using-spring">Remoting and web services using Spring</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-7">Introduction</a></li>
<li><a href="#exposing-services-using-rmi">Exposing services using RMI</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#exporting-the-service-using-the-code-class-class-rmiserviceexporter-code">Exporting the service using the <code class="class">RmiServiceExporter</code></a></li>
<li><a href="#linking-in-the-service-at-the-client">Linking in the service at the client</a></li>
</ul>
</li>
<li><a href="#using-hessian-or-burlap-to-remotely-call-services-via-http">Using Hessian or Burlap to remotely call services via HTTP</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#wiring-up-the-code-class-class-dispatcherservlet-code-for-hessian-and-co">Wiring up the <code class="class">DispatcherServlet</code> for Hessian and co.</a></li>
<li><a href="#exposing-your-beans-by-using-the-code-class-class-hessianserviceexporter-code">Exposing your beans by using the <code class="class">HessianServiceExporter</code></a></li>
<li><a href="#linking-in-the-service-on-the-client">Linking in the service on the client</a></li>
<li><a href="#using-burlap">Using Burlap</a></li>
<li><a href="#applying-http-basic-authentication-to-a-service-exposed-through-hessian-or-burlap">Applying HTTP basic authentication to a service exposed through Hessian or Burlap</a></li>
</ul>
</li>
<li><a href="#exposing-services-using-http-invokers">Exposing services using HTTP invokers</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#exposing-the-service-object">Exposing the service object</a></li>
<li><a href="#linking-in-the-service-at-the-client-2">Linking in the service at the client</a></li>
</ul>
</li>
<li><a href="#web-services">Web services</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#exposing-servlet-based-web-services-using-jax-ws">Exposing servlet-based web services using JAX-WS</a></li>
<li><a href="#exporting-standalone-web-services-using-jax-ws">Exporting standalone web services using JAX-WS</a></li>
<li><a href="#exporting-web-services-using-the-jax-ws-ri-s-spring-support">Exporting web services using the JAX-WS RI&#8217;s Spring support</a></li>
<li><a href="#accessing-web-services-using-jax-ws">Accessing web services using JAX-WS</a></li>
</ul>
</li>
<li><a href="#jms">JMS</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#server-side-configuration">Server-side configuration</a></li>
<li><a href="#client-side-configuration">Client-side configuration</a></li>
</ul>
</li>
<li><a href="#auto-detection-is-not-implemented-for-remote-interfaces">Auto-detection is not implemented for remote interfaces</a></li>
<li><a href="#considerations-when-choosing-a-technology">Considerations when choosing a technology</a></li>
<li><a href="#accessing-restful-services-on-the-client">Accessing RESTful services on the Client</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#resttemplate">RestTemplate</a></li>
<li><a href="#http-message-conversion">HTTP Message Conversion</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#enterprise-javabeans-ejb-integration">Enterprise JavaBeans (EJB) integration</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-8">Introduction</a></li>
<li><a href="#accessing-ejbs">Accessing EJBs</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#concepts">Concepts</a></li>
<li><a href="#accessing-local-slsbs">Accessing local SLSBs</a></li>
<li><a href="#accessing-remote-slsbs">Accessing remote SLSBs</a></li>
<li><a href="#accessing-ejb-2-x-slsbs-versus-ejb-3-slsbs">Accessing EJB 2.x SLSBs versus EJB 3 SLSBs</a></li>
</ul>
</li>
<li><a href="#using-spring-s-ejb-implementation-support-classes">Using Spring&#8217;s EJB implementation support classes</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#ejb-3-injection-interceptor">EJB 3 injection interceptor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#jms-java-message-service">JMS (Java Message Service)</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-9">Introduction</a></li>
<li><a href="#using-spring-jms">Using Spring JMS</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-class-jmstemplate-code"><code class="class">JmsTemplate</code></a></li>
<li><a href="#connections">Connections</a></li>
<li><a href="#destination-management">Destination Management</a></li>
<li><a href="#message-listener-containers">Message Listener Containers</a></li>
<li><a href="#transaction-management-5">Transaction management</a></li>
</ul>
</li>
<li><a href="#sending-a-code-class-interface-message-code">Sending a <code class="interface">Message</code></a></li>
<li>
<ul class="sectlevel2">
<li><a href="#using-message-converters">Using Message Converters</a></li>
<li><a href="#code-class-interface-sessioncallback-code-and-code-class-interface-producercallback-code"><code class="interface">SessionCallback</code> and <code class="interface">ProducerCallback</code></a></li>
</ul>
</li>
<li><a href="#receiving-a-message">Receiving a message</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#synchronous-reception">Synchronous Reception</a></li>
<li><a href="#asynchronous-reception-message-driven-pojos">Asynchronous Reception - Message-Driven POJOs</a></li>
<li><a href="#the-code-class-interface-sessionawaremessagelistener-code-interface">The <code class="interface">SessionAwareMessageListener</code> interface</a></li>
<li><a href="#the-code-class-class-messagelisteneradapter-code">The <code class="class">MessageListenerAdapter</code></a></li>
<li><a href="#processing-messages-within-transactions">Processing messages within transactions</a></li>
</ul>
</li>
<li><a href="#support-for-jca-message-endpoints">Support for JCA Message Endpoints</a></li>
<li><a href="#jms-namespace-support">JMS Namespace Support</a></li>
</ul>
</li>
<li><a href="#jmx">JMX</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-10">Introduction</a></li>
<li><a href="#exporting-your-beans-to-jmx">Exporting your beans to JMX</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#creating-an-code-class-interface-mbeanserver-code">Creating an <code class="interface">MBeanServer</code></a></li>
<li><a href="#reusing-an-existing-code-class-interface-mbeanserver-code">Reusing an existing <code class="interface">MBeanServer</code></a></li>
<li><a href="#lazy-initialized-mbeans">Lazy-initialized MBeans</a></li>
<li><a href="#automatic-registration-of-mbeans">Automatic registration of MBeans</a></li>
<li><a href="#controlling-the-registration-behavior">Controlling the registration behavior</a></li>
</ul>
</li>
<li><a href="#controlling-the-management-interface-of-your-beans">Controlling the management interface of your beans</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#the-code-class-interface-mbeaninfoassembler-code-interface">The <code class="interface">MBeanInfoAssembler</code> Interface</a></li>
<li><a href="#using-source-level-metadata-jdk-5-0-annotations">Using Source-Level Metadata (JDK 5.0 annotations)</a></li>
<li><a href="#source-level-metadata-types">Source-Level Metadata Types</a></li>
<li><a href="#the-code-class-class-autodetectcapablembeaninfoassembler-code-interface">The <code class="class">AutodetectCapableMBeanInfoAssembler</code> interface</a></li>
<li><a href="#defining-management-interfaces-using-java-interfaces">Defining management interfaces using Java interfaces</a></li>
<li><a href="#using-code-class-class-methodnamebasedmbeaninfoassembler-code">Using <code class="class">MethodNameBasedMBeanInfoAssembler</code></a></li>
</ul>
</li>
<li><a href="#controlling-the-class-objectname-s-for-your-beans">Controlling the [class]`ObjectName`s for your beans</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#reading-code-class-class-objectname-s-from-class-properties-code">Reading <code class="class">ObjectName`s from [class]`Properties</code></a></li>
<li><a href="#using-the-code-class-class-metadatanamingstrategy-code">Using the <code class="class">MetadataNamingStrategy</code></a></li>
<li><a href="#configuring-annotation-based-mbean-export">Configuring annotation based MBean export</a></li>
</ul>
</li>
<li><a href="#jsr-160-connectors">JSR-160 Connectors</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#server-side-connectors">Server-side Connectors</a></li>
<li><a href="#client-side-connectors">Client-side Connectors</a></li>
<li><a href="#jmx-over-burlap-hessian-soap">JMX over Burlap/Hessian/SOAP</a></li>
</ul>
</li>
<li><a href="#accessing-mbeans-via-proxies">Accessing MBeans via Proxies</a></li>
<li><a href="#notifications">Notifications</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#registering-listeners-for-notifications">Registering Listeners for Notifications</a></li>
<li><a href="#publishing-notifications">Publishing Notifications</a></li>
</ul>
</li>
<li><a href="#further-resources-3">Further Resources</a></li>
</ul>
</li>
<li><a href="#jca-cci">JCA CCI</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-11">Introduction</a></li>
<li><a href="#configuring-cci">Configuring CCI</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#connector-configuration">Connector configuration</a></li>
<li><a href="#code-class-interface-connectionfactory-code-configuration-in-spring"><code class="interface">ConnectionFactory</code> configuration in Spring</a></li>
<li><a href="#configuring-cci-connections">Configuring CCI connections</a></li>
<li><a href="#using-a-single-cci-connection">Using a single CCI connection</a></li>
</ul>
</li>
<li><a href="#using-spring-s-cci-access-support">Using Spring&#8217;s CCI access support</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#record-conversion">Record conversion</a></li>
<li><a href="#the-code-class-class-ccitemplate-code">The <code class="class">CciTemplate</code></a></li>
<li><a href="#dao-support">DAO support</a></li>
<li><a href="#automatic-output-record-generation">Automatic output record generation</a></li>
<li><a href="#summary-2">Summary</a></li>
<li><a href="#using-a-cci-code-class-interface-connection-code-and-code-class-interface-interaction-code-directly">Using a CCI <code class="interface">Connection</code> and <code class="interface">Interaction</code> directly</a></li>
<li><a href="#example-for-code-class-class-ccitemplate-code-usage">Example for <code class="class">CciTemplate</code> usage</a></li>
</ul>
</li>
<li><a href="#modeling-cci-access-as-operation-objects">Modeling CCI access as operation objects</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-class-mappingrecordoperation-code"><code class="class">MappingRecordOperation</code></a></li>
<li><a href="#code-class-class-mappingcommareaoperation-code"><code class="class">MappingCommAreaOperation</code></a></li>
<li><a href="#automatic-output-record-generation-2">Automatic output record generation</a></li>
<li><a href="#summary-3">Summary</a></li>
<li><a href="#example-for-code-class-class-mappingrecordoperation-code-usage">Example for <code class="class">MappingRecordOperation</code> usage</a></li>
<li><a href="#example-for-code-class-class-mappingcommareaoperation-code-usage">Example for <code class="class">MappingCommAreaOperation</code> usage</a></li>
</ul>
</li>
<li><a href="#transactions">Transactions</a></li>
</ul>
</li>
<li><a href="#email">Email</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-12">Introduction</a></li>
<li><a href="#usage">Usage</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#basic-code-class-interface-mailsender-code-and-code-class-class-simplemailmessage-code-usage">Basic <code class="interface">MailSender</code> and <code class="class">SimpleMailMessage</code> usage</a></li>
<li><a href="#using-the-code-class-interface-javamailsender-code-and-the-code-class-class-mimemessagepreparator-code">Using the <code class="interface">JavaMailSender</code> and the <code class="class">MimeMessagePreparator</code></a></li>
</ul>
</li>
<li><a href="#using-the-javamail-code-class-class-mimemessagehelper-code">Using the JavaMail <code class="class">MimeMessageHelper</code></a></li>
<li>
<ul class="sectlevel2">
<li><a href="#sending-attachments-and-inline-resources">Sending attachments and inline resources</a></li>
<li><a href="#creating-email-content-using-a-templating-library">Creating email content using a templating library</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#task-execution-and-scheduling">Task Execution and Scheduling</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-13">Introduction</a></li>
<li><a href="#the-spring-code-class-interface-taskexecutor-code-abstraction">The Spring <code class="interface">TaskExecutor</code> abstraction</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-class-interface-taskexecutor-code-types"><code class="interface">TaskExecutor</code> types</a></li>
<li><a href="#using-a-code-class-interface-taskexecutor-code">Using a <code class="interface">TaskExecutor</code></a></li>
</ul>
</li>
<li><a href="#the-spring-code-class-interface-taskscheduler-code-abstraction">The Spring <code class="interface">TaskScheduler</code> abstraction</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#the-code-class-interface-trigger-code-interface">The <code class="interface">Trigger</code> interface</a></li>
<li><a href="#code-class-interface-trigger-code-implementations"><code class="interface">Trigger</code> implementations</a></li>
<li><a href="#code-class-interface-taskscheduler-code-implementations"><code class="interface">TaskScheduler</code> implementations</a></li>
</ul>
</li>
<li><a href="#annotation-support-for-scheduling-and-asynchronous-execution">Annotation Support for Scheduling and Asynchronous Execution</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#enable-scheduling-annotations">Enable scheduling annotations</a></li>
<li><a href="#the-scheduled-annotation">The @Scheduled Annotation</a></li>
<li><a href="#the-async-annotation">The @Async Annotation</a></li>
<li><a href="#executor-qualification-with-async">Executor qualification with @Async</a></li>
</ul>
</li>
<li><a href="#the-task-namespace">The Task Namespace</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#the-em-scheduler-em-element">The <em>scheduler</em> element</a></li>
<li><a href="#the-em-executor-em-element">The <em>executor</em> element</a></li>
<li><a href="#the-em-scheduled-tasks-em-element">The <em>scheduled-tasks</em> element</a></li>
</ul>
</li>
<li><a href="#using-the-quartz-scheduler">Using the Quartz Scheduler</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#using-the-jobdetailbean">Using the JobDetailBean</a></li>
<li><a href="#using-the-code-class-class-methodinvokingjobdetailfactorybean-code">Using the <code class="class">MethodInvokingJobDetailFactoryBean</code></a></li>
<li><a href="#wiring-up-jobs-using-triggers-and-the-code-class-class-schedulerfactorybean-code">Wiring up jobs using triggers and the <code class="class">SchedulerFactoryBean</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#dynamic-language-support">Dynamic language support</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-14">Introduction</a></li>
<li><a href="#a-first-example">A first example</a></li>
<li><a href="#defining-beans-that-are-backed-by-dynamic-languages">Defining beans that are backed by dynamic languages</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#common-concepts">Common concepts</a></li>
<li><a href="#jruby-beans">JRuby beans</a></li>
<li><a href="#groovy-beans">Groovy beans</a></li>
<li><a href="#beanshell-beans">BeanShell beans</a></li>
</ul>
</li>
<li><a href="#scenarios">Scenarios</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#scripted-spring-mvc-controllers">Scripted Spring MVC Controllers</a></li>
<li><a href="#scripted-validators">Scripted Validators</a></li>
</ul>
</li>
<li><a href="#bits-and-bobs">Bits and bobs</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#aop-advising-scripted-beans">AOP - advising scripted beans</a></li>
<li><a href="#scoping">Scoping</a></li>
</ul>
</li>
<li><a href="#further-resources-4">Further Resources</a></li>
</ul>
</li>
<li><a href="#cache-abstraction">Cache Abstraction</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction-15">Introduction</a></li>
<li><a href="#understanding-the-cache-abstraction">Understanding the cache abstraction</a></li>
<li><a href="#declarative-annotation-based-caching">Declarative annotation-based caching</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#code-cacheable-code-annotation"><code>@Cacheable</code> annotation</a></li>
<li><a href="#code-cacheput-code-annotation"><code>@CachePut</code> annotation</a></li>
<li><a href="#code-cacheevict-code-annotation"><code>@CacheEvict</code> annotation</a></li>
<li><a href="#code-caching-code-annotation"><code>@Caching</code> annotation</a></li>
<li><a href="#enable-caching-annotations">Enable caching annotations</a></li>
<li><a href="#using-custom-annotations">Using custom annotations</a></li>
</ul>
</li>
<li><a href="#declarative-xml-based-caching">Declarative XML-based caching</a></li>
<li><a href="#configuring-the-cache-storage">Configuring the cache storage</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#jdk-code-class-interface-concurrentmap-code-based-code-class-interface-cache-code">JDK <code class="interface">ConcurrentMap</code>-based <code class="interface">Cache</code></a></li>
<li><a href="#ehcache-based-code-class-interface-cache-code">EhCache-based <code class="interface">Cache</code></a></li>
<li><a href="#gemfire-based-code-class-interface-cache-code">GemFire-based <code class="interface">Cache</code></a></li>
<li><a href="#dealing-with-caches-without-a-backing-store">Dealing with caches without a backing store</a></li>
</ul>
</li>
<li><a href="#plugging-in-different-back-end-caches">Plugging-in different back-end caches</a></li>
<li><a href="#how-can-i-set-the-ttl-tti-eviction-policy-xxx-feature">How can I set the TTL/TTI/Eviction policy/XXX feature?</a></li>
</ul>
</li>
<li><a href="#spring-appendices">Appendices</a></li>
<li><a href="#classic-spring-usage">Appendix A: Classic Spring Usage</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#classic-orm-usage">Classic ORM usage</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#hibernate-2">Hibernate</a></li>
<li><a href="#jdo-2">JDO</a></li>
<li><a href="#jpa-2">JPA</a></li>
</ul>
</li>
<li><a href="#classic-spring-mvc">Classic Spring MVC</a></li>
<li><a href="#jms-usage">JMS Usage</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#jmstemplate">JmsTemplate</a></li>
<li><a href="#asynchronous-message-reception">Asynchronous Message Reception</a></li>
<li><a href="#connections-2">Connections</a></li>
<li><a href="#transaction-management-6">Transaction Management</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#classic-spring-aop-usage">Appendix B: Classic Spring AOP Usage</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#pointcut-api-in-spring">Pointcut API in Spring</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#concepts-2">Concepts</a></li>
<li><a href="#operations-on-pointcuts">Operations on pointcuts</a></li>
<li><a href="#aspectj-expression-pointcuts">AspectJ expression pointcuts</a></li>
<li><a href="#convenience-pointcut-implementations">Convenience pointcut implementations</a></li>
<li><a href="#pointcut-superclasses">Pointcut superclasses</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#in-em-meta-inf-spring-handlers-em">in <em>META-INF/spring.handlers</em></a></li>
<li><a href="#in-em-meta-inf-spring-schemas-em">in <em>META-INF/spring.schemas</em></a></li>
<li><a href="#in-em-meta-inf-spring-handlers-em-2">in <em>META-INF/spring.handlers</em></a></li>
<li><a href="#in-em-meta-inf-spring-schemas-em-2">in <em>META-INF/spring.schemas</em></a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Spring Security is a powerful and highly customizable authentication and access-control framework. It is the de-facto standard for securing Spring-based applications.</p>
</div>
</div>
</div>
<h1 id="spring-introduction" class="sect0"><a class="anchor" href="#spring-introduction"></a>Overview of Spring Framework</h1>
<div class="paragraph">
<p>The Spring Framework is a lightweight solution and a potential one-stop-shop for building your enterprise-ready applications. However, Spring is modular, allowing you to use only those parts that you need, without having to bring in the rest. You can use the IoC container, with Struts on top, but you can also use only the <a href="#orm-hibernate">Hibernate integration code</a> or the <a href="#jdbc-introduction">JDBC abstraction layer</a>. The Spring Framework supports declarative transaction management, remote access to your logic through RMI or web services, and various options for persisting your data. It offers a full-featured <a href="#mvc-introduction">MVC framework</a>, and enables you to integrate <a href="#aop-introduction">AOP</a> transparently into your software.</p>
</div>
<div class="paragraph">
<p>Spring is designed to be non-intrusive, meaning that your domain logic code generally has no dependencies on the framework itself. In your integration layer (such as the data access layer), some dependencies on the data access technology and the Spring libraries will exist. However, it should be easy to isolate these dependencies from the rest of your code base.</p>
</div>
<div class="paragraph">
<p>This document is a reference guide to Spring Framework features. If you have any requests, comments, or questions on this document, please post them on the user mailing list or on the support forums at null[].</p>
</div>
<h1 id="introduction-to-spring-framework" class="sect0"><a class="anchor" href="#introduction-to-spring-framework"></a>Introduction to Spring Framework</h1>
<div class="paragraph">
<p>Spring Framework is a Java platform that provides comprehensive infrastructure support for developing Java applications.
Spring handles the infrastructure so you can focus on your application.</p>
</div>
<div class="paragraph">
<p>Spring enables you to build applications from &#8220;plain old Java objects&#8221; (POJOs) and to apply enterprise services non-invasively to POJOs.
This capability applies to the Java SE programming model and to full and partial Java EE.</p>
</div>
<div class="paragraph">
<p>Examples of how you, as an application developer, can use the Spring platform advantage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make a Java method execute in a database transaction without having to deal with transaction APIs.</p>
</li>
<li>
<p>Make a local Java method a remote procedure without having to deal with remote APIs.</p>
</li>
<li>
<p>Make a local Java method a management operation without having to deal with JMX APIs.</p>
</li>
<li>
<p>Make a local Java method a message handler without having to deal with JMS APIs.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="dependency-injection-and-inversion-of-control"><a class="anchor" href="#dependency-injection-and-inversion-of-control"></a>Dependency Injection and Inversion of Control</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">Background</div>
<div class="literalblock">
<div class="content">
<pre> Martin Fowler posed this question about Inversion of Control (IoC) on his site in 2004.
Fowler suggested renaming the principle to make it more self-explanatory and came up with .</pre>
</div>
</div>
<div class="paragraph">
<p>For insight into IoC and DI, refer to Fowler&#8217;s article at &lt;&lt;,http://martinfowler.com/articles/injection.html&gt;&gt;.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Java applications&#8201;&#8212;&#8201;a loose term that runs the gamut from constrained applets to n-tier server-side enterprise applications&#8201;&#8212;&#8201;typically consist of objects that collaborate to form the application proper.
Thus the objects in an application have <em>dependencies</em> on each other.</p>
</div>
<div class="paragraph">
<p>Although the Java platform provides a wealth of application development functionality, it lacks the means to organize the basic building blocks into a coherent whole, leaving that task to architects and developers.
True, you can use design patterns such as , , , , and  to compose the various classes and object instances that make up an application.
However, these patterns are simply that: best practices given a name, with a description of what the pattern does, where to apply it, the problems it addresses, and so forth.
Patterns are formalized best practices that <em>you must implement
    yourself</em> in your application.</p>
</div>
<div class="paragraph">
<p>The Spring Framework <em>Inversion of Control</em> (IoC) component addresses this concern by providing a formalized means of composing disparate components into a fully working application ready for use.
The Spring Framework codifies formalized design patterns as first-class objects that you can integrate into your own application(s).
Numerous organizations and institutions use the Spring Framework in this manner to engineer robust, <em>maintainable</em> applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modules"><a class="anchor" href="#modules"></a>Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Framework consists of features organized into about 20 modules.
These modules are grouped into Core Container, Data Access/Integration, Web, AOP (Aspect Oriented Programming), Instrumentation, and Test, as shown in the following diagram.</p>
</div>
<div class="sect2">
<h3 id="core-container"><a class="anchor" href="#core-container"></a>Core Container</h3>
<div class="paragraph">
<p>The <a href="#beans-introduction"><em>Core
      Container</em></a> consists of the Core, Beans, Context, and Expression Language modules.</p>
</div>
<div class="paragraph">
<p>The <a href="#beans-introduction"><em>Core and
      Beans</em></a> modules provide the fundamental parts of the framework, including the IoC and Dependency Injection features.
The <code class="class">BeanFactory</code> is a sophisticated implementation of the factory pattern.
It removes the need for programmatic singletons and allows you to decouple the configuration and specification of dependencies from your actual program logic.</p>
</div>
<div class="paragraph">
<p>The <a href="#context-introduction"><em>Context</em></a> module builds on the solid base provided by the <a href="#beans-introduction"><em>Core and Beans</em></a> modules: it is a means to access objects in a framework-style manner that is similar to a JNDI registry.
The Context module inherits its features from the Beans module and adds support for internationalization (using, for example, resource bundles), event-propagation, resource-loading, and the transparent creation of contexts by, for example, a servlet container.
The Context module also supports Java EE features such as EJB, JMX ,and basic remoting.
The <code class="class">ApplicationContext</code> interface is the focal point of the Context module.</p>
</div>
<div class="paragraph">
<p>The <a href="#expressions"><em>Expression
      Language</em></a> module provides a powerful expression language for querying and manipulating an object graph at runtime.
It is an extension of the unified expression language (unified EL) as specified in the JSP 2.1 specification.
The language supports setting and getting property values, property assignment, method invocation, accessing the context of arrays, collections and indexers, logical and arithmetic operators, named variables, and retrieval of objects by name from Spring&#8217;s IoC container.
It also supports list projection and selection as well as common list aggregations.</p>
</div>
</div>
<div class="sect2">
<h3 id="data-access-integration"><a class="anchor" href="#data-access-integration"></a>Data Access/Integration</h3>
<div class="paragraph">
<p>The <em>Data Access/Integration</em> layer consists of the JDBC, ORM, OXM, JMS and Transaction modules.</p>
</div>
<div class="paragraph">
<p>The <a href="#jdbc-introduction">JDBC</a> module provides a JDBC-abstraction layer that removes the need to do tedious JDBC coding and parsing of database-vendor specific error codes.</p>
</div>
<div class="paragraph">
<p>The <a href="#orm-introduction"><em>ORM</em></a> module provides integration layers for popular object-relational mapping APIs, including <a href="#orm-jpa">JPA</a>, <a href="#orm-jdo">JDO</a>, <a href="#orm-hibernate">Hibernate</a>, and <a href="#orm-ibatis">iBatis</a>.
Using the ORM package you can use all of these O/R-mapping frameworks in combination with all of the other features Spring offers, such as the simple declarative transaction management feature mentioned previously.</p>
</div>
<div class="paragraph">
<p>The <a href="#oxm">OXM</a> module provides an abstraction layer that supports Object/XML mapping implementations for JAXB, Castor, XMLBeans, JiBX and XStream.</p>
</div>
<div class="paragraph">
<p>The Java Messaging Service (<a href="#jms">JMS</a>) module contains features for producing and consuming messages.</p>
</div>
<div class="paragraph">
<p>The <a href="#transaction">Transaction</a> module supports programmatic and declarative transaction management for classes that implement special interfaces and for <em>all your POJOs (plain old
      Java objects)</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="web"><a class="anchor" href="#web"></a>Web</h3>
<div class="paragraph">
<p>The <em>Web</em> layer consists of the Web, Web-Servlet, Web-Struts, and Web-Portlet modules.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s <em>Web</em> module provides basic web-oriented integration features such as multipart file-upload functionality and the initialization of the IoC container using servlet listeners and a web-oriented application context.
It also contains the web-related parts of Spring&#8217;s remoting support.</p>
</div>
<div class="paragraph">
<p>The <em>Web-Servlet</em> module contains Spring&#8217;s model-view-controller (<a href="#mvc-introduction"><em>MVC</em></a>) implementation for web applications.
Spring&#8217;s MVC framework provides a clean separation between domain model code and web forms, and integrates with all the other features of the Spring Framework.</p>
</div>
<div class="paragraph">
<p>The <em>Web-Struts</em> module contains the support classes for integrating a classic Struts web tier within a Spring application.
Note that this support is now deprecated as of Spring 3.0.
Consider migrating your application to Struts 2.0 and its Spring integration or to a Spring MVC solution.</p>
</div>
<div class="paragraph">
<p>The <em>Web-Portlet</em> module provides the MVC implementation to be used in a portlet environment and mirrors the functionality of Web-Servlet module.</p>
</div>
</div>
<div class="sect2">
<h3 id="aop-and-instrumentation"><a class="anchor" href="#aop-and-instrumentation"></a>AOP and Instrumentation</h3>
<div class="paragraph">
<p>Spring&#8217;s <a href="#aop-introduction"><em>AOP</em></a> module provides an <em>AOP Alliance</em>-compliant aspect-oriented programming implementation allowing you to define, for example, method-interceptors and pointcuts to cleanly decouple code that implements functionality that should be separated.
Using source-level metadata functionality, you can also incorporate behavioral information into your code, in a manner similar to that of .NET attributes.</p>
</div>
<div class="paragraph">
<p>The separate <em>Aspects</em> module provides integration with AspectJ.</p>
</div>
<div class="paragraph">
<p>The <em>Instrumentation</em> module provides class instrumentation support and classloader implementations to be used in certain application servers.</p>
</div>
</div>
<div class="sect2">
<h3 id="test"><a class="anchor" href="#test"></a>Test</h3>
<div class="paragraph">
<p>The <em>Test</em> module supports the testing of Spring components with JUnit or TestNG. It provides consistent loading of Spring ApplicationContexts and caching of those contexts.
It also provides mock objects that you can use to test your code in isolation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage-scenarios"><a class="anchor" href="#usage-scenarios"></a>Usage scenarios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The building blocks described previously make Spring a logical choice in many scenarios, from applets to full-fledged enterprise applications that use Spring&#8217;s transaction management functionality and web framework integration.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s <a href="#transaction-declarative">declarative
    transaction management features</a> make the web application fully transactional, just as it would be if you used EJB container-managed transactions.
All your custom business logic can be implemented with simple POJOs and managed by Spring&#8217;s IoC container.
Additional services include support for sending email and validation that is independent of the web layer, which lets you choose where to execute validation rules.
Spring&#8217;s ORM support is integrated with JPA, Hibernate, JDO and iBatis; for example, when using Hibernate, you can continue to use your existing mapping files and standard Hibernate <code class="interface">SessionFactory</code> configuration.
Form controllers seamlessly integrate the web-layer with the domain model, removing the need for <code class="class">ActionForms</code> or other classes that transform HTTP parameters to values for your domain model.</p>
</div>
<div class="paragraph">
<p>Sometimes circumstances do not allow you to completely switch to a different framework.
The Spring Framework does <em>not</em> force you to use everything within it; it is not an <em>all-or-nothing</em> solution.
Existing front-ends built with WebWork, Struts, Tapestry, or other UI frameworks can be integrated with a Spring-based middle-tier, which allows you to use Spring transaction features.
You simply need to wire up your business logic using an <code class="class">ApplicationContext</code> and use a [class]`WebApplicationContext `to integrate your web layer.</p>
</div>
<div class="paragraph">
<p>When you need to access existing code through web services, you can use Spring&#8217;s <code>Hessian-</code>, <code>Burlap-</code>, <code>Rmi-</code> or <code class="class">JaxRpcProxyFactory</code> classes.
Enabling remote access to existing applications is not difficult.</p>
</div>
<div class="paragraph">
<p>The Spring Framework also provides an <a href="#ejb">access and
    abstraction layer</a> for Enterprise JavaBeans, enabling you to reuse your existing POJOs and wrap them in stateless session beans for use in scalable, fail-safe web applications that might need declarative security.</p>
</div>
<div class="sect2">
<h3 id="dependency-management-and-naming-conventions"><a class="anchor" href="#dependency-management-and-naming-conventions"></a>Dependency Management and Naming Conventions</h3>
<div class="paragraph">
<p>Dependency management and dependency injection are different things.
To get those nice features of Spring into your application (like dependency injection) you need to assemble all the libraries needed (jar files) and get them onto your classpath at runtime, and possibly at compile time.
These dependencies are not virtual components that are injected, but physical resources in a file system (typically).
The process of dependency management involves locating those resources, storing them and adding them to classpaths.
Dependencies can be direct (e.g.
my application depends on Spring at runtime), or indirect (e.g.
my application depends on <code>commons-dbcp</code> which depends on <code>commons-pool</code>).
The indirect dependencies are also known as "transitive" and it is those dependencies that are hardest to identify and manage.</p>
</div>
<div class="paragraph">
<p>If you are going to use Spring you need to get a copy of the jar libraries that comprise the pieces of Spring that you need.
To make this easier Spring is packaged as a set of modules that separate the dependencies as much as possible, so for example if you don&#8217;t want to write a web application you don&#8217;t need the spring-web modules.
To refer to Spring library modules in this guide we use a shorthand naming convention <code>spring-*</code> or <code>spring-*.jar,</code> where "*" represents the short name for the module (e.g.
<code>spring-core</code>, <code>spring-webmvc</code>, <code>spring-jms</code>, etc.).
The actual jar file name that you use may be in this form (see below) or it may not, and normally it also has a version number in the file name (e.g.
<code>spring-core-3.0.0.RELEASE.jar</code>).</p>
</div>
<div class="paragraph">
<p>In general, Spring publishes its artifacts to four different places:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On the community download site &lt;&lt;,http://www.springsource.org/download/community&gt;&gt;.
Here you find all the Spring jars bundled together into a zip file for easy download.
The names of the jars here since version 3.0 are in the form <code>org.springframework.*-&lt;version&gt;.jar</code>.</p>
</li>
<li>
<p>Maven Central, which is the default repository that Maven queries, and does not require any special configuration to use.
Many of the common libraries that Spring depends on also are available from Maven Central and a large section of the Spring community uses Maven for dependency management, so this is convenient for them.
The names of the jars here are in the form <code>spring-*-&lt;version&gt;.jar</code> and the Maven groupId is <code>org.springframework</code>.</p>
</li>
<li>
<p>The Enterprise Bundle Repository (EBR), which is run by SpringSource and also hosts all the libraries that integrate with Spring.
Both Maven and Ivy repositories are available here for all Spring jars and their dependencies, plus a large number of other common libraries that people use in applications with Spring.
Both full releases and also milestones and development snapshots are deployed here.
The names of the jar files are in the same form as the community download (<code>org.springframework.*-&lt;version&gt;.jar</code>), and the dependencies are also in this "long" form, with external libraries (not from SpringSource) having the prefix <code>com.springsource</code>.
See the &lt;&lt;,FAQ&gt;&gt; for more information.</p>
</li>
<li>
<p>In a public Maven repository hosted on Amazon S3 for development snapshots and milestone releases (a copy of the final releases is also held here).
The jar file names are in the same form as Maven Central, so this is a useful place to get development versions of Spring to use with other libraries deployed in Maven Central.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So the first thing you need to decide is how to manage your dependencies: most people use an automated system like Maven or Ivy, but you can also do it manually by downloading all the jars yourself.
When obtaining Spring with Maven or Ivy you have then to decide which place you&#8217;ll get it from.
In general, if you care about OSGi, use the EBR, since it houses OSGi compatible artifacts for all of Spring&#8217;s dependencies, such as Hibernate and Freemarker.
If OSGi does not matter to you, either place works, though there are some pros and cons between them.
In general, pick one place or the other for your project; do not mix them.
This is particularly important since EBR artifacts necessarily use a different naming convention than Maven Central artifacts.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 1. Comparison of Maven Central and SpringSource EBR Repositories</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Maven Central</th>
<th class="tableblock halign-left valign-top">EBR</th>
</tr>
</thead>
</table>

<div class="sect3">
<h4 id="spring-dependencies-and-depending-on-spring"><a class="anchor" href="#spring-dependencies-and-depending-on-spring"></a>Spring Dependencies and Depending on Spring</h4>
<div class="paragraph">
<p>Although Spring provides integration and support for a huge range of enterprise and other external tools, it intentionally keeps its mandatory dependencies to an absolute minimum: you shouldn&#8217;t have to locate and download (even automatically) a large number of jar libraries in order to use Spring for simple use cases.
For basic dependency injection there is only one mandatory external dependency, and that is for logging (see below for a more detailed description of logging options).</p>
</div>
<div class="paragraph">
<p>Next we outline the basic steps needed to configure an application that depends on Spring, first with Maven and then with Ivy.
In all cases, if anything is unclear, refer to the documentation of your dependency management system, or look at some sample code - Spring itself uses Ivy to manage dependencies when it is building, and our samples mostly use Maven.</p>
</div>
</div>
<div class="sect3">
<h4 id="maven-dependency-management"><a class="anchor" href="#maven-dependency-management"></a>Maven Dependency Management</h4>
<div class="paragraph">
<p>If you are using Maven for dependency management you don&#8217;t even need to supply the logging dependency explicitly.
For example, to create an application context and use dependency injection to configure an application, your Maven dependencies will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it.
Note the scope can be declared as runtime if you don&#8217;t need to compile against Spring APIs, which is typically the case for basic dependency injection use cases.</p>
</div>
<div class="paragraph">
<p>We used the Maven Central naming conventions in the example above, so that works with Maven Central or the SpringSource S3 Maven repository.
To use the S3 Maven repository (e.g.
for milestones or developer snapshots), you need to specify the repository location in your Maven configuration.
For full releases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;com.springsource.repository.maven.release&lt;/id&gt;
      &lt;url&gt;http://repo.springsource.org/release/&lt;/url&gt;
      &lt;snapshots&gt;&lt;enabled&gt;false&lt;/enabled&gt;&lt;/snapshots&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For milestones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;com.springsource.repository.maven.milestone&lt;/id&gt;
      &lt;url&gt;http://repo.springsource.org/milestone/&lt;/url&gt;
      &lt;snapshots&gt;&lt;enabled&gt;false&lt;/enabled&gt;&lt;/snapshots&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And for snapshots:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;com.springsource.repository.maven.snapshot&lt;/id&gt;
      &lt;url&gt;http://repo.springsource.org/snapshot/&lt;/url&gt;
      &lt;snapshots&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/snapshots&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the SpringSource EBR you would need to use a different naming convention for the dependencies.
The names are usually easy to guess, e.g.
in this case it is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;org.springframework.context&lt;/artifactId&gt;
      &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You also need to declare the location of the repository explicitly (only the URL is important):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;com.springsource.repository.bundles.release&lt;/id&gt;
      &lt;url&gt;http://repository.springsource.com/maven/bundles/release/&lt;/url&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are managing your dependencies by hand, the URL in the repository declaration above is not browsable, but there is a user interface at &lt;&lt;,http://www.springsource.com/repository&gt;&gt; that can be used to search for and download dependencies.
It also has handy snippets of Maven and Ivy configuration that you can copy and paste if you are using those tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="ivy-dependency-management"><a class="anchor" href="#ivy-dependency-management"></a>Ivy Dependency Management</h4>
<div class="paragraph">
<p>If you prefer to use &lt;&lt;,Ivy&gt;&gt; to manage dependencies then there are similar names and configuration options.</p>
</div>
<div class="paragraph">
<p>To configure Ivy to point to the SpringSource EBR add the following resolvers to your <code class="file">ivysettings.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;resolvers&gt;

  &lt;url name="com.springsource.repository.bundles.release"&gt;

    &lt;ivy pattern="http://repository.springsource.com/ivy/bundles/release/
      [organisation]/[module]/[revision]/[artifact]-[revision].[ext]" /&gt;
    &lt;artifact pattern="http://repository.springsource.com/ivy/bundles/release/
      [organisation]/[module]/[revision]/[artifact]-[revision].[ext]" /&gt;

  &lt;/url&gt;

  &lt;url name="com.springsource.repository.bundles.external"&gt;

    &lt;ivy pattern="http://repository.springsource.com/ivy/bundles/external/
       [organisation]/[module]/[revision]/[artifact]-[revision].[ext]" /&gt;
    &lt;artifact pattern="http://repository.springsource.com/ivy/bundles/external/
       [organisation]/[module]/[revision]/[artifact]-[revision].[ext]" /&gt;

  &lt;/url&gt;

&lt;/resolvers&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML above is not valid because the lines are too long - if you copy-paste then remove the extra line endings in the middle of the url patterns.</p>
</div>
<div class="paragraph">
<p>Once Ivy is configured to look in the EBR adding a dependency is easy.
Simply pull up the details page for the bundle in question in the repository browser and you&#8217;ll find an Ivy snippet ready for you to include in your dependencies section.
For example (in <code class="file">ivy.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;dependency org="org.springframework"
      name="org.springframework.core" rev="3.0.0.RELEASE" conf="compile-&gt;runtime"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging"><a class="anchor" href="#logging"></a>Logging</h3>
<div class="paragraph">
<p>Logging is a very important dependency for Spring because a) it is the only mandatory external dependency, b) everyone likes to see some output from the tools they are using, and c) Spring integrates with lots of other tools all of which have also made a choice of logging dependency.
One of the goals of an application developer is often to have unified logging configured in a central place for the whole application, including all external components.
This is more difficult than it might have been since there are so many choices of logging framework.</p>
</div>
<div class="paragraph">
<p>The mandatory logging dependency in Spring is the Jakarta Commons Logging API (JCL).
We compile against JCL and we also make JCL <code class="class">Log</code> objects visible for classes that extend the Spring Framework.
It&#8217;s important to users that all versions of Spring use the same logging library: migration is easy because backwards compatibility is preserved even with applications that extend Spring.
The way we do this is to make one of the modules in Spring depend explicitly on <code>commons-logging</code> (the canonical implementation of JCL), and then make all the other modules depend on that at compile time.
If you are using Maven for example, and wondering where you picked up the dependency on <code>commons-logging</code>, then it is from Spring and specifically from the central module called <code>spring-core</code>.</p>
</div>
<div class="paragraph">
<p>The nice thing about <code>commons-logging</code> is that you don&#8217;t need anything else to make your application work.
It has a runtime discovery algorithm that looks for other logging frameworks in well known places on the classpath and uses one that it thinks is appropriate (or you can tell it which one if you need to).
If nothing else is available you get pretty nice looking logs just from the JDK (java.util.logging or JUL for short).
You should find that your Spring application works and logs happily to the console out of the box in most situations, and that&#8217;s important.</p>
</div>
<div class="sect3">
<h4 id="not-using-commons-logging"><a class="anchor" href="#not-using-commons-logging"></a>Not Using Commons Logging</h4>
<div class="paragraph">
<p>Unfortunately, the runtime discovery algorithm in <code>commons-logging</code>, while convenient for the end-user, is problematic.
If we could turn back the clock and start Spring now as a new project it would use a different logging dependency.
The first choice would probably be the Simple Logging Facade for Java (&lt;&lt;,SLF4J&gt;&gt;), which is also used by a lot of other tools that people use with Spring inside their applications.</p>
</div>
<div class="paragraph">
<p>Switching off <code>commons-logging</code> is easy: just make sure it isn&#8217;t on the classpath at runtime.
In Maven terms you exclude the dependency, and because of the way that the Spring dependencies are declared, you only have to do that once.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
      &lt;exclusions&gt;
         &lt;exclusion&gt;
            &lt;groupId&gt;commons-logging&lt;/groupId&gt;
            &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
         &lt;/exclusion&gt;
      &lt;/exclusions&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now this application is probably broken because there is no implementation of the JCL API on the classpath, so to fix it a new one has to be provided.
In the next section we show you how to provide an alternative implementation of JCL using SLF4J as an example.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-slf4j"><a class="anchor" href="#using-slf4j"></a>Using SLF4J</h4>
<div class="paragraph">
<p>SLF4J is a cleaner dependency and more efficient at runtime than <code>commons-logging</code> because it uses compile-time bindings instead of runtime discovery of the other logging frameworks it integrates.
This also means that you have to be more explicit about what you want to happen at runtime, and declare it or configure it accordingly.
SLF4J provides bindings to many common logging frameworks, so you can usually choose one that you already use, and bind to that for configuration and management.</p>
</div>
<div class="paragraph">
<p>SLF4J provides bindings to many common logging frameworks, including JCL, and it also does the reverse: bridges between other logging frameworks and itself.
So to use SLF4J with Spring you need to replace the <code>commons-logging</code> dependency with the SLF4J-JCL bridge.
Once you have done that then logging calls from within Spring will be translated into logging calls to the SLF4J API, so if other libraries in your application use that API, then you have a single place to configure and manage logging.</p>
</div>
<div class="paragraph">
<p>A common choice might be to bridge Spring to SLF4J, and then provide explicit binding from SLF4J to Log4J. You need to supply 4 dependencies (and exclude the existing <code>commons-logging</code>): the bridge, the SLF4J API, the binding to Log4J, and the Log4J implementation itself.
In Maven you would do that like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;dependencies&gt;
       &lt;dependency&gt;
          &lt;groupId&gt;org.springframework&lt;/groupId&gt;
          &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
          &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
          &lt;scope&gt;runtime&lt;/scope&gt;
          &lt;exclusions&gt;
             &lt;exclusion&gt;
                &lt;groupId&gt;commons-logging&lt;/groupId&gt;
                &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
             &lt;/exclusion&gt;
          &lt;/exclusions&gt;
       &lt;/dependency&gt;
       &lt;dependency&gt;
          &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
          &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt;
          &lt;version&gt;1.5.8&lt;/version&gt;
          &lt;scope&gt;runtime&lt;/scope&gt;
       &lt;/dependency&gt;
       &lt;dependency&gt;
          &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
          &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
          &lt;version&gt;1.5.8&lt;/version&gt;
          &lt;scope&gt;runtime&lt;/scope&gt;
       &lt;/dependency&gt;
       &lt;dependency&gt;
          &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
          &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
          &lt;version&gt;1.5.8&lt;/version&gt;
          &lt;scope&gt;runtime&lt;/scope&gt;
       &lt;/dependency&gt;
       &lt;dependency&gt;
          &lt;groupId&gt;log4j&lt;/groupId&gt;
          &lt;artifactId&gt;log4j&lt;/artifactId&gt;
          &lt;version&gt;1.2.14&lt;/version&gt;
          &lt;scope&gt;runtime&lt;/scope&gt;
       &lt;/dependency&gt;
    &lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>That might seem like a lot of dependencies just to get some logging.
Well it is, but it <em>is</em> optional, and it should behave better than the vanilla <code>commons-logging</code> with respect to classloader issues, notably if you are in a strict container like an OSGi platform.
Allegedly there is also a performance benefit because the bindings are at compile-time not runtime.</p>
</div>
<div class="paragraph">
<p>A more common choice amongst SLF4J users, which uses fewer steps and generates fewer dependencies, is to bind directly to &lt;&lt;,Logback&gt;&gt;.
This removes the extra binding step because Logback implements SLF4J directly, so you only need to depend on two libraries not four (<code>jcl-over-slf4j</code> and <code>logback</code>).
If you do that you might also need to exclude the slf4j-api dependency from other external dependencies (not Spring), because you only want one version of that API on the classpath.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-log4j"><a class="anchor" href="#using-log4j"></a>Using Log4J</h4>
<div class="paragraph">
<p>Many people use &lt;&lt;,Log4j&gt;&gt; as a logging framework for configuration and management purposes.
It&#8217;s efficient and well-established, and in fact it&#8217;s what we use at runtime when we build and test Spring.
Spring also provides some utilities for configuring and initializing Log4j, so it has an optional compile-time dependency on Log4j in some modules.</p>
</div>
<div class="paragraph">
<p>To make Log4j work with the default JCL dependency (<code>commons-logging</code>) all you need to do is put Log4j on the classpath, and provide it with a configuration file (<code>log4j.properties</code> or <code>log4j.xml</code> in the root of the classpath).
So for Maven users this is your dependency declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;log4j&lt;/groupId&gt;
      &lt;artifactId&gt;log4j&lt;/artifactId&gt;
      &lt;version&gt;1.2.14&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here&#8217;s a sample log4j.properties for logging to the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>log4j.rootCategory=INFO, stdout

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d{ABSOLUTE} %5p %t %c{2}:%L - %m%n

log4j.category.org.springframework.beans.factory=DEBUG</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="runtime-containers-with-native-jcl"><a class="anchor" href="#runtime-containers-with-native-jcl"></a>Runtime Containers with Native JCL</h5>
<div class="paragraph">
<p>Many people run their Spring applications in a container that itself provides an implementation of JCL. IBM Websphere Application Server (WAS) is the archetype.
This often causes problems, and unfortunately there is no silver bullet solution; simply excluding <code>commons-logging</code> from your application is not enough in most situations.</p>
</div>
<div class="paragraph">
<p>To be clear about this: the problems reported are usually not with JCL per se, or even with <code>commons-logging</code>: rather they are to do with binding <code>commons-logging</code> to another framework (often Log4J).
This can fail because <code>commons-logging</code> changed the way they do the runtime discovery in between the older versions (1.0) found in some containers and the modern versions that most people use now (1.1).
Spring does not use any unusual parts of the JCL API, so nothing breaks there, but as soon as Spring or your application tries to do any logging you can find that the bindings to Log4J are not working.</p>
</div>
<div class="paragraph">
<p>In such cases with WAS the easiest thing to do is to invert the class loader hierarchy (IBM calls it "parent last") so that the application controls the JCL dependency, not the container.
That option isn&#8217;t always open, but there are plenty of other suggestions in the public domain for alternative approaches, and your mileage may vary depending on the exact version and feature set of the container.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="spring-whats-new" class="sect0"><a class="anchor" href="#spring-whats-new"></a>What&#8217;s New in Spring 3</h1>

<h1 id="new-features-and-enhancements-in-spring-framework-3-0" class="sect0"><a class="anchor" href="#new-features-and-enhancements-in-spring-framework-3-0"></a>New Features and Enhancements in Spring Framework 3.0</h1>
<div class="paragraph">
<p>If you have been using the Spring Framework for some time, you will be aware that Spring has undergone two major revisions: Spring 2.0, released in October 2006, and Spring 2.5, released in November 2007.
It is now time for a third overhaul resulting in Spring Framework 3.0.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Java SE and Java EE Support</div>
<div class="paragraph">
<p>The Spring Framework is now based on Java 5, and Java 6 is fully supported.</p>
</div>
<div class="paragraph">
<p>Furthermore, Spring is compatible with J2EE 1.4 and Java EE 5, while at the same time introducing some early support for Java EE 6.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-5"><a class="anchor" href="#java-5"></a>Java 5</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The entire framework code has been revised to take advantage of Java 5 features like generics, varargs and other language improvements.
We have done our best to still keep the code backwards compatible.
We now have consistent use of generic Collections and Maps, consistent use of generic FactoryBeans, and also consistent resolution of bridge methods in the Spring AOP API. Generic ApplicationListeners automatically receive specific event types only.
All callback interfaces such as TransactionCallback and HibernateCallback declare a generic result value now.
Overall, the Spring core codebase is now freshly revised and optimized for Java 5.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s TaskExecutor abstraction has been updated for close integration with Java 5&#8217;s java.util.concurrent facilities.
We provide first-class support for Callables and Futures now, as well as ExecutorService adapters, ThreadFactory integration, etc.
This has been aligned with JSR-236 (Concurrency Utilities for Java EE 6) as far as possible.
Furthermore, we provide support for asynchronous method invocations through the use of the new @Async annotation (or EJB 3.1&#8217;s @Asynchronous annotation).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="improved-documentation"><a class="anchor" href="#improved-documentation"></a>Improved documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring reference documentation has also substantially been updated to reflect all of the changes and new features for Spring Framework 3.0.
While every effort has been made to ensure that there are no errors in this documentation, some errors may nevertheless have crept in.
If you do spot any typos or even more serious errors, and you can spare a few cycles during lunch, please do bring the error to the attention of the Spring team by &lt;&lt;,raising an
    issue&gt;&gt;.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-articles-and-tutorials"><a class="anchor" href="#new-articles-and-tutorials"></a>New articles and tutorials</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> There are many excellent articles and tutorials that show how to get started with Spring Framework 3 features.
Read them at the &lt;&lt;,Spring Documentation&gt;&gt; page.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The samples have been improved and updated to take advantage of the new features in Spring Framework 3.
Additionally, the samples have been moved out of the source tree into a dedicated SVN &lt;&lt;,repository&gt;&gt; available at:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`https://anonsvn.springframework.org/svn/spring-samples/`</pre>
</div>
</div>
<div class="paragraph">
<p>As such, the samples are no longer distributed alongside Spring Framework 3 and need to be downloaded separately from the repository mentioned above.
However, this documentation will continue to refer to some samples (in particular Petclinic) to illustrate various features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
For more information on Subversion (or in short SVN), see the project homepage at: <code>http://subversion.apache.org/</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-module-organization-and-build-system"><a class="anchor" href="#new-module-organization-and-build-system"></a>New module organization and build system</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The framework modules have been revised and are now managed separately with one source-tree per module jar:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>org.springframework.aop</p>
</li>
<li>
<p>org.springframework.beans</p>
</li>
<li>
<p>org.springframework.context</p>
</li>
<li>
<p>org.springframework.context.support</p>
</li>
<li>
<p>org.springframework.expression</p>
</li>
<li>
<p>org.springframework.instrument</p>
</li>
<li>
<p>org.springframework.jdbc</p>
</li>
<li>
<p>org.springframework.jms</p>
</li>
<li>
<p>org.springframework.orm</p>
</li>
<li>
<p>org.springframework.oxm</p>
</li>
<li>
<p>org.springframework.test</p>
</li>
<li>
<p>org.springframework.transaction</p>
</li>
<li>
<p>org.springframework.web</p>
</li>
<li>
<p>org.springframework.web.portlet</p>
</li>
<li>
<p>org.springframework.web.servlet</p>
</li>
<li>
<p>org.springframework.web.struts</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Note:</div>
<p>[sidebar]The spring.jar artifact that contained almost the entire framework is no longer provided.</p>
</div>
<div class="paragraph">
<p>We are now using a new Spring build system as known from Spring Web Flow 2.0.
This gives us:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ivy-based "Spring Build" system</p>
</li>
<li>
<p>consistent deployment procedure</p>
</li>
<li>
<p>consistent dependency management</p>
</li>
<li>
<p>consistent generation of OSGi manifests</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview-of-new-features"><a class="anchor" href="#overview-of-new-features"></a>Overview of new features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a list of new features for Spring Framework 3.0.
We will cover these features in more detail later in this section.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Expression Language</p>
</li>
<li>
<p>IoC enhancements/Java based bean metadata</p>
</li>
<li>
<p>General-purpose type conversion system and field formatting system</p>
</li>
<li>
<p>Object to XML mapping functionality (OXM) moved from Spring Web Services project</p>
</li>
<li>
<p>Comprehensive REST support</p>
</li>
<li>
<p>@MVC additions</p>
</li>
<li>
<p>Declarative model validation</p>
</li>
<li>
<p>Early support for Java EE 6</p>
</li>
<li>
<p>Embedded database support</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="core-apis-updated-for-java-5"><a class="anchor" href="#core-apis-updated-for-java-5"></a>Core APIs updated for Java 5</h3>
<div class="paragraph">
<p>BeanFactory interface returns typed bean instances as far as possible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>T getBean(Class&lt;T&gt; requiredType)</p>
</li>
<li>
<p>T getBean(String name, Class&lt;T&gt; requiredType)</p>
</li>
<li>
<p>Map&lt;String, T&gt; getBeansOfType(Class&lt;T&gt; type)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring&#8217;s TaskExecutor interface now extends <code class="class">java.util.concurrent.Executor</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>extended AsyncTaskExecutor supports standard Callables with Futures</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>New Java 5 based converter API and SPI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>stateless ConversionService and Converters</p>
</li>
<li>
<p>superseding standard JDK PropertyEditors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Typed ApplicationListener&lt;E&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-expression-language"><a class="anchor" href="#spring-expression-language"></a>Spring Expression Language</h3>
<div class="paragraph">
<p>Spring introduces an expression language which is similar to Unified EL in its syntax but offers significantly more features.
The expression language can be used when defining XML and Annotation based bean definitions and also serves as the foundation for expression language support across the Spring portfolio.
Details of this new functionality can be found in the chapter <a href="#expressions">Spring Expression Language (SpEL).</a></p>
</div>
<div class="paragraph">
<p>The Spring Expression Language was created to provide the Spring community a single, well supported expression language that can be used across all the products in the Spring portfolio.
Its language features are driven by the requirements of the projects in the Spring portfolio, including tooling requirements for code completion support within the Eclipse based &lt;&lt;,SpringSource
      Tool Suite&gt;&gt;.</p>
</div>
<div class="paragraph">
<p>The following is an example of how the Expression Language can be used to configure some properties of a database setup</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="mycompany.RewardsTestDatabase"&gt;
    &lt;property name="databaseName"
        value="#{systemProperties.databaseName}"/&gt;
    &lt;property name="keyGenerator"
        value="#{strategyBean.databaseKeyGenerator}"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This functionality is also available if you prefer to configure your components using annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Repository
public class RewardsTestDatabase {

    @Value("#{systemProperties.databaseName}")
    public void setDatabaseName(String dbName) {  }

    @Value("#{strategyBean.databaseKeyGenerator}")
    public void setKeyGenerator(KeyGenerator kg) {  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-inversion-of-control-ioc-container"><a class="anchor" href="#the-inversion-of-control-ioc-container"></a>The Inversion of Control (IoC) container</h3>
<div class="sect3">
<h4 id="java-based-bean-metadata"><a class="anchor" href="#java-based-bean-metadata"></a>Java based bean metadata</h4>
<div class="paragraph">
<p>Some core features from the &lt;&lt;,JavaConfig&gt;&gt; project have been added to the Spring Framework now.
This means that the following annotations are now directly supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@Configuration</p>
</li>
<li>
<p>@Bean</p>
</li>
<li>
<p>@DependsOn</p>
</li>
<li>
<p>@Primary</p>
</li>
<li>
<p>@Lazy</p>
</li>
<li>
<p>@Import</p>
</li>
<li>
<p>@ImportResource</p>
</li>
<li>
<p>@Value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of a Java class providing basic configuration using the new JavaConfig features:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.example.config;

@Configuration
public class AppConfig {
    private @Value("#{jdbcProperties.url}") String jdbcUrl;
    private @Value("#{jdbcProperties.username}") String username;
    private @Value("#{jdbcProperties.password}") String password;

    @Bean
    public FooService fooService() {
        return new FooServiceImpl(fooRepository());
    }

    @Bean
    public FooRepository fooRepository() {
        return new HibernateFooRepository(sessionFactory());
    }

    @Bean
    public SessionFactory sessionFactory() {
        // wire up a session factory
        AnnotationSessionFactoryBean asFactoryBean =
            new AnnotationSessionFactoryBean();
        asFactoryBean.setDataSource(dataSource());
        // additional config
        return asFactoryBean.getObject();
    }

    @Bean
    public DataSource dataSource() {
        return new DriverManagerDataSource(jdbcUrl, username, password);
    }
}
---- To get this to work you need to add the following component scanning entry in your minimal application context XML file.

[source,xml]</code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;context:component-scan base-package="org.example.config"/&gt;
&lt;util:properties id="jdbcProperties" location="classpath:org/example/config/jdbc.properties"/&gt;
---- Or you can bootstrap a <code>@Configuration</code> class directly using <code>AnnotationConfigApplicationContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public static void main(String[] args) {
    ApplicationContext ctx = new AnnotationConfigApplicationContext(AppConfig.class);
    FooService fooService = ctx.getBean(FooService.class);
    fooService.doStuff();
}
---- See &lt;&lt;beans-java-instantiating-container&gt;&gt; for full information on `AnnotationConfigApplicationContext`.

==== Defining bean metadata within components

`@Bean` annotated methods are also supported inside Spring components.
They contribute a factory bean definition to the container.
See &lt;&lt;beans-factorybeans-annotations,Defining bean metadata within
        components&gt;&gt; for more information

=== General purpose type conversion system and field formatting system

A general purpose &lt;&lt;core-convert,type conversion
      system&gt;&gt; has been introduced.
The system is currently used by SpEL for type conversion, and may also be used by a Spring Container and DataBinder when binding bean property values.

In addition, a &lt;&lt;format,formatter&gt;&gt; SPI has been introduced for formatting field values.
This SPI provides a simpler and more robust alternative to JavaBean PropertyEditors for use in client environments such as Spring MVC.

=== The Data Tier

Object to XML mapping functionality (OXM) from the Spring Web Services project has been moved to the core Spring Framework now.
The functionality is found in the `org.springframework.oxm` package.
More information on the use of the `OXM` module can be found in the &lt;&lt;oxm,Marshalling XML using O/X
      Mappers&gt;&gt; chapter.

=== The Web Tier

The most exciting new feature for the Web Tier is the support for building RESTful web services and web applications.
There are also some new annotations that can be used in any web application.

==== Comprehensive REST support

Server-side support for building RESTful applications has been provided as an extension of the existing annotation driven MVC web framework.
Client-side support is provided by the [class]`RestTemplate` class in the spirit of other template classes such as [class]`JdbcTemplate` and [class]`JmsTemplate`.
Both server and client side REST functionality make use of [interface]`HttpConverter`s to facilitate the conversion between objects and their representation in HTTP requests and responses.

The [class]`MarshallingHttpMessageConverter` uses the _Object to XML mapping_ functionality mentioned earlier.

Refer to the sections on &lt;&lt;mvc,MVC&gt;&gt; and &lt;&lt;rest-resttemplate,the RestTemplate&gt;&gt; for more information.

==== @MVC additions

A `mvc` namespace has been introduced that greatly simplifies Spring MVC configuration.

Additional annotations such as [class]`@CookieValue` and [class]`@RequestHeaders` have been added.
See &lt;&lt;mvc-ann-cookievalue,Mapping cookie values with the
        @CookieValue annotation&gt;&gt; and &lt;&lt;mvc-ann-requestheader,Mapping request header attributes with
        the @RequestHeader annotation&gt;&gt; for more information.

=== Declarative model validation

Several &lt;&lt;validation-beanvalidation,validation enhancements&gt;&gt;, including JSR 303 support that uses Hibernate Validator as the default provider.

=== Early support for Java EE 6

We provide support for asynchronous method invocations through the use of the new @Async annotation (or EJB 3.1's @Asynchronous annotation).

JSR 303, JSF 2.0, JPA 2.0, etc

=== Support for embedded databases

Convenient support for &lt;&lt;jdbc-embedded-database-support,embedded Java database
      engines&gt;&gt;, including HSQL, H2, and Derby, is now provided.


= New Features and Enhancements in Spring Framework 3.1

This is a list of new features for Spring Framework 3.1.
A number of features do not have dedicated reference documentation but do have complete Javadoc.
In such cases, fully-qualified class names are given.
See also &lt;&lt;migration-3.1&gt;&gt;

== Cache Abstraction

* &lt;&lt;cache&gt;&gt;
* &lt;&lt;,
          Cache Abstraction&gt;&gt; (SpringSource team blog)

== Bean Definition Profiles

* &lt;&lt;,
          XML profiles&gt;&gt; (SpringSource Team Blog)
* &lt;&lt;,
          Introducing @Profile&gt;&gt; (SpringSource Team Blog)
* See org.springframework.context.annotation.Configuration Javadoc
* See org.springframework.context.annotation.Profile Javadoc

== Environment Abstraction

* &lt;&lt;,
          Environment Abstraction&gt;&gt; (SpringSource Team Blog)
* See org.springframework.core.env.Environment Javadoc

== PropertySource Abstraction

* &lt;&lt;,
          Unified Property Management&gt;&gt; (SpringSource Team Blog)
* See org.springframework.core.env.Environment Javadoc
* See org.springframework.core.env.PropertySource Javadoc
* See org.springframework.context.annotation.PropertySource Javadoc

== Code equivalents for Spring's XML namespaces

Code-based equivalents to popular Spring XML namespace elements &lt;context:component-scan/&gt;, &lt;tx:annotation-driven/&gt; and &lt;mvc:annotation-driven&gt; have been developed, most in the form of [interface]`@Enable` annotations.
These are designed for use in conjunction with Spring's [interface]`@Configuration` classes, which were introduced in Spring Framework 3.0.

* See org.springframework.context.annotation.Configuration Javadoc
* See org.springframework.context.annotation.ComponentScan Javadoc
* See org.springframework.transaction.annotation.EnableTransactionManagement Javadoc
* See org.springframework.cache.annotation.EnableCaching Javadoc
* See org.springframework.web.servlet.config.annotation.EnableWebMvc Javadoc
* See org.springframework.scheduling.annotation.EnableScheduling Javadoc
* See org.springframework.scheduling.annotation.EnableAsync Javadoc
* See org.springframework.context.annotation.EnableAspectJAutoProxy Javadoc
* See org.springframework.context.annotation.EnableLoadTimeWeaving Javadoc
* See org.springframework.beans.factory.aspectj.EnableSpringConfigured Javadoc

== Support for Hibernate 4.x

* See Javadoc for classes within the new org.springframework.orm.hibernate4 package

== TestContext framework support for @Configuration classes and bean definition profiles

The [interface]`@ContextConfiguration` annotation now supports supplying [interface]`@Configuration` classes for configuring the Spring [class]`TestContext`.
In addition, a new [interface]`@ActiveProfiles` annotation has been introduced to support declarative configuration of active bean definition profiles in [interface]`ApplicationContext` integration tests.

* &lt;&lt;,Spring
          3.1 M2: Testing with @Configuration Classes and Profiles&gt;&gt; (SpringSource Team Blog)
* See &lt;&lt;testcontext-framework&gt;&gt;
* See &lt;&lt;testcontext-ctx-management-javaconfig&gt;&gt; and [interface]`org.springframework.test.context.ContextConfiguration` Javadoc
* See [interface]`org.springframework.test.context.ActiveProfiles` Javadoc
* See [interface]`org.springframework.test.context.SmartContextLoader` Javadoc
* See [interface]`org.springframework.test.context.support.DelegatingSmartContextLoader` Javadoc
* See [interface]`org.springframework.test.context.support.AnnotationConfigContextLoader` Javadoc

== c: namespace for more concise constructor injection

* &lt;&lt;beans-c-namespace&gt;&gt;

== Support for injection against non-standard JavaBeans setters

Prior to Spring Framework 3.1, in order to inject against a property method it had to conform strictly to JavaBeans property signature rules, namely that any 'setter' method must be void-returning.
It is now possible in Spring XML to specify setter methods that return any object type.
This is useful when considering designing APIs for method-chaining, where setter methods return a reference to 'this'.

== Support for Servlet 3 code-based configuration of Servlet Container

The new [interface]`WebApplicationInitializer` builds atop Servlet 3.0's [interface]`ServletContainerInitializer` support to provide a programmatic alternative to the traditional web.xml.

* See org.springframework.web.WebApplicationInitializer Javadoc
* &lt;&lt;,Diff from Spring's
          Greenhouse reference application&gt;&gt; demonstrating migration from web.xml to [interface]`WebApplicationInitializer`

== Support for Servlet 3 MultipartResolver

* See org.springframework.web.multipart.support.StandardServletMultipartResolver Javadoc

== JPA EntityManagerFactory bootstrapping without persistence.xml

In standard JPA, persistence units get defined through `META-INF/persistence.xml` files in specific jar files which will in turn get searched for `@Entity` classes.
In many cases, persistence.xml does not contain more than a unit name and relies on defaults and/or external setup for all other concerns (such as the DataSource to use, etc).
For that reason, Spring Framework 3.1 provides an alternative: [class]`LocalContainerEntityManagerFactoryBean` accepts a 'packagesToScan' property, specifying base packages to scan for `@Entity` classes.
This is analogous to [class]`AnnotationSessionFactoryBean`'s property of the same name for native Hibernate setup, and also to Spring's component-scan feature for regular Spring beans.
Effectively, this allows for XML-free JPA setup at the mere expense of specifying a base package for entity scanning: a particularly fine match for Spring applications which rely on component scanning for Spring beans as well, possibly even bootstrapped using a code-based Servlet 3.0 initializer.

== New HandlerMethod-based Support Classes For Annotated Controller Processing

Spring Framework 3.1 introduces a new set of support classes for processing requests with annotated controllers:

* [class]`RequestMappingHandlerMapping`
* [class]`RequestMappingHandlerAdapter`
* [class]`ExceptionHandlerExceptionResolver`

These classes are a replacement for the existing:

* [class]`DefaultAnnotationHandlerMapping`
* [class]`AnnotationMethodHandlerAdapter`
* [class]`AnnotationMethodHandlerExceptionResolver`

The new classes were developed in response to many requests to make annotation controller support classes more customizable and open for extension.
Whereas previously you could configure a custom annotated controller method argument resolver, with the new support classes you can customize the processing for any supported method argument or return value type.

* See org.springframework.web.method.support.HandlerMethodArgumentResolver Javadoc
* See org.springframework.web.method.support.HandlerMethodReturnValueHandler Javadoc

A second notable difference is the introduction of a [class]`HandlerMethod` abstraction to represent an [interface]`@RequestMapping` method.
This abstraction is used throughout by the new support classes as the `handler` instance.
For example a [class]`HandlerInterceptor` can cast the `handler` from [class]`Object` to [class]`HandlerMethod` and get access to the target controller method, its annotations, etc.

The new classes are enabled by default by the MVC namespace and by Java-based configuration via [interface]`@EnableWebMvc`.
The existing classes will continue to be available but use of the new classes is recommended going forward.

See &lt;&lt;mvc-ann-requestmapping-31-vs-30&gt;&gt; for additional details and a list of features not available with the new support classes.

== "consumes" and "produces" conditions in [interface]`@RequestMapping`

Improved support for specifying media types consumed by a method through the `'Content-Type'` header as well as for producible types specified through the `'Accept'` header.
See &lt;&lt;mvc-ann-requestmapping-consumes&gt;&gt; and &lt;&lt;mvc-ann-requestmapping-produces&gt;&gt;

== Flash Attributes and [interface]`RedirectAttributes`

Flash attributes can now be stored in a [class]`FlashMap` and saved in the HTTP session to survive a redirect.
For an overview of the general support for flash attributes in Spring MVC see &lt;&lt;mvc-flash-attributes&gt;&gt;.

In annotated controllers, an [interface]`@RequestMapping` method can add flash attributes by declaring a method argument of type [interface]`RedirectAttributes`.
This method argument can now also be used to get precise control over the attributes used in a redirect scenario.
See &lt;&lt;mvc-ann-redirect-attributes&gt;&gt; for more details.

== URI Template Variable Enhancements

URI template variables from the current request are used in more places:

* URI template variables are used in addition to request parameters when binding a request to [interface]`@ModelAttribute` method arguments.
* @PathVariable method argument values are merged into the model before rendering, except in views that generate content in an automated fashion such as JSON serialization or XML marshalling.
* A redirect string can contain placeholders for URI variables (e.g.
  `"redirect:/blog/{year}/{month}"`).
  When expanding the placeholders, URI template variables from the current request are automatically considered.
* An [interface]`@ModelAttribute` method argument can be instantiated from a URI template variable provided there is a registered Converter or PropertyEditor to convert from a String to the target object type.

== [interface]`@Valid` On [interface]`@RequestBody` Controller Method Arguments

An [interface]`@RequestBody` method argument can be annotated with [interface]`@Valid` to invoke automatic validation similar to the support for [interface]`@ModelAttribute` method arguments.
A resulting [class]`MethodArgumentNotValidException` is handled in the [class]`DefaultHandlerExceptionResolver` and results in a `400` response code.

== [interface]`@RequestPart` Annotation On Controller Method Arguments

This new annotation provides access to the content of a "multipart/form-data" request part.
See &lt;&lt;mvc-multipart-forms-non-browsers&gt;&gt; and &lt;&lt;mvc-multipart&gt;&gt;.

== [class]`UriComponentsBuilder` and [class]`UriComponents`

A new [class]`UriComponents` class has been added, which is an immutable container of URI components providing access to all contained URI components.
A new [class]`UriComponentsBuilder` class is also provided to help create [class]`UriComponents` instances.
Together the two classes give fine-grained control over all aspects of preparing a URI including construction, expansion from URI template variables, and encoding.

In most cases the new classes can be used as a more flexible alternative to the existing [class]`UriTemplate` especially since [class]`UriTemplate` relies on those same classes internally.


A [class]`ServletUriComponentsBuilder` sub-class provides static factory methods to copy information from a Servlet request.
See &lt;&lt;mvc-construct-encode-uri&gt;&gt;.


= New Features and Enhancements in Spring Framework 3.2

This section covers what's new in Spring Framework 3.2.
See also &lt;&lt;migration-3.2&gt;&gt;

== Support for Servlet 3 based asynchronous request processing

The Spring MVC programming model now provides explicit Servlet 3 async support.
[interface]`@RequestMapping` methods can return one of:

* [interface]`java.util.concurrent.Callable` to complete processing in a separate thread managed by a task executor within Spring MVC.
* [class]`org.springframework.web.context.request.async.DeferredResult` to complete processing at a later time from a thread not known to Spring MVC -- for example, in response to some external event (JMS, AMQP, etc.)
* [class]`org.springframework.web.context.request.async.AsyncTask` to wrap a [interface]`Callable` and customize the timeout value or the task executor to use.

See &lt;&lt;mvc-ann-async&gt;&gt;.

== Spring MVC Test framework

First-class support for testing Spring MVC applications with a fluent API and without a Servlet container.
Server-side tests involve use of the [class]`DispatcherServlet` while client-side REST tests rely on the [class]`RestTemplate`.
See &lt;&lt;spring-mvc-test-framework&gt;&gt;.

== Content negotiation improvements

A [interface]`ContentNegotiationStrategy` is now available for resolving the requested media types from an incoming request.
The available implementations are based on the file extension, query parameter, the 'Accept' header, or a fixed content type.
Equivalent options were previously available only in the ContentNegotiatingViewResolver but are now available throughout.

[class]`ContentNegotiationManager` is the central class to use when configuring content negotiation options.
For more details see &lt;&lt;mvc-config-content-negotiation&gt;&gt;.

The introduction of [class]`ContentNegotiationManger` also enables selective suffix pattern matching for incoming requests.
For more details, see the Javadoc of &lt;&lt;,RequestMappingHandlerMapping.setUseRegisteredSuffixPatternMatch&gt;&gt;.

== [interface]`@ControllerAdvice` annotation

Classes annotated with [interface]`@ControllerAdvice` can contain [interface]`@ExceptionHandler`, [interface]`@InitBinder`, and [interface]`@ModelAttribute` methods and those will apply to [interface]`@RequestMapping` methods across controller hierarchies as opposed to the controller hierarchy within which they are declared.
[interface]`@ControllerAdvice` is a component annotation allowing implementation classes to be auto-detected through classpath scanning.

== Matrix variables

A new [interface]`@MatrixVariable` annotation adds support for extracting matrix variables from the request URI. For more details see &lt;&lt;mvc-ann-matrix-variables&gt;&gt;.

== Abstract base class for code-based Servlet 3+ container initialization

An abstract base class implementation of the [interface]`WebApplicationInitializer` interface is provided to simplify code-based registration of a DispatcherServlet and filters mapped to it.
The new class is named [class]`AbstractDispatcherServletInitializer` and its sub-class [class]`AbstractAnnotationConfigDispatcherServletInitializer` can be used with Java-based Spring configuration.
For more details see &lt;&lt;mvc-container-config&gt;&gt;.

== [class]`ResponseEntityExceptionHandler` class

A convenient base class with an [interface]`@ExceptionHandler` method that handles standard Spring MVC exceptions and returns a [class]`ResponseEntity` that allowing customizing and writing the response with HTTP message converters.
This serves as an alternative to the [class]`DefaultHandlerExceptionResolver`, which does the same but returns a [class]`ModelAndView` instead.

See the revised &lt;&lt;mvc-exceptionhandlers&gt;&gt; including information on customizing the default Servlet container error page.

== Support for generic types in the [class]`RestTemplate` and in [interface]`@RequestBody` arguments

The [class]`RestTemplate` can now read an HTTP response to a generic type (e.g.
`List&lt;Account&gt;`).
There are three new `exchange()` methods that accept [class]`ParameterizedTypeReference`, a new class that enables capturing and passing generic type info.

In support of this feature, the [interface]`HttpMessageConverter` is extended by [interface]`GenericHttpMessageConverter` adding a method for reading content given a specified parameterized type.
The new interface is implemented by the [class]`MappingJacksonHttpMessageConverter` and also by a new [class]`Jaxb2CollectionHttpMessageConverter` that can read read a generic [interface]`Collection` where the generic type is a JAXB type annotated with [interface]`@XmlRootElement` or [interface]`@XmlType`.

== Jackson JSON 2 and related improvements

The Jackson JSON 2 library is now supported.
Due to packaging changes in the Jackson library, there are separate classes in Spring MVC as well.
Those are [class]`MappingJackson2HttpMessageConverter` and [class]`MappingJackson2JsonView`.
Other related configuration improvements include support for pretty printing as well as a [class]`JacksonObjectMapperFactoryBean` for convenient customization of an [class]`ObjectMapper` in XML configuration.

== Tiles 3

Tiles 3 is now supported in addition to Tiles 2.x.
Configuring it should be very similar to the Tiles 2 configuration, i.e.
the combination of [class]`TilesConfigurer`, [class]`TilesViewResolver` and [class]`TilesView` except using the `tiles3` instead of the `tiles2` package.

Also note that besides the version number change, the tiles dependencies have also changed.
You will need to have a subset or all of [file]`tiles-request-api`, [file]`tiles-api`, [file]`tiles-core`, [file]`tiles-servlet`, [file]`tiles-jsp`, [file]`tiles-el`.


== [interface]`@RequestBody` improvements

An [interface]`@RequestBody` or an [interface]`@RequestPart` argument can now be followed by an [interface]`Errors` argument making it possible to handle validation errors (as a result of an [interface]`@Valid` annotation) locally within the [interface]`@RequestMapping` method.
[interface]`@RequestBody` now also supports a required flag.

== HTTP PATCH method

The HTTP request method `PATCH` may now be used in [interface]`@RequestMapping` methods as well as in the [class]`RestTemplate` in conjunction with Apache HttpComponents HttpClient version 4.2 or later.
The JDK [class]`HttpURLConnection` does not support the `PATCH` method.

== Excluded patterns in mapped interceptors

Mapped interceptors now support URL patterns to be excluded.
The MVC namespace and the MVC JavaConfig both expose these options.

== Using meta-annotations for injection points and for bean definition methods

As of 3.2, Spring allows for [interface]`@Autowired` and [interface]`@Value` to be used as meta-annotations, e.g.
to build custom injection annotations in combination with specific qualifiers.
Analogously, you may build custom [interface]`@Bean` definition annotations for [interface]`@Configuration` classes, e.g.
in combination with specific qualifiers, @Lazy, @Primary, etc.

== Initial support for JCache 0.5

Spring provides a CacheManager adapter for JCache, building against the JCache 0.5 preview release.
Full JCache support is coming next year, along with Java EE 7 final.

== Support for [interface]`@DateTimeFormat` without Joda Time

The [interface]`@DateTimeFormat` annotation can now be used without needing a dependency on the Joda Time library.
If Joda Time is not present the JDK [class]`SimpleDateFormat` will be used to parse and print date patterns.
When Joda Time is present it will continue to be used in preference to [class]`SimpleDateFormat`.

== Global date &amp; time formatting

It is now possible to define global formats that will be used when parsing and printing date and time types.
See &lt;&lt;format-configuring-formatting-globaldatetimeformat&gt;&gt; for details.

== New Testing Features

In addition to the aforementioned inclusion of the &lt;&lt;spring-mvc-test-framework,Spring MVC Test Framework&gt;&gt; in the `spring-test` module, the _Spring
    TestContext Framework_ has been revised with support for integration testing web applications as well as configuring application contexts with context initializers.
For further details, consult the following.

* Configuring and &lt;&lt;testcontext-ctx-management-web,loading a
          WebApplicationContext&gt;&gt; in integration tests
* Configuring &lt;&lt;testcontext-ctx-management-ctx-hierarchies,context hierarchies&gt;&gt; in integration tests
* Testing &lt;&lt;testcontext-web-scoped-beans,request and
          session scoped beans&gt;&gt;
* Improvements to &lt;&lt;mock-objects-servlet,Servlet API
          mocks&gt;&gt;
* Configuring test application contexts with &lt;&lt;testcontext-ctx-management-initializers,ApplicationContextInitializers&gt;&gt;

== Concurrency refinements across the framework

Spring Framework 3.2 includes fine-tuning of concurrent data structures in many parts of the framework, minimizing locks and generally improving the arrangements for highly concurrent creation of scoped/prototype beans.

== New Gradle-based build and move to GitHub

Building and contributing to the framework has never been simpler with our move to a Gradle-based build system and source control at GitHub.
See the &lt;&lt;,
    building from source&gt;&gt; section of the README and the &lt;&lt;,
    contributor guidelines&gt;&gt; for complete details.

== Refined Java SE 7 / OpenJDK 7 support

Last but not least, Spring Framework 3.2 comes with refined Java 7 support within the framework as well as through upgraded third-party dependencies: specifically, CGLIB 3.0, ASM 4.0 (both of which come as inlined dependencies with Spring now) and AspectJ 1.7 support (next to the existing AspectJ 1.6 support).


[[spring-core]]
= Core Technologies
This part of the reference documentation covers all of those technologies that are absolutely integral to the Spring Framework.

Foremost amongst these is the Spring Framework's Inversion of Control (IoC) container. A thorough treatment of the Spring Framework's IoC container is closely followed by comprehensive coverage of Spring's Aspect-Oriented Programming (AOP) technologies. The Spring Framework has its own AOP framework, which is conceptually easy to understand, and which successfully addresses the 80% sweet spot of AOP requirements in Java enterprise programming.

Coverage of Spring's integration with AspectJ (currently the richest - in terms of features - and certainly most mature AOP implementation in the Java enterprise space) is also provided.

Finally, the adoption of the test-driven-development (TDD) approach to software development is certainly advocated by the Spring team, and so coverage of Spring's support for integration testing is covered (alongside best practices for unit testing). The Spring team has found that the correct use of IoC certainly does make both unit and integration testing easier (in that the presence of setter methods and appropriate constructors on classes makes them easier to wire together in a test without having to set up service locator registries and suchlike)... the chapter dedicated solely to testing will hopefully convince you of this as well.


* &lt;&lt;beans&gt;&gt;

* &lt;&lt;resources&gt;&gt;

* &lt;&lt;validation&gt;&gt;

* &lt;&lt;expressions&gt;&gt;

* &lt;&lt;aop&gt;&gt;

* &lt;&lt;aop-api&gt;&gt;

* &lt;&lt;testing&gt;&gt;




= The IoC container

== Introduction to the Spring IoC container and beans

This chapter covers the Spring Framework implementation of the Inversion of Control (IoC) footnote:[See ]
principle.
IoC is also known as _dependency
      injection_ (DI).
It is a process whereby objects define their dependencies, that is, the other objects they work with, only through constructor arguments, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method.
The container then _injects_ those dependencies when it creates the bean.
This process is fundamentally the inverse, hence the name _Inversion of Control_ (IoC), of the bean itself controlling the instantiation or location of its dependencies by using direct construction of classes, or a mechanism such as the _Service Locator_ pattern.

The `org.springframework.beans` and `org.springframework.context` packages are the basis for Spring Framework's IoC container.
The [interface]`BeanFactory` interface provides an advanced configuration mechanism capable of managing any type of object.
`ApplicationContext` is a sub-interface of [interface]`BeanFactory.` It adds easier integration with Spring's AOP features; message resource handling (for use in internationalization), event publication; and application-layer specific contexts such as the [interface]`WebApplicationContext` for use in web applications.

In short, the [interface]`BeanFactory` provides the configuration framework and basic functionality, and the [interface]`ApplicationContext` adds more enterprise-specific functionality.
The [interface]`ApplicationContext` is a complete superset of the [interface]`BeanFactory`, and is used exclusively in this chapter in descriptions of Spring's IoC container.
For more information on using the [class]`BeanFactory` instead of the [class]`ApplicationContext,` refer to &lt;&lt;beans-beanfactory&gt;&gt;.

In Spring, the objects that form the backbone of your application and that are managed by the Spring IoC  are called .
A bean is an object that is instantiated, assembled, and otherwise managed by a Spring IoC container.
Otherwise, a bean is simply one of many objects in your application.
Beans, and the  among them, are reflected in the  used by a container.

== Container overview

The interface [class]`org.springframework.context.ApplicationContext` represents the Spring IoC container and is responsible for instantiating, configuring, and assembling the aforementioned beans.
The container gets its instructions on what objects to instantiate, configure, and assemble by reading configuration metadata.
The configuration metadata is represented in XML, Java annotations, or Java code.
It allows you to express the objects that compose your application and the rich interdependencies between such objects.

Several implementations of the [class]`ApplicationContext` interface are supplied out-of-the-box with Spring.
In standalone applications it is common to create an instance of &lt;&lt;,[class]`ClassPathXmlApplicationContext`&gt;&gt; or &lt;&lt;,[class]`FileSystemXmlApplicationContext`&gt;&gt;.
 While XML has been the traditional format for defining configuration metadata you can instruct the container to use Java annotations or code as the metadata format by providing a small amount of XML configuration to declaratively enable support for these additional metadata formats.

In most application scenarios, explicit user code is not required to instantiate one or more instances of a Spring IoC container.
For example, in a web application scenario, a simple eight (or so) lines of boilerplate J2EE web descriptor XML in the `web.xml` file of the application will typically suffice (see &lt;&lt;context-create&gt;&gt;).
If you are using the &lt;&lt;,SpringSource Tool Suite&gt;&gt; Eclipse-powered development environment or &lt;&lt;,Spring Roo&gt;&gt; this boilerplate configuration can be easily created with few mouse clicks or keystrokes.

The following diagram is a high-level view of how Spring works.
Your application classes are combined with configuration metadata so that after the [class]`ApplicationContext` is created and initialized, you have a fully configured and executable system or application.



=== Configuration metadata

As the preceding diagram shows, the Spring IoC container consumes a form of _configuration metadata_; this configuration metadata represents how you as an application developer tell the Spring container to instantiate, configure, and assemble the objects in your application.

Configuration metadata is traditionally supplied in a simple and intuitive XML format, which is what most of this chapter uses to convey key concepts and features of the Spring IoC container.

NOTE: XML-based metadata is _not_ the only allowed form of configuration metadata.
The Spring IoC container itself is _totally_ decoupled from the format in which this configuration metadata is actually written.

For information about using other forms of metadata with the Spring container, see:

* &lt;&lt;beans-annotation-config,Annotation-based
              configuration&gt;&gt;: Spring 2.5 introduced support for annotation-based configuration metadata.
* &lt;&lt;beans-java,Java-based configuration&gt;&gt;: Starting with Spring 3.0, many features provided by the &lt;&lt;,Spring JavaConfig
              project&gt;&gt; became part of the core Spring Framework.
  Thus you can define beans external to your application classes by using Java rather than XML files.
  To use these new features, see the [interface]`@Configuration`, [interface]`@Bean,
              @Import` and [interface]`@DependsOn` annotations.

Spring configuration consists of at least one and typically more than one bean definition that the container must manage.
XML-based configuration metadata shows these beans configured as `&lt;bean/&gt;` elements inside a top-level `&lt;beans/&gt;` element.

These bean definitions correspond to the actual objects that make up your application.
Typically you define service layer objects, data access objects (DAOs), presentation objects such as Struts [interface]`Action` instances, infrastructure objects such as Hibernate [interface]`SessionFactories`, JMS [interface]`Queues`, and so forth.
Typically one does not configure fine-grained domain objects in the container, because it is usually the responsibility of DAOs and business logic to create and load domain objects.
However, you can use Spring's integration with AspectJ to configure objects that have been created outside the control of an IoC container.
See &lt;&lt;aop-atconfigurable,Using
        AspectJ to dependency-inject domain objects with Spring&gt;&gt;.

The following example shows the basic structure of XML-based configuration metadata:

[source,xml]</code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           <a href="http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;">http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="..." class="..."&gt;
  &lt;!-- collaborators and configuration for this bean go here --&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="..." class="..."&gt;
  &lt;!-- collaborators and configuration for this bean go here --&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- more bean definitions go here --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `id` attribute is a string that you use to identify the individual bean definition.
The `class` attribute defines the type of the bean and uses the fully qualified classname.
The value of the id attribute refers to collaborating objects.
The XML for referring to collaborating objects is not shown in this example; see &lt;&lt;beans-dependencies,Dependencies&gt;&gt; for more information.

=== Instantiating a container

Instantiating a Spring IoC container is straightforward.
The location path or paths supplied to an [interface]`ApplicationContext` constructor are actually resource strings that allow the container to load configuration metadata from a variety of external resources such as the local file system, from the Java `CLASSPATH`, and so on.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext context =
    new ClassPathXmlApplicationContext(new String[] {"services.xml", "daos.xml"});</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: After you learn about Spring's IoC container, you may want to know more about Spring's [interface]`Resource` abstraction, as described in &lt;&lt;resources&gt;&gt;, which provides a convenient mechanism for reading an InputStream from locations defined in a URI syntax.
In particular, [class]`Resource` paths are used to construct applications contexts as described in &lt;&lt;resources-app-ctx&gt;&gt;.

The following example shows the service layer objects `(services.xml)` configuration file:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           <a href="http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;">http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- services --&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="petStore"
      class="org.springframework.samples.jpetstore.services.PetStoreServiceImpl"&gt;
  &lt;property name="accountDao" ref="accountDao"/&gt;
  &lt;property name="itemDao" ref="itemDao"/&gt;
  &lt;!-- additional collaborators and configuration for this bean go here --&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- more bean definitions for services go here --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The following example shows the data access objects `daos.xml` file:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           <a href="http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;">http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="accountDao"
    class="org.springframework.samples.jpetstore.dao.ibatis.SqlMapAccountDao"&gt;
  &lt;!-- additional collaborators and configuration for this bean go here --&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="itemDao" class="org.springframework.samples.jpetstore.dao.ibatis.SqlMapItemDao"&gt;
  &lt;!-- additional collaborators and configuration for this bean go here --&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- more bean definitions for data access objects go here --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In the preceding example, the service layer consists of the class [class]`PetStoreServiceImpl`, and two data access objects of the type [class]`SqlMapAccountDao` and SqlMapItemDao are based on the &lt;&lt;,iBatis&gt;&gt; Object/Relational mapping framework.
The `property
        name` element refers to the name of the JavaBean property, and the `ref` element refers to the name of another bean definition.
This linkage between id and ref elements expresses the dependency between collaborating objects.
For details of configuring an object's dependencies, see &lt;&lt;beans-dependencies,Dependencies&gt;&gt;.

==== Composing XML-based configuration metadata

It can be useful to have bean definitions span multiple XML files.
Often each individual XML configuration file represents a logical layer or module in your architecture.

You can use the application context constructor to load bean definitions from all these XML fragments.
This constructor takes multiple [interface]`Resource` locations, as was shown in the previous section.
Alternatively, use one or more occurrences of the `&lt;import/&gt;` element to load bean definitions from another file or files.
For example:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;beans&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;import resource="services.xml"/&gt;
&lt;import resource="resources/messageSource.xml"/&gt;
&lt;import resource="/resources/themeSource.xml"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="bean1" class="..."/&gt;
&lt;bean id="bean2" class="..."/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In the preceding example, external bean definitions are loaded from three files, `services.xml`, `messageSource.xml`, and `themeSource.xml`.
All location paths are relative to the definition file doing the importing, so `services.xml` must be in the same directory or classpath location as the file doing the importing, while `messageSource.xml` and `themeSource.xml` must be in a `resources` location below the location of the importing file.
As you can see, a leading slash is ignored, but given that these paths are relative, it is better form not to use the slash at all.
The contents of the files being imported, including the top level `&lt;beans/&gt;` element, must be valid XML bean definitions according to the Spring Schema or DTD.

[NOTE]
====
It is possible, but not recommended, to reference files in parent directories using a relative "../" path.
Doing so creates a dependency on a file that is outside the current application.
In particular, this reference is not recommended for "classpath:" URLs (for example, "classpath:../services.xml"), where the runtime resolution process chooses the "nearest" classpath root and then looks into its parent directory.
Classpath configuration changes may lead to the choice of a different, incorrect directory.

You can always use fully qualified resource locations instead of relative paths: for example, "file:C:/config/services.xml" or "classpath:/config/services.xml".
However, be aware that you are coupling your application's configuration to specific absolute locations.
It is generally preferable to keep an indirection for such absolute locations, for example, through "${...}" placeholders that are resolved against JVM system properties at runtime.
====

=== Using the container

The [interface]`ApplicationContext` is the interface for an advanced factory capable of maintaining a registry of different beans and their dependencies.
Using the method [method]`T
        getBean(String name, Class&lt;T&gt; requiredType)` you can retrieve instances of your beans.

The [interface]`ApplicationContext` enables you to read bean definitions and access them as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext context =
    new ClassPathXmlApplicationContext(new String[] {"services.xml", "daos.xml"});</p>
</div>
<div class="paragraph">
<p>PetStoreServiceImpl service = context.getBean("petStore", PetStoreServiceImpl.class);</p>
</div>
<div class="paragraph">
<p>List userList = service.getUsernameList();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
You use [method]`getBean()` to retrieve instances of your beans.
The [interface]`ApplicationContext` interface has a few other methods for retrieving beans, but ideally your application code should never use them.
Indeed, your application code should have no calls to the [method]`getBean()` method at all, and thus no dependency on Spring APIs at all.
For example, Spring's integration with web frameworks provides for dependency injection for various web framework classes such as controllers and JSF-managed beans.

== Bean overview

A Spring IoC container manages one or more _beans_.
These beans are created with the configuration metadata that you supply to the container, for example, in the form of XML `&lt;bean/&gt;` definitions.

Within the container itself, these bean definitions are represented as [interface]`BeanDefinition` objects, which contain (among other information) the following metadata:

* _A package-qualified class name:_ typically the actual implementation class of the bean being defined.
* Bean behavioral configuration elements, which state how the bean should behave in the container (scope, lifecycle callbacks, and so forth).
* References to other beans that are needed for the bean to do its work; these references are also called _collaborators_ or _dependencies_.
* Other configuration settings to set in the newly created object, for example, the number of connections to use in a bean that manages a connection pool, or the size limit of the pool.

This metadata translates to a set of properties that make up each bean definition.

.The bean definition
[cols="1,1", options="header"]
|===
| Property
| Explained in...
|

|

|

|


|


|


|


|


|
|===

In addition to bean definitions that contain information on how to create a specific bean, the [interface]`ApplicationContext` implementations also permit the registration of existing objects that are created outside the container, by users.
This is done by accessing the ApplicationContext's BeanFactory via the method [method]`getBeanFactory()` which returns the BeanFactory implementation [class]`DefaultListableBeanFactory`.
[class]`DefaultListableBeanFactory` supports this registration through the methods [method]`registerSingleton(..)` and [method]`registerBeanDefinition(..)`.
However, typical applications work solely with beans defined through metadata bean definitions.

=== Naming beans

Every bean has one or more identifiers.
These identifiers must be unique within the container that hosts the bean.
A bean usually has only one identifier, but if it requires more than one, the extra ones can be considered aliases.

In XML-based configuration metadata, you use the `id` and/or `name` attributes to specify the bean identifier(s).
The `id` attribute allows you to specify exactly one id.
 Conventionally these names are alphanumeric ('myBean', 'fooService', etc), but may special characters as well.
 If you want to introduce other aliases to the bean, you can also specify them in the `name` attribute, separated by a comma (`,`), semicolon (`;`), or white space.
 As a historical note, in versions prior to Spring 3.1, the `id` attribute was typed as an `xsd:ID`, which constrained possible characters.
 As of 3.1, it is now `xsd:string`.
 Note that bean id uniqueness is still enforced by the container, though no longer by XML parsers.

You are not required to supply a name or id for a bean.
If no name or id is supplied explicitly, the container generates a unique name for that bean.
However, if you want to refer to that bean by name, through the use of the `ref` element or &lt;&lt;beans-servicelocator,Service Locator&gt;&gt; style lookup, you must provide a name.
Motivations for not supplying a name are related to using &lt;&lt;beans-inner-beans,inner beans&gt;&gt; and &lt;&lt;beans-factory-autowire,autowiring
        collaborators&gt;&gt;.

.Bean naming conventions
****
The convention is to use the standard Java convention for instance field names when naming beans.
That is, bean names start with a lowercase letter, and are camel-cased from then on.
Examples of such names would be (without quotes) `'accountManager'`, `'accountService'`, `'userDao'`, `'loginController'`, and so forth.

Naming beans consistently makes your configuration easier to read and understand, and if you are using Spring AOP it helps a lot when applying advice to a set of beans related by name.
****

==== Aliasing a bean outside the bean definition

In a bean definition itself, you can supply more than one name for the bean, by using a combination of up to one name specified by the `id` attribute, and any number of other names in the `name` attribute.
These names can be equivalent aliases to the same bean, and are useful for some situations, such as allowing each component in an application to refer to a common dependency by using a bean name that is specific to that component itself.

Specifying all aliases where the bean is actually defined is not always adequate, however.
It is sometimes desirable to introduce an alias for a bean that is defined elsewhere.
This is commonly the case in large systems where configuration is split amongst each subsystem, each subsystem having its own set of object definitions.
In XML-based configuration metadata, you can use the `&lt;alias/&gt;` element to accomplish this.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;alias name="fromName" alias="toName"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In this case, a bean in the same container which is named `fromName`, may also after the use of this alias definition, be referred to as `toName`.

For example, the configuration metadata for subsystem A may refer to a DataSource via the name 'subsystemA-dataSource.
The configuration metadata for subsystem B may refer to a DataSource via the name 'subsystemB-dataSource'.
When composing the main application that uses both these subsystems the main application refers to the DataSource via the name 'myApp-dataSource'.
To have all three names refer to the same object you add to the MyApp configuration metadata the following aliases definitions:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;alias name="subsystemA-dataSource" alias="subsystemB-dataSource"/&gt;
&lt;alias name="subsystemA-dataSource" alias="myApp-dataSource" /&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Now each component and the main application can refer to the dataSource through a name that is unique and guaranteed not to clash with any other definition (effectively creating a namespace), yet they refer to the same bean.

=== Instantiating beans

A bean definition essentially is a recipe for creating one or more objects.
The container looks at the recipe for a named bean when asked, and uses the configuration metadata encapsulated by that bean definition to create (or acquire) an actual object.

If you use XML-based configuration metadata, you specify the type (or class) of object that is to be instantiated in the `class` attribute of the `&lt;bean/&gt;` element.
This `class` attribute, which internally is a [class]`Class` property on a [interface]`BeanDefinition` instance, is usually mandatory.
(For exceptions, see &lt;&lt;beans-factory-class-instance-factory-method&gt;&gt; and &lt;&lt;beans-child-bean-definitions&gt;&gt;.) You use the [class]`Class` property in one of two ways:

* Typically, to specify the bean class to be constructed in the case where the container itself directly creates the bean by calling its constructor reflectively, somewhat equivalent to Java code using the `new` operator.

* To specify the actual class containing the `static` factory method that will be invoked to create the object, in the less common case where the container invokes a `static`, _factory_ method on a class to create the bean.
  The object type returned from the invocation of the `static` factory method may be the same class or another class entirely.

.Inner class names
****
If you want to configure a bean definition for a `static` nested class, you have to use the _binary_ name of the inner class.

For example, if you have a class called [class]`Foo` in the `com.example` package, and this [class]`Foo` class has a `static` inner class called [class]`Bar`, the value of the `'class'` attribute on a bean definition would be...

[class]`com.example.Foo$Bar`

Notice the use of the `$` character in the name to separate the inner class name from the outer class name.
****

==== Instantiation with a constructor

When you create a bean by the constructor approach, all normal classes are usable by and compatible with Spring.
That is, the class being developed does not need to implement any specific interfaces or to be coded in a specific fashion.
Simply specifying the bean class should suffice.
However, depending on what type of IoC you use for that specific bean, you may need a default (empty) constructor.

The Spring IoC container can manage virtually _any_ class you want it to manage; it is not limited to managing true JavaBeans.
Most Spring users prefer actual JavaBeans with only a default (no-argument) constructor and appropriate setters and getters modeled after the properties in the container.
You can also have more exotic non-bean-style classes in your container.
If, for example, you need to use a legacy connection pool that absolutely does not adhere to the JavaBean specification, Spring can manage it as well.

With XML-based configuration metadata you can specify your bean class as follows:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="exampleBean" class="examples.ExampleBean"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean name="anotherExample" class="examples.ExampleBeanTwo"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
For details about the mechanism for supplying arguments to the constructor (if required) and setting object instance properties after the object is constructed, see &lt;&lt;beans-factory-collaborators,Injecting
          Dependencies&gt;&gt;.

==== Instantiation with a static factory method

When defining a bean that you create with a static factory method, you use the `class` attribute to specify the class containing the `static` factory method and an attribute named `factory-method` to specify the name of the factory method itself.
You should be able to call this method (with optional arguments as described later) and return a live object, which subsequently is treated as if it had been created through a constructor.
One use for such a bean definition is to call `static` factories in legacy code.

The following bean definition specifies that the bean will be created by calling a factory-method.
The definition does not specify the type (class) of the returned object, only the class containing the factory method.
In this example, the [method]`createInstance()` method must be a _static_ method.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="clientService"
      class="examples.ClientService"
      factory-method="createInstance"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class ClientService {
  private static ClientService clientService = new ClientService();
  private ClientService() {}</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  public static ClientService createInstance() {
    return clientService;
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
For details about the mechanism for supplying (optional) arguments to the factory method and setting object instance properties after the object is returned from the factory, see &lt;&lt;beans-factory-properties-detailed,Dependencies and
          configuration in detail&gt;&gt;.

==== Instantiation using an instance factory method

Similar to instantiation through a &lt;&lt;beans-factory-class-static-factory-method,static factory
          method&gt;&gt;, instantiation with an instance factory method invokes a non-static method of an existing bean from the container to create a new bean.
To use this mechanism, leave the `class
          `attribute empty, and in the `factory-bean` attribute, specify the name of a bean in the current (or parent/ancestor) container that contains the instance method that is to be invoked to create the object.
Set the name of the factory method itself with the `factory-method` attribute.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- the factory bean, which contains a method called createInstance() -&#8594;
&lt;bean id="serviceLocator" class="examples.DefaultServiceLocator"&gt;
  &lt;!-- inject any dependencies required by this locator bean -&#8594;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;!-- the bean to be created via the factory bean -&#8594;
&lt;bean id="clientService"
      factory-bean="serviceLocator"
      factory-method="createClientServiceInstance"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class DefaultServiceLocator {
  private static ClientService clientService = new ClientServiceImpl();
  private DefaultServiceLocator() {}</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  public ClientService createClientServiceInstance() {
    return clientService;
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
One factory class can also hold more than one factory method as shown here:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="serviceLocator" class="examples.DefaultServiceLocator"&gt;
  &lt;!-- inject any dependencies required by this locator bean -&#8594;
&lt;/bean&gt;
&lt;bean id="clientService"
      factory-bean="serviceLocator"
      factory-method="createClientServiceInstance"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="accountService"
      factory-bean="serviceLocator"
      factory-method="createAccountServiceInstance"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class DefaultServiceLocator {
  private static ClientService clientService = new ClientServiceImpl();
  private static AccountService accountService = new AccountServiceImpl();</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private DefaultServiceLocator() {}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public ClientService createClientServiceInstance() {
  return clientService;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  public AccountService createAccountServiceInstance() {
    return accountService;
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
This approach shows that the factory bean itself can be managed and configured through dependency injection (DI).
See &lt;&lt;beans-factory-properties-detailed,"&lt;&lt;beans-factory-properties-detailed,Dependencies and
          configuration in detail&gt;&gt;."&gt;&gt;

NOTE: In Spring documentation,_ factory bean_ refers to a bean that is configured in the Spring container that will create objects through an &lt;&lt;beans-factory-class-instance-factory-method,instance&gt;&gt; or &lt;&lt;beans-factory-class-static-factory-method,static&gt;&gt; factory method.
By contrast, [interface]`FactoryBean` (notice the capitalization) refers to a Spring-specific &lt;&lt;beans-factory-extension-factorybean,[interface]`FactoryBean`&gt;&gt;.

:leveloffset: 1
:leveloffset: 0

:leveloffset: 1
:leveloffset: 0

:leveloffset: 1
:leveloffset: 0

== Bean definition inheritance

A bean definition can contain a lot of configuration information, including constructor arguments, property values, and container-specific information such as initialization method, static factory method name, and so on.
A child bean definition inherits configuration data from a parent definition.
The child definition can override some values, or add others, as needed.
Using parent and child bean definitions can save a lot of typing.
Effectively, this is a form of templating.

If you work with an [interface]`ApplicationContext` interface programmatically, child bean definitions are represented by the [class]`ChildBeanDefinition` class.
Most users do not work with them on this level, instead configuring bean definitions declaratively in something like the [class]`ClassPathXmlApplicationContext`.
When you use XML-based configuration metadata, you indicate a child bean definition by using the `parent` attribute, specifying the parent bean as the value of this attribute.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="inheritedTestBean" abstract="true"
    class="org.springframework.beans.TestBean"&gt;
  &lt;property name="name" value="parent"/&gt;
  &lt;property name="age" value="1"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="inheritsWithDifferentClass"
      class="org.springframework.beans.DerivedTestBean"
      parent="inheritedTestBean" init-method="initialize"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;property name="name" value="override"/&gt;
&lt;!-- the age property value of 1 will be inherited from  parent --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
A child bean definition uses the bean class from the parent definition if none is specified, but can also override it.
In the latter case, the child bean class must be compatible with the parent, that is, it must accept the parent's property values.

A child bean definition inherits constructor argument values, property values, and method overrides from the parent, with the option to add new values.
Any initialization method, destroy method, and/or `static` factory method settings that you specify will override the corresponding parent settings.

The remaining settings are _always_ taken from the child definition: _depends on_, _autowire
      mode_, _dependency check_, _singleton_, _scope_, _lazy
      init_.

The preceding example explicitly marks the parent bean definition as abstract by using the `abstract` attribute.
If the parent definition does not specify a class, explicitly marking the parent bean definition as `abstract` is required, as follows:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="inheritedTestBeanWithoutClass" abstract="true"&gt;
    &lt;property name="name" value="parent"/&gt;
    &lt;property name="age" value="1"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="inheritsWithClass" class="org.springframework.beans.DerivedTestBean"
    parent="inheritedTestBeanWithoutClass" init-method="initialize"&gt;
  &lt;property name="name" value="override"/&gt;
  &lt;!-- age will inherit the value of 1 from the parent bean definition-&#8594;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The parent bean cannot be instantiated on its own because it is incomplete, and it is also explicitly marked as `abstract`.
When a definition is `abstract` like this, it is usable only as a pure template bean definition that serves as a parent definition for child definitions.
Trying to use such an `abstract` parent bean on its own, by referring to it as a ref property of another bean or doing an explicit [method]`getBean()` call with the parent bean id, returns an error.
Similarly, the container's internal [method]`preInstantiateSingletons()` method ignores bean definitions that are defined as abstract.

NOTE: `ApplicationContext` pre-instantiates all singletons by default.
Therefore, it is important (at least for singleton beans) that if you have a (parent) bean definition which you intend to use only as a template, and this definition specifies a class, you must make sure to set the _abstract_ attribute to _true_, otherwise the application context will actually (attempt to) pre-instantiate the `abstract` bean.

:leveloffset: 1
:leveloffset: 0

:leveloffset: 1
:leveloffset: 0

:leveloffset: 1
:leveloffset: 0

:leveloffset: 1
:leveloffset: 0

:leveloffset: 1
:leveloffset: 0

== Registering a [interface]`LoadTimeWeaver`

The [interface]`LoadTimeWeaver` is used by Spring to dynamically transform classes as they are loaded into the Java virtual machine (JVM).

To enable load-time weaving add the [interface]`@EnableLoadTimeWeaving` to one of your [interface]`@Configuration` classes:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Configuration
@EnableLoadTimeWeaving
public class AppConfig {</p>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Alternatively for XML configuration use the  `context:load-time-weaver` element:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;beans&gt;
     &lt;context:load-time-weaver/&gt;
&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Once configured for the [interface]`ApplicationContext`.
Any bean within that [interface]`ApplicationContext` may implement [interface]`LoadTimeWeaverAware`, thereby receiving a reference to the load-time weaver instance.
This is particularly useful in combination with &lt;&lt;orm-jpa,Spring's JPA support&gt;&gt; where load-time weaving may be necessary for JPA class transformation.
Consult the [class]`LocalContainerEntityManagerFactoryBean` Javadoc for more detail.
For more on AspectJ load-time weaving, see &lt;&lt;aop-aj-ltw&gt;&gt;.

:leveloffset: 1
:leveloffset: 0

== The BeanFactory

The [class]`BeanFactory` provides the underlying basis for Spring's IoC functionality but it is only used directly in integration with other third-party frameworks and is now largely historical in nature for most users of Spring.
The [class]`BeanFactory` and related interfaces, such as [class]`BeanFactoryAware`, [class]`InitializingBean`, [class]`DisposableBean`, are still present in Spring for the purposes of backward compatibility with the large number of third-party frameworks that integrate with Spring.
Often third-party components that can not use more modern equivalents such as `@PostConstruct` or `@PreDestroy` in order to remain compatible with JDK 1.4 or to avoid a dependency on JSR-250.

This section provides additional background into the differences between the [interface]`BeanFactory` and [interface]`ApplicationContext` and how one might access the IoC container directly through a classic singleton lookup.

=== [interface]`BeanFactory` or [interface]`ApplicationContext`?

Use an [interface]`ApplicationContext` unless you have a good reason for not doing so.

Because the [interface]`ApplicationContext` includes all functionality of the [interface]`BeanFactory`, it is generally recommended over the [interface]`BeanFactory`, except for a few situations such as in an [class]`Applet` where memory consumption might be critical and a few extra kilobytes might make a difference.
However, for most typical enterprise applications and systems, the [interface]`ApplicationContext` is what you will want to use.
Spring 2.0 and later makes _heavy_ use of the &lt;&lt;beans-factory-extension-bpp,[interface]`BeanPostProcessor` extension point&gt;&gt; (to effect proxying and so on).
If you use only a plain [interface]`BeanFactory`, a fair amount of support such as transactions and AOP will not take effect, at least not without some extra steps on your part.
This situation could be confusing because nothing is actually wrong with the configuration.

The following table lists features provided by the [interface]`BeanFactory` and [interface]`ApplicationContext` interfaces and implementations.

.Feature Matrix
[cols="1,1,1", options="header"]
|===
| Feature
| BeanFactory
| ApplicationContext
| Bean instantiation/wiring
| Yes
| Yes

| Automatic
                BeanPostProcessor
                registration
| No
| Yes

| Automatic
                BeanFactoryPostProcessor
                registration
| No
| Yes

| Convenient
                MessageSource access (for
                i18n)
| No
| Yes

| ApplicationEvent
                publication
| No
| Yes
|===

To explicitly register a bean post-processor with a [interface]`BeanFactory` implementation, you must write code like this:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ConfigurableBeanFactory factory = new XmlBeanFactory(&#8230;);</p>
</div>
<div class="paragraph">
<p>MyBeanPostProcessor postProcessor = new MyBeanPostProcessor();
factory.addBeanPostProcessor(postProcessor);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
To explicitly register a [class]`BeanFactoryPostProcessor` when using a [interface]`BeanFactory` implementation, you must write code like this:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>XmlBeanFactory factory = new XmlBeanFactory(new FileSystemResource("beans.xml"));</p>
</div>
<div class="paragraph">
<p>PropertyPlaceholderConfigurer cfg = new PropertyPlaceholderConfigurer();
cfg.setLocation(new FileSystemResource("jdbc.properties"));</p>
</div>
<div class="paragraph">
<p>cfg.postProcessBeanFactory(factory);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In both cases, the explicit registration step is inconvenient, which is one reason why the various [interface]`ApplicationContext` implementations are preferred above plain [interface]`BeanFactory` implementations in the vast majority of Spring-backed applications, especially when using `BeanFactoryPostProcessors` and [class]`BeanPostProcessors`.
These mechanisms implement important functionality such as property placeholder replacement and AOP.

=== Glue code and the evil singleton

It is best to write most application code in a dependency-injection (DI) style, where that code is served out of a Spring IoC container, has its own dependencies supplied by the container when it is created, and is completely unaware of the container.
However, for the small glue layers of code that are sometimes needed to tie other code together, you sometimes need a singleton (or quasi-singleton) style access to a Spring IoC container.
For example, third-party code may try to construct new objects directly (`Class.forName()` style), without the ability to get these objects out of a Spring IoC container.
If the object constructed by the third-party code is a small stub or proxy, which then uses a singleton style access to a Spring IoC container to get a real object to delegate to, then inversion of control has still been achieved for the majority of the code (the object coming out of the container).
Thus most code is still unaware of the container or how it is accessed, and remains decoupled from other code, with all ensuing benefits.
EJBs may also use this stub/proxy approach to delegate to a plain Java implementation object, retrieved from a Spring IoC container.
While the Spring IoC container itself ideally does not have to be a singleton, it may be unrealistic in terms of memory usage or initialization times (when using beans in the Spring IoC container such as a Hibernate [interface]`SessionFactory`) for each bean to use its own, non-singleton Spring IoC container.

Looking up the application context in a service locator style is sometimes the only option for accessing shared Spring-managed components, such as in an EJB 2.1 environment, or when you want to share a single ApplicationContext as a parent to WebApplicationContexts across WAR files.
In this case you should look into using the utility class &lt;&lt;,[class]`ContextSingletonBeanFactoryLocator`&gt;&gt; locator that is described in this &lt;&lt;,SpringSource team blog entry&gt;&gt;.


= Resources

== Introduction

Java's standard [class]`java.net.URL` class and standard handlers for various URL prefixes unfortunately are not quite adequate enough for all access to low-level resources.
For example, there is no standardized [class]`URL` implementation that may be used to access a resource that needs to be obtained from the classpath, or relative to a [interface]`ServletContext`.
While it is possible to register new handlers for specialized [class]`URL` prefixes (similar to existing handlers for prefixes such as `http:`), this is generally quite complicated, and the [class]`URL` interface still lacks some desirable functionality, such as a method to check for the existence of the resource being pointed to.

== The [interface]`Resource` interface

Spring's [interface]`Resource` interface is meant to be a more capable interface for abstracting access to low-level resources.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface Resource extends InputStreamSource {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean exists();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean isOpen();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>URL getURL() throws IOException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>File getFile() throws IOException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Resource createRelative(String relativePath) throws IOException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>String getFilename();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    String getDescription();
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface InputStreamSource {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    InputStream getInputStream() throws IOException;
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Some of the most important methods from the [interface]`Resource` interface are:

* [method]`getInputStream()`: locates and opens the resource, returning an [class]`InputStream` for reading from the resource.
  It is expected that each invocation returns a fresh [class]`InputStream`.
  It is the responsibility of the caller to close the stream.
* [method]`exists()`: returns a `boolean` indicating whether this resource actually exists in physical form.
* [method]`isOpen()`: returns a `boolean` indicating whether this resource represents a handle with an open stream.
  If `true`, the [class]`InputStream` cannot be read multiple times, and must be read once only and then closed to avoid resource leaks.
  Will be `false` for all usual resource implementations, with the exception of [class]`InputStreamResource`.
* [method]`getDescription()`: returns a description for this resource, to be used for error output when working with the resource.
  This is often the fully qualified file name or the actual URL of the resource.

Other methods allow you to obtain an actual [class]`URL` or [class]`File` object representing the resource (if the underlying implementation is compatible, and supports that functionality).

The [interface]`Resource` abstraction is used extensively in Spring itself, as an argument type in many method signatures when a resource is needed.
Other methods in some Spring APIs (such as the constructors to various [interface]`ApplicationContext` implementations), take a [class]`String` which in unadorned or simple form is used to create a [interface]`Resource` appropriate to that context implementation, or via special prefixes on the [class]`String` path, allow the caller to specify that a specific [interface]`Resource` implementation must be created and used.

While the [interface]`Resource` interface is used a lot with Spring and by Spring, it's actually very useful to use as a general utility class by itself in your own code, for access to resources, even when your code doesn't know or care about any other parts of Spring.
While this couples your code to Spring, it really only couples it to this small set of utility classes, which are serving as a more capable replacement for [class]`URL`, and can be considered equivalent to any other library you would use for this purpose.

It is important to note that the [interface]`Resource` abstraction does not replace functionality: it wraps it where possible.
For example, a [class]`UrlResource` wraps a URL, and uses the wrapped [class]`URL` to do its work.

== Built-in [interface]`Resource` implementations

There are a number of [interface]`Resource` implementations that come supplied straight out of the box in Spring:

=== [class]`UrlResource`

The [class]`UrlResource` wraps a [class]`java.net.URL`, and may be used to access any object that is normally accessible via a URL, such as files, an HTTP target, an FTP target, etc.
All URLs have a standardized [class]`String` representation, such that appropriate standardized prefixes are used to indicate one URL type from another.
This includes `file:` for accessing filesystem paths, `http:` for accessing resources via the HTTP protocol, `ftp:` for accessing resources via FTP, etc.

A [class]`UrlResource` is created by Java code explicitly using the [class]`UrlResource` constructor, but will often be created implicitly when you call an API method which takes a [class]`String` argument which is meant to represent a path.
For the latter case, a JavaBeans [interface]`PropertyEditor` will ultimately decide which type of [interface]`Resource` to create.
If the path string contains a few well-known (to it, that is) prefixes such as `classpath:`, it will create an appropriate specialized [interface]`Resource` for that prefix.
However, if it doesn't recognize the prefix, it will assume the this is just a standard URL string, and will create a [class]`UrlResource`.

=== [class]`ClassPathResource`

This class represents a resource which should be obtained from the classpath.
This uses either the thread context class loader, a given class loader, or a given class for loading resources.

This [interface]`Resource` implementation supports resolution as [class]`java.io.File` if the class path resource resides in the file system, but not for classpath resources which reside in a jar and have not been expanded (by the servlet engine, or whatever the environment is) to the filesystem.
To address this the various [interface]`Resource` implementations always support resolution as a [class]`java.net.URL`.

A [class]`ClassPathResource` is created by Java code explicitly using the [class]`ClassPathResource` constructor, but will often be created implicitly when you call an API method which takes a [class]`String` argument which is meant to represent a path.
For the latter case, a JavaBeans [interface]`PropertyEditor` will recognize the special prefix `classpath:`on the string path, and create a [class]`ClassPathResource` in that case.

=== [class]`FileSystemResource`

This is a [interface]`Resource` implementation for [class]`java.io.File` handles.
It obviously supports resolution as a [class]`File`, and as a [class]`URL`.

=== [class]`ServletContextResource`

This is a [interface]`Resource` implementation for [interface]`ServletContext` resources, interpreting relative paths within the relevant web application's root directory.

This always supports stream access and URL access, but only allows [class]`java.io.File` access when the web application archive is expanded and the resource is physically on the filesystem.
Whether or not it's expanded and on the filesystem like this, or accessed directly from the JAR or somewhere else like a DB (it's conceivable) is actually dependent on the Servlet container.

=== [class]`InputStreamResource`

A [interface]`Resource` implementation for a given [interface]`InputStream`.
This should only be used if no specific [interface]`Resource` implementation is applicable.
In particular, prefer [class]`ByteArrayResource` or any of the file-based [interface]`Resource` implementations where possible.

In contrast to other [interface]`Resource` implementations, this is a descriptor for an _already_ opened resource - therefore returning `true` from [method]`isOpen()`.
Do not use it if you need to keep the resource descriptor somewhere, or if you need to read a stream multiple times.

=== [class]`ByteArrayResource`

This is a [interface]`Resource` implementation for a given byte array.
It creates a [class]`ByteArrayInputStream` for the given byte array.

It's useful for loading content from any given byte array, without having to resort to a single-use [class]`InputStreamResource`.

== The [interface]`ResourceLoader`

The [interface]`ResourceLoader` interface is meant to be implemented by objects that can return (i.e.
load) [interface]`Resource` instances.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface ResourceLoader {
    Resource getResource(String location);
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
All application contexts implement the [interface]`ResourceLoader` interface, and therefore all application contexts may be used to obtain [interface]`Resource` instances.

When you call [method]`getResource()` on a specific application context, and the location path specified doesn't have a specific prefix, you will get back a [interface]`Resource` type that is appropriate to that particular application context.
For example, assume the following snippet of code was executed against a [class]`ClassPathXmlApplicationContext` instance:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Resource template = ctx.getResource("some/resource/path/myTemplate.txt");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
What would be returned would be a [class]`ClassPathResource`; if the same method was executed against a [class]`FileSystemXmlApplicationContext` instance, you'd get back a [class]`FileSystemResource`.
For a [class]`WebApplicationContext`, you'd get back a [class]`ServletContextResource`, and so on.

As such, you can load resources in a fashion appropriate to the particular application context.

On the other hand, you may also force [class]`ClassPathResource` to be used, regardless of the application context type, by specifying the special `classpath:` prefix:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Resource template = ctx.getResource("classpath:some/resource/path/myTemplate.txt");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Similarly, one can force a [class]`UrlResource` to be used by specifying any of the standard [class]`java.net.URL` prefixes:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Resource template = ctx.getResource("file:/some/resource/path/myTemplate.txt");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Resource template = ctx.getResource("http://myhost.com/resource/path/myTemplate.txt");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The following table summarizes the strategy for converting [class]`String`s to [interface]`Resource`s:

.Resource strings
[cols="1,1,1", options="header"]
|===
| Prefix
| Example
| Explanation
| classpath:
|  classpath:com/myapp/config.xml

| Loaded from the classpath.

| file:
|  file:/data/config.xml

|  Loaded as a URL, from the
            filesystem.
                But see also
                .


| http:
|  http://myserver/logo.png

| Loaded as a
            URL.

| (none)
|  /data/config.xml
|  Depends on the underlying
            ApplicationContext.
|===

== The [interface]`ResourceLoaderAware` interface

The [interface]`ResourceLoaderAware` interface is a special marker interface, identifying objects that expect to be provided with a [interface]`ResourceLoader` reference.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface ResourceLoaderAware {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   void setResourceLoader(ResourceLoader resourceLoader);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
When a class implements [interface]`ResourceLoaderAware` and is deployed into an application context (as a Spring-managed bean), it is recognized as [interface]`ResourceLoaderAware` by the application context.
The application context will then invoke the [method]`setResourceLoader(ResourceLoader)`, supplying itself as the argument (remember, all application contexts in Spring implement the [interface]`ResourceLoader` interface).

Of course, since an [interface]`ApplicationContext` is a [interface]`ResourceLoader`, the bean could also implement the [interface]`ApplicationContextAware` interface and use the supplied application context directly to load resources, but in general, it's better to use the specialized [interface]`ResourceLoader` interface if that's all that's needed.
The code would just be coupled to the resource loading interface, which can be considered a utility interface, and not the whole Spring [interface]`ApplicationContext` interface.

As of Spring 2.5, you can rely upon autowiring of the [interface]`ResourceLoader` as an alternative to implementing the [interface]`ResourceLoaderAware` interface.
The "traditional" `constructor` and `byType` autowiring modes (as described in &lt;&lt;beans-factory-autowire&gt;&gt;) are now capable of providing a dependency of type [interface]`ResourceLoader` for either a constructor argument or setter method parameter respectively.
For more flexibility (including the ability to autowire fields and multiple parameter methods), consider using the new annotation-based autowiring features.
In that case, the [interface]`ResourceLoader` will be autowired into a field, constructor argument, or method parameter that is expecting the [interface]`ResourceLoader` type as long as the field, constructor, or method in question carries the [interface]`@Autowired` annotation.
For more information, see &lt;&lt;beans-autowired-annotation&gt;&gt;.

== `Resources` as dependencies

If the bean itself is going to determine and supply the resource path through some sort of dynamic process, it probably makes sense for the bean to use the [interface]`ResourceLoader` interface to load resources.
Consider as an example the loading of a template of some sort, where the specific resource that is needed depends on the role of the user.
If the resources are static, it makes sense to eliminate the use of the [interface]`ResourceLoader` interface completely, and just have the bean expose the [interface]`Resource` properties it needs, and expect that they will be injected into it.

What makes it trivial to then inject these properties, is that all application contexts register and use a special JavaBeans [interface]`PropertyEditor` which can convert [class]`String` paths to [interface]`Resource` objects.
So if `myBean` has a template property of type [interface]`Resource`, it can be configured with a simple string for that resource, as follows:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="myBean" class="&#8230;"&gt;
  &lt;property name="template" value="some/resource/path/myTemplate.txt"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that the resource path has no prefix, so because the application context itself is going to be used as the [interface]`ResourceLoader`, the resource itself will be loaded via a [class]`ClassPathResource`, `FileSystemResource`, or [class]`ServletContextResource` (as appropriate) depending on the exact type of the context.

If there is a need to force a specific [interface]`Resource` type to be used, then a prefix may be used.
The following two examples show how to force a [class]`ClassPathResource` and a [class]`UrlResource` (the latter being used to access a filesystem file).

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;property name="template" value="classpath:some/resource/path/myTemplate.txt"&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;property name="template" value="file:/some/resource/path/myTemplate.txt"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Application contexts and [interface]`Resource` paths

=== Constructing application contexts

An application context constructor (for a specific application context type) generally takes a string or array of strings as the location path(s) of the resource(s) such as XML files that make up the definition of the context.

When such a location path doesn't have a prefix, the specific [interface]`Resource` type built from that path and used to load the bean definitions, depends on and is appropriate to the specific application context.
For example, if you create a [class]`ClassPathXmlApplicationContext` as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext ctx = new ClassPathXmlApplicationContext("conf/appContext.xml");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The bean definitions will be loaded from the classpath, as a [class]``[class]`ClassPathResource` will be used.
But if you create a [class]`FileSystemXmlApplicationContext` as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext ctx =
    new FileSystemXmlApplicationContext("conf/appContext.xml");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The bean definition will be loaded from a filesystem location, in this case relative to the current working directory.

Note that the use of the special classpath prefix or a standard URL prefix on the location path will override the default type of [interface]`Resource` created to load the definition.
So this [class]`FileSystemXmlApplicationContext`...

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext ctx =
    new FileSystemXmlApplicationContext("classpath:conf/appContext.xml");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
...
will actually load its bean definitions from the classpath.
However, it is still a [class]`FileSystemXmlApplicationContext`.
If it is subsequently used as a [interface]`ResourceLoader`, any unprefixed paths will still be treated as filesystem paths.

==== Constructing [class]`ClassPathXmlApplicationContext` instances - shortcuts

The [class]`ClassPathXmlApplicationContext` exposes a number of constructors to enable convenient instantiation.
The basic idea is that one supplies merely a string array containing just the filenames of the XML files themselves (without the leading path information), and one _also_ supplies a [class]`Class`; the [class]`ClassPathXmlApplicationContext` will derive the path information from the supplied class.

An example will hopefully make this clear.
Consider a directory layout that looks like this:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>com/
  foo/
    services.xml
    daos.xml
    MessengerService.class</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
A [class]`ClassPathXmlApplicationContext` instance composed of the beans defined in the `'services.xml'` and `'daos.xml'` could be instantiated like so...

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext ctx = new ClassPathXmlApplicationContext(
    new String[] {"services.xml", "daos.xml"}, MessengerService.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Please do consult the Javadocs for the [class]`ClassPathXmlApplicationContext` class for details of the various constructors.

=== Wildcards in application context constructor resource paths

The resource paths in application context constructor values may be a simple path (as shown above) which has a one-to-one mapping to a target Resource, or alternately may contain the special "classpath*:" prefix and/or internal Ant-style regular expressions (matched using Spring's [class]`PathMatcher` utility).
Both of the latter are effectively wildcards

One use for this mechanism is when doing component-style application assembly.
All components can 'publish' context definition fragments to a well-known location path, and when the final application context is created using the same path prefixed via `classpath*:`, all component fragments will be picked up automatically.

Note that this wildcarding is specific to use of resource paths in application context constructors (or when using the [class]`PathMatcher` utility class hierarchy directly), and is resolved at construction time.
It has nothing to do with the [interface]`Resource` type itself.
It's not possible to use the `classpath*:` prefix to construct an actual [interface]`Resource`, as a resource points to just one resource at a time.

==== Ant-style Patterns

When the path location contains an Ant-style pattern, for example:

[source]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>/WEB-INF/*-context.xml
com/mycompany/**/applicationContext.xml
file:C:/some/path/*-context.xml
classpath:com/mycompany/**/applicationContext.xml</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
...
the resolver follows a more complex but defined procedure to try to resolve the wildcard.
It produces a Resource for the path up to the last non-wildcard segment and obtains a URL from it.
If this URL is not a "jar:" URL or container-specific variant (e.g.
"`zip:`" in WebLogic, "`wsjar`" in WebSphere, etc.), then a [class]`java.io.File` is obtained from it and used to resolve the wildcard by traversing the filesystem.
In the case of a jar URL, the resolver either gets a [class]`java.net.JarURLConnection` from it or manually parses the jar URL and then traverses the contents of the jar file to resolve the wildcards.

===== Implications on portability

If the specified path is already a file URL (either explicitly, or implicitly because the base [interface]`ResourceLoader` is a filesystem one, then wildcarding is guaranteed to work in a completely portable fashion.

If the specified path is a classpath location, then the resolver must obtain the last non-wildcard path segment URL via a [method]`Classloader.getResource()` call.
Since this is just a node of the path (not the file at the end) it is actually undefined (in the [class]`ClassLoader` Javadocs) exactly what sort of a URL is returned in this case.
In practice, it is always a [class]`java.io.File` representing the directory, where the classpath resource resolves to a filesystem location, or a jar URL of some sort, where the classpath resource resolves to a jar location.
Still, there is a portability concern on this operation.

If a jar URL is obtained for the last non-wildcard segment, the resolver must be able to get a [class]`java.net.JarURLConnection` from it, or manually parse the jar URL, to be able to walk the contents of the jar, and resolve the wildcard.
This will work in most environments, but will fail in others, and it is strongly recommended that the wildcard resolution of resources coming from jars be thoroughly tested in your specific environment before you rely on it.

==== The `classpath*:` prefix

When constructing an XML-based application context, a location string may use the special `classpath*:` prefix:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext ctx =
    new ClassPathXmlApplicationContext("classpath*:conf/appContext.xml");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
This special prefix specifies that all classpath resources that match the given name must be obtained (internally, this essentially happens via a [method]`ClassLoader.getResources(...)` call), and then merged to form the final application context definition.

.Classpath*: portability
[NOTE]
====
The wildcard classpath relies on the `getResources()` method of the underlying classloader.
As most application servers nowadays supply their own classloader implementation, the behavior might differ especially when dealing with jar files.
A simple test to check if `classpath*` works is to use the classloader to load a file from within a jar on the classpath: `getClass().getClassLoader().getResources("&lt;someFileInsideTheJar&gt;")`.
Try this test with files that have the same name but are placed inside two different locations.
In case an inappropriate result is returned, check the application server documentation for settings that might affect the classloader behavior.
====

The "`classpath*:`" prefix can also be combined with a `PathMatcher` pattern in the rest of the location path, for example "`classpath*:META-INF/*-beans.xml`".
In this case, the resolution strategy is fairly simple: a ClassLoader.getResources() call is used on the last non-wildcard path segment to get all the matching resources in the class loader hierarchy, and then off each resource the same PathMatcher resolution strategy described above is used for the wildcard subpath.

==== Other notes relating to wildcards

Please note that "`classpath*:`" when combined with Ant-style patterns will only work reliably with at least one root directory before the pattern starts, unless the actual target files reside in the file system.
This means that a pattern like "`classpath*:*.xml`" will not retrieve files from the root of jar files but rather only from the root of expanded directories.
This originates from a limitation in the JDK's [method]`ClassLoader.getResources()` method which only returns file system locations for a passed-in empty string (indicating potential roots to search).

Ant-style patterns with "`classpath:`" resources are not guaranteed to find matching resources if the root package to search is available in multiple class path locations.
This is because a resource such as

[source]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>com/mycompany/package1/service-context.xml</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
may be in only one location, but when a path such as

[source]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>classpath:com/mycompany/**/service-context.xml</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
is used to try to resolve it, the resolver will work off the (first) URL returned by [method]`getResource("com/mycompany")`;.
If this base package node exists in multiple classloader locations, the actual end resource may not be underneath.
Therefore, preferably, use "`classpath*:`" with the same Ant-style pattern in such a case, which will search all class path locations that contain the root package.

=== [class]`FileSystemResource` caveats

A [class]`FileSystemResource` that is not attached to a [class]`FileSystemApplicationContext` (that is, a [class]`FileSystemApplicationContext` is not the actual [interface]`ResourceLoader`) will treat absolute vs.
relative paths as you would expect.
Relative paths are relative to the current working directory, while absolute paths are relative to the root of the filesystem.

For backwards compatibility (historical) reasons however, this changes when the [class]`FileSystemApplicationContext` is the `ResourceLoader`.
The [class]`FileSystemApplicationContext` simply forces all attached [class]`FileSystemResource` instances to treat all location paths as relative, whether they start with a leading slash or not.
In practice, this means the following are equivalent:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext ctx =
    new FileSystemXmlApplicationContext("conf/context.xml");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext ctx =
    new FileSystemXmlApplicationContext("/conf/context.xml");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
As are the following: (Even though it would make sense for them to be different, as one case is relative and the other absolute.)

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>FileSystemXmlApplicationContext ctx = &#8230;;
ctx.getResource("some/resource/path/myTemplate.txt");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>FileSystemXmlApplicationContext ctx = &#8230;;
ctx.getResource("/some/resource/path/myTemplate.txt");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In practice, if true absolute filesystem paths are needed, it is better to forgo the use of absolute paths with [class]`FileSystemResource` / [class]`FileSystemXmlApplicationContext`, and just force the use of a [class]`UrlResource`, by using the `file:` URL prefix.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ctx.getResource("file:/some/resource/path/myTemplate.txt");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationContext ctx =
    new FileSystemXmlApplicationContext("file:/conf/context.xml");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>

= Validation, Data Binding, and Type Conversion

== Introduction

.JSR-303/JSR-349 Bean Validation
****
Spring Framework 4.0 supports Bean Validation 1.0 (JSR-303) and Bean Validation 1.1 (JSR-349) in terms of setup support, also adapting it to Spring's [interface]`Validator` interface.

An application can choose to enable Bean Validation once globally, as described in &lt;&lt;validation-beanvalidation&gt;&gt;, and use it exclusively for all validation needs.

An application can also register additional Spring [interface]`Validator` instances per [class]`DataBinder` instance, as described in &lt;&lt;validation-binder&gt;&gt;.
This may be useful for plugging in validation logic without the use of annotations.
****

There are pros and cons for considering validation as business logic, and Spring offers a design for validation (and data binding) that does not exclude either one of them.
Specifically validation should not be tied to the web tier, should be easy to localize and it should be possible to plug in any validator available.
Considering the above, Spring has come up with a [interface]`Validator` interface that is both basic ands eminently usable in every layer of an application.

Data binding is useful for allowing user input to be dynamically bound to the domain model of an application (or whatever objects you use to process user input).
Spring provides the so-called [interface]`DataBinder` to do exactly that.
The [interface]`Validator` and the [interface]`DataBinder` make up the `validation` package, which is primarily used in but not limited to the MVC framework.

The [interface]`BeanWrapper` is a fundamental concept in the Spring Framework and is used in a lot of places.
However, you probably will not have the need to use the [interface]`BeanWrapper` directly.
Because this is reference documentation however, we felt that some explanation might be in order.
We will explain the [interface]`BeanWrapper` in this chapter since, if you were going to use it at all, you would most likely do so when trying to bind data to objects.

Spring's DataBinder and the lower-level BeanWrapper both use PropertyEditors to parse and format property values.
The [interface]`PropertyEditor` concept is part of the JavaBeans specification, and is also explained in this chapter.
Spring 3 introduces a "core.convert" package that provides a general type conversion facility, as well as a higher-level "format" package for formatting UI field values.
These new packages may be used as simpler alternatives to PropertyEditors, and will also be discussed in this chapter.

== Validation using Spring's [interface]`Validator` interface

Spring features a [interface]`Validator` interface that you can use to validate objects.
The [interface]`Validator` interface works using an [interface]`Errors` object so that while validating, validators can report validation failures to the [interface]`Errors` object.

Let's consider a small data object:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class Person {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private String name;
private int age;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  // the usual getters and setters...
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
We're going to provide validation behavior for the [class]`Person` class by implementing the following two methods of the [interface]`org.springframework.validation.Validator` interface:

* [method]`supports(Class)` - Can this [interface]`Validator` validate instances of the supplied [class]`Class`?
* [method]`validate(Object,
            org.springframework.validation.Errors)` - validates the given object and in case of validation errors, registers those with the given [interface]`Errors` object

Implementing a [interface]`Validator` is fairly straightforward, especially when you know of the [class]`ValidationUtils` helper class that the Spring Framework also provides.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class PersonValidator implements Validator {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/**
* This Validator validates *just* Person instances
*/
public boolean supports(Class clazz) {
    return Person.class.equals(clazz);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void validate(Object obj, Errors e) {
        ValidationUtils.rejectIfEmpty(e, "name", "name.empty");
        Person p = (Person) obj;
        if (p.getAge() &lt; 0) {
            e.rejectValue("age", "negativevalue");
        } else if (p.getAge() &gt; 110) {
            e.rejectValue("age", "too.darn.old");
        }
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
As you can see, the `static` [method]`rejectIfEmpty(..)` method on the [class]`ValidationUtils` class is used to reject the `'name'` property if it is `null` or the empty string.
Have a look at the Javadoc for the [class]`ValidationUtils` class to see what functionality it provides besides the example shown previously.

While it is certainly possible to implement a single [interface]`Validator` class to validate each of the nested objects in a rich object, it may be better to encapsulate the validation logic for each nested class of object in its own [interface]`Validator` implementation.
A simple example of a _'rich'_ object would be a [class]`Customer` that is composed of two [class]`String` properties (a first and second name) and a complex [class]`Address` object.
[class]`Address` objects may be used independently of [class]`Customer` objects, and so a distinct [class]`AddressValidator` has been implemented.
If you want your [class]`CustomerValidator` to reuse the logic contained within the [class]`AddressValidator` class without resorting to copy-and-paste, you can dependency-inject or instantiate an [class]`AddressValidator` within your [class]`CustomerValidator`, and use it like so:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class CustomerValidator implements Validator {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private final Validator addressValidator;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public CustomerValidator(Validator addressValidator) {
    if (addressValidator == null) {
        throw new IllegalArgumentException(
          "The supplied [Validator] is required and must not be null.");
    }
    if (!addressValidator.supports(Address.class)) {
        throw new IllegalArgumentException(
          "The supplied [Validator] must support the validation of [Address] instances.");
    }
    this.addressValidator = addressValidator;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>/**
* This Validator validates Customer instances, and any subclasses of Customer too
*/
public boolean supports(Class clazz) {
    return Customer.class.isAssignableFrom(clazz);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void validate(Object target, Errors errors) {
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, "firstName", "field.required");
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, "surname", "field.required");
        Customer customer = (Customer) target;
        try {
            errors.pushNestedPath("address");
            ValidationUtils.invokeValidator(this.addressValidator, customer.getAddress(), errors);
        } finally {
            errors.popNestedPath();
        }
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Validation errors are reported to the [interface]`Errors` object passed to the validator.
In case of Spring Web MVC you can use `&lt;spring:bind/&gt;` tag to inspect the error messages, but of course you can also inspect the errors object yourself.
More information about the methods it offers can be found from the Javadoc.

== Resolving codes to error messages

We've talked about databinding and validation.
Outputting messages corresponding to validation errors is the last thing we need to discuss.
In the example we've shown above, we rejected the `name` and the `age` field.
If we're going to output the error messages by using a [interface]`MessageSource`, we will do so using the error code we've given when rejecting the field ('name' and 'age' in this case).
When you call (either directly, or indirectly, using for example the [class]`ValidationUtils` class) `rejectValue` or one of the other `reject` methods from the [interface]`Errors` interface, the underlying implementation will not only register the code you've passed in, but also a number of additional error codes.
What error codes it registers is determined by the [interface]`MessageCodesResolver` that is used.
By default, the [class]`DefaultMessageCodesResolver` is used, which for example not only registers a message with the code you gave, but also messages that include the field name you passed to the reject method.
So in case you reject a field using `rejectValue("age",
      "too.darn.old")`, apart from the `too.darn.old` code, Spring will also register `too.darn.old.age` and `too.darn.old.age.int` (so the first will include the field name and the second will include the type of the field); this is done as a convenience to aid developers in targeting error messages and suchlike.

More information on the [interface]`MessageCodesResolver` and the default strategy can be found online with the Javadocs for &lt;&lt;,MessageCodesResolver&gt;&gt; and &lt;&lt;,DefaultMessageCodesResolver&gt;&gt; respectively.

== Bean manipulation and the [interface]`BeanWrapper`

The `org.springframework.beans` package adheres to the JavaBeans standard provided by Sun.
A JavaBean is simply a class with a default no-argument constructor, which follows a naming convention where (by way of an example) a property named `bingoMadness` would have a setter method [method]`setBingoMadness(..)` and a getter method [method]`getBingoMadness()`.
For more information about JavaBeans and the specification, please refer to Sun's website ( &lt;&lt;,java.sun.com/products/javabeans&gt;&gt;).

One quite important class in the beans package is the [interface]`BeanWrapper` interface and its corresponding implementation ([class]`BeanWrapperImpl`).
As quoted from the Javadoc, the [interface]`BeanWrapper` offers functionality to set and get property values (individually or in bulk), get property descriptors, and to query properties to determine if they are readable or writable.
Also, the [interface]`BeanWrapper` offers support for nested properties, enabling the setting of properties on sub-properties to an unlimited depth.
Then, the [interface]`BeanWrapper` supports the ability to add standard JavaBeans [interface]`PropertyChangeListeners` and [interface]`VetoableChangeListeners`, without the need for supporting code in the target class.
Last but not least, the [interface]`BeanWrapper` provides support for the setting of indexed properties.
The [interface]`BeanWrapper` usually isn't used by application code directly, but by the [interface]`DataBinder` and the [interface]`BeanFactory`.

The way the [interface]`BeanWrapper` works is partly indicated by its name: _it wraps a bean_ to perform actions on that bean, like setting and retrieving properties.

=== Setting and getting basic and nested properties

Setting and getting properties is done using the `setPropertyValue(s)` and `getPropertyValue(s)` methods that both come with a couple of overloaded variants.
They're all described in more detail in the Javadoc Spring comes with.
What's important to know is that there are a couple of conventions for indicating properties of an object.
A couple of examples:

.Examples of properties
[cols="1,1", options="header"]
|===
| Expression
| Explanation
| name
| Indicates the property name
                corresponding to the methods getName()
                or isName() and
                setName(..)

| account.name
| Indicates the nested property name of
                the property account corresponding e.g. to
                the methods getAccount().setName() or
                getAccount().getName()

| account[2]
| Indicates the third element of the
                indexed property account. Indexed properties
                can be of type array, list
                or other naturally ordered
                collection

| account[COMPANYNAME]
| Indicates the value of the map entry indexed by the key
                COMPANYNAME of the Map property
                account
|===

Below you'll find some examples of working with the [interface]`BeanWrapper` to get and set properties.

_(This next section is not vitally important to you if
        you're not planning to work with the
        [interface]`BeanWrapper` directly. If you're just
        using the [interface]`DataBinder` and the
        [interface]`BeanFactory` and their out-of-the-box
        implementation, you should skip ahead to the section about
        [interface]`PropertyEditors`.)_

Consider the following two classes:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class Company {
    private String name;
    private Employee managingDirector;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public String getName() {
        return this.name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public Employee getManagingDirector() {
        return this.managingDirector;
    }
    public void setManagingDirector(Employee managingDirector) {
        this.managingDirector = managingDirector;
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class Employee {
    private String name;
    private float salary;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public String getName() {
        return this.name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public float getSalary() {
        return salary;
    }
    public void setSalary(float salary) {
        this.salary = salary;
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The following code snippets show some examples of how to retrieve and manipulate some of the properties of instantiated `Companies` and `Employees`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>BeanWrapper company = BeanWrapperImpl(new Company());
company.setPropertyValue("name", "Some Company Inc.");
PropertyValue value = new PropertyValue("name", "Some Company Inc.");
company.setPropertyValue(value);</p>
</div>
<div class="paragraph">
<p>BeanWrapper jim = BeanWrapperImpl(new Employee());
jim.setPropertyValue("name", "Jim Stravinsky");
company.setPropertyValue("managingDirector", jim.getWrappedInstance());</p>
</div>
<div class="paragraph">
<p>Float salary = (Float) company.getPropertyValue("managingDirector.salary");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Built-in [interface]`PropertyEditor` implementations

Spring uses the concept of `PropertyEditors` to effect the conversion between an [class]`Object` and a [class]`String`.
If you think about it, it sometimes might be handy to be able to represent properties in a different way than the object itself.
For example, a [class]`Date` can be represented in a human readable way (as the [class]`String` '`2007-14-09`'), while we're still able to convert the human readable form back to the original date (or even better: convert any date entered in a human readable form, back to [class]`Date` objects).
This behavior can be achieved by _registering custom editors_, of type [interface]`java.beans.PropertyEditor`.
Registering custom editors on a [interface]`BeanWrapper` or alternately in a specific IoC container as mentioned in the previous chapter, gives it the knowledge of how to convert properties to the desired type.
Read more about [interface]`PropertyEditors` in the Javadoc of the `java.beans` package provided by Sun.

A couple of examples where property editing is used in Spring:

* _setting properties on beans_ is done using `PropertyEditors`.
  When mentioning `java.lang.String` as the value of a property of some bean you're declaring in XML file, Spring will (if the setter of the corresponding property has a [class]`Class`-parameter) use the [class]`ClassEditor` to try to resolve the parameter to a [class]`Class` object.
* _parsing HTTP request parameters_ in Spring's MVC framework is done using all kinds of `PropertyEditors` that you can manually bind in all subclasses of the [class]`CommandController`.

Spring has a number of built-in `PropertyEditors` to make life easy.
Each of those is listed below and they are all located in the `org.springframework.beans.propertyeditors` package.
Most, but not all (as indicated below), are registered by default by [class]`BeanWrapperImpl`.
Where the property editor is configurable in some fashion, you can of course still register your own variant to override the default one:

.Built-in `PropertyEditors`
[cols="1,1", options="header"]
|===
| Class
| Explanation
| ByteArrayPropertyEditor
| Editor for byte arrays. Strings will simply be converted to
                their corresponding byte representations. Registered by default
                by BeanWrapperImpl.

| ClassEditor
| Parses Strings representing classes to actual classes and
                the other way around. When a class is not found, an
                IllegalArgumentException is thrown.
                Registered by default by
                BeanWrapperImpl.

| CustomBooleanEditor
| Customizable property editor for
                Boolean properties. Registered by default
                by BeanWrapperImpl, but, can be
                overridden by registering custom instance of it as custom
                editor.

| CustomCollectionEditor
| Property editor for Collections, converting any source
                Collection to a given target
                Collection type.

| CustomDateEditor

| CustomNumberEditor
| Customizable property editor for any Number subclass like
                Integer, Long,
                Float, Double.
                Registered by default by BeanWrapperImpl,
                but can be overridden by registering custom instance of it as a
                custom editor.

| FileEditor
| Capable of resolving Strings to
                java.io.File objects. Registered by
                default by BeanWrapperImpl.

| InputStreamEditor
| One-way property editor, capable of taking a text string
                and producing (via an intermediate
                ResourceEditor and
                Resource) an
                InputStream, so
                InputStream properties may be
                directly set as Strings. Note that the default usage will not
                close the InputStream for you!
                Registered by default by
                BeanWrapperImpl.

| LocaleEditor
| Capable of resolving Strings to
                Locale objects and vice versa (the String
                format is [language]_[country]_[variant], which is the same
                thing the toString() method of Locale provides). Registered by
                default by BeanWrapperImpl.

| PatternEditor
| Capable of resolving Strings to JDK 1.5
                Pattern objects and vice versa.

| PropertiesEditor
| Capable of converting Strings (formatted using the format
                as defined in the Javadoc for the java.lang.Properties class) to
                Properties objects. Registered by default
                by BeanWrapperImpl.

| StringTrimmerEditor
| Property editor that trims Strings. Optionally allows
                transforming an empty string into a null
                value. NOT registered by default; must be user registered as
                needed.

| URLEditor
| Capable of resolving a String representation of a URL to an
                actual URL object. Registered by default
                by BeanWrapperImpl.
|===

Spring uses the [interface]`java.beans.PropertyEditorManager` to set the search path for property editors that might be needed.
The search path also includes `sun.bean.editors`, which includes [interface]`PropertyEditor` implementations for types such as [class]`Font`, [class]`Color`, and most of the primitive types.
Note also that the standard JavaBeans infrastructure will automatically discover [interface]`PropertyEditor` classes (without you having to register them explicitly) if they are in the same package as the class they handle, and have the same name as that class, with `'Editor'` appended; for example, one could have the following class and package structure, which would be sufficient for the [class]`FooEditor` class to be recognized and used as the [interface]`PropertyEditor` for [class]`Foo`-typed properties.

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>com
  chank
    pop
      Foo
      FooEditor   // the PropertyEditor for the Foo class</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that you can also use the standard [interface]`BeanInfo` JavaBeans mechanism here as well (described &lt;&lt;,in not-amazing-detail here&gt;&gt;).
Find below an example of using the [interface]`BeanInfo` mechanism for explicitly registering one or more [interface]`PropertyEditor` instances with the properties of an associated class.

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>com
  chank
    pop
      Foo
      FooBeanInfo   // the BeanInfo for the Foo class</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Here is the Java source code for the referenced [class]`FooBeanInfo` class.
This would associate a [class]`CustomNumberEditor` with the `age` property of the [class]`Foo` class.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class FooBeanInfo extends SimpleBeanInfo {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public PropertyDescriptor[] getPropertyDescriptors() {
        try {
            final PropertyEditor numberPE = new CustomNumberEditor(Integer.class, true);
            PropertyDescriptor ageDescriptor = new PropertyDescriptor("age", Foo.class) {
                public PropertyEditor createPropertyEditor(Object bean) {
                    return numberPE;
                };
            };
            return new PropertyDescriptor[] { ageDescriptor };
        }
        catch (IntrospectionException ex) {
            throw new Error(ex.toString());
        }
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Registering additional custom [interface]`PropertyEditors`

When setting bean properties as a string value, a Spring IoC container ultimately uses standard JavaBeans `PropertyEditors` to convert these Strings to the complex type of the property.
Spring pre-registers a number of custom `PropertyEditors` (for example, to convert a classname expressed as a string into a real [class]`Class` object).
Additionally, Java's standard JavaBeans [interface]`PropertyEditor` lookup mechanism allows a [class]`PropertyEditor` for a class simply to be named appropriately and placed in the same package as the class it provides support for, to be found automatically.

If there is a need to register other custom `PropertyEditors`, there are several mechanisms available.
The most manual approach, which is not normally convenient or recommended, is to simply use the [method]`registerCustomEditor()` method of the [interface]`ConfigurableBeanFactory` interface, assuming you have a [interface]`BeanFactory` reference.
Another, slightly more convenient, mechanism is to use a special bean factory post-processor called [class]`CustomEditorConfigurer`.
Although bean factory post-processors can be used with [interface]`BeanFactory` implementations, the [class]`CustomEditorConfigurer` has a nested property setup, so it is strongly recommended that it is used with the [interface]`ApplicationContext`, where it may be deployed in similar fashion to any other bean, and automatically detected and applied.

Note that all bean factories and application contexts automatically use a number of built-in property editors, through their use of something called a [interface]`BeanWrapper` to handle property conversions.
The standard property editors that the [interface]`BeanWrapper` registers are listed in &lt;&lt;beans-beans-conversion,the previous section&gt;&gt;.
Additionally, `ApplicationContexts` also override or add an additional number of editors to handle resource lookups in a manner appropriate to the specific application context type.

Standard JavaBeans [interface]`PropertyEditor` instances are used to convert property values expressed as strings to the actual complex type of the property.
[class]`CustomEditorConfigurer`, a bean factory post-processor, may be used to conveniently add support for additional [interface]`PropertyEditor` instances to an [interface]`ApplicationContext`.

Consider a user class [class]`ExoticType`, and another class [class]`DependsOnExoticType` which needs [class]`ExoticType` set as a property:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package example;</p>
</div>
<div class="paragraph">
<p>public class ExoticType {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private String name;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public ExoticType(String name) {
        this.name = name;
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>public class DependsOnExoticType {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private ExoticType type;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void setType(ExoticType type) {
        this.type = type;
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
When things are properly set up, we want to be able to assign the type property as a string, which a [interface]`PropertyEditor` will behind the scenes convert into an actual [class]`ExoticType` instance:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="sample" class="example.DependsOnExoticType"&gt;
    &lt;property name="type" value="aNameForExoticType"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The [interface]`PropertyEditor` implementation could look similar to this:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package example;</p>
</div>
<div class="paragraph">
<p>public class ExoticTypeEditor extends PropertyEditorSupport {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void setAsText(String text) {
        setValue(new ExoticType(text.toUpperCase()));
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Finally, we use [class]`CustomEditorConfigurer` to register the new [interface]`PropertyEditor` with the [interface]`ApplicationContext`, which will then be able to use it as needed:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.beans.factory.config.CustomEditorConfigurer"&gt;
  &lt;property name="customEditors"&gt;
    &lt;map&gt;
      &lt;entry key="example.ExoticType" value="example.ExoticTypeEditor"/&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
===== Using [interface]`PropertyEditorRegistrars`

Another mechanism for registering property editors with the Spring container is to create and use a [interface]`PropertyEditorRegistrar`.
This interface is particularly useful when you need to use the same set of property editors in several different situations: write a corresponding registrar and reuse that in each case.
`PropertyEditorRegistrars` work in conjunction with an interface called [interface]`PropertyEditorRegistry`, an interface that is implemented by the Spring [interface]`BeanWrapper` (and [interface]`DataBinder`).
`PropertyEditorRegistrars` are particularly convenient when used in conjunction with the [class]`CustomEditorConfigurer` (introduced &lt;&lt;beans-beans-conversion-customeditor-registration,here&gt;&gt;), which exposes a property called [method]`setPropertyEditorRegistrars(..)`: `PropertyEditorRegistrars` added to a [class]`CustomEditorConfigurer` in this fashion can easily be shared with [interface]`DataBinder` and Spring MVC [interface]`Controllers`.
Furthermore, it avoids the need for synchronization on custom editors: a [interface]`PropertyEditorRegistrar` is expected to create fresh [interface]`PropertyEditor` instances for each bean creation attempt.

Using a [interface]`PropertyEditorRegistrar` is perhaps best illustrated with an example.
First off, you need to create your own [interface]`PropertyEditorRegistrar` implementation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.foo.editors.spring;</p>
</div>
<div class="paragraph">
<p>public final class CustomPropertyEditorRegistrar implements PropertyEditorRegistrar {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void registerCustomEditors(PropertyEditorRegistry registry) {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// it is expected that new PropertyEditor instances are created
registry.registerCustomEditor(ExoticType.class, new ExoticTypeEditor());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        // you could register as many custom property editors as are required here...
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
See also the [class]`org.springframework.beans.support.ResourceEditorRegistrar` for an example [interface]`PropertyEditorRegistrar` implementation.
Notice how in its implementation of the [method]`registerCustomEditors(..)` method it creates new instances of each property editor.

Next we configure a [class]`CustomEditorConfigurer` and inject an instance of our [class]`CustomPropertyEditorRegistrar` into it:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.beans.factory.config.CustomEditorConfigurer"&gt;
    &lt;property name="propertyEditorRegistrars"&gt;
        &lt;list&gt;
            &lt;ref bean="customPropertyEditorRegistrar"/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="customPropertyEditorRegistrar"
      class="com.foo.editors.spring.CustomPropertyEditorRegistrar"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Finally, and in a bit of a departure from the focus of this chapter, for those of you using &lt;&lt;mvc,Spring's MVC web
            framework&gt;&gt;, using [interface]`PropertyEditorRegistrars` in conjunction with data-binding [interface]`Controllers` (such as [class]`SimpleFormController`) can be very convenient.
Find below an example of using a [interface]`PropertyEditorRegistrar` in the implementation of an [method]`initBinder(..)` method:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public final class RegisterUserController extends SimpleFormController {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private final PropertyEditorRegistrar customPropertyEditorRegistrar;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public RegisterUserController(PropertyEditorRegistrar propertyEditorRegistrar) {
    this.customPropertyEditorRegistrar = propertyEditorRegistrar;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>protected void initBinder(HttpServletRequest request, ServletRequestDataBinder binder)
                    throws Exception {
    this.customPropertyEditorRegistrar.registerCustomEditors(binder);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    // other methods to do with registering a User
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
This style of [interface]`PropertyEditor` registration can lead to concise code (the implementation of [method]`initBinder(..)` is just one line long!), and allows common [interface]`PropertyEditor` registration code to be encapsulated in a class and then shared amongst as many [interface]`Controllers` as needed.

== Spring 3 Type Conversion

Spring 3 introduces a [file]`core.convert` package that provides a general type conversion system.
The system defines an SPI to implement type conversion logic, as well as an API to execute type conversions at runtime.
Within a Spring container, this system can be used as an alternative to PropertyEditors to convert externalized bean property value strings to required property types.
The public API may also be used anywhere in your application where type conversion is needed.

=== Converter SPI

The SPI to implement type conversion logic is simple and strongly typed:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.core.convert.converter;</p>
</div>
<div class="paragraph">
<p>public interface Converter&lt;S, T&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>T convert(S source);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
To create your own Converter, simply implement the interface above.
Parameterize S as the type you are converting from, and T as the type you are converting to.
For each call to convert(S), the source argument is guaranteed to be NOT null.
Your Converter may throw any Exception if conversion fails.
An IllegalArgumentException should be thrown to report an invalid source value.
Take care to ensure your Converter implementation is thread-safe.

Several converter implementations are provided in the [file]`core.convert.support` package as a convenience.
These include converters from Strings to Numbers and other common types.
Consider [class]`StringToInteger` as an example Converter implementation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.core.convert.support;</p>
</div>
<div class="paragraph">
<p>final class StringToInteger implements Converter&lt;String, Integer&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public Integer convert(String source) {
    return Integer.valueOf(source);
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== ConverterFactory

When you need to centralize the conversion logic for an entire class hierarchy, for example, when converting from String to java.lang.Enum objects, implement [interface]`ConverterFactory`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.core.convert.converter;</p>
</div>
<div class="paragraph">
<p>public interface ConverterFactory&lt;S, R&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;T extends R&gt; Converter&lt;S, T&gt; getConverter(Class&lt;T&gt; targetType);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Parameterize S to be the type you are converting from and R to be the base type defining the _range_ of classes you can convert to.
Then implement getConverter(Class&lt;T&gt;), where T is a subclass of R.

Consider the [class]`StringToEnum` ConverterFactory as an example:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.core.convert.support;</p>
</div>
<div class="paragraph">
<p>final class StringToEnumConverterFactory implements ConverterFactory&lt;String, Enum&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public &lt;T extends Enum&gt; Converter&lt;String, T&gt; getConverter(Class&lt;T&gt; targetType) {
    return new StringToEnumConverter(targetType);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private final class StringToEnumConverter&lt;T extends Enum&gt; implements Converter&lt;String, T&gt; {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private Class&lt;T&gt; enumType;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public StringToEnumConverter(Class&lt;T&gt; enumType) {
    this.enumType = enumType;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        public T convert(String source) {
            return (T) Enum.valueOf(this.enumType, source.trim());
        }
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== GenericConverter

When you require a sophisticated Converter implementation, consider the GenericConverter interface.
With a more flexible but less strongly typed signature, a GenericConverter supports converting between multiple source and target types.
In addition, a GenericConverter makes available source and target field context you can use when implementing your conversion logic.
Such context allows a type conversion to be driven by a field annotation, or generic information declared on a field signature.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.core.convert.converter;</p>
</div>
<div class="paragraph">
<p>public interface GenericConverter {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public Set&lt;ConvertiblePair&gt; getConvertibleTypes();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
To implement a GenericConverter, have getConvertibleTypes() return the supported source-&gt;target type pairs.
Then implement convert(Object, TypeDescriptor, TypeDescriptor) to implement your conversion logic.
The source TypeDescriptor provides access to the source field holding the value being converted.
The target TypeDescriptor provides access to the target field where the converted value will be set.

A good example of a GenericConverter is a converter that converts between a Java Array and a Collection.
Such an ArrayToCollectionConverter introspects the field that declares the target Collection type to resolve the Collection's element type.
This allows each element in the source array to be converted to the Collection element type before the Collection is set on the target field.

NOTE: Because GenericConverter is a more complex SPI interface, only use it when you need it.
Favor Converter or ConverterFactory for basic type conversion needs.

==== ConditionalGenericConverter

Sometimes you only want a Converter to execute if a specific condition holds true.
For example, you might only want to execute a Converter if a specific annotation is present on the target field.
Or you might only want to execute a Converter if a specific method, such as static valueOf method, is defined on the target class.
ConditionalGenericConverter is an subinterface of GenericConverter that allows you to define such custom matching criteria:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface ConditionalGenericConverter extends GenericConverter {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean matches(TypeDescriptor sourceType, TypeDescriptor targetType);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
A good example of a ConditionalGenericConverter is an EntityConverter that converts between an persistent entity identifier and an entity reference.
Such a EntityConverter might only match if the target entity type declares a static finder method e.g.
findAccount(Long).
You would perform such a finder method check in the implementation of matches(TypeDescriptor, TypeDescriptor).

=== ConversionService API

The ConversionService defines a unified API for executing type conversion logic at runtime.
Converters are often executed behind this facade interface:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.core.convert;</p>
</div>
<div class="paragraph">
<p>public interface ConversionService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean canConvert(Class&lt;?&gt; sourceType, Class&lt;?&gt; targetType);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;T&gt; T convert(Object source, Class&lt;T&gt; targetType);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean canConvert(TypeDescriptor sourceType, TypeDescriptor targetType);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Most ConversionService implementations also implement [interface]`ConverterRegistry`, which provides an SPI for registering converters.
Internally, a ConversionService implementation delegates to its registered converters to carry out type conversion logic.

A robust ConversionService implementation is provided in the [file]`core.convert.support` package.
[class]`GenericConversionService` is the general-purpose implementation suitable for use in most environments.
[class]`ConversionServiceFactory` provides a convenient factory for creating common ConversionService configurations.

=== Configuring a ConversionService

A ConversionService is a stateless object designed to be instantiated at application startup, then shared between multiple threads.
In a Spring application, you typically configure a ConversionService instance per Spring container (or ApplicationContext).
That ConversionService will be picked up by Spring and then used whenever a type conversion needs to be performed by the framework.
You may also inject this ConversionService into any of your beans and invoke it directly.

NOTE: If no ConversionService is registered with Spring, the original PropertyEditor-based system is used.

To register a default ConversionService with Spring, add the following bean definition with id `conversionService`:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="conversionService"
      class="org.springframework.context.support.ConversionServiceFactoryBean"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
A default ConversionService can convert between strings, numbers, enums, collections, maps, and other common types.
To supplement or override the default converters with your own custom converter(s), set the `converters` property.
Property values may implement either of the Converter, ConverterFactory, or GenericConverter interfaces.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="conversionService"
      class="org.springframework.context.support.ConversionServiceFactoryBean"&gt;
    &lt;property name="converters"&gt;
        &lt;list&gt;
            &lt;bean class="example.MyCustomConverter"/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
It is also common to use a ConversionService within a Spring MVC application.
See &lt;&lt;format-configuring-formatting-mvc&gt;&gt; for details on use with `&lt;mvc:annotation-driven/&gt;`.

In certain situations you may wish to apply formatting during conversion.
See &lt;&lt;format-FormatterRegistry-SPI&gt;&gt; for details on using [class]`FormattingConversionServiceFactoryBean`.

=== Using a ConversionService programmatically

To work with a ConversionService instance programmatically, simply inject a reference to it like you would for any other bean:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Service
public class MyService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
public MyService(ConversionService conversionService) {
    this.conversionService = conversionService;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void doIt() {
        this.conversionService.convert(...)
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Spring 3 Field Formatting

As discussed in the previous section, &lt;&lt;core-convert,[file]`core.convert`&gt;&gt; is a general-purpose type conversion system.
It provides a unified ConversionService API as well as a strongly-typed Converter SPI for implementing conversion logic from one type to another.
A Spring Container uses this system to bind bean property values.
In addition, both the Spring Expression Language (SpEL) and DataBinder use this system to bind field values.
For example, when SpEL needs to coerce a [class]`Short` to a [class]`Long` to complete an  attempt, the core.convert system performs the coercion.

Now consider the type conversion requirements of a typical client environment such as a web or desktop application.
In such environments, you typically convert _from String_ to support the client postback process, as well as back _to String_ to support the view rendering process.
In addition, you often need to localize String values.
The more general _core.convert_ Converter SPI does not address such _formatting_ requirements directly.
To directly address them, Spring 3 introduces a convenient Formatter SPI that provides a simple and robust alternative to PropertyEditors for client environments.

In general, use the Converter SPI when you need to implement general-purpose type conversion logic; for example, for converting between a java.util.Date and and java.lang.Long.
Use the Formatter SPI when you're working in a client environment, such as a web application, and need to parse and print localized field values.
The ConversionService provides a unified type conversion API for both SPIs.

=== Formatter SPI

The Formatter SPI to implement field formatting logic is simple and strongly typed:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.format;</p>
</div>
<div class="paragraph">
<p>public interface Formatter&lt;T&gt; extends Printer&lt;T&gt;, Parser&lt;T&gt; {
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Where Formatter extends from the Printer and Parser building-block interfaces:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface Printer&lt;T&gt; {
    String print(T fieldValue, Locale locale);
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import java.text.ParseException;</p>
</div>
<div class="paragraph">
<p>public interface Parser&lt;T&gt; {
    T parse(String clientValue, Locale locale) throws ParseException;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
To create your own Formatter, simply implement the Formatter interface above.
Parameterize T to be the type of object you wish to format, for example, [class]`java.util.Date`.
Implement the [method]`print()` operation to print an instance of T for display in the client locale.
Implement the [method]`parse()` operation to parse an instance of T from the formatted representation returned from the client locale.
Your Formatter should throw a ParseException or IllegalArgumentException if a parse attempt fails.
Take care to ensure your Formatter implementation is thread-safe.

Several Formatter implementations are provided in [file]`format` subpackages as a convenience.
The [file]`number` package provides a NumberFormatter, CurrencyFormatter, and PercentFormatter to format java.lang.Number objects using a java.text.NumberFormat.
The [file]`datetime` package provides a DateFormatter to format java.util.Date objects with a java.text.DateFormat.
The [file]`datetime.joda` package provides comprehensive datetime formatting support based on the &lt;&lt;,Joda Time library&gt;&gt;.

Consider [class]`DateFormatter` as an example [interface]`Formatter` implementation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.format.datetime;</p>
</div>
<div class="paragraph">
<p>public final class DateFormatter implements Formatter&lt;Date&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private String pattern;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public DateFormatter(String pattern) {
    this.pattern = pattern;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public String print(Date date, Locale locale) {
    if (date == null) {
        return "";
    }
    return getDateFormat(locale).format(date);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Date parse(String formatted, Locale locale) throws ParseException {
    if (formatted.length() == 0) {
        return null;
    }
    return getDateFormat(locale).parse(formatted);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>protected DateFormat getDateFormat(Locale locale) {
    DateFormat dateFormat = new SimpleDateFormat(this.pattern, locale);
    dateFormat.setLenient(false);
    return dateFormat;
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The Spring team welcomes community-driven Formatter contributions; see &lt;&lt;,http://jira.springframework.org&gt;&gt; to contribute.

=== Annotation-driven Formatting

As you will see, field formatting can be configured by field type or annotation.
To bind an Annotation to a formatter, implement AnnotationFormatterFactory:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.format;</p>
</div>
<div class="paragraph">
<p>public interface AnnotationFormatterFactory&lt;A extends Annotation&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Set&lt;Class&lt;?&gt;&gt; getFieldTypes();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Printer&lt;?&gt; getPrinter(A annotation, Class&lt;?&gt; fieldType);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Parser&lt;?&gt; getParser(A annotation, Class&lt;?&gt; fieldType);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Parameterize A to be the field annotationType you wish to associate formatting logic with, for example `org.springframework.format.annotation.DateTimeFormat`.
Have [method]`getFieldTypes()` return the types of fields the annotation may be used on.
Have [method]`getPrinter()` return a Printer to print the value of an annotated field.
Have [method]`getParser()` return a Parser to parse a clientValue for an annotated field.

The example AnnotationFormatterFactory implementation below binds the @NumberFormat Annotation to a formatter.
This annotation allows either a number style or pattern to be specified:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public final class NumberFormatAnnotationFormatterFactory
        implements AnnotationFormatterFactory&lt;NumberFormat&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public Set&lt;Class&lt;?&gt;&gt; getFieldTypes() {
    return new HashSet&lt;Class&lt;?&gt;&gt;(asList(new Class&lt;?&gt;[] {
        Short.class, Integer.class, Long.class, Float.class,
        Double.class, BigDecimal.class, BigInteger.class }));
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Printer&lt;Number&gt; getPrinter(NumberFormat annotation, Class&lt;?&gt; fieldType) {
    return configureFormatterFrom(annotation, fieldType);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Parser&lt;Number&gt; getParser(NumberFormat annotation, Class&lt;?&gt; fieldType) {
    return configureFormatterFrom(annotation, fieldType);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    private Formatter&lt;Number&gt; configureFormatterFrom(NumberFormat annotation,
                                                     Class&lt;?&gt; fieldType) {
        if (!annotation.pattern().isEmpty()) {
            return new NumberFormatter(annotation.pattern());
        } else {
            Style style = annotation.style();
            if (style == Style.PERCENT) {
                return new PercentFormatter();
            } else if (style == Style.CURRENCY) {
                return new CurrencyFormatter();
            } else {
                return new NumberFormatter();
            }
        }
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
To trigger formatting, simply annotate fields with @NumberFormat:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class MyModel {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@NumberFormat(style=Style.CURRENCY)
private BigDecimal decimal;</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Format Annotation API

A portable format annotation API exists in the [file]`org.springframework.format.annotation` package.
Use @NumberFormat to format java.lang.Number fields.
Use @DateTimeFormat to format java.util.Date, java.util.Calendar, java.util.Long, or Joda Time fields.

The example below uses @DateTimeFormat to format a java.util.Date as a ISO Date (yyyy-MM-dd):

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class MyModel {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@DateTimeFormat(iso=ISO.DATE)
private Date date;</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== FormatterRegistry SPI

The FormatterRegistry is an SPI for registering formatters and converters.
[class]`FormattingConversionService` is an implementation of FormatterRegistry suitable for most environments.
This implementation may be configured programmatically or declaratively as a Spring bean using [class]`FormattingConversionServiceFactoryBean`.
Because this implementation also implements [class]`ConversionService`, it can be directly configured for use with Spring's DataBinder and the Spring Expression Language (SpEL).


Review the FormatterRegistry SPI below:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.format;</p>
</div>
<div class="paragraph">
<p>public interface FormatterRegistry extends ConverterRegistry {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>void addFormatterForFieldType(Class&lt;?&gt; fieldType, Printer&lt;?&gt; printer, Parser&lt;?&gt; parser);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void addFormatterForFieldType(Class&lt;?&gt; fieldType, Formatter&lt;?&gt; formatter);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void addFormatterForFieldType(Formatter&lt;?&gt; formatter);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void addFormatterForAnnotation(AnnotationFormatterFactory&lt;?, ?&gt; factory);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
As shown above, Formatters can be registered by fieldType or annotation.


The FormatterRegistry SPI allows you to configure Formatting rules centrally, instead of duplicating such configuration across your Controllers.
For example, you might want to enforce that all Date fields are formatted a certain way, or fields with a specific annotation are formatted in a certain way.
With a shared FormatterRegistry, you define these rules once and they are applied whenever formatting is needed.


=== FormatterRegistrar SPI

The FormatterRegistrar is an SPI for registering formatters and converters through the FormatterRegistry:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.format;</p>
</div>
<div class="paragraph">
<p>public interface FormatterRegistrar {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>void registerFormatters(FormatterRegistry registry);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
A FormatterRegistrar is useful when registering multiple related converters and formatters for a given formatting category, such as Date formatting.
It can also be useful where declarative registration is insufficient.
For example when a formatter needs to be indexed under a specific field type different from its own &lt;T&gt; or when registering a Printer/Parser pair.
The next section provides more information on converter and formatter registration.


=== Configuring Formatting in Spring MVC

In a Spring MVC application, you may configure a custom ConversionService instance explicitly as an attribute of the `annotation-driven` element of the MVC namespace.
This ConversionService will then be used anytime a type conversion is required during Controller model binding.
If not configured explicitly, Spring MVC will automatically register default formatters and converters for common types such as numbers and dates.

To rely on default formatting rules, no custom configuration is required in your Spring MVC config XML:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
        <a href="http://www.springframework.org/schema/mvc">http://www.springframework.org/schema/mvc</a>
        <a href="http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;">http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;mvc:annotation-driven/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
With this one-line of configuration, default formatters for Numbers and Date types will be installed, including support for the @NumberFormat and @DateTimeFormat annotations.
Full support for the Joda Time formatting library is also installed if Joda Time is present on the classpath.

To inject a ConversionService instance with custom formatters and converters registered, set the conversion-service attribute and then specify custom converters, formatters, or FormatterRegistrars as properties of the FormattingConversionServiceFactoryBean:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
        <a href="http://www.springframework.org/schema/mvc">http://www.springframework.org/schema/mvc</a>
        <a href="http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;">http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;mvc:annotation-driven conversion-service="conversionService"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="conversionService"
      class="org.springframework.format.support.FormattingConversionServiceFactoryBean"&gt;
    &lt;property name="converters"&gt;
        &lt;set&gt;
            &lt;bean class="org.example.MyConverter"/&gt;
        &lt;/set&gt;
    &lt;/property&gt;
    &lt;property name="formatters"&gt;
        &lt;set&gt;
            &lt;bean class="org.example.MyFormatter"/&gt;
            &lt;bean class="org.example.MyAnnotationFormatterFactory"/&gt;
        &lt;/set&gt;
    &lt;/property&gt;
    &lt;property name="formatterRegistrars"&gt;
        &lt;set&gt;
            &lt;bean class="org.example.MyFormatterRegistrar"/&gt;
        &lt;/set&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: See &lt;&lt;format-FormatterRegistrar-SPI&gt;&gt; and the [class]`FormattingConversionServiceFactoryBean` for more information on when to use FormatterRegistrars.


== Configuring a global date &amp; time format

By default, date and time fields that are not annotated with [interface]`@DateTimeFormat` are converted from strings using the the `DateFormat.SHORT` style.
If you prefer, you can change this by defining your own global format.

You will need to ensure that Spring does not register default formatters, and instead you should register all formatters manually.
Use the [class]`org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar` or [class]`org.springframework.format.datetime.DateFormatterRegistrar` class depending on whether you use the Joda Time library.

For example, the following Java configuration will register a global '`yyyyMMdd`' format.
This example does not depend on the Joda Time library:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Configuration
public class AppConfig {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Bean
public FormattingConversionService conversionService() {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// Use the DefaultFormattingConversionService but do not register defaults
DefaultFormattingConversionService conversionService = new DefaultFormattingConversionService(false);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// Ensure @NumberFormat is still supported
conversionService.addFormatterForFieldAnnotation(new NumberFormatAnnotationFormatterFactory());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// Register date conversion with a specific global format
DateFormatterRegistrar registrar = new DateFormatterRegistrar();
registrar.setFormatter(new DateFormatter("yyyyMMdd"));
registrar.registerFormatters(conversionService);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    return conversionService;
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
If you prefer XML based configuration you can use a [class]`FormattingConversionServiceFactoryBean`.
Here is the same example, this time using Joda Time:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd&gt;">http://www.springframework.org/schema/beans/spring-beans.xsd&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;bean id="conversionService" class="org.springframework.format.support.FormattingConversionServiceFactoryBean"&gt;
      &lt;property name="registerDefaultFormatters" value="false" /&gt;
      &lt;property name="formatters"&gt;
      &lt;set&gt;
          &lt;bean class="org.springframework.format.number.NumberFormatAnnotationFormatterFactory" /&gt;
      &lt;/set&gt;
      &lt;/property&gt;
      &lt;property name="formatterRegistrars"&gt;
      &lt;set&gt;
        &lt;bean class="org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar"&gt;
            &lt;property name="dateFormatter"&gt;
                &lt;bean class="org.springframework.format.datetime.joda.DateTimeFormatterFactoryBean"&gt;
                    &lt;property name="pattern" value="yyyyMMdd"/&gt;
                &lt;/bean&gt;
            &lt;/property&gt;
        &lt;/bean&gt;
    &lt;/set&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: Joda Time provides separate distinct types to represent `date`, `time` and `date-time` values.
The `dateFormatter`, `timeFormatter` and `dateTimeFormatter` properties of the [class]`JodaTimeFormatterRegistrar` should be used to configure the different formats for each type.
The [class]`DateTimeFormatterFactoryBean` provides a convenient way to create formatters.

If you are using Spring MVC remember to explicitly configure the conversion service that is used.
For Java based [interface]`@Configuration` this means extending the [class]`WebMvcConfigurationSupport` class and overriding the `mvcConversionService()` method.
For XML you should use the `'conversion-service'` attribute of the `mvc:annotation-driven` element.
See &lt;&lt;format-configuring-formatting-mvc&gt;&gt; for details.

== Spring 3 Validation

Spring 3 introduces several enhancements to its validation support.
First, the JSR-303 Bean Validation API is now fully supported.
Second, when used programmatically, Spring's DataBinder can now validate objects as well as bind to them.
Third, Spring MVC now has support for declaratively validating @Controller inputs.

=== Overview of the JSR-303 Bean Validation API

JSR-303 standardizes validation constraint declaration and metadata for the Java platform.
Using this API, you annotate domain model properties with declarative validation constraints and the runtime enforces them.
There are a number of built-in constraints you can take advantage of.
You may also define your own custom constraints.

To illustrate, consider a simple PersonForm model with two properties:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class PersonForm {
    private String name;
    private int age;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
JSR-303 allows you to define declarative validation constraints against such properties:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class PersonForm {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@NotNull
@Size(max=64)
private String name;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Min(0)
private int age;</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
When an instance of this class is validated by a JSR-303 Validator, these constraints will be enforced.

For general information on JSR-303/JSR-349, see the &lt;&lt;,Bean Validation website&gt;&gt;.
For information on the specific capabilities of the default reference implementation, see the &lt;&lt;,Hibernate Validator&gt;&gt; documentation.
To learn how to setup a Bean Validation provider as a Spring bean, keep reading.

=== Configuring a Bean Validation Provider

Spring provides full support for the Bean Validation API. This includes convenient support for bootstrapping a JSR-303/JSR-349 Bean Validation provider as a Spring bean.
This allows for a `javax.validation.ValidatorFactory` or `javax.validation.Validator` to be injected wherever validation is needed in your application.

Use the [class]`LocalValidatorFactoryBean` to configure a default Validator as a Spring bean:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="validator"
      class="org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The basic configuration above will trigger Bean Validation to initialize using its default bootstrap mechanism.
A JSR-303/JSR-349 provider, such as Hibernate Validator, is expected to be present in the classpath and will be detected automatically.

==== Injecting a Validator

[class]`LocalValidatorFactoryBean` implements both `javax.validation.ValidatorFactory` and `javax.validation.Validator`, as well as Spring's `org.springframework.validation.Validator`.
You may inject a reference to either of these interfaces into beans that need to invoke validation logic.

Inject a reference to `javax.validation.Validator` if you prefer to work with the Bean Validation API directly:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import javax.validation.Validator;</p>
</div>
<div class="paragraph">
<p>@Service
public class MyService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
private Validator validator;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Inject a reference to `org.springframework.validation.Validator` if your bean requires the Spring Validation API:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.springframework.validation.Validator;</p>
</div>
<div class="paragraph">
<p>@Service
public class MyService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
private Validator validator;</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Configuring Custom Constraints

Each Bean Validation constraint consists of two parts.
First, a @Constraint annotation that declares the constraint and its configurable properties.
Second, an implementation of the `javax.validation.ConstraintValidator` interface that implements the constraint's behavior.
To associate a declaration with an implementation, each @Constraint annotation references a corresponding ValidationConstraint implementation class.
At runtime, a `ConstraintValidatorFactory` instantiates the referenced implementation when the constraint annotation is encountered in your domain model.

By default, the [class]`LocalValidatorFactoryBean` configures a `SpringConstraintValidatorFactory` that uses Spring to create ConstraintValidator instances.
This allows your custom ConstraintValidators to benefit from dependency injection like any other Spring bean.

Shown below is an example of a custom @Constraint declaration, followed by an associated `ConstraintValidator` implementation that uses Spring for dependency injection:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Target({ElementType.METHOD, ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy=MyConstraintValidator.class)
public @interface MyConstraint {
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import javax.validation.ConstraintValidator;</p>
</div>
<div class="paragraph">
<p>public class MyConstraintValidator implements ConstraintValidator {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired;
private Foo aDependency;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    ...
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
As you can see, a ConstraintValidator implementation may have its dependencies @Autowired like any other Spring bean.

==== Additional Configuration Options

The default [class]`LocalValidatorFactoryBean` configuration should prove sufficient for most cases.
There are a number of configuration options for various Bean Validation constructs, from message interpolation to traversal resolution.
See the JavaDocs of [class]`LocalValidatorFactoryBean` for more information on these options.

=== Configuring a DataBinder

Since Spring 3, a DataBinder instance can be configured with a Validator.
Once configured, the Validator may be invoked by calling `binder.validate()`.
Any validation Errors are automatically added to the binder's BindingResult.

When working with the DataBinder programmatically, this can be used to invoke validation logic after binding to a target object:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Foo target = new Foo();
DataBinder binder = new DataBinder(target);
binder.setValidator(new FooValidator());</p>
</div>
<div class="paragraph">
<p>binder.bind(propertyValues);</p>
</div>
<div class="paragraph">
<p>binder.validate();</p>
</div>
<div class="paragraph">
<p>BindingResult results = binder.getBindingResult();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
A DataBinder can also be configured with multiple [interface]`Validator` instances via `dataBinder.addValidators` and `dataBinder.replaceValidators`.
This is useful when combining globally configured Bean Validation with a Spring [interface]`Validator` configured locally on a DataBinder instance.
See &lt;&lt;validation-mvc-configuring&gt;&gt;.

=== Spring MVC 3 Validation

Beginning with Spring 3, Spring MVC has the ability to automatically validate @Controller inputs.
In previous versions it was up to the developer to manually invoke validation logic.

==== Triggering @Controller Input Validation

To trigger validation of a @Controller input, simply annotate the input argument as @Valid:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Controller
public class MyController {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@RequestMapping("/foo", method=RequestMethod.POST)
public void processFoo(@Valid Foo foo) { /* ... */ }</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Spring MVC will validate a @Valid object after binding so-long as an appropriate Validator has been configured.

NOTE: The @Valid annotation is part of the standard JSR-303 Bean Validation API, and is not a Spring-specific construct.

==== Configuring a Validator for use by Spring MVC

The Validator instance invoked when a @Valid method argument is encountered may be configured in two ways.
First, you may call binder.setValidator(Validator) within a @Controller's @InitBinder callback.
This allows you to configure a Validator instance per @Controller class:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Controller
public class MyController {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@InitBinder
protected void initBinder(WebDataBinder binder) {
    binder.setValidator(new FooValidator());
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@RequestMapping("/foo", method=RequestMethod.POST)
public void processFoo(@Valid Foo foo) { ... }</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Second, you may call setValidator(Validator) on the global WebBindingInitializer.
This allows you to configure a Validator instance across all @Controllers.
This can be achieved easily by using the Spring MVC namespace:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
        <a href="http://www.springframework.org/schema/mvc">http://www.springframework.org/schema/mvc</a>
        <a href="http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;">http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;mvc:annotation-driven validator="globalValidator"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
To combine a global and a local validator, configure the global validator as shown above and then add a local validator:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Controller
public class MyController {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@InitBinder
protected void initBinder(WebDataBinder binder) {
    binder.addValidators(new FooValidator());
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Configuring a JSR-303/JSR-349 Validator for use by Spring MVC

With Bean Validation, a single `javax.validation.Validator` instance typically validates _all_ model objects that declare validation constraints.
To configure such a JSR-303 backed Validator with Spring MVC, simply add a Bean Validation provider, such as Hibernate Validator, to your classpath.
Spring MVC will detect it and automatically enable Bean Validation support across all Controllers.

The Spring MVC configuration required to enable Bean Validation support is shown below:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
        <a href="http://www.springframework.org/schema/mvc">http://www.springframework.org/schema/mvc</a>
        <a href="http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;">http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- JSR-303/JSR-349 support will be detected on classpath and enabled automatically --&gt;
&lt;mvc:annotation-driven/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
With this minimal configuration, anytime a @Valid @Controller input is encountered, it will be validated by the Bean Validation provider.
That provider, in turn, will enforce any constraints declared against the input.
Any ConstraintViolations will automatically be exposed as errors in the BindingResult renderable by standard Spring MVC form tags.


= Spring Expression Language (SpEL)

== Introduction

The Spring Expression Language (SpEL for short) is a powerful expression language that supports querying and manipulating an object graph at runtime.
The language syntax is similar to Unified EL but offers additional features, most notably method invocation and basic string templating functionality.

While there are several other Java expression languages available, OGNL, MVEL, and JBoss EL, to name a few, the Spring Expression Language was created to provide the Spring community with a single well supported expression language that can be used across all the products in the Spring portfolio.
Its language features are driven by the requirements of the projects in the Spring portfolio, including tooling requirements for code completion support within the eclipse based SpringSource Tool Suite.
That said, SpEL is based on a technology agnostic API allowing other expression language implementations to be integrated should the need arise.

While SpEL serves as the foundation for expression evaluation within the Spring portfolio, it is not directly tied to Spring and can be used independently.
In order to be self contained, many of the examples in this chapter use SpEL as if it were an independent expression language.
This requires creating a few bootstrapping infrastructure classes such as the parser.
Most Spring users will not need to deal with this infrastructure and will instead only author expression strings for evaluation.
An example of this typical use is the integration of SpEL into creating XML or annotated based bean definitions as shown in the section &lt;&lt;expressions-beandef,Expression support for defining bean
    definitions.&gt;&gt;

This chapter covers the features of the expression language, its API, and its language syntax.
In several places an Inventor and Inventor's Society class are used as the target objects for expression evaluation.
These class declarations and the data used to populate them are listed at the end of the chapter.

== Feature Overview

The expression language supports the following functionality

* Literal expressions
* Boolean and relational operators
* Regular expressions
* Class expressions
* Accessing properties, arrays, lists, maps
* Method invocation
* Relational operators
* Assignment
* Calling constructors
* Bean references
* Array construction
* Inline lists
* Ternary operator
* Variables
* User defined functions
* Collection projection
* Collection selection
* Templated expressions

== Expression Evaluation using Spring's Expression Interface

This section introduces the simple use of SpEL interfaces and its expression language.
The complete language reference can be found in the section &lt;&lt;expressions-language-ref,Language
    Reference&gt;&gt;.

The following code introduces the SpEL API to evaluate the literal string expression 'Hello World'.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression("<em>Hello World</em>");
String message = (String) exp.getValue();
----The value of the message variable is simply <em>Hello World</em>.</p>
</div>
<div class="paragraph">
<p>The SpEL classes and interfaces you are most likely to use are located in the packages  and its sub packages and .</p>
</div>
<div class="paragraph">
<p>The interface <code class="interface">ExpressionParser</code> is responsible for parsing an expression string.
In this example the expression string is a string literal denoted by the surrounding single quotes.
The interface <code class="interface">Expression</code> is responsible for evaluating the previously defined expression string.
There are two exceptions that can be thrown, <code class="class">ParseException</code> and <code class="class">EvaluationException</code> when calling <em><code>parser.parseExpression</code></em> and <em><code>exp.getValue</code></em> respectively.</p>
</div>
<div class="paragraph">
<p>SpEL supports a wide range of features, such as calling methods, accessing properties, and calling constructors.</p>
</div>
<div class="paragraph">
<p>As an example of method invocation, we call the <em>concat</em> method on the string literal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression("'Hello World'.concat('!')");
String message = (String) exp.getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of message is now <em>Hello World!</em>.</p>
</div>
<div class="paragraph">
<p>As an example of calling a JavaBean property, the String property <em>Bytes</em> can be called as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>ExpressionParser parser = new SpelExpressionParser();

// invokes 'getBytes()'
Expression exp = parser.parseExpression("'Hello World'.bytes");

byte[] bytes = (byte[]) exp.getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>SpEL also supports nested properties using standard <em>dot</em> notation, i.e.
prop1.prop2.prop3 and the setting of property values</p>
</div>
<div class="paragraph">
<p>Public fields may also be accessed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>ExpressionParser parser = new SpelExpressionParser();

// invokes 'getBytes().length'
Expression exp = parser.parseExpression("'Hello World'.bytes.length");

int length = (Integer) exp.getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The String&#8217;s constructor can be called instead of using a string literal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression("new String('hello world').toUpperCase()");
String message = exp.getValue(String.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the generic method <code>public &lt;T&gt; T
    getValue(Class&lt;T&gt; desiredResultType)</code>.
Using this method removes the need to cast the value of the expression to the desired result type.
An <code class="class">EvaluationException</code> will be thrown if the value cannot be cast to the type <code>T</code> or converted using the registered type converter.</p>
</div>
<div class="paragraph">
<p>The more common usage of SpEL is to provide an expression string that is evaluated against a specific object instance (called the root object).
There are two options here and which to choose depends on whether the object against which the expression is being evaluated will be changing with each call to evaluate the expression.
 In the following example we retrieve the <code>name</code> property from an instance of the Inventor class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// Create and set a calendar
GregorianCalendar c = new GregorianCalendar();
c.set(1856, 7, 9);

//  The constructor arguments are name, birthday, and nationality.
Inventor tesla = new Inventor("Nikola Tesla", c.getTime(), "Serbian");

ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression("name");
EvaluationContext context = new StandardEvaluationContext(tesla);

String name = (String) exp.getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the last line, the value of the string variable <em>name</em> will be set to "Nikola Tesla".
The class StandardEvaluationContext is where you can specify which object the "name" property will be evaluated against.
 This is the mechanism to use if the root object is unlikely to change, it can simply be set once in the evaluation context.
 If the root object is likely to change repeatedly, it can be supplied on each call to <code>getValue</code>, as this next example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>/ Create and set a calendar
GregorianCalendar c = new GregorianCalendar();
c.set(1856, 7, 9);

//  The constructor arguments are name, birthday, and nationality.
Inventor tesla = new Inventor("Nikola Tesla", c.getTime(), "Serbian");

ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression("name");

String name = (String) exp.getValue(tesla);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the inventor <code>tesla</code> has been supplied directly to <code>getValue</code> and the expression evaluation infrastructure creates and manages a default evaluation context internally - it did not require one to be supplied.</p>
</div>
<div class="paragraph">
<p>The StandardEvaluationContext is relatively expensive to construct and during repeated usage it builds up cached state that enables subsequent expression evaluations to be performed more quickly.
 For this reason it is better to cache and reuse them where possible, rather than construct a new one for each expression evaluation.</p>
</div>
<div class="paragraph">
<p>In some cases it can be desirable to use a configured evaluation context and yet still supply a different root object on each call to <code>getValue</code>.
<code>getValue</code> allows both to be specified on the same call.
In these situations the root object passed on the call is considered to override any (which maybe null) specified on the evaluation context.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
In standalone usage of SpEL there is a need to create the parser, parse expressions and perhaps provide evaluation contexts and a root context object.
However, more common usage is to provide only the SpEL expression string as part of a configuration file, for example for Spring bean or Spring Web Flow definitions.
In this case, the parser, evaluation context, root object and any predefined variables are all set up implicitly, requiring the user to specify nothing other than the expressions. As a final introductory example, the use of a boolean operator is shown using the Inventor object in the previous example.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>Expression exp = parser.parseExpression("name == 'Nikola Tesla'");
boolean result = exp.getValue(context, Boolean.class);  // evaluates to true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-evaluationcontext-interface"><a class="anchor" href="#the-evaluationcontext-interface"></a>The EvaluationContext interface</h3>
<div class="paragraph">
<p>The interface <code class="interface">EvaluationContext</code> is used when evaluating an expression to resolve properties, methods, fields, and to help perform type conversion.
The out-of-the-box implementation, <code class="class">StandardEvaluationContext</code>, uses reflection to manipulate the object, caching 's <code class="class">Method</code>, <code class="class">Field</code>, and <code class="class">Constructor</code> instances for increased performance.</p>
</div>
<div class="paragraph">
<p>The <code class="class">StandardEvaluationContext</code> is where you may specify the root object to evaluate against via the method <code class="method">setRootObject()</code> or passing the root object into the constructor.
You can also specify variables and functions that will be used in the expression using the methods <code class="method">setVariable()</code> and <code class="method">registerFunction()</code>.
The use of variables and functions are described in the language reference sections <a href="#expressions-ref-variables">Variables</a> and <a href="#expressions-ref-functions">Functions</a>.
The <code class="class">StandardEvaluationContext</code> is also where you can register custom [class]`ConstructorResolver`s, [class]`MethodResolver`s, and [class]`PropertyAccessor`s to extend how SpEL evaluates expressions.
Please refer to the JavaDoc of these classes for more details.</p>
</div>
<div class="sect3">
<h4 id="type-conversion"><a class="anchor" href="#type-conversion"></a>Type Conversion</h4>
<div class="paragraph">
<p>By default SpEL uses the conversion service available in Spring core (<code>org.springframework.core.convert.ConversionService</code>).
This conversion service comes with many converters built in for common conversions but is also fully extensible so custom conversions between types can be added.
Additionally it has the key capability that it is generics aware.
This means that when working with generic types in expressions, SpEL will attempt conversions to maintain type correctness for any objects it encounters.</p>
</div>
<div class="paragraph">
<p>What does this mean in practice? Suppose assignment, using <code>setValue()</code>, is being used to set a <code>List</code> property.
The type of the property is actually <code>List&lt;Boolean&gt;</code>.
SpEL will recognize that the elements of the list need to be converted to <code>Boolean</code> before being placed in it.
A simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>class Simple {
    public List&lt;Boolean&gt; booleanList = new ArrayList&lt;Boolean&gt;();
}

Simple simple = new Simple();

simple.booleanList.add(true);

StandardEvaluationContext simpleContext = new StandardEvaluationContext(simple);

// false is passed in here as a string.  SpEL and the conversion service will
// correctly recognize that it needs to be a Boolean and convert it
parser.parseExpression("booleanList[0]").setValue(simpleContext, "false");

// b will be false
Boolean b = simple.booleanList.get(0);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="expression-support-for-defining-bean-definitions"><a class="anchor" href="#expression-support-for-defining-bean-definitions"></a>Expression support for defining bean definitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SpEL expressions can be used with XML or annotation based configuration metadata for defining BeanDefinitions.
In both cases the syntax to define the expression is of the form <code>#{ &lt;expression
    string&gt; }</code>.</p>
</div>
<div class="sect2">
<h3 id="xml-based-configuration"><a class="anchor" href="#xml-based-configuration"></a>XML based configuration</h3>
<div class="paragraph">
<p>A property or constructor-arg value can be set using expressions as shown below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="numberGuess" class="org.spring.samples.NumberGuess"&gt;
    &lt;property name="randomNumber" value="#{ T(java.lang.Math).random() * 100.0 }"/&gt;

    &lt;!-- other properties --&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The variable <em>systemProperties</em> is predefined, so you can use it in your expressions as shown below.
Note that you do not have to prefix the predefined variable with the <em>#</em> symbol in this context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="taxCalculator" class="org.spring.samples.TaxCalculator"&gt;
    &lt;property name="defaultLocale" value="#{ systemProperties['user.region'] }"/&gt;

    &lt;!-- other properties --&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also refer to other bean properties by name, for example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="numberGuess" class="org.spring.samples.NumberGuess"&gt;
    &lt;property name="randomNumber" value="#{ T(java.lang.Math).random() * 100.0 }"/&gt;

    &lt;!-- other properties --&gt;
&lt;/bean&gt;


&lt;bean id="shapeGuess" class="org.spring.samples.ShapeGuess"&gt;
    &lt;property name="initialShapeSeed" value="#{ numberGuess.randomNumber }"/&gt;

    &lt;!-- other properties --&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="annotation-based-configuration"><a class="anchor" href="#annotation-based-configuration"></a>Annotation-based configuration</h3>
<div class="paragraph">
<p>The <code>@Value</code> annotation can be placed on fields, methods and method/constructor parameters to specify a default value.</p>
</div>
<div class="paragraph">
<p>Here is an example to set the default value of a field variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public static class FieldValueTestBean

  @Value("#{ systemProperties['user.region'] }")
  private String defaultLocale;

  public void setDefaultLocale(String defaultLocale)
  {
    this.defaultLocale = defaultLocale;
  }

  public String getDefaultLocale()
  {
    return this.defaultLocale;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent but on a property setter method is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public static class PropertyValueTestBean

  private String defaultLocale;

  @Value("#{ systemProperties['user.region'] }")
  public void setDefaultLocale(String defaultLocale)
  {
    this.defaultLocale = defaultLocale;
  }

  public String getDefaultLocale()
  {
    return this.defaultLocale;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Autowired methods and constructors can also use the <code>@Value</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class SimpleMovieLister {

  private MovieFinder movieFinder;
  private String defaultLocale;

  @Autowired
  public void configure(MovieFinder movieFinder,
                        @Value("#{ systemProperties['user.region'] }") String defaultLocale) {
      this.movieFinder = movieFinder;
      this.defaultLocale = defaultLocale;
  }

  // ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MovieRecommender {

  private String defaultLocale;

  private CustomerPreferenceDao customerPreferenceDao;

  @Autowired
  public MovieRecommender(CustomerPreferenceDao customerPreferenceDao,
                          @Value("#{systemProperties['user.country']}") String defaultLocale) {
      this.customerPreferenceDao = customerPreferenceDao;
      this.defaultLocale = defaultLocale;
  }

  // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="language-reference"><a class="anchor" href="#language-reference"></a>Language Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="literal-expressions"><a class="anchor" href="#literal-expressions"></a>Literal expressions</h3>
<div class="paragraph">
<p>The types of literal expressions supported are strings, dates, numeric values (int, real, and hex), boolean and null.
Strings are delimited by single quotes.
To put a single quote itself in a string use two single quote characters.
The following listing shows simple usage of literals.
Typically they would not be used in isolation like this, but as part of a more complex expression, for example using a literal on one side of a logical comparison operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>ExpressionParser parser = new SpelExpressionParser();

// evals to "Hello World"
String helloWorld = (String) parser.parseExpression("'Hello World'").getValue();

double avogadrosNumber  = (Double) parser.parseExpression("6.0221415E+23").getValue();

// evals to 2147483647
int maxValue = (Integer) parser.parseExpression("0x7FFFFFFF").getValue();

boolean trueValue = (Boolean) parser.parseExpression("true").getValue();

Object nullValue = parser.parseExpression("null").getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Numbers support the use of the negative sign, exponential notation, and decimal points.
By default real numbers are parsed using Double.parseDouble().</p>
</div>
</div>
<div class="sect2">
<h3 id="properties-arrays-lists-maps-indexers"><a class="anchor" href="#properties-arrays-lists-maps-indexers"></a>Properties, Arrays, Lists, Maps, Indexers</h3>
<div class="paragraph">
<p>Navigating with property references is easy, just use a period to indicate a nested property value.
The instances of Inventor class, pupin and tesla, were populated with data listed in the section <a href="#expressions-example-classes">Classes used in the
      examples</a>.
To navigate "down" and get Tesla&#8217;s year of birth and Pupin&#8217;s city of birth the following expressions are used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// evals to 1856
int year = (Integer) parser.parseExpression("Birthdate.Year + 1900").getValue(context);


String city = (String) parser.parseExpression("placeOfBirth.City").getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Case insensitivity is allowed for the first letter of property names.
The contents of arrays and lists are obtained using square bracket notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>ExpressionParser parser = new SpelExpressionParser();

// Inventions Array
StandardEvaluationContext teslaContext = new StandardEvaluationContext(tesla);

// evaluates to "Induction motor"
String invention = parser.parseExpression("inventions[3]").getValue(teslaContext,
                                                                    String.class);


// Members List
StandardEvaluationContext societyContext = new StandardEvaluationContext(ieee);

// evaluates to "Nikola Tesla"
String name = parser.parseExpression("Members[0].Name").getValue(societyContext, String.class);

// List and Array navigation
// evaluates to "Wireless communication"
String invention = parser.parseExpression("Members[0].Inventions[6]").getValue(societyContext,
                                                                               String.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The contents of maps are obtained by specifying the literal key value within the brackets.
In this case, because keys for the Officers map are strings, we can specify string literals.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// Officer's Dictionary

Inventor pupin = parser.parseExpression("Officers['president']").getValue(societyContext,
                                                                          Inventor.class);

// evaluates to "Idvor"
String city =
    parser.parseExpression("Officers['president'].PlaceOfBirth.City").getValue(societyContext,
                                                                               String.class);

// setting values
parser.parseExpression("Officers['advisors'][0].PlaceOfBirth.Country").setValue(societyContext,
                                                                                "Croatia");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inline-lists"><a class="anchor" href="#inline-lists"></a>Inline lists</h3>
<div class="paragraph">
<p>Lists can be expressed directly in an expression using {} notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
// evaluates to a Java list containing the four numbers
List numbers = (List) parser.parseExpression("{1,2,3,4}").getValue(context);

List listOfLists = (List) parser.parseExpression("{{'a','b'},{'x','y'}}").getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>{} by itself means an empty list.
 For performance reasons, if the list is itself entirely composed of fixed literals then a constant list is created to represent the expression, rather than building a new list on each evaluation.</p>
</div>
</div>
<div class="sect2">
<h3 id="array-construction"><a class="anchor" href="#array-construction"></a>Array construction</h3>
<div class="paragraph">
<p>Arrays can be built using the familiar Java syntax, optionally supplying an initializer to have the array populated at construction time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>int[] numbers1 = (int[]) parser.parseExpression("new int[4]").getValue(context);

// Array with initializer
int[] numbers2 = (int[]) parser.parseExpression("new int[]{1,2,3}").getValue(context);

// Multi dimensional array
int[][] numbers3 = (int[][]) parser.parseExpression("new int[4][5]").getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is not currently allowed to supply an initializer when constructing a multi-dimensional array.</p>
</div>
</div>
<div class="sect2">
<h3 id="methods"><a class="anchor" href="#methods"></a>Methods</h3>
<div class="paragraph">
<p>Methods are invoked using typical Java programming syntax.
You may also invoke methods on literals.
Varargs are also supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// string literal, evaluates to "bc"
String c = parser.parseExpression("'abc'.substring(2, 3)").getValue(String.class);

// evaluates to true
boolean isMember = parser.parseExpression("isMember('Mihajlo Pupin')").getValue(societyContext,
                                                                                Boolean.class);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="operators"><a class="anchor" href="#operators"></a>Operators</h3>
<div class="sect3">
<h4 id="relational-operators"><a class="anchor" href="#relational-operators"></a>Relational operators</h4>
<div class="paragraph">
<p>The relational operators; equal, not equal, less than, less than or equal, greater than, and greater than or equal are supported using standard operator notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// evaluates to true
boolean trueValue = parser.parseExpression("2 == 2").getValue(Boolean.class);

// evaluates to false
boolean falseValue = parser.parseExpression("2 &lt; -5.0").getValue(Boolean.class);

// evaluates to true
boolean trueValue = parser.parseExpression("'black' &lt; 'block'").getValue(Boolean.class);
---- In addition to standard relational operators SpEL supports the 'instanceof' and regular expression based 'matches' operator.

[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>boolean falseValue = parser.parseExpression("<em>xyz</em> instanceof T(int)").getValue(Boolean.class);</p>
</div>
<div class="paragraph">
<p>boolean trueValue =
     parser.parseExpression("<em>5.00</em> matches <em>^-?\\d+(\\.\\d{2})?$</em>").getValue(Boolean.class);</p>
</div>
<div class="paragraph">
<p>boolean falseValue =
     parser.parseExpression("<em>5.0067</em> matches <em>^-?\\d+(\\.\\d{2})?$</em>").getValue(Boolean.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Each symbolic operator can also be specified as a purely alphabetic equivalent.
 This avoids problems where the symbols used have special meaning for the document type in which the expression is embedded (eg.
an XML document).
 The textual equivalents are shown here: lt ('&lt;'), gt ('&gt;'), le ('&lt;='), ge ('&gt;='), eq ('=='), ne ('!='), div ('/'), mod ('%'), not ('!').
These are case insensitive.

==== Logical operators

The logical operators that are supported are and, or, and not.
Their use is demonstrated below.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>boolean falseValue = parser.parseExpression("true and false").getValue(Boolean.class);</p>
</div>
<div class="paragraph">
<p>String expression =  "isMember(<em>Nikola Tesla</em>) and isMember(<em>Mihajlo Pupin</em>)";
boolean trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.class);</p>
</div>
<div class="paragraph">
<p>boolean trueValue = parser.parseExpression("true or false").getValue(Boolean.class);</p>
</div>
<div class="paragraph">
<p>String expression =  "isMember(<em>Nikola Tesla</em>) or isMember(<em>Albert Einstein</em>)";
boolean trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.class);</p>
</div>
<div class="paragraph">
<p>boolean falseValue = parser.parseExpression("!true").getValue(Boolean.class);</p>
</div>
<div class="paragraph">
<p>String expression =  "isMember(<em>Nikola Tesla</em>) and !isMember(<em>Mihajlo Pupin</em>)";
boolean falseValue = parser.parseExpression(expression).getValue(societyContext, Boolean.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Mathematical operators

The addition operator can be used on numbers, strings and dates.
Subtraction can be used on numbers and dates.
Multiplication and division can be used only on numbers.
Other mathematical operators supported are modulus (%) and exponential power (^).
Standard operator precedence is enforced.
These operators are demonstrated below.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>int two = parser.parseExpression("1 + 1").getValue(Integer.class); // 2</p>
</div>
<div class="paragraph">
<p>String testString =
   parser.parseExpression("<em>test</em> + ' ' + <em>string</em>").getValue(String.class);  // <em>test string</em></p>
</div>
<div class="paragraph">
<p>int four =  parser.parseExpression("1 - -3").getValue(Integer.class); // 4</p>
</div>
<div class="paragraph">
<p>double d = parser.parseExpression("1000.00 - 1e4").getValue(Double.class); // -9000</p>
</div>
<div class="paragraph">
<p>int six =  parser.parseExpression("-2 * -3").getValue(Integer.class); // 6</p>
</div>
<div class="paragraph">
<p>double twentyFour = parser.parseExpression("2.0 * 3e0 * 4").getValue(Double.class); // 24.0</p>
</div>
<div class="paragraph">
<p>int minusTwo =  parser.parseExpression("6 / -3").getValue(Integer.class); // -2</p>
</div>
<div class="paragraph">
<p>double one = parser.parseExpression("8.0 / 4e0 / 2").getValue(Double.class); // 1.0</p>
</div>
<div class="paragraph">
<p>int three =  parser.parseExpression("7 % 4").getValue(Integer.class); // 3</p>
</div>
<div class="paragraph">
<p>int one = parser.parseExpression("8 / 5 % 2").getValue(Integer.class); // 1</p>
</div>
<div class="paragraph">
<p>int minusTwentyOne = parser.parseExpression("1+2-3*8").getValue(Integer.class); // -21</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Assignment

Setting of a property is done by using the assignment operator.
This would typically be done within a call to `setValue` but can also be done inside a call to `getValue`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Inventor inventor = new Inventor();
StandardEvaluationContext inventorContext = new StandardEvaluationContext(inventor);</p>
</div>
<div class="paragraph">
<p>parser.parseExpression("Name").setValue(inventorContext, "Alexander Seovic2");</p>
</div>
<div class="paragraph">
<p>String aleks = parser.parseExpression("Name = <em>Alexandar Seovic</em>").getValue(inventorContext,
                                                                            String.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>


=== Types

The special 'T' operator can be used to specify an instance of java.lang.Class (the 'type').
Static methods are invoked using this operator as well.
The [class]`StandardEvaluationContext` uses a [class]`TypeLocator` to find types and the [class]`StandardTypeLocator` (which can be replaced) is built with an understanding of the java.lang package.
This means T() references to types within java.lang do not need to be fully qualified, but all other type references must be.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Class dateClass = parser.parseExpression("T(java.util.Date)").getValue(Class.class);</p>
</div>
<div class="paragraph">
<p>Class stringClass = parser.parseExpression("T(String)").getValue(Class.class);</p>
</div>
<div class="paragraph">
<p>boolean trueValue =
   parser.parseExpression("T(java.math.RoundingMode).CEILING &lt; T(java.math.RoundingMode).FLOOR")
  .getValue(Boolean.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Constructors

Constructors can be invoked using the new operator.
The fully qualified class name should be used for all but the primitive type and String (where int, float, etc, can be used).

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Inventor einstein =
  p.parseExpression("new org.spring.samples.spel.inventor.Inventor(<em>Albert Einstein</em>,
                                                                   <em>German</em>)")
                                                                   .getValue(Inventor.class);</p>
</div>
<div class="paragraph">
<p>p.parseExpression("Members.add(new org.spring.samples.spel.inventor.Inventor(<em>Albert Einstein</em>,
                                                                   <em>German</em>))")
                                                                   .getValue(societyContext);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Variables

Variables can be referenced in the expression using the syntax #variableName.
Variables are set using the method setVariable on the StandardEvaluationContext.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Inventor tesla = new Inventor("Nikola Tesla", "Serbian");
StandardEvaluationContext context = new StandardEvaluationContext(tesla);
context.setVariable("newName", "Mike Tesla");</p>
</div>
<div class="paragraph">
<p>parser.parseExpression("Name = #newName").getValue(context);</p>
</div>
<div class="paragraph">
<p>System.out.println(tesla.getName()) // "Mike Tesla"</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== The #this and #root variables

The variable #this is always defined and refers to the current evaluation object (against which unqualified references are resolved).
The variable #root is always defined and refers to the root context object.
 Although #this may vary as components of an expression are evaluated, #root always refers to the root.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>List&lt;Integer&gt; primes = new ArrayList&lt;Integer&gt;();
primes.addAll(Arrays.asList(2,3,5,7,11,13,17));</p>
</div>
<div class="paragraph">
<p>ExpressionParser parser = new SpelExpressionParser();
StandardEvaluationContext context = new StandardEvaluationContext();
context.setVariable("primes",primes);</p>
</div>
<div class="paragraph">
<p>List&lt;Integer&gt; primesGreaterThanTen =
             (List&lt;Integer&gt;) parser.parseExpression("#primes.?[#this&gt;10]").getValue(context);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Functions

You can extend SpEL by registering user defined functions that can be called within the expression string.
The function is registered with the [class]`StandardEvaluationContext` using the method.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public void registerFunction(String name, Method m)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
A reference to a Java Method provides the implementation of the function.
For example, a utility method to reverse a string is shown below.

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>public abstract class StringUtils {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  public static String reverseString(String input) {
    StringBuilder backwards = new StringBuilder();
    for (int i = 0; i &lt; input.length(); i++)
      backwards.append(input.charAt(input.length() - 1 - i));
    }
    return backwards.toString();
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
This method is then registered with the evaluation context and can be used within an expression string.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ExpressionParser parser = new SpelExpressionParser();
StandardEvaluationContext context = new StandardEvaluationContext();</p>
</div>
<div class="paragraph">
<p>context.registerFunction("reverseString",
                         StringUtils.class.getDeclaredMethod("reverseString",
                                                             new Class[] { String.class }));</p>
</div>
<div class="paragraph">
<p>String helloWorldReversed =
          parser.parseExpression("#reverseString(<em>hello</em>)").getValue(context, String.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Bean references

If the evaluation context has been configured with a bean resolver it is possible to lookup beans from an expression using the (@) symbol.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ExpressionParser parser = new SpelExpressionParser();
StandardEvaluationContext context = new StandardEvaluationContext();
context.setBeanResolver(new MyBeanResolver());</p>
</div>
<div class="paragraph">
<p>Object bean = parser.parseExpression("@foo").getValue(context);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Ternary Operator (If-Then-Else)

You can use the ternary operator for performing if-then-else conditional logic inside the expression.
A minimal example is:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>String falseString =
             parser.parseExpression("false ? <em>trueExp</em> : <em>falseExp</em>").getValue(String.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In this case, the boolean false results in returning the string value 'falseExp'.
A more realistic example is shown below.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>parser.parseExpression("Name").setValue(societyContext, "IEEE");
societyContext.setVariable("queryName", "Nikola Tesla");</p>
</div>
<div class="paragraph">
<p>expression = "isMember(#queryName)? #queryName + ' is a member of the ' "<br>
             "+ Name + ' Society' : #queryName + ' is not a member of the ' + Name + ' Society'";</p>
</div>
<div class="paragraph">
<p>String queryResultString =
                    parser.parseExpression(expression).getValue(societyContext, String.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Also see the next section on the Elvis operator for an even shorter syntax for the ternary operator.

=== The Elvis Operator

The Elvis operator is a shortening of the ternary operator syntax and is used in the &lt;&lt;,Groovy&gt;&gt; language.
With the ternary operator syntax you usually have to repeat a variable twice, for example:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>String name = "Elvis Presley";
String displayName = name != null ? name : "Unknown";</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Instead you can use the Elvis operator, named for the resemblance to Elvis' hair style.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ExpressionParser parser = new SpelExpressionParser();</p>
</div>
<div class="paragraph">
<p>String name = parser.parseExpression("null?:'Unknown'").getValue(String.class);</p>
</div>
<div class="paragraph">
<p>System.out.println(name);  // <em>Unknown</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Here is a more complex example.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ExpressionParser parser = new SpelExpressionParser();</p>
</div>
<div class="paragraph">
<p>Inventor tesla = new Inventor("Nikola Tesla", "Serbian");
StandardEvaluationContext context = new StandardEvaluationContext(tesla);</p>
</div>
<div class="paragraph">
<p>String name = parser.parseExpression("Name?:'Elvis Presley'").getValue(context, String.class);</p>
</div>
<div class="paragraph">
<p>System.out.println(name); // Nikola Tesla</p>
</div>
<div class="paragraph">
<p>tesla.setName(null);</p>
</div>
<div class="paragraph">
<p>name = parser.parseExpression("Name?:'Elvis Presley'").getValue(context, String.class);</p>
</div>
<div class="paragraph">
<p>System.out.println(name); // Elvis Presley</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Safe Navigation operator

The Safe Navigation operator is used to avoid a `NullPointerException` and comes from the &lt;&lt;,Groovy&gt;&gt; language.
Typically when you have a reference to an object you might need to verify that it is not null before accessing methods or properties of the object.
To avoid this, the safe navigation operator will simply return null instead of throwing an exception.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ExpressionParser parser = new SpelExpressionParser();</p>
</div>
<div class="paragraph">
<p>Inventor tesla = new Inventor("Nikola Tesla", "Serbian");
tesla.setPlaceOfBirth(new PlaceOfBirth("Smiljan"));</p>
</div>
<div class="paragraph">
<p>StandardEvaluationContext context = new StandardEvaluationContext(tesla);</p>
</div>
<div class="paragraph">
<p>String city = parser.parseExpression("PlaceOfBirth?.City").getValue(context, String.class);
System.out.println(city); // Smiljan</p>
</div>
<div class="paragraph">
<p>tesla.setPlaceOfBirth(null);</p>
</div>
<div class="paragraph">
<p>city = parser.parseExpression("PlaceOfBirth?.City").getValue(context, String.class);</p>
</div>
<div class="paragraph">
<p>System.out.println(city); // null - does not throw NullPointerException!!!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[NOTE]
====
The Elvis operator can be used to apply default values in expressions, e.g.
in an [interface]`@Value` expression:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>@Value("#{systemProperties[<em>pop3.port</em>] ?: 25}")</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
This will inject a system property `pop3.port` if it is defined or 25 if not.
====

=== Collection Selection

Selection is a powerful expression language feature that allows you to transform some source collection into another by selecting from its entries.

Selection uses the syntax `?[selectionExpression]`.
This will filter the collection and return a new collection containing a subset of the original elements.
For example, selection would allow us to easily get a list of Serbian inventors:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>List&lt;Inventor&gt; list = (List&lt;Inventor&gt;)
      parser.parseExpression("Members.?[Nationality == <em>Serbian</em>]").getValue(societyContext);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Selection is possible upon both lists and maps.
In the former case the selection criteria is evaluated against each individual list element whilst against a map the selection criteria is evaluated against each map entry (objects of the Java type `Map.Entry`).
Map entries have their key and value accessible as properties for use in the selection.

This expression will return a new map consisting of those elements of the original map where the entry value is less than 27.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Map newMap = parser.parseExpression("map.?[value&lt;27]").getValue();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In addition to returning all the selected elements, it is possible to retrieve just the first or the last value.
To obtain the first entry matching the selection the syntax is `^[...]` whilst to obtain the last matching selection the syntax is `$[...]`.

=== Collection Projection

Projection allows a collection to drive the evaluation of a sub-expression and the result is a new collection.
The syntax for projection is `![projectionExpression]`.
Most easily understood by example, suppose we have a list of inventors but want the list of cities where they were born.
Effectively we want to evaluate 'placeOfBirth.city' for every entry in the inventor list.
Using projection:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>List placesOfBirth = (List)parser.parseExpression("Members.![placeOfBirth.city]");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
A map can also be used to drive projection and in this case the projection expression is evaluated against each entry in the map (represented as a Java `Map.Entry`).
The result of a projection across a map is a list consisting of the evaluation of the projection expression against each map entry.

=== Expression templating

Expression templates allow a mixing of literal text with one or more evaluation blocks.
Each evaluation block is delimited with prefix and suffix characters that you can define, a common choice is to use `#{ }` as the delimiters.
For example,

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>String randomPhrase =
   parser.parseExpression("random number is #{T(java.lang.Math).random()}",
                          new TemplateParserContext()).getValue(String.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The string is evaluated by concatenating the literal text 'random number is ' with the result of evaluating the expression inside the #{ } delimiter, in this case the result of calling that random() method.
The second argument to the method `parseExpression()` is of the type [interface]`ParserContext`.
The [interface]`ParserContext` interface is used to influence how the expression is parsed in order to support the expression templating functionality.
The definition of [class]`TemplateParserContext` is shown below.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class TemplateParserContext implements ParserContext {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public String getExpressionPrefix() {
  return "#{";
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public String getExpressionSuffix() {
  return "}";
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  public boolean isTemplate() {
    return true;
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Classes used in the examples

Inventor.java

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.spring.samples.spel.inventor;</p>
</div>
<div class="paragraph">
<p>import java.util.Date;
import java.util.GregorianCalendar;</p>
</div>
<div class="paragraph">
<p>public class Inventor {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private String name;
private String nationality;
private String[] inventions;
private Date birthdate;
private PlaceOfBirth placeOfBirth;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Inventor(String name, String nationality)
{
  GregorianCalendar c= new GregorianCalendar();
  this.name = name;
  this.nationality = nationality;
  this.birthdate = c.getTime();
}
public Inventor(String name, Date birthdate, String nationality) {
  this.name = name;
  this.nationality = nationality;
  this.birthdate = birthdate;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Inventor() {
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  public String getName() {
    return name;
  }
  public void setName(String name) {
    this.name = name;
  }
  public String getNationality() {
    return nationality;
  }
  public void setNationality(String nationality) {
    this.nationality = nationality;
  }
  public Date getBirthdate() {
    return birthdate;
  }
  public void setBirthdate(Date birthdate) {
    this.birthdate = birthdate;
  }
  public PlaceOfBirth getPlaceOfBirth() {
    return placeOfBirth;
  }
  public void setPlaceOfBirth(PlaceOfBirth placeOfBirth) {
    this.placeOfBirth = placeOfBirth;
  }
  public void setInventions(String[] inventions) {
    this.inventions = inventions;
  }
  public String[] getInventions() {
    return inventions;
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
PlaceOfBirth.java

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.spring.samples.spel.inventor;</p>
</div>
<div class="paragraph">
<p>public class PlaceOfBirth {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private String city;
private String country;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public PlaceOfBirth(String city) {
    this.city=city;
}
public PlaceOfBirth(String city, String country)
{
    this(city);
    this.country = country;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public String getCity() {
    return city;
}
public void setCity(String s) {
    this.city = s;
}
public String getCountry() {
    return country;
}
public void setCountry(String country) {
    this.country = country;
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Society.java

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.spring.samples.spel.inventor;</p>
</div>
<div class="paragraph">
<p>import java.util.*;</p>
</div>
<div class="paragraph">
<p>public class Society {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private String name;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public static String Advisors = "advisors";
public static String President = "president";</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private List&lt;Inventor&gt; members = new ArrayList&lt;Inventor&gt;();
private Map officers = new HashMap();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public List getMembers() {
    return members;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Map getOfficers() {
    return officers;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public String getName() {
    return name;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setName(String name) {
    this.name = name;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public boolean isMember(String name)
{
    boolean found = false;
    for (Inventor inventor : members) {
        if (inventor.getName().equals(name))
        {
            found = true;
            break;
        }
    }
    return found;
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>

= Aspect Oriented Programming with Spring

== Introduction

_Aspect-Oriented Programming_ (AOP) complements Object-Oriented Programming (OOP) by providing another way of thinking about program structure.
The key unit of modularity in OOP is the class, whereas in AOP the unit of modularity is the _aspect_.
Aspects enable the modularization of concerns such as transaction management that cut across multiple types and objects.
(Such concerns are often termed _crosscutting_ concerns in AOP literature.)

One of the key components of Spring is the _AOP
    framework_.
While the Spring IoC container does not depend on AOP, meaning you do not need to use AOP if you don't want to, AOP complements Spring IoC to provide a very capable middleware solution.

.Spring 2.0 AOP
****
Spring 2.0 introduces a simpler and more powerful way of writing custom aspects using either a &lt;&lt;aop-schema,schema-based
      approach&gt;&gt; or the &lt;&lt;aop-ataspectj,@AspectJ annotation
      style&gt;&gt;.
Both of these styles offer fully typed advice and use of the AspectJ pointcut language, while still using Spring AOP for weaving.

The Spring 2.0 schema- and @AspectJ-based AOP support is discussed in this chapter.
Spring 2.0 AOP remains fully backwards compatible with Spring 1.2 AOP, and the lower-level AOP support offered by the Spring 1.2 APIs is discussed in &lt;&lt;aop-api,the following
      chapter&gt;&gt;.
****

AOP is used in the Spring Framework to...

* ...
  provide declarative enterprise services, especially as a replacement for EJB declarative services.
  The most important such service is &lt;&lt;transaction-declarative,_declarative transaction
          management_&gt;&gt;.
* ...
  allow users to implement custom aspects, complementing their use of OOP with AOP.

=== AOP concepts

Let us begin by defining some central AOP concepts and terminology.
These terms are not Spring-specific...
unfortunately, AOP terminology is not particularly intuitive; however, it would be even more confusing if Spring used its own terminology.

* _Aspect_: a modularization of a concern that cuts across multiple classes.
  Transaction management is a good example of a crosscutting concern in enterprise Java applications.
  In Spring AOP, aspects are implemented using regular classes (the &lt;&lt;aop-schema,schema-based approach&gt;&gt;) or regular classes annotated with the [interface]`@Aspect` annotation (the &lt;&lt;aop-ataspectj,[interface]`@AspectJ`
            style&gt;&gt;).
* _Join point_: a point during the execution of a program, such as the execution of a method or the handling of an exception.
  In Spring AOP, a join point _always_ represents a method execution.
* _Advice_: action taken by an aspect at a particular join point.
  Different types of advice include "around," "before" and "after" advice.
  (Advice types are discussed below.) Many AOP frameworks, including Spring, model an advice as an _interceptor_, maintaining a chain of interceptors _around_ the join point.
* _Pointcut_: a predicate that matches join points.
  Advice is associated with a pointcut expression and runs at any join point matched by the pointcut (for example, the execution of a method with a certain name).
  The concept of join points as matched by pointcut expressions is central to AOP, and Spring uses the AspectJ pointcut expression language by default.
* _Introduction_: declaring additional methods or fields on behalf of a type.
  Spring AOP allows you to introduce new interfaces (and a corresponding implementation) to any advised object.
  For example, you could use an introduction to make a bean implement an [interface]`IsModified` interface, to simplify caching.
  (An introduction is known as an inter-type declaration in the AspectJ community.)
* _Target object_: object being advised by one or more aspects.
  Also referred to as the _advised_ object.
  Since Spring AOP is implemented using runtime proxies, this object will always be a _proxied_ object.
* _AOP proxy_: an object created by the AOP framework in order to implement the aspect contracts (advise method executions and so on).
  In the Spring Framework, an AOP proxy will be a JDK dynamic proxy or a CGLIB proxy.
* _Weaving_: linking aspects with other application types or objects to create an advised object.
  This can be done at compile time (using the AspectJ compiler, for example), load time, or at runtime.
  Spring AOP, like other pure Java AOP frameworks, performs weaving at runtime.

Types of advice:

* _Before advice_: Advice that executes before a join point, but which does not have the ability to prevent execution flow proceeding to the join point (unless it throws an exception).
* _After returning advice_: Advice to be executed after a join point completes normally: for example, if a method returns without throwing an exception.
* _After throwing advice_: Advice to be executed if a method exits by throwing an exception.
* _After (finally) advice_: Advice to be executed regardless of the means by which a join point exits (normal or exceptional return).
* _Around advice_: Advice that surrounds a join point such as a method invocation.
  This is the most powerful kind of advice.
  Around advice can perform custom behavior before and after the method invocation.
  It is also responsible for choosing whether to proceed to the join point or to shortcut the advised method execution by returning its own return value or throwing an exception.

Around advice is the most general kind of advice.
Since Spring AOP, like AspectJ, provides a full range of advice types, we recommend that you use the least powerful advice type that can implement the required behavior.
For example, if you need only to update a cache with the return value of a method, you are better off implementing an after returning advice than an around advice, although an around advice can accomplish the same thing.
Using the most specific advice type provides a simpler programming model with less potential for errors.
For example, you do not need to invoke the [method]`proceed()` method on the [interface]`JoinPoint` used for around advice, and hence cannot fail to invoke it.

In Spring 2.0, all advice parameters are statically typed, so that you work with advice parameters of the appropriate type (the type of the return value from a method execution for example) rather than [class]`Object` arrays.

The concept of join points, matched by pointcuts, is the key to AOP which distinguishes it from older technologies offering only interception.
Pointcuts enable advice to be targeted independently of the Object-Oriented hierarchy.
For example, an around advice providing declarative transaction management can be applied to a set of methods spanning multiple objects (such as all business operations in the service layer).

=== Spring AOP capabilities and goals

Spring AOP is implemented in pure Java.
There is no need for a special compilation process.
Spring AOP does not need to control the class loader hierarchy, and is thus suitable for use in a Servlet container or application server.

Spring AOP currently supports only method execution join points (advising the execution of methods on Spring beans).
Field interception is not implemented, although support for field interception could be added without breaking the core Spring AOP APIs.
If you need to advise field access and update join points, consider a language such as AspectJ.

Spring AOP's approach to AOP differs from that of most other AOP frameworks.
The aim is not to provide the most complete AOP implementation (although Spring AOP is quite capable); it is rather to provide a close integration between AOP implementation and Spring IoC to help solve common problems in enterprise applications.

Thus, for example, the Spring Framework's AOP functionality is normally used in conjunction with the Spring IoC container.
Aspects are configured using normal bean definition syntax (although this allows powerful "autoproxying" capabilities): this is a crucial difference from other AOP implementations.
There are some things you cannot do easily or efficiently with Spring AOP, such as advise very fine-grained objects (such as domain objects typically): AspectJ is the best choice in such cases.
However, our experience is that Spring AOP provides an excellent solution to most problems in enterprise Java applications that are amenable to AOP.

Spring AOP will never strive to compete with AspectJ to provide a comprehensive AOP solution.
We believe that both proxy-based frameworks like Spring AOP and full-blown frameworks such as AspectJ are valuable, and that they are complementary, rather than in competition.
Spring 2.0 seamlessly integrates Spring AOP and IoC with AspectJ, to enable all uses of AOP to be catered for within a consistent Spring-based application architecture.
This integration does not affect the Spring AOP API or the AOP Alliance API: Spring AOP remains backward-compatible.
See &lt;&lt;aop-api,the following chapter&gt;&gt; for a discussion of the Spring AOP APIs.

[NOTE]
====
One of the central tenets of the Spring Framework is that of _non-invasiveness_; this is the idea that you should not be forced to introduce framework-specific classes and interfaces into your business/domain model.
However, in some places the Spring Framework does give you the option to introduce Spring Framework-specific dependencies into your codebase: the rationale in giving you such options is because in certain scenarios it might be just plain easier to read or code some specific piece of functionality in such a way.
The Spring Framework (almost) always offers you the choice though: you have the freedom to make an informed decision as to which option best suits your particular use case or scenario.

One such choice that is relevant to this chapter is that of which AOP framework (and which AOP style) to choose.
You have the choice of AspectJ and/or Spring AOP, and you also have the choice of either the @AspectJ annotation-style approach or the Spring XML configuration-style approach.
The fact that this chapter chooses to introduce the @AspectJ-style approach first should not be taken as an indication that the Spring team favors the @AspectJ annotation-style approach over the Spring XML configuration-style.

See &lt;&lt;aop-choosing&gt;&gt; for a more complete discussion of the whys and wherefores of each style.
====

=== AOP Proxies

Spring AOP defaults to using standard J2SE _dynamic
      proxies_ for AOP proxies.
This enables any interface (or set of interfaces) to be proxied.

Spring AOP can also use CGLIB proxies.
This is necessary to proxy classes, rather than interfaces.
CGLIB is used by default if a business object does not implement an interface.
As it is good practice to program to interfaces rather than classes, business classes normally will implement one or more business interfaces.
It is possible to &lt;&lt;aop-autoproxy-force-CGLIB,force the use of CGLIB&gt;&gt;, in those (hopefully rare) cases where you need to advise a method that is not declared on an interface, or where you need to pass a proxied object to a method as a concrete type.

It is important to grasp the fact that Spring AOP is _proxy-based_.
See &lt;&lt;aop-understanding-aop-proxies&gt;&gt; for a thorough examination of exactly what this implementation detail actually means.

== @AspectJ support

@AspectJ refers to a style of declaring aspects as regular Java classes annotated with Java 5 annotations.
The @AspectJ style was introduced by the &lt;&lt;,AspectJ
    project&gt;&gt; as part of the AspectJ 5 release.
Spring 2.0 interprets the same annotations as AspectJ 5, using a library supplied by AspectJ for pointcut parsing and matching.
The AOP runtime is still pure Spring AOP though, and there is no dependency on the AspectJ compiler or weaver.

=== Enabling @AspectJ Support

To use @AspectJ aspects in a Spring configuration you need to enable Spring support for configuring Spring AOP based on @AspectJ aspects, and _autoproxying_ beans based on whether or not they are advised by those aspects.
By autoproxying we mean that if Spring determines that a bean is advised by one or more aspects, it will automatically generate a proxy for that bean to intercept method invocations and ensure that advice is executed as needed.

The @AspectJ support can be enabled with XML or Java style configuration.
 In either case you will also need to ensure that AspectJ's [file]`aspectjweaver.jar` library is on the classpath of your application (version 1.6.8 or later).
This library is available in the [file]`'lib'` directory of an AspectJ distribution or via the Maven Central repository.

==== Enabling @AspectJ Support with Java configuration

To enable @AspectJ support with Java [interface]`@Configuration` add the [interface]`@EnableAspectJAutoProxy` annotation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Configuration
@EnableAspectJAutoProxy
public class AppConfig {</p>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Enabling @AspectJ Support with XML configuration

To enable @AspectJ support with XML based configuration use the `aop:aspectj-autoproxy` element:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspectj-autoproxy/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
This assumes that you are using schema support as described in &lt;&lt;xsd-config&gt;&gt;.
See &lt;&lt;xsd-config-body-schemas-aop&gt;&gt; for how to import the tags in the aop namespace.

If you are using the DTD, it is still possible to enable @AspectJ support by adding the following definition to your application context:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator" /&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Declaring an aspect

With the @AspectJ support enabled, any bean defined in your application context with a class that is an @AspectJ aspect (has the [interface]`@Aspect` annotation) will be automatically detected by Spring and used to configure Spring AOP. The following example shows the minimal definition required for a not-very-useful aspect:

A regular bean definition in the application context, pointing to a bean class that has the [interface]`@Aspect` annotation:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="myAspect" class="org.xyz.NotVeryUsefulAspect"&gt;
   &lt;!-- configure properties of aspect here as normal -&#8594;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
And the [class]`NotVeryUsefulAspect` class definition, annotated with [interface]`org.aspectj.lang.annotation.Aspect` annotation;

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.xyz;
import org.aspectj.lang.annotation.Aspect;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class NotVeryUsefulAspect {</p>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Aspects (classes annotated with [interface]`@Aspect`) may have methods and fields just like any other class.
They may also contain pointcut, advice, and introduction (inter-type) declarations.

.Autodetecting aspects through component scanning
[NOTE]
====
You may register aspect classes as regular beans in your Spring XML configuration, or autodetect them through classpath scanning - just like any other Spring-managed bean.
However, note that the _@Aspect_ annotation is _not_ sufficient for autodetection in the classpath: For that purpose, you need to add a separate _@Component_ annotation (or alternatively a custom stereotype annotation that qualifies, as per the rules of Spring's component scanner).
====

.Advising aspects with other aspects?
[NOTE]
====
In Spring AOP, it is _not_ possible to have aspects themselves be the target of advice from other aspects.
The _@Aspect_ annotation on a class marks it as an aspect, and hence excludes it from auto-proxying.
====

=== Declaring a pointcut

Recall that pointcuts determine join points of interest, and thus enable us to control when advice executes.
_Spring AOP only
      supports method execution join points for Spring beans_, so you can think of a pointcut as matching the execution of methods on Spring beans.
A pointcut declaration has two parts: a signature comprising a name and any parameters, and a pointcut expression that determines _exactly_ which method executions we are interested in.
In the @AspectJ annotation-style of AOP, a pointcut signature is provided by a regular method definition, and the pointcut expression is indicated using the [interface]`@Pointcut` annotation (the method serving as the pointcut signature _must_ have a `void` return type).

An example will help make this distinction between a pointcut signature and a pointcut expression clear.
The following example defines a pointcut named `'anyOldTransfer'` that will match the execution of any method named `'transfer'`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Pointcut("execution(* transfer(..))")// the pointcut expression
private void anyOldTransfer() {}// the pointcut signature</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The pointcut expression that forms the value of the [interface]`@Pointcut` annotation is a regular AspectJ 5 pointcut expression.
For a full discussion of AspectJ's pointcut language, see the &lt;&lt;,AspectJ
      Programming Guide&gt;&gt; (and for Java 5 based extensions, the &lt;&lt;,AspectJ
      5 Developers Notebook&gt;&gt;) or one of the books on AspectJ such as  by Colyer et.
al.
or  by Ramnivas Laddad.

==== Supported Pointcut Designators

Spring AOP supports the following AspectJ pointcut designators (PCD) for use in pointcut expressions:

.Other pointcut types
****
The full AspectJ pointcut language supports additional pointcut designators that are not supported in Spring.
These are: `call, get, set, preinitialization, staticinitialization,
          initialization, handler, adviceexecution, withincode, cflow,
          cflowbelow, if, @this`, and `@withincode`.
Use of these pointcut designators in pointcut expressions interpreted by Spring AOP will result in an [class]`IllegalArgumentException` being thrown.

The set of pointcut designators supported by Spring AOP may be extended in future releases to support more of the AspectJ pointcut designators.
****

* _execution_ - for matching method execution join points, this is the primary pointcut designator you will use when working with Spring AOP
* _within_ - limits matching to join points within certain types (simply the execution of a method declared within a matching type when using Spring AOP)
* _this_ - limits matching to join points (the execution of methods when using Spring AOP) where the bean reference (Spring AOP proxy) is an instance of the given type
* _target_ - limits matching to join points (the execution of methods when using Spring AOP) where the target object (application object being proxied) is an instance of the given type
* _args_ - limits matching to join points (the execution of methods when using Spring AOP) where the arguments are instances of the given types
* _[interface]`@target`_ - limits matching to join points (the execution of methods when using Spring AOP) where the class of the executing object has an annotation of the given type
* _[interface]`@args`_ - limits matching to join points (the execution of methods when using Spring AOP) where the runtime type of the actual arguments passed have annotations of the given type(s)
* _[interface]`@within`_ - limits matching to join points within types that have the given annotation (the execution of methods declared in types with the given annotation when using Spring AOP)
* _@annotation_ - limits matching to join points where the subject of the join point (method being executed in Spring AOP) has the given annotation

Because Spring AOP limits matching to only method execution join points, the discussion of the pointcut designators above gives a narrower definition than you will find in the AspectJ programming guide.
In addition, AspectJ itself has type-based semantics and at an execution join point both '`this`' and '`target`' refer to the same object - the object executing the method.
Spring AOP is a proxy-based system and differentiates between the proxy object itself (bound to '`this`') and the target object behind the proxy (bound to '`target`').

[NOTE]
====
Due to the proxy-based nature of Spring's AOP framework, protected methods are by definition _not_ intercepted, neither for JDK proxies (where this isn't applicable) nor for CGLIB proxies (where this is technically possible but not recommendable for AOP purposes).
As a consequence, any given pointcut will be matched against _public methods only_!

If your interception needs include protected/private methods or even constructors, consider the use of Spring-driven &lt;&lt;aop-aj-ltw,native AspectJ weaving&gt;&gt; instead of Spring's proxy-based AOP framework.
This constitutes a different mode of AOP usage with different characteristics, so be sure to make yourself familiar with weaving first before making a decision.
====

Spring AOP also supports an additional PCD named '`bean`'.
This PCD allows you to limit the matching of join points to a particular named Spring bean, or to a set of named Spring beans (when using wildcards).
The '`bean`' PCD has the following form:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>bean(idOrNameOfBean)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The '`idOrNameOfBean`' token can be the name of any Spring bean: limited wildcard support using the '`*`' character is provided, so if you establish some naming conventions for your Spring beans you can quite easily write a '`bean`' PCD expression to pick them out.
As is the case with other pointcut designators, the '`bean`' PCD can be &amp;&amp;'ed, ||'ed, and ! (negated) too.

[NOTE]
====
Please note that the '`bean`' PCD is _only_ supported in Spring AOP - and _not_ in native AspectJ weaving.
It is a Spring-specific extension to the standard PCDs that AspectJ defines.

The '`bean`' PCD operates at the _instance_ level (building on the Spring bean name concept) rather than at the type level only (which is what weaving-based AOP is limited to).
Instance-based pointcut designators are a special capability of Spring's proxy-based AOP framework and its close integration with the Spring bean factory, where it is natural and straightforward to identify specific beans by name.
====

==== Combining pointcut expressions

Pointcut expressions can be combined using '&amp;&amp;', '||' and '!'.
It is also possible to refer to pointcut expressions by name.
The following example shows three pointcut expressions: `anyPublicOperation` (which matches if a method execution join point represents the execution of any public method); `inTrading` (which matches if a method execution is in the trading module), and `tradingOperation` (which matches if a method execution represents any public method in the trading module).

[source,java]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Pointcut("execution(public * *(..))")
private void anyPublicOperation() {}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Pointcut("within(com.xyz.someapp.trading..*)")
private void inTrading() {}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Pointcut("anyPublicOperation() &amp;&amp; inTrading()")
private void tradingOperation() {}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
It is a best practice to build more complex pointcut expressions out of smaller named components as shown above.
When referring to pointcuts by name, normal Java visibility rules apply (you can see private pointcuts in the same type, protected pointcuts in the hierarchy, public pointcuts anywhere and so on).
Visibility does not affect pointcut _matching_.

==== Sharing common pointcut definitions

When working with enterprise applications, you often want to refer to modules of the application and particular sets of operations from within several aspects.
We recommend defining a "SystemArchitecture" aspect that captures common pointcut expressions for this purpose.
A typical such aspect would look as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.xyz.someapp;</p>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class SystemArchitecture {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/**
 * A join point is in the web layer if the method is defined
 * in a type in the com.xyz.someapp.web package or any sub-package
 * under that.
 */
@Pointcut("within(com.xyz.someapp.web..*)")
public void inWebLayer() {}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>/**
 * A join point is in the service layer if the method is defined
 * in a type in the com.xyz.someapp.service package or any sub-package
 * under that.
 */
@Pointcut("within(com.xyz.someapp.service..*)")
public void inServiceLayer() {}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>/**
 * A join point is in the data access layer if the method is defined
 * in a type in the com.xyz.someapp.dao package or any sub-package
 * under that.
 */
@Pointcut("within(com.xyz.someapp.dao..*)")
public void inDataAccessLayer() {}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>/**
 * A business service is the execution of any method defined on a service
 * interface. This definition assumes that interfaces are placed in the
 * "service" package, and that implementation types are in sub-packages.
 *
 * If you group service interfaces by functional area (for example,
 * in packages com.xyz.someapp.abc.service and com.xyz.def.service) then
 * the pointcut expression "execution(* com.xyz.someapp..service.*.*(..))"
 * could be used instead.
 *
 * Alternatively, you can write the expression using the 'bean'
 * PCD, like so "bean(*Service)". (This assumes that you have
 * named your Spring service beans in a consistent fashion.)
 */
@Pointcut("execution(* com.xyz.someapp.service.*.*(..))")
public void businessService() {}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>/**
 * A data access operation is the execution of any method defined on a
 * dao interface. This definition assumes that interfaces are placed in the
 * "dao" package, and that implementation types are in sub-packages.
 */
@Pointcut("execution(* com.xyz.someapp.dao.*.*(..))")
public void dataAccessOperation() {}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The pointcuts defined in such an aspect can be referred to anywhere that you need a pointcut expression.
For example, to make the service layer transactional, you could write:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;
  &lt;aop:advisor
      pointcut="com.xyz.someapp.SystemArchitecture.businessService()"
      advice-ref="tx-advice"/&gt;
&lt;/aop:config&gt;</p>
</div>
<div class="paragraph">
<p>&lt;tx:advice id="tx-advice"&gt;
  &lt;tx:attributes&gt;
    &lt;tx:method name="*" propagation="REQUIRED"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `&lt;aop:config&gt;` and `&lt;aop:advisor&gt;` elements are discussed in &lt;&lt;aop-schema&gt;&gt;.
The transaction elements are discussed in &lt;&lt;transaction&gt;&gt;.

==== Examples

Spring AOP users are likely to use the `execution` pointcut designator the most often.
The format of an execution expression is:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern)
          throws-pattern?)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
All parts except the returning type pattern (ret-type-pattern in the snippet above), name pattern, and parameters pattern are optional.
The returning type pattern determines what the return type of the method must be in order for a join point to be matched.
Most frequently you will use `*` as the returning type pattern, which matches any return type.
A fully-qualified type name will match only when the method returns the given type.
The name pattern matches the method name.
You can use the `*` wildcard as all or part of a name pattern.
The parameters pattern is slightly more complex: `()` matches a method that takes no parameters, whereas `(..)` matches any number of parameters (zero or more).
The pattern `(*)` matches a method taking one parameter of any type, `(*,String)` matches a method taking two parameters, the first can be of any type, the second must be a String.
Consult the &lt;&lt;,
        Language Semantics&gt;&gt; section of the AspectJ Programming Guide for more information.

Some examples of common pointcut expressions are given below.

* the execution of any public method:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>execution(public * *(..))</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
* the execution of any method with a name beginning with "set":
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>execution(* set*(..))</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
* the execution of any method defined by the [interface]`AccountService` interface:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>execution(* com.xyz.service.AccountService.*(..))</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
* the execution of any method defined in the service package:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>execution(* com.xyz.service.<strong>.</strong>(..))</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
* the execution of any method defined in the service package or a sub-package:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>execution(* com.xyz.service..<strong>.</strong>(..))</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
* any join point (method execution only in Spring AOP) within the service package:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>within(com.xyz.service.*)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
* any join point (method execution only in Spring AOP) within the service package or a sub-package:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>within(com.xyz.service..*)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
* any join point (method execution only in Spring AOP) where the proxy implements the [interface]`AccountService` interface:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>this(com.xyz.service.AccountService)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
* any join point (method execution only in Spring AOP) where the target object implements the [interface]`AccountService` interface:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>target(com.xyz.service.AccountService)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
* any join point (method execution only in Spring AOP) which takes a single parameter, and where the argument passed at runtime is [interface]`Serializable`:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>args(java.io.Serializable)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
+
Note that the pointcut given in this example is different to `execution(* *(java.io.Serializable))`: the args version matches if the argument passed at runtime is Serializable, the execution version matches if the method signature declares a single parameter of type [interface]`Serializable`.

* any join point (method execution only in Spring AOP) where the target object has an [interface]`@Transactional` annotation:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@target(org.springframework.transaction.annotation.Transactional)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
* any join point (method execution only in Spring AOP) where the declared type of the target object has an [interface]`@Transactional` annotation:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@within(org.springframework.transaction.annotation.Transactional)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
* any join point (method execution only in Spring AOP) where the executing method has an [interface]`@Transactional` annotation:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@annotation(org.springframework.transaction.annotation.Transactional)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
* any join point (method execution only in Spring AOP) which takes a single parameter, and where the runtime type of the argument passed has the [interface]`@Classified` annotation:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@args(com.xyz.security.Classified)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
* any join point (method execution only in Spring AOP) on a Spring bean named '`tradeService`':
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>bean(tradeService)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
* any join point (method execution only in Spring AOP) on Spring beans having names that match the wildcard expression '`*Service`':
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>bean(*Service)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>

==== Writing good pointcuts

During compilation, AspectJ processes pointcuts in order to try and optimize matching performance.
Examining code and determining if each join point matches (statically or dynamically) a given pointcut is a costly process.
(A dynamic match means the match cannot be fully determined from static analysis and a test will be placed in the code to determine if there is an actual match when the code is running).
On first encountering a pointcut declaration, AspectJ will rewrite it into an optimal form for the matching process.
What does this mean? Basically pointcuts are rewritten in DNF (Disjunctive Normal Form) and the components of the pointcut are sorted such that those components that are cheaper to evaluate are checked first.
This means you do not have to worry about understanding the performance of various pointcut designators and may supply them in any order in a pointcut declaration.

However, AspectJ can only work with what it is told, and for optimal performance of matching you should think about what they are trying to achieve and narrow the search space for matches as much as possible in the definition.
The existing designators naturally fall into one of three groups: kinded, scoping and context:

* Kinded designators are those which select a particular kind of join point.
  For example: execution, get, set, call, handler
* Scoping designators are those which select a group of join points of interest (of probably many kinds).
  For example: within, withincode
* Contextual designators are those that match (and optionally bind) based on context.
  For example: this, target, @annotation

A well written pointcut should try and include at least the first two types (kinded and scoping), whilst the contextual designators may be included if wishing to match based on join point context, or bind that context for use in the advice.
Supplying either just a kinded designator or just a contextual designator will work but could affect weaving performance (time and memory used) due to all the extra processing and analysis.
Scoping designators are very fast to match and their usage means AspectJ can very quickly dismiss groups of join points that should not be further processed - that is why a good pointcut should always include one if possible.

=== Declaring advice

Advice is associated with a pointcut expression, and runs before, after, or around method executions matched by the pointcut.
The pointcut expression may be either a simple reference to a named pointcut, or a pointcut expression declared in place.

==== Before advice

Before advice is declared in an aspect using the [interface]`@Before` annotation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class BeforeExample {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Before("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")
public void doAccessCheck() {
  // ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If using an in-place pointcut expression we could rewrite the above example as:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class BeforeExample {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Before("execution(* com.xyz.myapp.dao.*.*(..))")
public void doAccessCheck() {
  // ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== After returning advice

After returning advice runs when a matched method execution returns normally.
It is declared using the [interface]`@AfterReturning` annotation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.AfterReturning;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class AfterReturningExample {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@AfterReturning("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")
public void doAccessCheck() {
  // ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Sometimes you need access in the advice body to the actual value that was returned.
You can use the form of [interface]`@AfterReturning` that binds the return value for this:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.AfterReturning;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class AfterReturningExample {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@AfterReturning(
  pointcut="com.xyz.myapp.SystemArchitecture.dataAccessOperation()",
  returning="retVal")
public void doAccessCheck(Object retVal) {
  // ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The name used in the `returning` attribute must correspond to the name of a parameter in the advice method.
When a method execution returns, the return value will be passed to the advice method as the corresponding argument value.
A `returning` clause also restricts matching to only those method executions that return a value of the specified type ([class]`Object` in this case, which will match any return value).

Please note that it is _not_ possible to return a totally different reference when using after-returning advice.

==== After throwing advice

After throwing advice runs when a matched method execution exits by throwing an exception.
It is declared using the [interface]`@AfterThrowing` annotation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.AfterThrowing;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class AfterThrowingExample {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@AfterThrowing("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")
public void doRecoveryActions() {
  // ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Often you want the advice to run only when exceptions of a given type are thrown, and you also often need access to the thrown exception in the advice body.
Use the `throwing` attribute to both restrict matching (if desired, use [interface]`Throwable` as the exception type otherwise) and bind the thrown exception to an advice parameter.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.AfterThrowing;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class AfterThrowingExample {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@AfterThrowing(
  pointcut="com.xyz.myapp.SystemArchitecture.dataAccessOperation()",
  throwing="ex")
public void doRecoveryActions(DataAccessException ex) {
  // ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The name used in the `throwing` attribute must correspond to the name of a parameter in the advice method.
When a method execution exits by throwing an exception, the exception will be passed to the advice method as the corresponding argument value.
A `throwing` clause also restricts matching to only those method executions that throw an exception of the specified type ([class]`DataAccessException` in this case).

==== After (finally) advice

After (finally) advice runs however a matched method execution exits.
It is declared using the [interface]`@After` annotation.
After advice must be prepared to handle both normal and exception return conditions.
It is typically used for releasing resources, etc.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.After;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class AfterFinallyExample {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@After("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")
public void doReleaseLock() {
  // ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Around advice

The final kind of advice is around advice.
Around advice runs "around" a matched method execution.
It has the opportunity to do work both before and after the method executes, and to determine when, how, and even if, the method actually gets to execute at all.
Around advice is often used if you need to share state before and after a method execution in a thread-safe manner (starting and stopping a timer for example).
Always use the least powerful form of advice that meets your requirements (i.e.
don't use around advice if simple before advice would do).

Around advice is declared using the [interface]`@Around` annotation.
The first parameter of the advice method must be of type [interface]`ProceedingJoinPoint`.
Within the body of the advice, calling `proceed()` on the [interface]`ProceedingJoinPoint` causes the underlying method to execute.
The `proceed` method may also be called passing in an [class]`Object[]` - the values in the array will be used as the arguments to the method execution when it proceeds.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.ProceedingJoinPoint;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class AroundExample {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Around("com.xyz.myapp.SystemArchitecture.businessService()")
public Object doBasicProfiling(ProceedingJoinPoint pjp) throws Throwable {
  // start stopwatch
  Object retVal = pjp.proceed();
  // stop stopwatch
  return retVal;
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The value returned by the around advice will be the return value seen by the caller of the method.
A simple caching aspect for example could return a value from a cache if it has one, and invoke proceed() if it does not.
Note that proceed may be invoked once, many times, or not at all within the body of the around advice, all of these are quite legal.

==== Advice parameters

Spring 2.0 offers fully typed advice - meaning that you declare the parameters you need in the advice signature (as we saw for the returning and throwing examples above) rather than work with [class]`Object[]` arrays all the time.
We'll see how to make argument and other contextual values available to the advice body in a moment.
First let's take a look at how to write generic advice that can find out about the method the advice is currently advising.

===== Access to the current [interface]`JoinPoint`

Any advice method may declare as its first parameter, a parameter of type [interface]`org.aspectj.lang.JoinPoint` (please note that around advice is _required_ to declare a first parameter of type [interface]`ProceedingJoinPoint`, which is a subclass of [interface]`JoinPoint`.
The [interface]`JoinPoint` interface provides a number of useful methods such as `getArgs()` (returns the method arguments), [method]`getThis()` (returns the proxy object), [method]`getTarget()` (returns the target object), [method]`getSignature()` (returns a description of the method that is being advised) and [method]`toString()` (prints a useful description of the method being advised).
Please do consult the Javadocs for full details.

===== Passing parameters to advice

We've already seen how to bind the returned value or exception value (using after returning and after throwing advice).
To make argument values available to the advice body, you can use the binding form of `args`.
If a parameter name is used in place of a type name in an args expression, then the value of the corresponding argument will be passed as the parameter value when the advice is invoked.
An example should make this clearer.
Suppose you want to advise the execution of dao operations that take an Account object as the first parameter, and you need access to the account in the advice body.
You could write the following:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Before("com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp;"<br>
        "args(account,..)")
public void validateAccount(Account account) {
  // &#8230;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `args(account,..)` part of the pointcut expression serves two purposes: firstly, it restricts matching to only those method executions where the method takes at least one parameter, and the argument passed to that parameter is an instance of [class]`Account`; secondly, it makes the actual [class]`Account` object available to the advice via the `account` parameter.

Another way of writing this is to declare a pointcut that "provides" the [class]`Account` object value when it matches a join point, and then just refer to the named pointcut from the advice.
This would look as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Pointcut("com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp;"<br>
          "args(account,..)")
private void accountDataAccessOperation(Account account) {}</p>
</div>
<div class="paragraph">
<p>@Before("accountDataAccessOperation(account)")
public void validateAccount(Account account) {
  // &#8230;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The interested reader is once more referred to the AspectJ programming guide for more details.

The proxy object (`this`), target object (`target`), and annotations (`@within,
          @target, @annotation, @args`) can all be bound in a similar fashion.
The following example shows how you could match the execution of methods annotated with an [interface]`@Auditable` annotation, and extract the audit code.

First the definition of the [interface]`@Auditable` annotation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Auditable {
    AuditCode value();
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
And then the advice that matches the execution of [interface]`@Auditable` methods:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Before("com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; "<br>
        "@annotation(auditable)")
public void audit(Auditable auditable) {
  AuditCode code = auditable.value();
  // &#8230;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
===== Advice parameters and generics

Spring AOP can handle generics used in class declarations and method parameters.
Suppose you have a generic type like this:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface Sample&lt;T&gt; {
  void sampleGenericMethod(T param);
  void sampleGenericCollectionMethod(Collection&gt;T&gt; param);
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
You can restrict interception of method types to certain parameter types by simply typing the advice parameter to the parameter type you want to intercept the method for:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Before("execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)")
public void beforeSampleMethod(MyType param) {
  // Advice implementation
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
That this works is pretty obvious as we already discussed above.
However, it's worth pointing out that this won't work for generic collections.
So you cannot define a pointcut like this:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Before("execution(* ..Sample+.sampleGenericCollectionMethod(*)) &amp;&amp; args(param)")
public void beforeSampleMethod(Collection&lt;MyType&gt; param) {
  // Advice implementation
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
To make this work we would have to inspect every element of the collection, which is not reasonable as we also cannot decide how to treat `null` values in general.
To achieve something similar to this you have to type the parameter to [interface]`Collection&lt;?&gt;` and manually check the type of the elements.

===== Determining argument names

The parameter binding in advice invocations relies on matching names used in pointcut expressions to declared parameter names in (advice and pointcut) method signatures.
Parameter names are _not_ available through Java reflection, so Spring AOP uses the following strategies to determine parameter names:

[]
. If the parameter names have been specified by the user explicitly, then the specified parameter names are used: both the advice and the pointcut annotations have an optional "argNames" attribute which can be used to specify the argument names of the annotated method - these argument names _are_ available at runtime.
  For example:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Before(
   value="com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)",
   argNames="bean,auditable")
public void audit(Object bean, Auditable auditable) {
  AuditCode code = auditable.value();
  // &#8230; use code and bean
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
If the first parameter is of the [interface]`JoinPoint`, [interface]`ProceedingJoinPoint`, or [interface]`JoinPoint.StaticPart` type, you may leave out the name of the parameter from the value of the "argNames" attribute.
For example, if you modify the preceding advice to receive the join point object, the "argNames" attribute need not include it:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Before(
   value="com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)",
   argNames="bean,auditable")
public void audit(JoinPoint jp, Object bean, Auditable auditable) {
  AuditCode code = auditable.value();
  // &#8230; use code, bean, and jp
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
The special treatment given to the first parameter of the [interface]`JoinPoint`, [interface]`ProceedingJoinPoint`, and [interface]`JoinPoint.StaticPart` types is particularly convenient for advice that do not collect any other join point context.
In such situations, you may simply omit the "argNames" attribute.
For example, the following advice need not declare the "argNames" attribute:
+
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Before(
   "com.xyz.lib.Pointcuts.anyPublicMethod()")
public void audit(JoinPoint jp) {
  // &#8230; use jp
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
. Using the `'argNames'` attribute is a little clumsy, so if the `'argNames'` attribute has not been specified, then Spring AOP will look at the debug information for the class and try to determine the parameter names from the local variable table.
  This information will be present as long as the classes have been compiled with debug information (`'-g:vars'` at a minimum).
  The consequences of compiling with this flag on are: (1) your code will be slightly easier to understand (reverse engineer), (2) the class file sizes will be very slightly bigger (typically inconsequential), (3) the optimization to remove unused local variables will not be applied by your compiler.
  In other words, you should encounter no difficulties building with this flag on.
+
. If the code has been compiled without the necessary debug information, then Spring AOP will attempt to deduce the pairing of binding variables to parameters (for example, if only one variable is bound in the pointcut expression, and the advice method only takes one parameter, the pairing is obvious!).
  If the binding of variables is ambiguous given the available information, then an  will be thrown.
. If all of the above strategies fail then an  will be thrown.

===== Proceeding with arguments

We remarked earlier that we would describe how to write a proceed call _with arguments_ that works consistently across Spring AOP and AspectJ. The solution is simply to ensure that the advice signature binds each of the method parameters in order.
For example:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Around("execution(List&lt;Account&gt; find*(..)) &amp;&amp;"<br>
        "com.xyz.myapp.SystemArchitecture.inDataAccessLayer() &amp;&amp; "<br>
        "args(accountHolderNamePattern)")
public Object preProcessQueryPattern(ProceedingJoinPoint pjp, String accountHolderNamePattern)
throws Throwable {
  String newPattern = preProcess(accountHolderNamePattern);
  return pjp.proceed(new Object[] {newpattern});
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In many cases you will be doing this binding anyway (as in the example above).

==== Advice ordering

What happens when multiple pieces of advice all want to run at the same join point? Spring AOP follows the same precedence rules as AspectJ to determine the order of advice execution.
The highest precedence advice runs first "on the way in" (so given two pieces of before advice, the one with highest precedence runs first).
"On the way out" from a join point, the highest precedence advice runs last (so given two pieces of after advice, the one with the highest precedence will run second).

When two pieces of advice defined in _different_ aspects both need to run at the same join point, unless you specify otherwise the order of execution is undefined.
You can control the order of execution by specifying precedence.
This is done in the normal Spring way by either implementing the [interface]`org.springframework.core.Ordered` interface in the aspect class or annotating it with the [interface]`Order` annotation.
Given two aspects, the aspect returning the lower value from `Ordered.getValue()` (or the annotation value) has the higher precedence.

When two pieces of advice defined in _the
        same_ aspect both need to run at the same join point, the ordering is undefined (since there is no way to retrieve the declaration order via reflection for javac-compiled classes).
Consider collapsing such advice methods into one advice method per join point in each aspect class, or refactor the pieces of advice into separate aspect classes - which can be ordered at the aspect level.

=== Introductions

Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare that advised objects implement a given interface, and to provide an implementation of that interface on behalf of those objects.

An introduction is made using the [interface]`@DeclareParents` annotation.
This annotation is used to declare that matching types have a new parent (hence the name).
For example, given an interface [interface]`UsageTracked`, and an implementation of that interface [class]`DefaultUsageTracked`, the following aspect declares that all implementors of service interfaces also implement the [interface]`UsageTracked` interface.
(In order to expose statistics via JMX for example.)

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Aspect
public class UsageTracking {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@DeclareParents(value="com.xzy.myapp.service.*+",
                defaultImpl=DefaultUsageTracked.class)
public static UsageTracked mixin;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Before("com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp;" +
        "this(usageTracked)")
public void recordUsage(UsageTracked usageTracked) {
  usageTracked.incrementUseCount();
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The interface to be implemented is determined by the type of the annotated field.
The `value` attribute of the [interface]`@DeclareParents` annotation is an AspectJ type pattern :- any bean of a matching type will implement the UsageTracked interface.
Note that in the before advice of the above example, service beans can be directly used as implementations of the [interface]`UsageTracked` interface.
If accessing a bean programmatically you would write the following:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>UsageTracked usageTracked = (UsageTracked) context.getBean("myService");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Aspect instantiation models

By default there will be a single instance of each aspect within the application context.
AspectJ calls this the singleton instantiation model.
It is possible to define aspects with alternate lifecycles :- Spring supports AspectJ's `perthis` and `pertarget` instantiation models (`percflow,
      percflowbelow,` and `pertypewithin` are not currently supported).

A "perthis" aspect is declared by specifying a `perthis` clause in the [interface]`@Aspect` annotation.
Let's look at an example, and then we'll explain how it works.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Aspect("perthis(com.xyz.myapp.SystemArchitecture.businessService())")
public class MyAspect {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private int someState;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Before(com.xyz.myapp.SystemArchitecture.businessService())
public void recordServiceUsage() {
  // ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The effect of the `'perthis'` clause is that one aspect instance will be created for each unique service object executing a business service (each unique object bound to 'this' at join points matched by the pointcut expression).
The aspect instance is created the first time that a method is invoked on the service object.
The aspect goes out of scope when the service object goes out of scope.
Before the aspect instance is created, none of the advice within it executes.
As soon as the aspect instance has been created, the advice declared within it will execute at matched join points, but only when the service object is the one this aspect is associated with.
See the AspectJ programming guide for more information on per-clauses.

The `'pertarget'` instantiation model works in exactly the same way as perthis, but creates one aspect instance for each unique target object at matched join points.

=== Example

Now that you have seen how all the constituent parts work, let's put them together to do something useful!

The execution of business services can sometimes fail due to concurrency issues (for example, deadlock loser).
If the operation is retried, it is quite likely to succeed next time round.
For business services where it is appropriate to retry in such conditions (idempotent operations that don't need to go back to the user for conflict resolution), we'd like to transparently retry the operation to avoid the client seeing a [class]`PessimisticLockingFailureException`.
This is a requirement that clearly cuts across multiple services in the service layer, and hence is ideal for implementing via an aspect.

Because we want to retry the operation, we will need to use around advice so that we can call proceed multiple times.
Here's how the basic aspect implementation looks:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Aspect
public class ConcurrentOperationExecutor implements Ordered {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private static final int DEFAULT_MAX_RETRIES = 2;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private int maxRetries = DEFAULT_MAX_RETRIES;
private int order = 1;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setMaxRetries(int maxRetries) {
   this.maxRetries = maxRetries;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public int getOrder() {
   return this.order;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setOrder(int order) {
   this.order = order;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Around("com.xyz.myapp.SystemArchitecture.businessService()")
public Object doConcurrentOperation(ProceedingJoinPoint pjp) throws Throwable {
   int numAttempts = 0;
   PessimisticLockingFailureException lockFailureException;
   do {
      numAttempts++;
      try {
         return pjp.proceed();
      }
      catch(PessimisticLockingFailureException ex) {
         lockFailureException = ex;
      }
   }
   while(numAttempts &lt;= this.maxRetries);
   throw lockFailureException;
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that the aspect implements the [interface]`Ordered` interface so we can set the precedence of the aspect higher than the transaction advice (we want a fresh transaction each time we retry).
The `maxRetries` and `order` properties will both be configured by Spring.
The main action happens in the `doConcurrentOperation` around advice.
Notice that for the moment we're applying the retry logic to all `businessService()s`.
We try to proceed, and if we fail with an [class]`PessimisticLockingFailureException` we simply try again unless we have exhausted all of our retry attempts.

The corresponding Spring configuration is:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspectj-autoproxy/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="concurrentOperationExecutor"
  class="com.xyz.myapp.service.impl.ConcurrentOperationExecutor"&gt;
     &lt;property name="maxRetries" value="3"/&gt;
     &lt;property name="order" value="100"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
To refine the aspect so that it only retries idempotent operations, we might define an [interface]`Idempotent` annotation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Retention(RetentionPolicy.RUNTIME)
public @interface Idempotent {
  // marker annotation
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
and use the annotation to annotate the implementation of service operations.
The change to the aspect to only retry idempotent operations simply involves refining the pointcut expression so that only [interface]`@Idempotent` operations match:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Around("com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; "<br>
        "@annotation(com.xyz.myapp.service.Idempotent)")
public Object doConcurrentOperation(ProceedingJoinPoint pjp) throws Throwable {
  &#8230;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Schema-based AOP support

If you are unable to use Java 5, or simply prefer an XML-based format, then Spring 2.0 also offers support for defining aspects using the new "aop" namespace tags.
The exact same pointcut expressions and advice kinds are supported as when using the @AspectJ style, hence in this section we will focus on the new _syntax_ and refer the reader to the discussion in the previous section (&lt;&lt;aop-ataspectj&gt;&gt;) for an understanding of writing pointcut expressions and the binding of advice parameters.

To use the aop namespace tags described in this section, you need to import the spring-aop schema as described in &lt;&lt;xsd-config&gt;&gt;.
See &lt;&lt;xsd-config-body-schemas-aop&gt;&gt; for how to import the tags in the aop namespace.

Within your Spring configurations, all aspect and advisor elements must be placed within an `&lt;aop:config&gt;` element (you can have more than one `&lt;aop:config&gt;` element in an application context configuration).
An `&lt;aop:config&gt;` element can contain pointcut, advisor, and aspect elements (note these must be declared in that order).

WARNING: The `&lt;aop:config&gt;` style of configuration makes heavy use of Spring's &lt;&lt;aop-autoproxy,auto-proxying&gt;&gt; mechanism.
This can cause issues (such as advice not being woven) if you are already using explicit auto-proxying via the use of [class]`BeanNameAutoProxyCreator` or suchlike.
The recommended usage pattern is to use either just the `&lt;aop:config&gt;` style, or just the [interface]`AutoProxyCreator` style.

=== Declaring an aspect

Using the schema support, an aspect is simply a regular Java object defined as a bean in your Spring application context.
The state and behavior is captured in the fields and methods of the object, and the pointcut and advice information is captured in the XML.

An aspect is declared using the &lt;aop:aspect&gt; element, and the backing bean is referenced using the `ref` attribute:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;
  &lt;aop:aspect id="myAspect" ref="aBean"&gt;
    &#8230;
  &lt;/aop:aspect&gt;
&lt;/aop:config&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="aBean" class="&#8230;"&gt;
  &#8230;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The bean backing the aspect ("`aBean`" in this case) can of course be configured and dependency injected just like any other Spring bean.

=== Declaring a pointcut

A named pointcut can be declared inside an &lt;aop:config&gt; element, enabling the pointcut definition to be shared across several aspects and advisors.

A pointcut representing the execution of any business service in the service layer could be defined as follows:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="businessService"
      expression="execution(* com.xyz.myapp.service.*.*(..))"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:config&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that the pointcut expression itself is using the same AspectJ pointcut expression language as described in &lt;&lt;aop-ataspectj&gt;&gt;.
If you are using the schema based declaration style with Java 5, you can refer to named pointcuts defined in types (@Aspects) within the pointcut expression, but this feature is not available on JDK 1.4 and below (it relies on the Java 5 specific AspectJ reflection APIs).
On JDK 1.5 therefore, another way of defining the above pointcut would be:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="businessService"
      expression="com.xyz.myapp.SystemArchitecture.businessService()"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:config&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Assuming you have a `SystemArchitecture` aspect as described in &lt;&lt;aop-common-pointcuts&gt;&gt;.

Declaring a pointcut inside an aspect is very similar to declaring a top-level pointcut:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:aspect id="myAspect" ref="aBean"&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="businessService"
      expression="execution(* com.xyz.myapp.service.*.*(..))"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/aop:aspect&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:config&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Much the same way in an @AspectJ aspect, pointcuts declared using the schema based definition style may collect join point context.
For example, the following pointcut collects the 'this' object as the join point context and passes it to advice:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:aspect id="myAspect" ref="aBean"&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="businessService"
      expression="execution(* com.xyz.myapp.service.*.*(..)) &amp;amp;&amp;amp; this(service)"/&gt;
&lt;aop:before pointcut-ref="businessService" method="monitor"/&gt;
...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/aop:aspect&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:config&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The advice must be declared to receive the collected join point context by including parameters of the matching names:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public void monitor(Object service) {
    &#8230;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
When combining pointcut sub-expressions, '&amp;&amp;' is awkward within an XML document, and so the keywords 'and', 'or' and 'not' can be used in place of '&amp;&amp;', '||' and '!' respectively.
For example, the previous pointcut may be better written as:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:aspect id="myAspect" ref="aBean"&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="businessService"
      expression="execution(* com.xyz.myapp.service.*.*(..)) and this(service)"/&gt;
&lt;aop:before pointcut-ref="businessService" method="monitor"/&gt;
...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/aop:aspect&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:config&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that pointcuts defined in this way are referred to by their XML id and cannot be used as named pointcuts to form composite pointcuts.
The named pointcut support in the schema based definition style is thus more limited than that offered by the @AspectJ style.

=== Declaring advice

The same five advice kinds are supported as for the @AspectJ style, and they have exactly the same semantics.

==== Before advice

Before advice runs before a matched method execution.
It is declared inside an `&lt;aop:aspect&gt;` using the &lt;aop:before&gt; element.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspect id="beforeExample" ref="aBean"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:before
  pointcut-ref="dataAccessOperation"
  method="doAccessCheck"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:aspect&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Here `dataAccessOperation` is the id of a pointcut defined at the top (`&lt;aop:config&gt;`) level.
To define the pointcut inline instead, replace the `pointcut-ref` attribute with a `pointcut` attribute:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspect id="beforeExample" ref="aBean"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:before
  pointcut="execution(* com.xyz.myapp.dao.*.*(..))"
  method="doAccessCheck"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:aspect&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
As we noted in the discussion of the @AspectJ style, using named pointcuts can significantly improve the readability of your code.

The method attribute identifies a method (`doAccessCheck`) that provides the body of the advice.
This method must be defined for the bean referenced by the aspect element containing the advice.
Before a data access operation is executed (a method execution join point matched by the pointcut expression), the "doAccessCheck" method on the aspect bean will be invoked.

==== After returning advice

After returning advice runs when a matched method execution completes normally.
It is declared inside an `&lt;aop:aspect&gt;` in the same way as before advice.
For example:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspect id="afterReturningExample" ref="aBean"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:after-returning
  pointcut-ref="dataAccessOperation"
  method="doAccessCheck"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:aspect&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Just as in the @AspectJ style, it is possible to get hold of the return value within the advice body.
Use the returning attribute to specify the name of the parameter to which the return value should be passed:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspect id="afterReturningExample" ref="aBean"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:after-returning
  pointcut-ref="dataAccessOperation"
  returning="retVal"
  method="doAccessCheck"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:aspect&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The doAccessCheck method must declare a parameter named `retVal`.
The type of this parameter constrains matching in the same way as described for @AfterReturning.
For example, the method signature may be declared as:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public void doAccessCheck(Object retVal) {&#8230;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== After throwing advice

After throwing advice executes when a matched method execution exits by throwing an exception.
It is declared inside an `&lt;aop:aspect&gt;` using the after-throwing element:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspect id="afterThrowingExample" ref="aBean"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:after-throwing
  pointcut-ref="dataAccessOperation"
  method="doRecoveryActions"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:aspect&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Just as in the @AspectJ style, it is possible to get hold of the thrown exception within the advice body.
Use the throwing attribute to specify the name of the parameter to which the exception should be passed:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspect id="afterThrowingExample" ref="aBean"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:after-throwing
  pointcut-ref="dataAccessOperation"
  throwing="dataAccessEx"
  method="doRecoveryActions"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:aspect&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The doRecoveryActions method must declare a parameter named `dataAccessEx`.
The type of this parameter constrains matching in the same way as described for @AfterThrowing.
For example, the method signature may be declared as:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public void doRecoveryActions(DataAccessException dataAccessEx) {&#8230;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== After (finally) advice

After (finally) advice runs however a matched method execution exits.
It is declared using the `after` element:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspect id="afterFinallyExample" ref="aBean"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:after
  pointcut-ref="dataAccessOperation"
  method="doReleaseLock"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:aspect&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Around advice

The final kind of advice is around advice.
Around advice runs "around" a matched method execution.
It has the opportunity to do work both before and after the method executes, and to determine when, how, and even if, the method actually gets to execute at all.
Around advice is often used if you need to share state before and after a method execution in a thread-safe manner (starting and stopping a timer for example).
Always use the least powerful form of advice that meets your requirements; don't use around advice if simple before advice would do.

Around advice is declared using the `aop:around` element.
The first parameter of the advice method must be of type [interface]`ProceedingJoinPoint`.
Within the body of the advice, calling `proceed()` on the [interface]`ProceedingJoinPoint` causes the underlying method to execute.
The `proceed` method may also be calling passing in an [class]`Object[]` - the values in the array will be used as the arguments to the method execution when it proceeds.
See &lt;&lt;aop-ataspectj-around-advice&gt;&gt; for notes on calling proceed with an [class]`Object[]`.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspect id="aroundExample" ref="aBean"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:around
  pointcut-ref="businessService"
  method="doBasicProfiling"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:aspect&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The implementation of the `doBasicProfiling` advice would be exactly the same as in the @AspectJ example (minus the annotation of course):

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public Object doBasicProfiling(ProceedingJoinPoint pjp) throws Throwable {
    // start stopwatch
    Object retVal = pjp.proceed();
    // stop stopwatch
    return retVal;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Advice parameters

The schema based declaration style supports fully typed advice in the same way as described for the @AspectJ support - by matching pointcut parameters by name against advice method parameters.
See &lt;&lt;aop-ataspectj-advice-params&gt;&gt; for details.
If you wish to explicitly specify argument names for the advice methods (not relying on the detection strategies previously described) then this is done using the `arg-names` attribute of the advice element, which is treated in the same manner to the "argNames" attribute in an advice annotation as described in &lt;&lt;aop-ataspectj-advice-params-names&gt;&gt;.
For example:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:before
  pointcut="com.xyz.lib.Pointcuts.anyPublicMethod() and @annotation(auditable)"
  method="audit"
  arg-names="auditable"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `arg-names` attribute accepts a comma-delimited list of parameter names.

Find below a slightly more involved example of the XSD-based approach that illustrates some around advice used in conjunction with a number of strongly typed parameters.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package x.y.service;</p>
</div>
<div class="paragraph">
<p>public interface FooService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   Foo getFoo(String fooName, int age);
}</pre>
</div>
</div>
<div class="paragraph">
<p>public class DefaultFooService implements FooService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   public Foo getFoo(String name, int age) {
      return new Foo(name, age);
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Next up is the aspect.
Notice the fact that the [method]`profile(..)` method accepts a number of strongly-typed parameters, the first of which happens to be the join point used to proceed with the method call: the presence of this parameter is an indication that the [method]`profile(..)` is to be used as `around` advice:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package x.y;</p>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.ProceedingJoinPoint;
import org.springframework.util.StopWatch;</p>
</div>
<div class="paragraph">
<p>public class SimpleProfiler {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   public Object profile(ProceedingJoinPoint call, String name, int age) throws Throwable {
      StopWatch clock = new StopWatch(
            "Profiling for '" + name + "' and '" + age + "'");
      try {
         clock.start(call.toShortString());
         return call.proceed();
      } finally {
         clock.stop();
         System.out.println(clock.prettyPrint());
      }
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Finally, here is the XML configuration that is required to effect the execution of the above advice for a particular join point:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:aop="http://www.springframework.org/schema/aop"
      xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop</a> <a href="http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;">http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- this is the object that will be proxied by Spring's AOP infrastructure --&gt;
&lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- this is the actual advice itself --&gt;
&lt;bean id="profiler" class="x.y.SimpleProfiler"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:config&gt;
   &lt;aop:aspect ref="profiler"&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="theExecutionOfSomeFooServiceMethod"
           expression="execution(* x.y.service.FooService.getFoo(String,int))
           and args(name, age)"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:around pointcut-ref="theExecutionOfSomeFooServiceMethod"
         method="profile"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>   &lt;/aop:aspect&gt;
&lt;/aop:config&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If we had the following driver script, we would get output something like this on standard output:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.BeanFactory;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import x.y.service.FooService;</p>
</div>
<div class="paragraph">
<p>public final class Boot {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   public static void main(final String[] args) throws Exception {
      BeanFactory ctx = new ClassPathXmlApplicationContext("x/y/plain.xml");
      FooService foo = (FooService) ctx.getBean("fooService");
      foo.getFoo("Pengo", 12);
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>StopWatch <em>Profiling for 'Pengo</em> and <em>12</em>': running time (millis) = 0</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ms     %     Task name</pre>
</div>
</div>
<div class="paragraph">
<p>00000  ?  execution(getFoo)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Advice ordering

When multiple advice needs to execute at the same join point (executing method) the ordering rules are as described in &lt;&lt;aop-ataspectj-advice-ordering&gt;&gt;.
The precedence between aspects is determined by either adding the [interface]`Order` annotation to the bean backing the aspect or by having the bean implement the [interface]`Ordered` interface.

=== Introductions

Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare that advised objects implement a given interface, and to provide an implementation of that interface on behalf of those objects.

An introduction is made using the `aop:declare-parents` element inside an `aop:aspect` This element is used to declare that matching types have a new parent (hence the name).
For example, given an interface [interface]`UsageTracked`, and an implementation of that interface [class]`DefaultUsageTracked`, the following aspect declares that all implementors of service interfaces also implement the [interface]`UsageTracked` interface.
(In order to expose statistics via JMX for example.)

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspect id="usageTrackerAspect" ref="usageTracking"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:declare-parents
    types-matching="com.xzy.myapp.service.*+"
    implement-interface="com.xyz.myapp.service.tracking.UsageTracked"
    default-impl="com.xyz.myapp.service.tracking.DefaultUsageTracked"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:before
  pointcut="com.xyz.myapp.SystemArchitecture.businessService()
            and this(usageTracked)"
  method="recordUsage"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:aspect&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The class backing the `usageTracking` bean would contain the method:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public void recordUsage(UsageTracked usageTracked) {
    usageTracked.incrementUseCount();
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The interface to be implemented is determined by `implement-interface` attribute.
The value of the `types-matching` attribute is an AspectJ type pattern :- any bean of a matching type will implement the [interface]`UsageTracked` interface.
Note that in the before advice of the above example, service beans can be directly used as implementations of the [interface]`UsageTracked` interface.
If accessing a bean programmatically you would write the following:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>UsageTracked usageTracked = (UsageTracked) context.getBean("myService");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Aspect instantiation models

The only supported instantiation model for schema-defined aspects is the singleton model.
Other instantiation models may be supported in future releases.

=== Advisors

The concept of "advisors" is brought forward from the AOP support defined in Spring 1.2 and does not have a direct equivalent in AspectJ. An advisor is like a small self-contained aspect that has a single piece of advice.
The advice itself is represented by a bean, and must implement one of the advice interfaces described in &lt;&lt;aop-api-advice-types&gt;&gt;.
Advisors can take advantage of AspectJ pointcut expressions though.

Spring 2.0 supports the advisor concept with the `&lt;aop:advisor&gt;` element.
You will most commonly see it used in conjunction with transactional advice, which also has its own namespace support in Spring 2.0.
Here's how it looks:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="businessService"
      expression="execution(* com.xyz.myapp.service.*.*(..))"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:advisor
    pointcut-ref="businessService"
    advice-ref="tx-advice"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:config&gt;</p>
</div>
<div class="paragraph">
<p>&lt;tx:advice id="tx-advice"&gt;
  &lt;tx:attributes&gt;
    &lt;tx:method name="*" propagation="REQUIRED"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
As well as the `pointcut-ref` attribute used in the above example, you can also use the `pointcut` attribute to define a pointcut expression inline.

To define the precedence of an advisor so that the advice can participate in ordering, use the `order` attribute to define the `Ordered` value of the advisor.

=== Example

Let's see how the concurrent locking failure retry example from &lt;&lt;aop-ataspectj-example&gt;&gt; looks when rewritten using the schema support.

The execution of business services can sometimes fail due to concurrency issues (for example, deadlock loser).
If the operation is retried, it is quite likely it will succeed next time round.
For business services where it is appropriate to retry in such conditions (idempotent operations that don't need to go back to the user for conflict resolution), we'd like to transparently retry the operation to avoid the client seeing a [class]`PessimisticLockingFailureException`.
This is a requirement that clearly cuts across multiple services in the service layer, and hence is ideal for implementing via an aspect.

Because we want to retry the operation, we'll need to use around advice so that we can call proceed multiple times.
Here's how the basic aspect implementation looks (it's just a regular Java class using the schema support):

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class ConcurrentOperationExecutor implements Ordered {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private static final int DEFAULT_MAX_RETRIES = 2;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private int maxRetries = DEFAULT_MAX_RETRIES;
private int order = 1;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setMaxRetries(int maxRetries) {
   this.maxRetries = maxRetries;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public int getOrder() {
   return this.order;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setOrder(int order) {
   this.order = order;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Object doConcurrentOperation(ProceedingJoinPoint pjp) throws Throwable {
   int numAttempts = 0;
   PessimisticLockingFailureException lockFailureException;
   do {
      numAttempts++;
      try {
         return pjp.proceed();
      }
      catch(PessimisticLockingFailureException ex) {
         lockFailureException = ex;
      }
   }
   while(numAttempts &lt;= this.maxRetries);
   throw lockFailureException;
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that the aspect implements the [interface]`Ordered` interface so we can set the precedence of the aspect higher than the transaction advice (we want a fresh transaction each time we retry).
The `maxRetries` and `order` properties will both be configured by Spring.
The main action happens in the `doConcurrentOperation` around advice method.
We try to proceed, and if we fail with a [class]`PessimisticLockingFailureException` we simply try again unless we have exhausted all of our retry attempts.

The corresponding Spring configuration is:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:aspect id="concurrentOperationRetry" ref="concurrentOperationExecutor"&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="idempotentOperation"
    expression="execution(* com.xyz.myapp.service.*.*(..))"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:around
   pointcut-ref="idempotentOperation"
   method="doConcurrentOperation"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/aop:aspect&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/aop:config&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="concurrentOperationExecutor"
  class="com.xyz.myapp.service.impl.ConcurrentOperationExecutor"&gt;
     &lt;property name="maxRetries" value="3"/&gt;
     &lt;property name="order" value="100"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Notice that for the time being we assume that all business services are idempotent.
If this is not the case we can refine the aspect so that it only retries genuinely idempotent operations, by introducing an [interface]`Idempotent` annotation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Retention(RetentionPolicy.RUNTIME)
public @interface Idempotent {
  // marker annotation
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
and using the annotation to annotate the implementation of service operations.
The change to the aspect to retry only idempotent operations simply involves refining the pointcut expression so that only [interface]`@Idempotent` operations match:

[source,xml]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="idempotentOperation"
      expression="execution(* com.xyz.myapp.service.*.*(..)) and
                  @annotation(com.xyz.myapp.service.Idempotent)"/&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Choosing which AOP declaration style to use

Once you have decided that an aspect is the best approach for implementing a given requirement, how do you decide between using Spring AOP or AspectJ, and between the Aspect language (code) style, @AspectJ annotation style, or the Spring XML style? These decisions are influenced by a number of factors including application requirements, development tools, and team familiarity with AOP.

=== Spring AOP or full AspectJ?

Use the simplest thing that can work.
Spring AOP is simpler than using full AspectJ as there is no requirement to introduce the AspectJ compiler / weaver into your development and build processes.
If you only need to advise the execution of operations on Spring beans, then Spring AOP is the right choice.
If you need to advise objects not managed by the Spring container (such as domain objects typically), then you will need to use AspectJ. You will also need to use AspectJ if you wish to advise join points other than simple method executions (for example, field get or set join points, and so on).

When using AspectJ, you have the choice of the AspectJ language syntax (also known as the "code style") or the @AspectJ annotation style.
Clearly, if you are not using Java 5+ then the choice has been made for you...
use the code style.
If aspects play a large role in your design, and you are able to use the &lt;&lt;,AspectJ Development Tools
      (AJDT)&gt;&gt; plugin for Eclipse, then the AspectJ language syntax is the preferred option: it is cleaner and simpler because the language was purposefully designed for writing aspects.
If you are not using Eclipse, or have only a few aspects that do not play a major role in your application, then you may want to consider using the @AspectJ style and sticking with a regular Java compilation in your IDE, and adding an aspect weaving phase to your build script.

=== @AspectJ or XML for Spring AOP?

If you have chosen to use Spring AOP, then you have a choice of @AspectJ or XML style.
Clearly if you are not running on Java 5+, then the XML style is the appropriate choice; for Java 5 projects there are various tradeoffs to consider.

The XML style will be most familiar to existing Spring users.
It can be used with any JDK level (referring to named pointcuts from within pointcut expressions does still require Java 5+ though) and is backed by genuine POJOs.
When using AOP as a tool to configure enterprise services then XML can be a good choice (a good test is whether you consider the pointcut expression to be a part of your configuration you might want to change independently).
With the XML style arguably it is clearer from your configuration what aspects are present in the system.

The XML style has two disadvantages.
Firstly it does not fully encapsulate the implementation of the requirement it addresses in a single place.
The DRY principle says that there should be a single, unambiguous, authoritative representation of any piece of knowledge within a system.
When using the XML style, the knowledge of _how_ a requirement is implemented is split across the declaration of the backing bean class, and the XML in the configuration file.
When using the @AspectJ style there is a single module - the aspect - in which this information is encapsulated.
Secondly, the XML style is slightly more limited in what it can express than the @AspectJ style: only the "singleton" aspect instantiation model is supported, and it is not possible to combine named pointcuts declared in XML. For example, in the @AspectJ style you can write something like:

[source,java]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Pointcut(execution(* get*()))
public void propertyAccess() {}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Pointcut(execution(org.xyz.Account+ *(..))
public void operationReturningAnAccount() {}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Pointcut(propertyAccess() &amp;&amp; operationReturningAnAccount())
public void accountPropertyAccess() {}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
In the XML style I can declare the first two pointcuts:

[source,xml]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="propertyAccess"
    expression="execution(* get*())"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="operationReturningAnAccount"
    expression="execution(org.xyz.Account+ *(..))"/&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The downside of the XML approach is that you cannot define the '`accountPropertyAccess`' pointcut by combining these definitions.

The @AspectJ style supports additional instantiation models, and richer pointcut composition.
It has the advantage of keeping the aspect as a modular unit.
It also has the advantage the @AspectJ aspects can be understood (and thus consumed) both by Spring AOP and by AspectJ - so if you later decide you need the capabilities of AspectJ to implement additional requirements then it is very easy to migrate to an AspectJ-based approach.
On balance the Spring team prefer the @AspectJ style whenever you have aspects that do more than simple "configuration" of enterprise services.

== Mixing aspect types

It is perfectly possible to mix @AspectJ style aspects using the autoproxying support, schema-defined `&lt;aop:aspect&gt;` aspects, `&lt;aop:advisor&gt;` declared advisors and even proxies and interceptors defined using the Spring 1.2 style in the same configuration.
All of these are implemented using the same underlying support mechanism and will co-exist without any difficulty.

== Proxying mechanisms

Spring AOP uses either JDK dynamic proxies or CGLIB to create the proxy for a given target object.
(JDK dynamic proxies are preferred whenever you have a choice).

If the target object to be proxied implements at least one interface then a JDK dynamic proxy will be used.
All of the interfaces implemented by the target type will be proxied.
If the target object does not implement any interfaces then a CGLIB proxy will be created.

If you want to force the use of CGLIB proxying (for example, to proxy every method defined for the target object, not just those implemented by its interfaces) you can do so.
However, there are some issues to consider:

* `final` methods cannot be advised, as they cannot be overridden.
* As of Spring 3.2, it is no longer necessary to add CGLIB to your project classpath, as CGLIB classes are repackaged under org.springframework and included directly in the spring-core JAR. This means that CGLIB-based proxy support 'just works' in the same way that JDK dynamic proxies always have.
* The constructor of your proxied object will be called twice.
  This is a natural consequence of the CGLIB proxy model whereby a subclass is generated for each proxied object.
  For each proxied instance, two objects are created: the actual proxied object and an instance of the subclass that implements the advice.
  This behavior is not exhibited when using JDK proxies.
  Usually, calling the constructor of the proxied type twice, is not an issue, as there are usually only assignments taking place and no real logic is implemented in the constructor.

To force the use of CGLIB proxies set the value of the `proxy-target-class` attribute of the `&lt;aop:config&gt;` element to true:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config proxy-target-class="true"&gt;
    &lt;!-- other beans defined here&#8230; -&#8594;
&lt;/aop:config&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
To force CGLIB proxying when using the @AspectJ autoproxy support, set the `'proxy-target-class'` attribute of the `&lt;aop:aspectj-autoproxy&gt;` element to `true`:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspectj-autoproxy proxy-target-class="true"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[NOTE]
====
Multiple `&lt;aop:config/&gt;` sections are collapsed into a single unified auto-proxy creator at runtime, which applies the _strongest_ proxy settings that any of the `&lt;aop:config/&gt;` sections (typically from different XML bean definition files) specified.
This also applies to the `&lt;tx:annotation-driven/&gt;` and `&lt;aop:aspectj-autoproxy/&gt;` elements.

To be clear: using '`proxy-target-class="true"`' on `&lt;tx:annotation-driven/&gt;`, `&lt;aop:aspectj-autoproxy/&gt;` or `&lt;aop:config/&gt;` elements will force the use of CGLIB proxies _for all three of them_.
====

=== Understanding AOP proxies

Spring AOP is _proxy-based_.
It is vitally important that you grasp the semantics of what that last statement actually means before you write your own aspects or use any of the Spring AOP-based aspects supplied with the Spring Framework.

Consider first the scenario where you have a plain-vanilla, un-proxied, nothing-special-about-it, straight object reference, as illustrated by the following code snippet.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class SimplePojo implements Pojo {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void foo() {
   // this next method invocation is a direct
   call on the 'this' reference
   this.bar();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>   public void bar() {
      // some logic...
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
If you invoke a method on an object reference, the method is invoked _directly_ on that object reference, as can be seen below.



[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class Main {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public static void main(String[] args) {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Pojo pojo = new SimplePojo();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>      // this is a direct method call on the 'pojo' reference
      pojo.foo();
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Things change slightly when the reference that client code has is a proxy.
Consider the following diagram and code snippet.



[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class Main {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public static void main(String[] args) {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ProxyFactory factory = new ProxyFactory(new SimplePojo());
factory.addInterface(Pojo.class);
factory.addAdvice(new RetryAdvice());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Pojo pojo = (Pojo) factory.getProxy();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>      // this is a method call on the proxy!
      pojo.foo();
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The key thing to understand here is that the client code inside the [method]`main(..)` of the [class]`Main` class _has a reference to the proxy_.
This means that method calls on that object reference will be calls on the proxy, and as such the proxy will be able to delegate to all of the interceptors (advice) that are relevant to that particular method call.
However, once the call has finally reached the target object, the [class]`SimplePojo` reference in this case, any method calls that it may make on itself, such as [method]`this.bar()` or [method]`this.foo()`, are going to be invoked against the _`this`_ reference, and _not_ the proxy.
This has important implications.
It means that self-invocation is _not_ going to result in the advice associated with a method invocation getting a chance to execute.

Okay, so what is to be done about this? The best approach (the term best is used loosely here) is to refactor your code such that the self-invocation does not happen.
For sure, this does entail some work on your part, but it is the best, least-invasive approach.
The next approach is absolutely horrendous, and I am almost reticent to point it out precisely because it is so horrendous.
You can (choke!) totally tie the logic within your class to Spring AOP by doing this:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class SimplePojo implements Pojo {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void foo() {
   // this works, but... gah!
   ((Pojo) AopContext.currentProxy()).bar();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>   public void bar() {
      // some logic...
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
This totally couples your code to Spring AOP, _and_ it makes the class itself aware of the fact that it is being used in an AOP context, which flies in the face of AOP. It also requires some additional configuration when the proxy is being created:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class Main {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public static void main(String[] args) {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ProxyFactory factory = new ProxyFactory(new SimplePojo());
factory.adddInterface(Pojo.class);
factory.addAdvice(new RetryAdvice());
factory.setExposeProxy(true);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Pojo pojo = (Pojo) factory.getProxy();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>      // this is a method call on the proxy!
      pojo.foo();
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Finally, it must be noted that AspectJ does not have this self-invocation issue because it is not a proxy-based AOP framework.

== Programmatic creation of @AspectJ Proxies

In addition to declaring aspects in your configuration using either `&lt;aop:config&gt;` or `&lt;aop:aspectj-autoproxy&gt;`, it is also possible programmatically to create proxies that advise target objects.
For the full details of Spring's AOP API, see the next chapter.
Here we want to focus on the ability to automatically create proxies using @AspectJ aspects.

The class [class]`org.springframework.aop.aspectj.annotation.AspectJProxyFactory` can be used to create a proxy for a target object that is advised by one or more @AspectJ aspects.
Basic usage for this class is very simple, as illustrated below.
See the Javadocs for full information.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>AspectJProxyFactory factory = new AspectJProxyFactory(targetObject);</p>
</div>
<div class="paragraph">
<p>factory.addAspect(SecurityManager.class);</p>
</div>
<div class="paragraph">
<p>factory.addAspect(usageTracker);</p>
</div>
<div class="paragraph">
<p>MyInterfaceType proxy = factory.getProxy();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Using AspectJ with Spring applications

Everything we've covered so far in this chapter is pure Spring AOP. In this section, we're going to look at how you can use the AspectJ compiler/weaver instead of, or in addition to, Spring AOP if your needs go beyond the facilities offered by Spring AOP alone.

Spring ships with a small AspectJ aspect library, which is available standalone in your distribution as [file]`spring-aspects.jar`; you'll need to add this to your classpath in order to use the aspects in it.
&lt;&lt;aop-atconfigurable&gt;&gt; and &lt;&lt;aop-ajlib-other&gt;&gt; discuss the content of this library and how you can use it.
&lt;&lt;aop-aj-configure&gt;&gt; discusses how to dependency inject AspectJ aspects that are woven using the AspectJ compiler.
Finally, &lt;&lt;aop-aj-ltw&gt;&gt; provides an introduction to load-time weaving for Spring applications using AspectJ.

=== Using AspectJ to dependency inject domain objects with Spring

The Spring container instantiates and configures beans defined in your application context.
It is also possible to ask a bean factory to configure a _pre-existing_ object given the name of a bean definition containing the configuration to be applied.
The [file]`spring-aspects.jar` contains an annotation-driven aspect that exploits this capability to allow dependency injection of _any object_.
The support is intended to be used for objects created _outside of the control
      of any container_.
Domain objects often fall into this category because they are often created programmatically using the `new` operator, or by an ORM tool as a result of a database query.

The [interface]`@Configurable` annotation marks a class as eligible for Spring-driven configuration.
In the simplest case it can be used just as a marker annotation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.xyz.myapp.domain;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.annotation.Configurable;</p>
</div>
<div class="paragraph">
<p>@Configurable
public class Account {
   // &#8230;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
When used as a marker interface in this way, Spring will configure new instances of the annotated type ([class]`Account` in this case) using a bean definition (typically prototype-scoped) with the same name as the fully-qualified type name ([class]`com.xyz.myapp.domain.Account`).
Since the default name for a bean is the fully-qualified name of its type, a convenient way to declare the prototype definition is simply to omit the `id` attribute:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean class="com.xyz.myapp.domain.Account" scope="prototype"&gt;
  &lt;property name="fundsTransferService" ref="fundsTransferService"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If you want to explicitly specify the name of the prototype bean definition to use, you can do so directly in the annotation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.xyz.myapp.domain;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.annotation.Configurable;</p>
</div>
<div class="paragraph">
<p>@Configurable("account")
public class Account {
   // &#8230;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Spring will now look for a bean definition named "`account`" and use that as the definition to configure new [class]`Account` instances.

You can also use autowiring to avoid having to specify a dedicated bean definition at all.
To have Spring apply autowiring use the '`autowire`' property of the [interface]`@Configurable` annotation: specify either `@Configurable(autowire=Autowire.BY_TYPE)` or `@Configurable(autowire=Autowire.BY_NAME` for autowiring by type or by name respectively.
As an alternative, as of Spring 2.5 it is preferable to specify explicit, annotation-driven dependency injection for your [interface]`@Configurable` beans by using [interface]`@Autowired` or [interface]`@Inject` at the field or method level (see &lt;&lt;beans-annotation-config&gt;&gt; for further details).

Finally you can enable Spring dependency checking for the object references in the newly created and configured object by using the `dependencyCheck` attribute (for example: `@Configurable(autowire=Autowire.BY_NAME,dependencyCheck=true)`).
If this attribute is set to true, then Spring will validate after configuration that all properties (_which are not primitives or
      collections_) have been set.

Using the annotation on its own does nothing of course.
It is the [class]`AnnotationBeanConfigurerAspect` in [file]`spring-aspects.jar` that acts on the presence of the annotation.
In essence the aspect says "after returning from the initialization of a new object of a type annotated with [interface]`@Configurable`, configure the newly created object using Spring in accordance with the properties of the annotation".
In this context, _initialization_ refers to newly instantiated objects (e.g., objects instantiated with the '`new`' operator) as well as to [interface]`Serializable` objects that are undergoing deserialization (e.g., via &lt;&lt;,readResolve()&gt;&gt;).

[NOTE]
====
One of the key phrases in the above paragraph is '_in
        essence_'.
For most cases, the exact semantics of '_after returning from the initialization of a new
        object_' will be fine...
in this context, '_after
        initialization_' means that the dependencies will be injected _after_ the object has been constructed - this means that the dependencies will not be available for use in the constructor bodies of the class.
If you want the dependencies to be injected _before_ the constructor bodies execute, and thus be available for use in the body of the constructors, then you need to define this on the [interface]`@Configurable` declaration like so:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Configurable(preConstruction=true)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
You can find out more information about the language semantics of the various pointcut types in AspectJ &lt;&lt;,in
        this appendix&gt;&gt; of the &lt;&lt;,AspectJ
        Programming Guide&gt;&gt;.
====

For this to work the annotated types must be woven with the AspectJ weaver - you can either use a build-time Ant or Maven task to do this (see for example the &lt;&lt;,AspectJ
      Development Environment Guide&gt;&gt;) or load-time weaving (see &lt;&lt;aop-aj-ltw&gt;&gt;).
The [class]`AnnotationBeanConfigurerAspect` itself needs configuring by Spring (in order to obtain a reference to the bean factory that is to be used to configure new objects).
If you are using Java based configuration simply add [interface]`@EnableSpringConfigured` to any [interface]`@Configuration` class.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Configuration
@EnableSpringConfigured
public class AppConfig {</p>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If you prefer XML based configuration, the Spring &lt;&lt;xsd-config-body-schemas-context,`context`
      namespace&gt;&gt; defines a convenient `context:spring-configured` element:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;context:spring-configured/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If you are using the DTD instead of schema, the equivalent definition is:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean
      class="org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect"
      factory-method="aspectOf"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Instances of [interface]`@Configurable` objects created _before_ the aspect has been configured will result in a message being issued to the debug log and no configuration of the object taking place.
An example might be a bean in the Spring configuration that creates domain objects when it is initialized by Spring.
In this case you can use the "depends-on" bean attribute to manually specify that the bean depends on the configuration aspect.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="myService"
  class="com.xzy.myapp.service.MyService"
  depends-on="org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- ... --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: Do not activate [interface]`@Configurable` processing through the bean configurer aspect unless you really mean to rely on its semantics at runtime.
In particular, make sure that you do not use [interface]`@Configurable` on bean classes which are registered as regular Spring beans with the container: You would get double initialization otherwise, once through the container and once through the aspect.

==== Unit testing [interface]`@Configurable` objects

One of the goals of the [interface]`@Configurable` support is to enable independent unit testing of domain objects without the difficulties associated with hard-coded lookups.
If [interface]`@Configurable` types have not been woven by AspectJ then the annotation has no affect during unit testing, and you can simply set mock or stub property references in the object under test and proceed as normal.
If [interface]`@Configurable` types _have_ been woven by AspectJ then you can still unit test outside of the container as normal, but you will see a warning message each time that you construct an [interface]`@Configurable` object indicating that it has not been configured by Spring.

==== Working with multiple application contexts

The [class]`AnnotationBeanConfigurerAspect` used to implement the [interface]`@Configurable` support is an AspectJ singleton aspect.
The scope of a singleton aspect is the same as the scope of `static` members, that is to say there is one aspect instance per classloader that defines the type.
This means that if you define multiple application contexts within the same classloader hierarchy you need to consider where to define the [interface]`@EnableSpringConfigured` bean and where to place [file]`spring-aspects.jar` on the classpath.

Consider a typical Spring web-app configuration with a shared parent application context defining common business services and everything needed to support them, and one child application context per servlet containing definitions particular to that servlet.
All of these contexts will co-exist within the same classloader hierarchy, and so the `AnnotationBeanConfigurerAspect` can only hold a reference to one of them.
In this case we recommend defining the [interface]`@EnableSpringConfigured` bean in the shared (parent) application context: this defines the services that you are likely to want to inject into domain objects.
A consequence is that you cannot configure domain objects with references to beans defined in the child (servlet-specific) contexts using the @Configurable mechanism (probably not something you want to do anyway!).

When deploying multiple web-apps within the same container, ensure that each web-application loads the types in [file]`spring-aspects.jar` using its own classloader (for example, by placing [file]`spring-aspects.jar` in [file]`'WEB-INF/lib'`).
If [file]`spring-aspects.jar` is only added to the container wide classpath (and hence loaded by the shared parent classloader), all web applications will share the same aspect instance which is probably not what you want.

=== Other Spring aspects for AspectJ

In addition to the [interface]`@Configurable` aspect, [file]`spring-aspects.jar` contains an AspectJ aspect that can be used to drive Spring's transaction management for types and methods annotated with the [interface]`@Transactional` annotation.
This is primarily intended for users who want to use the Spring Framework's transaction support outside of the Spring container.

The aspect that interprets [interface]`@Transactional` annotations is the [class]`AnnotationTransactionAspect`.
When using this aspect, you must annotate the _implementation_ class (and/or methods within that class), _not_ the interface (if any) that the class implements.
AspectJ follows Java's rule that annotations on interfaces are _not
      inherited_.

A [interface]`@Transactional` annotation on a class specifies the default transaction semantics for the execution of any _public_ operation in the class.

A [interface]`@Transactional` annotation on a method within the class overrides the default transaction semantics given by the class annotation (if present).
Methods with `public`, `protected`, and default visibility may all be annotated.
Annotating `protected` and default visibility methods directly is the only way to get transaction demarcation for the execution of such methods.

For AspectJ programmers that want to use the Spring configuration and transaction management support but don't want to (or cannot) use annotations, [file]`spring-aspects.jar` also contains `abstract` aspects you can extend to provide your own pointcut definitions.
See the sources for the [class]`AbstractBeanConfigurerAspect` and [class]`AbstractTransactionAspect` aspects for more information.
As an example, the following excerpt shows how you could write an aspect to configure all instances of objects defined in the domain model using prototype bean definitions that match the fully-qualified class names:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public aspect DomainObjectConfiguration extends AbstractBeanConfigurerAspect {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public DomainObjectConfiguration() {
  setBeanWiringInfoResolver(new ClassNameBeanWiringInfoResolver());
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// the creation of a new bean (any object in the domain model)
protected pointcut beanCreation(Object beanInstance) :
  initialization(new(..)) &amp;&amp;
  SystemArchitecture.inDomainModel() &amp;&amp;
  this(beanInstance);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Configuring AspectJ aspects using Spring IoC

When using AspectJ aspects with Spring applications, it is natural to both want and expect to be able to configure such aspects using Spring.
The AspectJ runtime itself is responsible for aspect creation, and the means of configuring the AspectJ created aspects via Spring depends on the AspectJ instantiation model (the '`per-xxx`' clause) used by the aspect.

The majority of AspectJ aspects are _singleton_ aspects.
Configuration of these aspects is very easy: simply create a bean definition referencing the aspect type as normal, and include the bean attribute `'factory-method="aspectOf"'`.
This ensures that Spring obtains the aspect instance by asking AspectJ for it rather than trying to create an instance itself.
For example:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="profiler" class="com.xyz.profiler.Profiler"
      factory-method="aspectOf"&gt;
  &lt;property name="profilingStrategy" ref="jamonProfilingStrategy"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Non-singleton aspects are harder to configure: however it is possible to do so by creating prototype bean definitions and using the [interface]`@Configurable` support from [file]`spring-aspects.jar` to configure the aspect instances once they have bean created by the AspectJ runtime.

If you have some @AspectJ aspects that you want to weave with AspectJ (for example, using load-time weaving for domain model types) and other @AspectJ aspects that you want to use with Spring AOP, and these aspects are all configured using Spring, then you will need to tell the Spring AOP @AspectJ autoproxying support which exact subset of the @AspectJ aspects defined in the configuration should be used for autoproxying.
You can do this by using one or more `&lt;include/&gt;` elements inside the `&lt;aop:aspectj-autoproxy/&gt;` declaration.
Each `&lt;include/&gt;` element specifies a name pattern, and only beans with names matched by at least one of the patterns will be used for Spring AOP autoproxy configuration:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:aspectj-autoproxy&gt;
  &lt;aop:include name="thisBean"/&gt;
  &lt;aop:include name="thatBean"/&gt;
&lt;/aop:aspectj-autoproxy&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: Do not be misled by the name of the `&lt;aop:aspectj-autoproxy/&gt;` element: using it will result in the creation of _Spring AOP
        proxies_.
The @AspectJ style of aspect declaration is just being used here, but the AspectJ runtime is _not_ involved.

=== Load-time weaving with AspectJ in the Spring Framework

Load-time weaving (LTW) refers to the process of weaving AspectJ aspects into an application's class files as they are being loaded into the Java virtual machine (JVM).
The focus of this section is on configuring and using LTW in the specific context of the Spring Framework: this section is not an introduction to LTW though.
For full details on the specifics of LTW and configuring LTW with just AspectJ (with Spring not being involved at all), see the &lt;&lt;,LTW
      section of the AspectJ Development Environment Guide&gt;&gt;.

The value-add that the Spring Framework brings to AspectJ LTW is in enabling much finer-grained control over the weaving process.
'Vanilla' AspectJ LTW is effected using a Java (5+) agent, which is switched on by specifying a VM argument when starting up a JVM. It is thus a JVM-wide setting, which may be fine in some situations, but often is a little too coarse.
Spring-enabled LTW enables you to switch on LTW on a _per-[class]`ClassLoader`_ basis, which obviously is more fine-grained and which can make more sense in a 'single-JVM-multiple-application' environment (such as is found in a typical application server environment).

Further, &lt;&lt;aop-aj-ltw-environments,in certain
      environments&gt;&gt;, this support enables load-time weaving _without making any modifications to the application server's
      launch script_ that will be needed to add `-javaagent:path/to/aspectjweaver.jar` or (as we describe later in this section) `-javaagent:path/to/org.springframework.instrument-{version}.jar` (previously named `spring-agent.jar`).
Developers simply modify one or more files that form the application context to enable load-time weaving instead of relying on administrators who typically are in charge of the deployment configuration such as the launch script.

Now that the sales pitch is over, let us first walk through a quick example of AspectJ LTW using Spring, followed by detailed specifics about elements introduced in the following example.
For a complete example, please see the Petclinic &lt;&lt;new-in-3.0-samples,sample&gt;&gt; application.

==== A first example

Let us assume that you are an application developer who has been tasked with diagnosing the cause of some performance problems in a system.
Rather than break out a profiling tool, what we are going to do is switch on a simple profiling aspect that will enable us to very quickly get some performance metrics, so that we can then apply a finer-grained profiling tool to that specific area immediately afterwards.

NOTE: The example presented here uses XML style configuration, it is also possible to configure and use @AspectJ with &lt;&lt;beans-java,Java Configuration&gt;&gt;.
Specifically the [interface]`@EnableLoadTimeWeaving` annotation can be used as an alternative to `&lt;context:load-time-weaver/&gt;` (see &lt;&lt;aop-aj-ltw-spring,below&gt;&gt; for details).

Here is the profiling aspect.
Nothing too fancy, just a quick-and-dirty time-based profiler, using the @AspectJ-style of aspect declaration.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package foo;</p>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Pointcut;
import org.springframework.util.StopWatch;
import org.springframework.core.annotation.Order;</p>
</div>
<div class="paragraph">
<p>@Aspect
public class ProfilingAspect {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Around("methodsToBeProfiled()")
public Object profile(ProceedingJoinPoint pjp) throws Throwable {
    StopWatch sw = new StopWatch(getClass().getSimpleName());
    try {
        sw.start(pjp.getSignature().getName());
        return pjp.proceed();
    } finally {
        sw.stop();
        System.out.println(sw.prettyPrint());
    }
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    @Pointcut("execution(public * foo..*.*(..))")
    public void methodsToBeProfiled(){}
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
We will also need to create an '[file]`META-INF/aop.xml`' file, to inform the AspectJ weaver that we want to weave our [class]`ProfilingAspect` into our classes.
This file convention, namely the presence of a file (or files) on the Java classpath called ' [file]`META-INF/aop.xml`' is standard AspectJ.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!DOCTYPE aspectj PUBLIC
        "-//AspectJ//DTD//EN" "http://www.eclipse.org/aspectj/dtd/aspectj.dtd"&gt;
&lt;aspectj&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;weaver&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- only weave classes in our application-specific packages --&gt;
&lt;include within="foo.*"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/weaver&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aspects&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- weave in just this aspect --&gt;
&lt;aspect name="foo.ProfilingAspect"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/aspects&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/aspectj&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Now to the Spring-specific portion of the configuration.
We need to configure a [interface]`LoadTimeWeaver` (all explained later, just take it on trust for now).
This load-time weaver is the essential component responsible for weaving the aspect configuration in one or more '[file]`META-INF/aop.xml`' files into the classes in your application.
The good thing is that it does not require a lot of configuration, as can be seen below (there are some more options that you can specify, but these are detailed later).

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
    <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/context">http://www.springframework.org/schema/context</a>
    <a href="http://www.springframework.org/schema/context/spring-context.xsd"&gt;">http://www.springframework.org/schema/context/spring-context.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- a service object; we will be profiling its methods --&gt;
&lt;bean id="entitlementCalculationService"
      class="foo.StubEntitlementCalculationService"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- this switches on the load-time weaving --&gt;
&lt;context:load-time-weaver/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Now that all the required artifacts are in place - the aspect, the '[file]`META-INF/aop.xml`' file, and the Spring configuration -, let us create a simple driver class with a [method]`main(..)` method to demonstrate the LTW in action.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package foo;</p>
</div>
<div class="paragraph">
<p>import org.springframework.context.support.ClassPathXmlApplicationContext;</p>
</div>
<div class="paragraph">
<p>public final class Main {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public static void main(String[] args) {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml", Main.class);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>EntitlementCalculationService entitlementCalculationService
    = (EntitlementCalculationService) ctx.getBean("entitlementCalculationService");</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        // the profiling aspect is 'woven' around this method execution
        entitlementCalculationService.calculateEntitlement();
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
There is one last thing to do.
The introduction to this section did say that one could switch on LTW selectively on a per-[class]`ClassLoader` basis with Spring, and this is true.
However, just for this example, we are going to use a Java agent (supplied with Spring) to switch on the LTW. This is the command line we will use to run the above [class]`Main` class:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>java -javaagent:C:/projects/foo/lib/global/spring-instrument.jar foo.Main</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The '`-javaagent`' is a Java 5+ flag for specifying and enabling &lt;&lt;,agents
        to instrument programs running on the JVM&gt;&gt;.
The Spring Framework ships with such an agent, the [class]`InstrumentationSavingAgent`, which is packaged in the [file]`spring-instrument.jar` that was supplied as the value of the `-javaagent` argument in the above example.

The output from the execution of the [class]`Main` program will look something like that below.
(I have introduced a [method]`Thread.sleep(..)` statement into the [method]`calculateEntitlement()` implementation so that the profiler actually captures something other than 0 milliseconds - the `01234` milliseconds is _not_ an overhead introduced by the AOP :) )

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>Calculating entitlement</p>
</div>
<div class="paragraph">
<p>StopWatch <em>ProfilingAspect</em>: running time (millis) = 1234
------ ----- ----------------------------
ms     %     Task name
------ ----- ----------------------------
01234  100%  calculateEntitlement</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Since this LTW is effected using full-blown AspectJ, we are not just limited to advising Spring beans; the following slight variation on the [class]`Main` program will yield the same result.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package foo;</p>
</div>
<div class="paragraph">
<p>import org.springframework.context.support.ClassPathXmlApplicationContext;</p>
</div>
<div class="paragraph">
<p>public final class Main {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public static void main(String[] args) {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>new ClassPathXmlApplicationContext("beans.xml", Main.class);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>EntitlementCalculationService entitlementCalculationService =
    new StubEntitlementCalculationService();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        // the profiling aspect will be 'woven' around this method execution
        entitlementCalculationService.calculateEntitlement();
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Notice how in the above program we are simply bootstrapping the Spring container, and then creating a new instance of the [class]`StubEntitlementCalculationService` totally outside the context of Spring...
the profiling advice still gets woven in.

The example admittedly is simplistic...
however the basics of the LTW support in Spring have all been introduced in the above example, and the rest of this section will explain the 'why' behind each bit of configuration and usage in detail.

NOTE: The [class]`ProfilingAspect` used in this example may be basic, but it is quite useful.
It is a nice example of a development-time aspect that developers can use during development (of course), and then quite easily exclude from builds of the application being deployed into UAT or production.

==== Aspects

The aspects that you use in LTW have to be AspectJ aspects.
They can be written in either the AspectJ language itself or you can write your aspects in the @AspectJ-style.
The latter option is of course only an option if you are using Java 5+, but it does mean that your aspects are then both valid AspectJ _and_ Spring AOP aspects.
Furthermore, the compiled aspect classes need to be available on the classpath.

==== '[file]`META-INF/aop.xml`'

The AspectJ LTW infrastructure is configured using one or more '[file]`META-INF/aop.xml`' files, that are on the Java classpath (either directly, or more typically in jar files).

The structure and contents of this file is detailed in the main AspectJ reference documentation, and the interested reader is &lt;&lt;,referred
        to that resource&gt;&gt;.
(I appreciate that this section is brief, but the '[file]`aop.xml`' file is 100% AspectJ - there is no Spring-specific information or semantics that apply to it, and so there is no extra value that I can contribute either as a result), so rather than rehash the quite satisfactory section that the AspectJ developers wrote, I am just directing you there.)

==== Required libraries (JARS)

At a minimum you will need the following libraries to use the Spring Framework's support for AspectJ LTW:

[]
. [file]`spring-aop.jar` (version 2.5 or later, plus all mandatory dependencies)
. [file]`aspectjweaver.jar` (version 1.6.8 or later)

If you are using the &lt;&lt;aop-aj-ltw-environment-generic,Spring-provided agent to
        enable instrumentation&gt;&gt;, you will also need:

[]
. [file]`spring-instrument.jar`

==== Spring configuration

The key component in Spring's LTW support is the [interface]`LoadTimeWeaver` interface (in the `org.springframework.instrument.classloading` package), and the numerous implementations of it that ship with the Spring distribution.
A [interface]`LoadTimeWeaver` is responsible for adding one or more [class]`java.lang.instrument.ClassFileTransformers` to a [class]`ClassLoader` at runtime, which opens the door to all manner of interesting applications, one of which happens to be the LTW of aspects.

TIP: If you are unfamiliar with the idea of runtime class file transformation, you are encouraged to read the Javadoc API documentation for the `java.lang.instrument` package before continuing.
This is not a huge chore because there is - rather annoyingly - precious little documentation there...
the key interfaces and classes will at least be laid out in front of you for reference as you read through this section.

Configuring a [interface]`LoadTimeWeaver` for a particular [interface]`ApplicationContext` can be as easy as adding one line.
(Please note that you almost certainly will need to be using an [interface]`ApplicationContext` as your Spring container - typically a [interface]`BeanFactory` will not be enough because the LTW support makes use of [interface]`BeanFactoryPostProcessors`.)

To enable the Spring Framework's LTW support, you need to configure a [interface]`LoadTimeWeaver`, which typically is done using the [interface]`@EnableLoadTimeWeaving` annotation.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Configuration
@EnableLoadTimeWeaving
public class AppConfig {</p>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Alternatively, if you prefer XML based configuration, use the `&lt;context:load-time-weaver/&gt;` element.
Note that the element is defined in the '`context`' namespace.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
    <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/context">http://www.springframework.org/schema/context</a>
    <a href="http://www.springframework.org/schema/context/spring-context.xsd"&gt;">http://www.springframework.org/schema/context/spring-context.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;context:load-time-weaver/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above configuration will define and register a number of LTW-specific infrastructure beans for you automatically, such as a [interface]`LoadTimeWeaver` and an [class]`AspectJWeavingEnabler`.
 The default [interface]`LoadTimeWeaver` is the [class]`DefaultContextLoadTimeWeaver` class, which attempts to decorate an automatically detected [interface]`LoadTimeWeaver`: the exact type of [interface]`LoadTimeWeaver` that will be 'automatically detected' is dependent upon your runtime environment (summarized in the following table).

.[class]`DefaultContextLoadTimeWeaver`[interface]`LoadTimeWeavers`
[cols="1,1", options="header"]
|===
| Runtime Environment
| LoadTimeWeaver implementation
| Running in BEA's
                Weblogic 10
| WebLogicLoadTimeWeaver

| Running in IBM WebSphere Application Server 7
| WebSphereLoadTimeWeaver

| Running in GlassFish
| GlassFishLoadTimeWeaver

| Running in JBoss AS
| JBossLoadTimeWeaver

| JVM started with Spring
                InstrumentationSavingAgent
                (java
                -javaagent:path/to/spring-instrument.jar)
| InstrumentationLoadTimeWeaver

| Fallback, expecting the underlying ClassLoader to follow common conventions
                (e.g. applicable to TomcatInstrumentableClassLoader and
                Resin)
| ReflectiveLoadTimeWeaver
|===

Note that these are just the [interface]`LoadTimeWeavers` that are autodetected when using the [class]`DefaultContextLoadTimeWeaver`: it is of course possible to specify exactly which [interface]`LoadTimeWeaver` implementation that you wish to use.

To specify a specific [interface]`LoadTimeWeaver` with Java configuration implement the [interface]`LoadTimeWeavingConfigurer` interface and override the `getLoadTimeWeaver()` method:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Configuration
@EnableLoadTimeWeaving
public class AppConfig implements LoadTimeWeavingConfigurer {
    @Override
    public LoadTimeWeaver getLoadTimeWeaver() {
        return new ReflectiveLoadTimeWeaver();
    }
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If you are using XML based configuration you can specify the fully-qualified classname as the value of the '`weaver-class`' attribute on the `&lt;context:load-time-weaver/&gt;` element:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
    <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/context">http://www.springframework.org/schema/context</a>
    <a href="http://www.springframework.org/schema/context/spring-context.xsd"&gt;">http://www.springframework.org/schema/context/spring-context.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;context:load-time-weaver
        weaver-class="org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The [interface]`LoadTimeWeaver` that is defined and registered by the configuration can be later retrieved from the Spring container using the well-known name '`loadTimeWeaver`'.
Remember that the [interface]`LoadTimeWeaver` exists just as a mechanism for Spring's LTW infrastructure to add one or more [interface]`ClassFileTransformers`.
The actual [class]`ClassFileTransformer` that does the LTW is the [class]`ClassPreProcessorAgentAdapter` (from the `org.aspectj.weaver.loadtime` package) class.
See the class-level Javadoc for the [class]`ClassPreProcessorAgentAdapter` class for further details, because the specifics of how the weaving is actually effected is beyond the scope of this section.

There is one final attribute of the configuration left to discuss: the '`aspectjWeaving`' attribute (or '`aspectj-weaving`' if you are using XML).
This is a simple attribute that controls whether LTW is enabled or not, it is as simple as that.
It accepts one of three possible values, summarized below, with the default value if the attribute is not present being '`autodetect`'

.AspectJ weaving attribute values
[cols="1,1,1", options="header"]
|===
| Annotation Value
| XML Value
| Explanation
| ENABLED
| on
| AspectJ weaving is on, and aspects will be woven
                at load-time as appropriate.

| DISABLED
| off
| LTW is off... no aspect will be woven at
                load-time.

| AUTODETECT
| autodetect
| If the Spring LTW infrastructure can find at
                least one 'META-INF/aop.xml' file, then
                AspectJ weaving is on, else it is off. This is the default
                value.
|===

==== Environment-specific configuration

This last section contains any additional settings and configuration that you will need when using Spring's LTW support in environments such as application servers and web containers.

===== Tomcat

&lt;&lt;,Apache Tomcat&gt;&gt;'s default class loader does not support class transformation which is why Spring provides an enhanced implementation that addresses this need.
Named [class]`TomcatInstrumentableClassLoader`, the loader works on Tomcat 5.0 and above and can be registered individually for _each_ web application as follows:

* Tomcat 6.0.x or higher
+
[]
. Copy `org.springframework.instrument.tomcat.jar` into _$CATALINA_HOME_/lib, where _$CATALINA_HOME_ represents the root of the Tomcat installation)
. Instruct Tomcat to use the custom class loader (instead of the default) by editing the web application context file:
+
[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;Context path="/myWebApp" docBase="/my/webApp/location"&gt;
    &lt;Loader
        loaderClass="org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"/&gt;
&lt;/Context&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
Apache Tomcat 6.0.x (similar to 5.0.x/5.5.x) series supports several context locations:
+
* server configuration file - _$CATALINA_HOME/conf/server.xml_
* default context configuration - _$CATALINA_HOME/conf/context.xml_ - that affects all deployed web applications
* per-web application configuration which can be deployed either on the server-side at _$CATALINA_HOME/conf/[enginename]/[hostname]/[webapp]-context.xml_ or embedded inside the web-app archive at _META-INF/context.xml_
+
For efficiency, the embedded per-web-app configuration style is recommended because it will impact only applications that use the custom class loader and does not require any changes to the server configuration.
See the Tomcat 6.0.x &lt;&lt;,documentation&gt;&gt; for more details about available context locations.


* Tomcat 5.0.x/5.5.x
+
[]
. Copy `org.springframework.instrument.tomcat.jar` into _$CATALINA_HOME_/server/lib, where _$CATALINA_HOME_ represents the root of the Tomcat installation.
. Instruct Tomcat to use the custom class loader instead of the default one by editing the web application context file:
+
[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;Context path="/myWebApp" docBase="/my/webApp/location"&gt;
    &lt;Loader
        loaderClass="org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"/&gt;
&lt;/Context&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
Tomcat 5.0.x and 5.5.x series supports several context locations:
+
* server configuration file - _$CATALINA_HOME/conf/server.xml_
* default context configuration - _$CATALINA_HOME/conf/context.xml_ - that affects all deployed web applications
* per-web application configuration which can be deployed either on the server-side at _$CATALINA_HOME/conf/[enginename]/[hostname]/[webapp]-context.xml_ or embedded inside the web-app archive at _META-INF/context.xml_
+
For efficiency, the embedded web-app configuration style is recommended recommended because it will impact only applications that use the class loader.
See the Tomcat 5.x &lt;&lt;,documentation&gt;&gt; for more details about available context locations.
+
Tomcat versions prior to 5.5.20 contained a bug in the XML configuration parsing that prevented usage of the `Loader` tag inside _server.xml_ configuration, regardless of whether a class loader is specified or whether it is the official or a custom one.
See Tomcat's bugzilla for &lt;&lt;,more
                details&gt;&gt;.
+
In Tomcat 5.5.x, versions 5.5.20 or later, you should set _useSystemClassLoaderAsParent_ to `false` to fix this problem:
+
[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;Context path="/myWebApp" docBase="/my/webApp/location"&gt;
    &lt;Loader
        loaderClass="org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"
            useSystemClassLoaderAsParent="false"/&gt;
&lt;/Context&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
This setting is not needed on Tomcat 6 or higher.



Alternatively, consider the use of the Spring-provided generic VM agent, to be specified in Tomcat's launch script (see above).
This will make instrumentation available to all deployed web applications, no matter what ClassLoader they happen to run on.

===== WebLogic, WebSphere, Resin, GlassFish, JBoss

Recent versions of WebLogic Server (version 10 and above), IBM WebSphere Application Server (version 7 and above), Resin (3.1 and above) and JBoss (5.x or above) provide a ClassLoader that is capable of local instrumentation.
Spring's native LTW leverages such ClassLoaders to enable AspectJ weaving.
You can enable LTW by simply activating load-time weaving as described earlier.
Specifically, you do _not_ need to modify the launch script to add `-javaagent:path/to/spring-instrument.jar`.

Note that GlassFish instrumentation-capable ClassLoader is available only in its EAR environment.
For GlassFish web applications, follow the Tomcat setup instructions as outlined above.

Note that on JBoss 6.x, the app server scanning needs to be disabled to prevent it from loading the classes before the application actually starts.
A quick workaround is to add to your artifact a file named [file]`WEB-INF/jboss-scanning.xml` with the following content:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;scanning xmlns="urn:jboss:scanning:1.0"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
===== Generic Java applications

When class instrumentation is required in environments that do not support or are not supported by the existing [class]`LoadTimeWeaver` implementations, a JDK agent can be the only solution.
For such cases, Spring provides [class]`InstrumentationLoadTimeWeaver`, which requires a Spring-specific (but very general) VM agent, [file]`org.springframework.instrument-{version}.jar` (previously named [file]`spring-agent.jar`).

To use it, you must start the virtual machine with the Spring agent, by supplying the following JVM options:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>-javaagent:/path/to/org.springframework.instrument-{version}.jar</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
 Note that this requires modification of the VM launch script which may prevent you from using this in application server environments (depending on your operation policies).
Additionally, the JDK agent will instrument the _entire_ VM which can prove expensive.

For performance reasons, it is recommended to use this configuration only if your target environment (such as &lt;&lt;,Jetty&gt;&gt;) does not have (or does not support) a dedicated LTW.

== Further Resources

More information on AspectJ can be found on the &lt;&lt;,AspectJ website&gt;&gt;.

The book _Eclipse AspectJ_ by Adrian Colyer et.
al.
(Addison-Wesley, 2005) provides a comprehensive introduction and reference for the AspectJ language.

The book _AspectJ in Action_ by Ramnivas Laddad (Manning, 2003) comes highly recommended; the focus of the book is on AspectJ, but a lot of general AOP themes are explored (in some depth).


= Spring AOP APIs

== Introduction

The previous chapter described the Spring 2.0 and later version's support for AOP using @AspectJ and schema-based aspect definitions.
In this chapter we discuss the lower-level Spring AOP APIs and the AOP support used in Spring 1.2 applications.
For new applications, we recommend the use of the Spring 2.0 and later AOP support described in the previous chapter, but when working with existing applications, or when reading books and articles, you may come across Spring 1.2 style examples.
Spring 3.0 is backwards compatible with Spring 1.2 and everything described in this chapter is fully supported in Spring 3.0.

== Pointcut API in Spring

Let's look at how Spring handles the crucial pointcut concept.

=== Concepts

Spring's pointcut model enables pointcut reuse independent of advice types.
It's possible to target different advice using the same pointcut.

The `org.springframework.aop.Pointcut` interface is the central interface, used to target advices to particular classes and methods.
The complete interface is shown below:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface Pointcut {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ClassFilter getClassFilter();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>MethodMatcher getMethodMatcher();</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Splitting the [interface]`Pointcut` interface into two parts allows reuse of class and method matching parts, and fine-grained composition operations (such as performing a "union" with another method matcher).

The [interface]`ClassFilter` interface is used to restrict the pointcut to a given set of target classes.
If the `matches()` method always returns true, all target classes will be matched:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface ClassFilter {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    boolean matches(Class clazz);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The [interface]`MethodMatcher` interface is normally more important.
The complete interface is shown below:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface MethodMatcher {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean matches(Method m, Class targetClass);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean isRuntime();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    boolean matches(Method m, Class targetClass, Object[] args);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `matches(Method, Class) `method is used to test whether this pointcut will ever match a given method on a target class.
This evaluation can be performed when an AOP proxy is created, to avoid the need for a test on every method invocation.
If the 2-argument matches method returns true for a given method, and the `isRuntime()` method for the MethodMatcher returns true, the 3-argument matches method will be invoked on every method invocation.
This enables a pointcut to look at the arguments passed to the method invocation immediately before the target advice is to execute.

Most MethodMatchers are static, meaning that their `isRuntime()` method returns false.
In this case, the 3-argument matches method will never be invoked.

TIP: If possible, try to make pointcuts static, allowing the AOP framework to cache the results of pointcut evaluation when an AOP proxy is created.

=== Operations on pointcuts

Spring supports operations on pointcuts: notably, _union_ and _intersection_.

* Union means the methods that either pointcut matches.
* Intersection means the methods that both pointcuts match.
* Union is usually more useful.
* Pointcuts can be composed using the static methods in the _org.springframework.aop.support.Pointcuts_ class, or using the _ComposablePointcut_ class in the same package.
  However, using AspectJ pointcut expressions is usually a simpler approach.

=== AspectJ expression pointcuts

Since 2.0, the most important type of pointcut used by Spring is `org.springframework.aop.aspectj.AspectJExpressionPointcut`.
This is a pointcut that uses an AspectJ supplied library to parse an AspectJ pointcut expression string.

See the previous chapter for a discussion of supported AspectJ pointcut primitives.

=== Convenience pointcut implementations

Spring provides several convenient pointcut implementations.
Some can be used out of the box; others are intended to be subclassed in application-specific pointcuts.

==== Static pointcuts

Static pointcuts are based on method and target class, and cannot take into account the method's arguments.
Static pointcuts are sufficient - _and best_ - for most usages.
It's possible for Spring to evaluate a static pointcut only once, when a method is first invoked: after that, there is no need to evaluate the pointcut again with each method invocation.

Let's consider some static pointcut implementations included with Spring.

===== Regular expression pointcuts

One obvious way to specify static pointcuts is regular expressions.
Several AOP frameworks besides Spring make this possible.
`org.springframework.aop.support.JdkRegexpMethodPointcut` is a generic regular expression pointcut, using the regular expression support in JDK 1.4+.

Using the `JdkRegexpMethodPointcut` class, you can provide a list of pattern Strings.
If any of these is a match, the pointcut will evaluate to true.
(So the result is effectively the union of these pointcuts.)

The usage is shown below:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="settersAndAbsquatulatePointcut"
    class="org.springframework.aop.support.JdkRegexpMethodPointcut"&gt;
    &lt;property name="patterns"&gt;
        &lt;list&gt;
            &lt;value&gt;.<strong>set.</strong>&lt;/value&gt;
            &lt;value&gt;.*absquatulate&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Spring provides a convenience class, `RegexpMethodPointcutAdvisor`, that allows us to also reference an Advice (remember that an Advice can be an interceptor, before advice, throws advice etc.).
Behind the scenes, Spring will use a `JdkRegexpMethodPointcut`.
Using `RegexpMethodPointcutAdvisor` simplifies wiring, as the one bean encapsulates both pointcut and advice, as shown below:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="settersAndAbsquatulateAdvisor"
    class="org.springframework.aop.support.RegexpMethodPointcutAdvisor"&gt;
    &lt;property name="advice"&gt;
        &lt;ref bean="beanNameOfAopAllianceInterceptor"/&gt;
    &lt;/property&gt;
    &lt;property name="patterns"&gt;
        &lt;list&gt;
            &lt;value&gt;.<strong>set.</strong>&lt;/value&gt;
            &lt;value&gt;.*absquatulate&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
_RegexpMethodPointcutAdvisor_ can be used with any Advice type.

===== Attribute-driven pointcuts

An important type of static pointcut is a _metadata-driven_ pointcut.
This uses the values of metadata attributes: typically, source-level metadata.

==== Dynamic pointcuts

Dynamic pointcuts are costlier to evaluate than static pointcuts.
They take into account method _arguments_, as well as static information.
This means that they must be evaluated with every method invocation; the result cannot be cached, as arguments will vary.

The main example is the `control flow` pointcut.

===== Control flow pointcuts

Spring control flow pointcuts are conceptually similar to AspectJ _cflow_ pointcuts, although less powerful.
(There is currently no way to specify that a pointcut executes below a join point matched by another pointcut.) A control flow pointcut matches the current call stack.
For example, it might fire if the join point was invoked by a method in the `com.mycompany.web` package, or by the `SomeCaller` class.
Control flow pointcuts are specified using the `org.springframework.aop.support.ControlFlowPointcut
          `class.

NOTE: Control flow pointcuts are significantly more expensive to evaluate at runtime than even other dynamic pointcuts.
In Java 1.4, the cost is about 5 times that of other dynamic pointcuts.

=== Pointcut superclasses

Spring provides useful pointcut superclasses to help you to implement your own pointcuts.

Because static pointcuts are most useful, you'll probably subclass StaticMethodMatcherPointcut, as shown below.
This requires implementing just one abstract method (although it's possible to override other methods to customize behavior):


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>class TestStaticPointcut extends StaticMethodMatcherPointcut {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public boolean matches(Method m, Class targetClass) {
        // return true if custom criteria match
    }
}
----There are also superclasses for dynamic pointcuts.</pre>
</div>
</div>
<div class="paragraph">
<p>You can use custom pointcuts with any advice type in Spring 1.0 RC2 and above.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-pointcuts"><a class="anchor" href="#custom-pointcuts"></a>Custom pointcuts</h3>
<div class="paragraph">
<p>Because pointcuts in Spring AOP are Java classes, rather than language features (as in AspectJ) it&#8217;s possible to declare custom pointcuts, whether static or dynamic.
Custom pointcuts in Spring can be arbitrarily complex.
However, using the AspectJ pointcut expression language is recommended if possible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Later versions of Spring may offer support for "semantic pointcuts" as offered by JAC: for example, "all methods that change instance variables in the target object."
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advice-api-in-spring"><a class="anchor" href="#advice-api-in-spring"></a>Advice API in Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s now look at how Spring AOP handles advice.</p>
</div>
<div class="sect2">
<h3 id="advice-lifecycles"><a class="anchor" href="#advice-lifecycles"></a>Advice lifecycles</h3>
<div class="paragraph">
<p>Each advice is a Spring bean.
An advice instance can be shared across all advised objects, or unique to each advised object.
This corresponds to <em>per-class</em> or <em>per-instance</em> advice.</p>
</div>
<div class="paragraph">
<p>Per-class advice is used most often.
It is appropriate for generic advice such as transaction advisors.
These do not depend on the state of the proxied object or add new state; they merely act on the method and arguments.</p>
</div>
<div class="paragraph">
<p>Per-instance advice is appropriate for introductions, to support mixins.
In this case, the advice adds state to the proxied object.</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to use a mix of shared and per-instance advice in the same AOP proxy.</p>
</div>
</div>
<div class="sect2">
<h3 id="advice-types-in-spring"><a class="anchor" href="#advice-types-in-spring"></a>Advice types in Spring</h3>
<div class="paragraph">
<p>Spring provides several advice types out of the box, and is extensible to support arbitrary advice types.
Let us look at the basic concepts and standard advice types.</p>
</div>
<div class="sect3">
<h4 id="interception-around-advice"><a class="anchor" href="#interception-around-advice"></a>Interception around advice</h4>
<div class="paragraph">
<p>The most fundamental advice type in Spring is <em>interception around advice</em>.</p>
</div>
<div class="paragraph">
<p>Spring is compliant with the AOP Alliance interface for around advice using method interception.
MethodInterceptors implementing around advice should implement the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface MethodInterceptor extends Interceptor {

    Object invoke(MethodInvocation invocation) throws Throwable;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">MethodInvocation</code> argument to the <code class="method">invoke()</code> method exposes the method being invoked; the target join point; the AOP proxy; and the arguments to the method.
The <code class="method">invoke()</code> method should return the invocation&#8217;s result: the return value of the join point.</p>
</div>
<div class="paragraph">
<p>A simple <code class="class">MethodInterceptor</code> implementation looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class DebugInterceptor implements MethodInterceptor {

    public Object invoke(MethodInvocation invocation) throws Throwable {
        System.out.println("Before: invocation=[" + invocation + "]");
        Object rval = invocation.proceed();
        System.out.println("Invocation returned");
        return rval;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the call to the MethodInvocation&#8217;s <code class="method">proceed()</code> method.
This proceeds down the interceptor chain towards the join point.
Most interceptors will invoke this method, and return its return value.
However, a MethodInterceptor, like any around advice, can return a different value or throw an exception rather than invoke the proceed method.
However, you don&#8217;t want to do this without good reason!</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
MethodInterceptors offer interoperability with other AOP Alliance-compliant AOP implementations.
The other advice types discussed in the remainder of this section implement common AOP concepts, but in a Spring-specific way.
While there is an advantage in using the most specific advice type, stick with MethodInterceptor around advice if you are likely to want to run the aspect in another AOP framework.
Note that pointcuts are not currently interoperable between frameworks, and the AOP Alliance does not currently define pointcut interfaces.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="before-advice"><a class="anchor" href="#before-advice"></a>Before advice</h4>
<div class="paragraph">
<p>A simpler advice type is a <em>before
        advice</em>.
This does not need a <code>MethodInvocation</code> object, since it will only be called before entering the method.</p>
</div>
<div class="paragraph">
<p>The main advantage of a before advice is that there is no need to invoke the `proceed() `method, and therefore no possibility of inadvertently failing to proceed down the interceptor chain.</p>
</div>
<div class="paragraph">
<p>The <code>MethodBeforeAdvice</code> interface is shown below.
(Spring&#8217;s API design would allow for field before advice, although the usual objects apply to field interception and it&#8217;s unlikely that Spring will ever implement it).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface MethodBeforeAdvice extends BeforeAdvice {

    void before(Method m, Object[] args, Object target) throws Throwable;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the return type is <code>void</code>.
Before advice can insert custom behavior before the join point executes, but cannot change the return value.
If a before advice throws an exception, this will abort further execution of the interceptor chain.
The exception will propagate back up the interceptor chain.
If it is unchecked, or on the signature of the invoked method, it will be passed directly to the client; otherwise it will be wrapped in an unchecked exception by the AOP proxy.</p>
</div>
<div class="paragraph">
<p>An example of a before advice in Spring, which counts all method invocations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class CountingBeforeAdvice implements MethodBeforeAdvice {

    private int count;

    public void before(Method m, Object[] args, Object target) throws Throwable {
        ++count;
    }

    public int getCount() {
        return count;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Before advice can be used with any pointcut.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="throws-advice"><a class="anchor" href="#throws-advice"></a>Throws advice</h4>
<div class="paragraph">
<p><em>Throws advice</em> is invoked after the return of the join point if the join point threw an exception.
Spring offers typed throws advice.
Note that this means that the <code>org.springframework.aop.ThrowsAdvice</code> interface does not contain any methods: It is a tag interface identifying that the given object implements one or more typed throws advice methods.
These should be in the form of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>afterThrowing([Method, args, target], subclassOfThrowable)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only the last argument is required.
The method signatures may have either one or four arguments, depending on whether the advice method is interested in the method and arguments.
The following classes are examples of throws advice.</p>
</div>
<div class="paragraph">
<p>The advice below is invoked if a  is thrown (including subclasses):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class RemoteThrowsAdvice implements ThrowsAdvice {

    public void afterThrowing(RemoteException ex) throws Throwable {
        // Do something with remote exception
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following advice is invoked if a  is thrown.
Unlike the above advice, it declares 4 arguments, so that it has access to the invoked method, method arguments and target object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ServletThrowsAdviceWithArguments implements ThrowsAdvice {

    public void afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        // Do something with all arguments
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The final example illustrates how these two methods could be used in a single class, which handles both <code>RemoteException</code> and <code>ServletException</code>.
Any number of throws advice methods can be combined in a single class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public static class CombinedThrowsAdvice implements ThrowsAdvice {

    public void afterThrowing(RemoteException ex) throws Throwable {
        // Do something with remote exception
    }

    public void afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        // Do something with all arguments
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Note:</em> If a throws-advice method throws an exception itself, it will override the original exception (i.e.
change the exception thrown to the user).
The overriding exception will typically be a RuntimeException; this is compatible with any method signature.
However, if a throws-advice method throws a checked exception, it will have to match the declared exceptions of the target method and is hence to some degree coupled to specific target method signatures.
<em>Do not throw an undeclared checked exception
        that is incompatible with the target method&#8217;s
        signature!</em></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Throws advice can be used with any pointcut.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="after-returning-advice"><a class="anchor" href="#after-returning-advice"></a>After Returning advice</h4>
<div class="paragraph">
<p>An after returning advice in Spring must implement the <em>org.springframework.aop.AfterReturningAdvice</em> interface, shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface AfterReturningAdvice extends Advice {

    void afterReturning(Object returnValue, Method m, Object[] args, Object target)
            throws Throwable;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An after returning advice has access to the return value (which it cannot modify), invoked method, methods arguments and target.</p>
</div>
<div class="paragraph">
<p>The following after returning advice counts all successful method invocations that have not thrown exceptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class CountingAfterReturningAdvice implements AfterReturningAdvice {

    private int count;

    public void afterReturning(Object returnValue, Method m, Object[] args, Object target)
            throws Throwable {
        ++count;
    }

    public int getCount() {
        return count;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This advice doesn&#8217;t change the execution path.
If it throws an exception, this will be thrown up the interceptor chain instead of the return value.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
After returning advice can be used with any pointcut.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="introduction-advice"><a class="anchor" href="#introduction-advice"></a>Introduction advice</h4>
<div class="paragraph">
<p>Spring treats introduction advice as a special kind of interception advice.</p>
</div>
<div class="paragraph">
<p>Introduction requires an <code>IntroductionAdvisor</code>, and an <code>IntroductionInterceptor</code>, implementing the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface IntroductionInterceptor extends MethodInterceptor {

    boolean implementsInterface(Class intf);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>invoke() `method inherited from the AOP Alliance `MethodInterceptor</code> interface must implement the introduction: that is, if the invoked method is on an introduced interface, the introduction interceptor is responsible for handling the method call - it cannot invoke <code>proceed()</code>.</p>
</div>
<div class="paragraph">
<p>Introduction advice cannot be used with any pointcut, as it applies only at class, rather than method, level.
You can only use introduction advice with the <code>IntroductionAdvisor</code>, which has the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface IntroductionAdvisor extends Advisor, IntroductionInfo {

    ClassFilter getClassFilter();

    void validateInterfaces() throws IllegalArgumentException;
}

public interface IntroductionInfo {

    Class[] getInterfaces();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no <code class="interface">MethodMatcher</code>, and hence no <code class="interface">Pointcut</code>, associated with introduction advice.
Only class filtering is logical.</p>
</div>
<div class="paragraph">
<p>The <code>getInterfaces()</code> method returns the interfaces introduced by this advisor.</p>
</div>
<div class="paragraph">
<p>The <code>validateInterfaces()</code> method is used internally to see whether or not the introduced interfaces can be implemented by the configured <code>IntroductionInterceptor</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a simple example from the Spring test suite.
Let&#8217;s suppose we want to introduce the following interface to one or more objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface Lockable {
    void lock();
    void unlock();
    boolean locked();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This illustrates a <em>mixin</em>.
We want to be able to cast advised objects to Lockable, whatever their type, and call lock and unlock methods.
If we call the lock() method, we want all setter methods to throw a <code>LockedException</code>.
Thus we can add an aspect that provides the ability to make objects immutable, without them having any knowledge of it: a good example of AOP.</p>
</div>
<div class="paragraph">
<p>Firstly, we&#8217;ll need an <code>IntroductionInterceptor</code> that does the heavy lifting.
In this case, we extend the <code>org.springframework.aop.support.DelegatingIntroductionInterceptor</code> convenience class.
We could implement IntroductionInterceptor directly, but using <code>DelegatingIntroductionInterceptor</code> is best for most cases.</p>
</div>
<div class="paragraph">
<p>The <code>DelegatingIntroductionInterceptor</code> is designed to delegate an introduction to an actual implementation of the introduced interface(s), concealing the use of interception to do so.
The delegate can be set to any object using a constructor argument; the default delegate (when the no-arg constructor is used) is this.
Thus in the example below, the delegate is the <code>LockMixin</code> subclass of <code>DelegatingIntroductionInterceptor</code>.
Given a delegate (by default itself), a <code>DelegatingIntroductionInterceptor</code> instance looks for all interfaces implemented by the delegate (other than IntroductionInterceptor), and will support introductions against any of them.
It&#8217;s possible for subclasses such as <code>LockMixin</code> to call the <code>suppressInterface(Class intf) `method to suppress interfaces that should not be exposed.
However, no matter how many interfaces an `IntroductionInterceptor</code> is prepared to support, the <code>IntroductionAdvisor</code> used will control which interfaces are actually exposed.
An introduced interface will conceal any implementation of the same interface by the target.</p>
</div>
<div class="paragraph">
<p>Thus LockMixin subclasses <code>DelegatingIntroductionInterceptor</code> and implements Lockable itself.
The superclass automatically picks up that Lockable can be supported for introduction, so we don&#8217;t need to specify that.
We could introduce any number of interfaces in this way.</p>
</div>
<div class="paragraph">
<p>Note the use of the <code>locked</code> instance variable.
This effectively adds additional state to that held in the target object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class LockMixin extends DelegatingIntroductionInterceptor
    implements Lockable {

    private boolean locked;

    public void lock() {
        this.locked = true;
    }

    public void unlock() {
        this.locked = false;
    }

    public boolean locked() {
        return this.locked;
    }

    public Object invoke(MethodInvocation invocation) throws Throwable {
        if (locked() &amp;&amp; invocation.getMethod().getName().indexOf("set") == 0)
            throw new LockedException();
        return super.invoke(invocation);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Often it isn&#8217;t necessary to override the <code>invoke()
        `method: the `DelegatingIntroductionInterceptor</code> implementation - which calls the delegate method if the method is introduced, otherwise proceeds towards the join point - is usually sufficient.
In the present case, we need to add a check: no setter method can be invoked if in locked mode.</p>
</div>
<div class="paragraph">
<p>The introduction advisor required is simple.
All it needs to do is hold a distinct <code>LockMixin</code> instance, and specify the introduced interfaces - in this case, just <code>Lockable</code>.
A more complex example might take a reference to the introduction interceptor (which would be defined as a prototype): in this case, there&#8217;s no configuration relevant for a <code>LockMixin</code>, so we simply create it using <code>new</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class LockMixinAdvisor extends DefaultIntroductionAdvisor {

    public LockMixinAdvisor() {
        super(new LockMixin(), Lockable.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can apply this advisor very simply: it requires no configuration.
(However, it <em>is</em> necessary: It&#8217;s impossible to use an <code>IntroductionInterceptor</code> without an <em>IntroductionAdvisor</em>.) As usual with introductions, the advisor must be per-instance, as it is stateful.
We need a different instance of <code>LockMixinAdvisor</code>, and hence <code>LockMixin</code>, for each advised object.
The advisor comprises part of the advised object&#8217;s state.</p>
</div>
<div class="paragraph">
<p>We can apply this advisor programmatically, using the `Advised.addAdvisor() `method, or (the recommended way) in XML configuration, like any other advisor.
All proxy creation choices discussed below, including "auto proxy creators," correctly handle introductions and stateful mixins.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advisor-api-in-spring"><a class="anchor" href="#advisor-api-in-spring"></a>Advisor API in Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Spring, an Advisor is an aspect that contains just a single advice object associated with a pointcut expression.</p>
</div>
<div class="paragraph">
<p>Apart from the special case of introductions, any advisor can be used with any advice.
<code>org.springframework.aop.support.DefaultPointcutAdvisor</code> is the most commonly used advisor class.
For example, it can be used with a <code>MethodInterceptor</code>, <code>BeforeAdvice</code> or <code>ThrowsAdvice</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to mix advisor and advice types in Spring in the same AOP proxy.
For example, you could use a interception around advice, throws advice and before advice in one proxy configuration: Spring will automatically create the necessary interceptor chain.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-proxyfactorybean-to-create-aop-proxies"><a class="anchor" href="#using-the-proxyfactorybean-to-create-aop-proxies"></a>Using the ProxyFactoryBean to create AOP proxies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re using the Spring IoC container (an ApplicationContext or BeanFactory) for your business objects - and you should be! - you will want to use one of Spring&#8217;s AOP FactoryBeans.
(Remember that a factory bean introduces a layer of indirection, enabling it to create objects of a different type.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The Spring 2.0 AOP support also uses factory beans under the covers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic way to create an AOP proxy in Spring is to use the <em>org.springframework.aop.framework.ProxyFactoryBean</em>.
This gives complete control over the pointcuts and advice that will apply, and their ordering.
However, there are simpler options that are preferable if you don&#8217;t need such control.</p>
</div>
<div class="sect2">
<h3 id="basics"><a class="anchor" href="#basics"></a>Basics</h3>
<div class="paragraph">
<p>The <code>ProxyFactoryBean</code>, like other Spring <code>FactoryBean</code> implementations, introduces a level of indirection.
If you define a <code>ProxyFactoryBean</code> with name <code>foo</code>, what objects referencing <code>foo</code> see is not the <code>ProxyFactoryBean</code> instance itself, but an object created by the <code>ProxyFactoryBean</code>'s implementation of the `getObject() `method.
This method will create an AOP proxy wrapping a target object.</p>
</div>
<div class="paragraph">
<p>One of the most important benefits of using a <code>ProxyFactoryBean</code> or another IoC-aware class to create AOP proxies, is that it means that advices and pointcuts can also be managed by IoC. This is a powerful feature, enabling certain approaches that are hard to achieve with other AOP frameworks.
For example, an advice may itself reference application objects (besides the target, which should be available in any AOP framework), benefiting from all the pluggability provided by Dependency Injection.</p>
</div>
</div>
<div class="sect2">
<h3 id="javabean-properties"><a class="anchor" href="#javabean-properties"></a>JavaBean properties</h3>
<div class="paragraph">
<p>In common with most <code class="interface">FactoryBean</code> implementations provided with Spring, the <code class="class">ProxyFactoryBean</code> class is itself a JavaBean.
Its properties are used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the target you want to proxy.</p>
</li>
<li>
<p>Specify whether to use CGLIB (see below and also <a href="#aop-pfb-proxy-types">[aop-pfb-proxy-types]</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some key properties are inherited from <code class="class">org.springframework.aop.framework.ProxyConfig</code> (the superclass for all AOP proxy factories in Spring).
These key properties include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>proxyTargetClass</code>: <code>true</code> if the target class is to be proxied, rather than the target class' interfaces.
If this property value is set to <code>true</code>, then CGLIB proxies will be created (but see also <a href="#aop-pfb-proxy-types">[aop-pfb-proxy-types]</a>).</p>
</li>
<li>
<p><code>optimize</code>: controls whether or not aggressive optimizations are applied to proxies <em>created
          via CGLIB</em>.
One should not blithely use this setting unless one fully understands how the relevant AOP proxy handles optimization.
This is currently used only for CGLIB proxies; it has no effect with JDK dynamic proxies.</p>
</li>
<li>
<p><code>frozen</code>: if a proxy configuration is <code>frozen</code>, then changes to the configuration are no longer allowed.
This is useful both as a slight optimization and for those cases when you don&#8217;t want callers to be able to manipulate the proxy (via the <code class="interface">Advised</code> interface) after the proxy has been created.
The default value of this property is <code>false</code>, so changes such as adding additional advice are allowed.</p>
</li>
<li>
<p><code>exposeProxy</code>: determines whether or not the current proxy should be exposed in a <code class="class">ThreadLocal</code> so that it can be accessed by the target.
If a target needs to obtain the proxy and the <code>exposeProxy</code> property is set to <code>true</code>, the target can use the <code class="method">AopContext.currentProxy()</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other properties specific to <code class="class">ProxyFactoryBean</code> include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>proxyInterfaces</code>: array of String interface names.
If this isn&#8217;t supplied, a CGLIB proxy for the target class will be used (but see also <a href="#aop-pfb-proxy-types">[aop-pfb-proxy-types]</a>).</p>
</li>
<li>
<p><code>interceptorNames</code>: String array of <code class="interface">Advisor</code>, interceptor or other advice names to apply.
Ordering is significant, on a first come-first served basis.
That is to say that the first interceptor in the list will be the first to be able to intercept the invocation.</p>
<div class="paragraph">
<p>The names are bean names in the current factory, including bean names from ancestor factories.
You can&#8217;t mention bean references here since doing so would result in the <code class="class">ProxyFactoryBean</code> ignoring the singleton setting of the advice.</p>
</div>
<div class="paragraph">
<p>You can append an interceptor name with an asterisk (<code>*</code>).
This will result in the application of all advisor beans with names starting with the part before the asterisk to be applied.
An example of using this feature can be found in <a href="#aop-global-advisors">[aop-global-advisors]</a>.</p>
</div>
</li>
<li>
<p>singleton: whether or not the factory should return a single object, no matter how often the <code>getObject()</code> method is called.
Several <code class="interface">FactoryBean</code> implementations offer such a method.
The default value is <code>true</code>.
If you want to use stateful advice - for example, for stateful mixins - use prototype advices along with a singleton value of <code>false</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jdk-and-cglib-based-proxies"><a class="anchor" href="#jdk-and-cglib-based-proxies"></a>JDK- and CGLIB-based proxies</h3>
<div class="paragraph">
<p>This section serves as the definitive documentation on how the <code class="class">ProxyFactoryBean</code> chooses to create one of either a JDK- and CGLIB-based proxy for a particular target object (that is to be proxied).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The behavior of the <code class="class">ProxyFactoryBean</code> with regard to creating JDK- or CGLIB-based proxies changed between versions 1.2.x and 2.0 of Spring.
The <code class="class">ProxyFactoryBean</code> now exhibits similar semantics with regard to auto-detecting interfaces as those of the <code class="class">TransactionProxyFactoryBean</code> class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the class of a target object that is to be proxied (hereafter simply referred to as the target class) doesn&#8217;t implement any interfaces, then a CGLIB-based proxy will be created.
This is the easiest scenario, because JDK proxies are interface based, and no interfaces means JDK proxying isn&#8217;t even possible.
One simply plugs in the target bean, and specifies the list of interceptors via the <code>interceptorNames</code> property.
Note that a CGLIB-based proxy will be created even if the <code>proxyTargetClass</code> property of the <code class="class">ProxyFactoryBean</code> has been set to <code>false</code>.
(Obviously this makes no sense, and is best removed from the bean definition because it is at best redundant, and at worst confusing.)</p>
</div>
<div class="paragraph">
<p>If the target class implements one (or more) interfaces, then the type of proxy that is created depends on the configuration of the <code class="class">ProxyFactoryBean</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>proxyTargetClass</code> property of the <code class="class">ProxyFactoryBean</code> has been set to <code>true</code>, then a CGLIB-based proxy will be created.
This makes sense, and is in keeping with the principle of least surprise.
Even if the <code>proxyInterfaces</code> property of the <code class="class">ProxyFactoryBean</code> has been set to one or more fully qualified interface names, the fact that the <code>proxyTargetClass</code> property is set to <code>true</code> <em>will</em> cause CGLIB-based proxying to be in effect.</p>
</div>
<div class="paragraph">
<p>If the <code>proxyInterfaces</code> property of the <code class="class">ProxyFactoryBean</code> has been set to one or more fully qualified interface names, then a JDK-based proxy will be created.
The created proxy will implement all of the interfaces that were specified in the <code>proxyInterfaces</code> property; if the target class happens to implement a whole lot more interfaces than those specified in the <code>proxyInterfaces</code> property, that is all well and good but those additional interfaces will not be implemented by the returned proxy.</p>
</div>
<div class="paragraph">
<p>If the <code>proxyInterfaces</code> property of the <code class="class">ProxyFactoryBean</code> has <em>not</em> been set, but the target class <em>does implement one (or
      more)</em> interfaces, then the <code class="class">ProxyFactoryBean</code> will auto-detect the fact that the target class does actually implement at least one interface, and a JDK-based proxy will be created.
The interfaces that are actually proxied will be <em>all</em> of the interfaces that the target class implements; in effect, this is the same as simply supplying a list of each and every interface that the target class implements to the <code>proxyInterfaces</code> property.
However, it is significantly less work, and less prone to typos.</p>
</div>
</div>
<div class="sect2">
<h3 id="proxying-interfaces"><a class="anchor" href="#proxying-interfaces"></a>Proxying interfaces</h3>
<div class="paragraph">
<p>Let&#8217;s look at a simple example of <code class="class">ProxyFactoryBean</code> in action.
This example involves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>target bean</em> that will be proxied.
This is the "personTarget" bean definition in the example below.</p>
</li>
<li>
<p>An Advisor and an Interceptor used to provide advice.</p>
</li>
<li>
<p>An AOP proxy bean definition specifying the target object (the personTarget bean) and the interfaces to proxy, along with the advices to apply.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="personTarget" class="com.mycompany.PersonImpl"&gt;
    &lt;property name="name" value="Tony"/&gt;
    &lt;property name="age" value="51"/&gt;
&lt;/bean&gt;

&lt;bean id="myAdvisor" class="com.mycompany.MyAdvisor"&gt;
    &lt;property name="someProperty" value="Custom string property value"/&gt;
&lt;/bean&gt;

&lt;bean id="debugInterceptor" class="org.springframework.aop.interceptor.DebugInterceptor"&gt;
&lt;/bean&gt;

&lt;bean id="person"
    class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
    &lt;property name="proxyInterfaces" value="com.mycompany.Person"/&gt;

    &lt;property name="target" ref="personTarget"/&gt;
    &lt;property name="interceptorNames"&gt;
        &lt;list&gt;
            &lt;value&gt;myAdvisor&lt;/value&gt;
            &lt;value&gt;debugInterceptor&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>interceptorNames</code> property takes a list of String: the bean names of the interceptor or advisors in the current factory.
Advisors, interceptors, before, after returning and throws advice objects can be used.
The ordering of advisors is significant.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
You might be wondering why the list doesn&#8217;t hold bean references.
The reason for this is that if the ProxyFactoryBean&#8217;s singleton property is set to false, it must be able to return independent proxy instances.
If any of the advisors is itself a prototype, an independent instance would need to be returned, so it&#8217;s necessary to be able to obtain an instance of the prototype from the factory; holding a reference isn&#8217;t sufficient.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The "person" bean definition above can be used in place of a Person implementation, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>Person person = (Person) factory.getBean("person");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other beans in the same IoC context can express a strongly typed dependency on it, as with an ordinary Java object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="personUser" class="com.mycompany.PersonUser"&gt;
  &lt;property name="person"&gt;&lt;ref bean="person"/&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PersonUser</code> class in this example would expose a property of type Person.
As far as it&#8217;s concerned, the AOP proxy can be used transparently in place of a "real" person implementation.
However, its class would be a dynamic proxy class.
It would be possible to cast it to the <code>Advised</code> interface (discussed below).</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to conceal the distinction between target and proxy using an anonymous <em>inner bean</em>, as follows.
Only the <code>ProxyFactoryBean</code> definition is different; the advice is included only for completeness:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="myAdvisor" class="com.mycompany.MyAdvisor"&gt;
  &lt;property name="someProperty" value="Custom string property value"/&gt;
&lt;/bean&gt;

&lt;bean id="debugInterceptor" class="org.springframework.aop.interceptor.DebugInterceptor"/&gt;

&lt;bean id="person" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="proxyInterfaces" value="com.mycompany.Person"/&gt;
  &lt;!-- Use inner bean, not local reference to target --&gt;
  &lt;property name="target"&gt;
    &lt;bean class="com.mycompany.PersonImpl"&gt;
      &lt;property name="name" value="Tony"/&gt;
      &lt;property name="age" value="51"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
  &lt;property name="interceptorNames"&gt;
    &lt;list&gt;
      &lt;value&gt;myAdvisor&lt;/value&gt;
      &lt;value&gt;debugInterceptor&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This has the advantage that there&#8217;s only one object of type <code>Person</code>: useful if we want to prevent users of the application context from obtaining a reference to the un-advised object, or need to avoid any ambiguity with Spring IoC <em>autowiring</em>.
There&#8217;s also arguably an advantage in that the ProxyFactoryBean definition is self-contained.
However, there are times when being able to obtain the un-advised target from the factory might actually be an <em>advantage</em>: for example, in certain test scenarios.</p>
</div>
</div>
<div class="sect2">
<h3 id="proxying-classes"><a class="anchor" href="#proxying-classes"></a>Proxying classes</h3>
<div class="paragraph">
<p>What if you need to proxy a class, rather than one or more interfaces?</p>
</div>
<div class="paragraph">
<p>Imagine that in our example above, there was no <code>Person</code> interface: we needed to advise a class called <code>Person</code> that didn&#8217;t implement any business interface.
In this case, you can configure Spring to use CGLIB proxying, rather than dynamic proxies.
Simply set the <code>proxyTargetClass</code> property on the ProxyFactoryBean above to true.
While it&#8217;s best to program to interfaces, rather than classes, the ability to advise classes that don&#8217;t implement interfaces can be useful when working with legacy code.
(In general, Spring isn&#8217;t prescriptive.
While it makes it easy to apply good practices, it avoids forcing a particular approach.)</p>
</div>
<div class="paragraph">
<p>If you want to, you can force the use of CGLIB in any case, even if you do have interfaces.</p>
</div>
<div class="paragraph">
<p>CGLIB proxying works by generating a subclass of the target class at runtime.
Spring configures this generated subclass to delegate method calls to the original target: the subclass is used to implement the <em>Decorator</em> pattern, weaving in the advice.</p>
</div>
<div class="paragraph">
<p>CGLIB proxying should generally be transparent to users.
However, there are some issues to consider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Final</code> methods can&#8217;t be advised, as they can&#8217;t be overridden.</p>
</li>
<li>
<p>There is no need to add CGLIB to your classpath.
As of Spring 3.2, CGLIB is repackaged and included in the spring-core JAR. In other words, CGLIB-based AOP will work "out of the box" just as do JDK dynamic proxies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There&#8217;s little performance difference between CGLIB proxying and dynamic proxies.
As of Spring 1.0, dynamic proxies are slightly faster.
However, this may change in the future.
Performance should not be a decisive consideration in this case.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-em-global-em-advisors"><a class="anchor" href="#using-em-global-em-advisors"></a>Using <em>global</em> advisors</h3>
<div class="paragraph">
<p>By appending an asterisk to an interceptor name, all advisors with bean names matching the part before the asterisk, will be added to the advisor chain.
This can come in handy if you need to add a standard set of <em>global</em> advisors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;bean id="proxy" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="target" ref="service"/&gt;
  &lt;property name="interceptorNames"&gt;
    &lt;list&gt;
      &lt;value&gt;global*&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="global_debug" class="org.springframework.aop.interceptor.DebugInterceptor"/&gt;
&lt;bean id="global_performance" class="org.springframework.aop.interceptor.PerformanceMonitorInterceptor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="concise-proxy-definitions"><a class="anchor" href="#concise-proxy-definitions"></a>Concise proxy definitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Especially when defining transactional proxies, you may end up with many similar proxy definitions.
The use of parent and child bean definitions, along with inner bean definitions, can result in much cleaner and more concise proxy definitions.</p>
</div>
<div class="paragraph">
<p>First a parent, <em>template</em>, bean definition is created for the proxy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="txProxyTemplate" abstract="true"
        class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="transactionAttributes"&gt;
    &lt;props&gt;
      &lt;prop key="*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will never be instantiated itself, so may actually be incomplete.
Then each proxy which needs to be created is just a child bean definition, which wraps the target of the proxy as an inner bean definition, since the target will never be used on its own anyway.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="myService" parent="txProxyTemplate"&gt;
  &lt;property name="target"&gt;
    &lt;bean class="org.springframework.samples.MyServiceImpl"&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is of course possible to override properties from the parent template, such as in this case, the transaction propagation settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="mySpecialService" parent="txProxyTemplate"&gt;
  &lt;property name="target"&gt;
    &lt;bean class="org.springframework.samples.MySpecialServiceImpl"&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
  &lt;property name="transactionAttributes"&gt;
    &lt;props&gt;
      &lt;prop key="get*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
      &lt;prop key="find*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
      &lt;prop key="load*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
      &lt;prop key="store*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in the example above, we have explicitly marked the parent bean definition as <em>abstract</em> by using the <em>abstract</em> attribute, as described <a href="#beans-child-bean-definitions">previously</a>, so that it may not actually ever be instantiated.
Application contexts (but not simple bean factories) will by default pre-instantiate all singletons.
It is therefore important (at least for singleton beans) that if you have a (parent) bean definition which you intend to use only as a template, and this definition specifies a class, you must make sure to set the <em>abstract</em> attribute to <em>true</em>, otherwise the application context will actually try to pre-instantiate it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-aop-proxies-programmatically-with-the-proxyfactory"><a class="anchor" href="#creating-aop-proxies-programmatically-with-the-proxyfactory"></a>Creating AOP proxies programmatically with the ProxyFactory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s easy to create AOP proxies programmatically using Spring.
This enables you to use Spring AOP without dependency on Spring IoC.</p>
</div>
<div class="paragraph">
<p>The following listing shows creation of a proxy for a target object, with one interceptor and one advisor.
The interfaces implemented by the target object will automatically be proxied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>ProxyFactory factory = new ProxyFactory(myBusinessInterfaceImpl);
factory.addAdvice(myMethodInterceptor);
factory.addAdvisor(myAdvisor);
MyBusinessInterface tb = (MyBusinessInterface) factory.getProxy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step is to construct an object of type <code>org.springframework.aop.framework.ProxyFactory</code>.
You can create this with a target object, as in the above example, or specify the interfaces to be proxied in an alternate constructor.</p>
</div>
<div class="paragraph">
<p>You can add advices (with interceptors as a specialized kind of advice) and/or advisors, and manipulate them for the life of the ProxyFactory.
If you add an IntroductionInterceptionAroundAdvisor, you can cause the proxy to implement additional interfaces.</p>
</div>
<div class="paragraph">
<p>There are also convenience methods on ProxyFactory (inherited from <code class="class">AdvisedSupport</code>) which allow you to add other advice types such as before and throws advice.
AdvisedSupport is the superclass of both ProxyFactory and ProxyFactoryBean.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Integrating AOP proxy creation with the IoC framework is best practice in most applications.
We recommend that you externalize configuration from Java code with AOP, as in general.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manipulating-advised-objects"><a class="anchor" href="#manipulating-advised-objects"></a>Manipulating advised objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>However you create AOP proxies, you can manipulate them using the <code>org.springframework.aop.framework.Advised</code> interface.
Any AOP proxy can be cast to this interface, whichever other interfaces it implements.
This interface includes the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>Advisor[] getAdvisors();

void addAdvice(Advice advice) throws AopConfigException;

void addAdvice(int pos, Advice advice)
        throws AopConfigException;

void addAdvisor(Advisor advisor) throws AopConfigException;

void addAdvisor(int pos, Advisor advisor) throws AopConfigException;

int indexOf(Advisor advisor);

boolean removeAdvisor(Advisor advisor) throws AopConfigException;

void removeAdvisor(int index) throws AopConfigException;

boolean replaceAdvisor(Advisor a, Advisor b) throws AopConfigException;

boolean isFrozen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getAdvisors()</code> method will return an Advisor for every advisor, interceptor or other advice type that has been added to the factory.
If you added an Advisor, the returned advisor at this index will be the object that you added.
If you added an interceptor or other advice type, Spring will have wrapped this in an advisor with a pointcut that always returns true.
Thus if you added a <code>MethodInterceptor</code>, the advisor returned for this index will be an <code>DefaultPointcutAdvisor</code> returning your <code>MethodInterceptor</code> and a pointcut that matches all classes and methods.</p>
</div>
<div class="paragraph">
<p>The <code>addAdvisor()</code> methods can be used to add any Advisor.
Usually the advisor holding pointcut and advice will be the generic <code>DefaultPointcutAdvisor</code>, which can be used with any advice or pointcut (but not for introductions).</p>
</div>
<div class="paragraph">
<p>By default, it&#8217;s possible to add or remove advisors or interceptors even once a proxy has been created.
The only restriction is that it&#8217;s impossible to add or remove an introduction advisor, as existing proxies from the factory will not show the interface change.
(You can obtain a new proxy from the factory to avoid this problem.)</p>
</div>
<div class="paragraph">
<p>A simple example of casting an AOP proxy to the <code>Advised</code> interface and examining and manipulating its advice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>Advised advised = (Advised) myObject;
Advisor[] advisors = advised.getAdvisors();
int oldAdvisorCount = advisors.length;
System.out.println(oldAdvisorCount + " advisors");

// Add an advice like an interceptor without a pointcut
// Will match all proxied methods
// Can use for interceptors, before, after returning or throws advice
advised.addAdvice(new DebugInterceptor());

// Add selective advice using a pointcut
advised.addAdvisor(new DefaultPointcutAdvisor(mySpecialPointcut, myAdvice));

assertEquals("Added two advisors",
     oldAdvisorCount + 2, advised.getAdvisors().length);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
It&#8217;s questionable whether it&#8217;s advisable (no pun intended) to modify advice on a business object in production, although there are no doubt legitimate usage cases.
However, it can be very useful in development: for example, in tests.
I have sometimes found it very useful to be able to add test code in the form of an interceptor or other advice, getting inside a method invocation I want to test.
(For example, the advice can get inside a transaction created for that method: for example, to run SQL to check that a database was correctly updated, before marking the transaction for roll back.)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on how you created the proxy, you can usually set a <code>frozen</code> flag, in which case the <code>Advised</code> <code>isFrozen()</code> method will return true, and any attempts to modify advice through addition or removal will result in an <code>AopConfigException</code>.
The ability to freeze the state of an advised object is useful in some cases, for example, to prevent calling code removing a security interceptor.
It may also be used in Spring 1.1 to allow aggressive optimization if runtime advice modification is known not to be required.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-auto-proxy-facility"><a class="anchor" href="#using-the-auto-proxy-facility"></a>Using the "auto-proxy" facility</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we&#8217;ve considered explicit creation of AOP proxies using a <code>ProxyFactoryBean</code> or similar factory bean.</p>
</div>
<div class="paragraph">
<p>Spring also allows us to use "auto-proxy" bean definitions, which can automatically proxy selected bean definitions.
This is built on Spring "bean post processor" infrastructure, which enables modification of any bean definition as the container loads.</p>
</div>
<div class="paragraph">
<p>In this model, you set up some special bean definitions in your XML bean definition file to configure the auto proxy infrastructure.
This allows you just to declare the targets eligible for auto-proxying: you don&#8217;t need to use <code>ProxyFactoryBean</code>.</p>
</div>
<div class="paragraph">
<p>There are two ways to do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using an auto-proxy creator that refers to specific beans in the current context.</p>
</li>
<li>
<p>A special case of auto-proxy creation that deserves to be considered separately; auto-proxy creation driven by source-level metadata attributes.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="autoproxy-bean-definitions"><a class="anchor" href="#autoproxy-bean-definitions"></a>Autoproxy bean definitions</h3>
<div class="paragraph">
<p>The <code>org.springframework.aop.framework.autoproxy</code> package provides the following standard auto-proxy creators.</p>
</div>
<div class="sect3">
<h4 id="beannameautoproxycreator"><a class="anchor" href="#beannameautoproxycreator"></a>BeanNameAutoProxyCreator</h4>
<div class="paragraph">
<p>The <code>BeanNameAutoProxyCreator</code> class is a <code>BeanPostProcessor</code> that automatically creates AOP proxies for beans with names matching literal values or wildcards.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"&gt;
  &lt;property name="beanNames" value="jdk*,onlyJdk"/&gt;
  &lt;property name="interceptorNames"&gt;
    &lt;list&gt;
      &lt;value&gt;myInterceptor&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with <code>ProxyFactoryBean</code>, there is an <code>interceptorNames</code> property rather than a list of interceptors, to allow correct behavior for prototype advisors.
Named "interceptors" can be advisors or any advice type.</p>
</div>
<div class="paragraph">
<p>As with auto proxying in general, the main point of using <code>BeanNameAutoProxyCreator</code> is to apply the same configuration consistently to multiple objects, with minimal volume of configuration.
It is a popular choice for applying declarative transactions to multiple objects.</p>
</div>
<div class="paragraph">
<p>Bean definitions whose names match, such as "jdkMyBean" and "onlyJdk" in the above example, are plain old bean definitions with the target class.
An AOP proxy will be created automatically by the <code>BeanNameAutoProxyCreator</code>.
The same advice will be applied to all matching beans.
Note that if advisors are used (rather than the interceptor in the above example), the pointcuts may apply differently to different beans.</p>
</div>
</div>
<div class="sect3">
<h4 id="defaultadvisorautoproxycreator"><a class="anchor" href="#defaultadvisorautoproxycreator"></a>DefaultAdvisorAutoProxyCreator</h4>
<div class="paragraph">
<p>A more general and extremely powerful auto proxy creator is <code>DefaultAdvisorAutoProxyCreator</code>.
This will automagically apply eligible advisors in the current context, without the need to include specific bean names in the auto-proxy advisor&#8217;s bean definition.
It offers the same merit of consistent configuration and avoidance of duplication as <code>BeanNameAutoProxyCreator</code>.</p>
</div>
<div class="paragraph">
<p>Using this mechanism involves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specifying a <code>DefaultAdvisorAutoProxyCreator</code> bean definition.</p>
</li>
<li>
<p>Specifying any number of Advisors in the same or related contexts.
Note that these <em>must</em> be Advisors, not just interceptors or other advices.
This is necessary because there must be a pointcut to evaluate, to check the eligibility of each advice to candidate bean definitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>DefaultAdvisorAutoProxyCreator</code> will automatically evaluate the pointcut contained in each advisor, to see what (if any) advice it should apply to each business object (such as "businessObject1" and "businessObject2" in the example).</p>
</div>
<div class="paragraph">
<p>This means that any number of advisors can be applied automatically to each business object.
If no pointcut in any of the advisors matches any method in a business object, the object will not be proxied.
As bean definitions are added for new business objects, they will automatically be proxied if necessary.</p>
</div>
<div class="paragraph">
<p>Autoproxying in general has the advantage of making it impossible for callers or dependencies to obtain an un-advised object.
Calling getBean("businessObject1") on this ApplicationContext will return an AOP proxy, not the target business object.
(The "inner bean" idiom shown earlier also offers this benefit.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;

&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="transactionInterceptor"/&gt;
&lt;/bean&gt;

&lt;bean id="customAdvisor" class="com.mycompany.MyAdvisor"/&gt;

&lt;bean id="businessObject1" class="com.mycompany.BusinessObject1"&gt;
  &lt;!-- Properties omitted --&gt;
&lt;/bean&gt;

&lt;bean id="businessObject2" class="com.mycompany.BusinessObject2"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DefaultAdvisorAutoProxyCreator</code> is very useful if you want to apply the same advice consistently to many business objects.
Once the infrastructure definitions are in place, you can simply add new business objects without including specific proxy configuration.
You can also drop in additional aspects very easily - for example, tracing or performance monitoring aspects - with minimal change to configuration.</p>
</div>
<div class="paragraph">
<p>The DefaultAdvisorAutoProxyCreator offers support for filtering (using a naming convention so that only certain advisors are evaluated, allowing use of multiple, differently configured, AdvisorAutoProxyCreators in the same factory) and ordering.
Advisors can implement the <code>org.springframework.core.Ordered</code> interface to ensure correct ordering if this is an issue.
The TransactionAttributeSourceAdvisor used in the above example has a configurable order value; the default setting is unordered.</p>
</div>
</div>
<div class="sect3">
<h4 id="abstractadvisorautoproxycreator"><a class="anchor" href="#abstractadvisorautoproxycreator"></a>AbstractAdvisorAutoProxyCreator</h4>
<div class="paragraph">
<p>This is the superclass of DefaultAdvisorAutoProxyCreator.
You can create your own auto-proxy creators by subclassing this class, in the unlikely event that advisor definitions offer insufficient customization to the behavior of the framework <code>DefaultAdvisorAutoProxyCreator</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-metadata-driven-auto-proxying"><a class="anchor" href="#using-metadata-driven-auto-proxying"></a>Using metadata-driven auto-proxying</h3>
<div class="paragraph">
<p>A particularly important type of auto-proxying is driven by metadata.
This produces a similar programming model to .NET <code>ServicedComponents</code>.
Instead of defining metadata in XML descriptors, configuration for transaction management and other enterprise services is held in source-level attributes.</p>
</div>
<div class="paragraph">
<p>In this case, you use the <code>DefaultAdvisorAutoProxyCreator</code>, in combination with Advisors that understand metadata attributes.
The metadata specifics are held in the pointcut part of the candidate advisors, rather than in the auto-proxy creation class itself.</p>
</div>
<div class="paragraph">
<p>This is really a special case of the <code>DefaultAdvisorAutoProxyCreator</code>, but deserves consideration on its own.
(The metadata-aware code is in the pointcuts contained in the advisors, not the AOP framework itself.)</p>
</div>
<div class="paragraph">
<p>The <code>/attributes</code> directory of the JPetStore sample application shows the use of attribute-driven auto-proxying.
In this case, there&#8217;s no need to use the <code>TransactionProxyFactoryBean</code>.
Simply defining transactional attributes on business objects is sufficient, because of the use of metadata-aware pointcuts.
The bean definitions include the following code, in <code>/WEB-INF/declarativeServices.xml</code>.
Note that this is generic, and can be used outside the JPetStore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;

&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="transactionInterceptor"/&gt;
&lt;/bean&gt;

&lt;bean id="transactionInterceptor"
    class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="transactionAttributeSource"&gt;
    &lt;bean class="org.springframework.transaction.interceptor.AttributesTransactionAttributeSource"&gt;
      &lt;property name="attributes" ref="attributes"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="attributes" class="org.springframework.metadata.commons.CommonsAttributes"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DefaultAdvisorAutoProxyCreator</code> bean definition (the name is not significant, hence it can even be omitted) will pick up all eligible pointcuts in the current application context.
In this case, the "transactionAdvisor" bean definition, of type <code>TransactionAttributeSourceAdvisor</code>, will apply to classes or methods carrying a transaction attribute.
The TransactionAttributeSourceAdvisor depends on a TransactionInterceptor, via constructor dependency.
The example resolves this via autowiring.
The <code>AttributesTransactionAttributeSource</code> depends on an implementation of the <code>org.springframework.metadata.Attributes</code> interface.
In this fragment, the "attributes" bean satisfies this, using the Jakarta Commons Attributes API to obtain attribute information.
(The application code must have been compiled using the Commons Attributes compilation task.)</p>
</div>
<div class="paragraph">
<p>The <code>/annotation</code> directory of the JPetStore sample application contains an analogous example for auto-proxying driven by JDK 1.5+ annotations.
The following configuration enables automatic detection of Spring&#8217;s <code>Transactional</code> annotation, leading to implicit proxies for beans containing that annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;

&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="transactionInterceptor"/&gt;
&lt;/bean&gt;

&lt;bean id="transactionInterceptor"
    class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="transactionAttributeSource"&gt;
    &lt;bean class="org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TransactionInterceptor</code> defined here depends on a <code>PlatformTransactionManager</code> definition, which is not included in this generic file (although it could be) because it will be specific to the application&#8217;s transaction requirements (typically JTA, as in this example, or Hibernate, JDO or JDBC):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="transactionManager"
    class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
If you require only declarative transaction management, using these generic XML definitions will result in Spring automatically proxying all classes or methods with transaction attributes.
You won&#8217;t need to work directly with AOP, and the programming model is similar to that of .NET ServicedComponents.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This mechanism is extensible.
It&#8217;s possible to do auto-proxying based on custom attributes.
You need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define your custom attribute.</p>
</li>
<li>
<p>Specify an Advisor with the necessary advice, including a pointcut that is triggered by the presence of the custom attribute on a class or method.
You may be able to use an existing advice, merely implementing a static pointcut that picks up the custom attribute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s possible for such advisors to be unique to each advised class (for example, mixins): they simply need to be defined as prototype, rather than singleton, bean definitions.
For example, the <code>LockMixin</code> introduction interceptor from the Spring test suite, shown above, could be used in conjunction with an attribute-driven pointcut to target a mixin, as shown here.
We use the generic <code>DefaultPointcutAdvisor</code>, configured using JavaBean properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="lockMixin" class="org.springframework.aop.LockMixin"
    scope="prototype"/&gt;

&lt;bean id="lockableAdvisor" class="org.springframework.aop.support.DefaultPointcutAdvisor"
    scope="prototype"&gt;
  &lt;property name="pointcut" ref="myAttributeAwarePointcut"/&gt;
  &lt;property name="advice" ref="lockMixin"/&gt;
&lt;/bean&gt;

&lt;bean id="anyBean" class="anyclass" ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the attribute aware pointcut matches any methods in the <code>anyBean</code> or other bean definitions, the mixin will be applied.
Note that both <code>lockMixin</code> and <code>lockableAdvisor</code> definitions are prototypes.
The <code>myAttributeAwarePointcut</code> pointcut can be a singleton definition, as it doesn&#8217;t hold state for individual advised objects.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-targetsources"><a class="anchor" href="#using-targetsources"></a>Using TargetSources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring offers the concept of a <em>TargetSource</em>, expressed in the <code>org.springframework.aop.TargetSource</code> interface.
This interface is responsible for returning the "target object" implementing the join point.
The <code>TargetSource</code> implementation is asked for a target instance each time the AOP proxy handles a method invocation.</p>
</div>
<div class="paragraph">
<p>Developers using Spring AOP don&#8217;t normally need to work directly with TargetSources, but this provides a powerful means of supporting pooling, hot swappable and other sophisticated targets.
For example, a pooling TargetSource can return a different target instance for each invocation, using a pool to manage instances.</p>
</div>
<div class="paragraph">
<p>If you do not specify a TargetSource, a default implementation is used that wraps a local object.
The same target is returned for each invocation (as you would expect).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the standard target sources provided with Spring, and how you can use them.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
When using a custom target source, your target will usually need to be a prototype rather than a singleton bean definition.
This allows Spring to create a new target instance when required.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="hot-swappable-target-sources"><a class="anchor" href="#hot-swappable-target-sources"></a>Hot swappable target sources</h3>
<div class="paragraph">
<p>The <code>org.springframework.aop.target.HotSwappableTargetSource</code> exists to allow the target of an AOP proxy to be switched while allowing callers to keep their references to it.</p>
</div>
<div class="paragraph">
<p>Changing the target source&#8217;s target takes effect immediately.
The <code>HotSwappableTargetSource</code> is threadsafe.</p>
</div>
<div class="paragraph">
<p>You can change the target via the <code>swap()</code> method on HotSwappableTargetSource as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>HotSwappableTargetSource swapper =
    (HotSwappableTargetSource) beanFactory.getBean("swapper");
Object oldTarget = swapper.swap(newTarget);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML definitions required look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="initialTarget" class="mycompany.OldTarget"/&gt;

&lt;bean id="swapper" class="org.springframework.aop.target.HotSwappableTargetSource"&gt;
  &lt;constructor-arg ref="initialTarget"/&gt;
&lt;/bean&gt;

&lt;bean id="swappable" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="targetSource" ref="swapper"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>swap()</code> call changes the target of the swappable bean.
Clients who hold a reference to that bean will be unaware of the change, but will immediately start hitting the new target.</p>
</div>
<div class="paragraph">
<p>Although this example doesn&#8217;t add any advice - and it&#8217;s not necessary to add advice to use a <code>TargetSource</code> - of course any <code>TargetSource</code> can be used in conjunction with arbitrary advice.</p>
</div>
</div>
<div class="sect2">
<h3 id="pooling-target-sources"><a class="anchor" href="#pooling-target-sources"></a>Pooling target sources</h3>
<div class="paragraph">
<p>Using a pooling target source provides a similar programming model to stateless session EJBs, in which a pool of identical instances is maintained, with method invocations going to free objects in the pool.</p>
</div>
<div class="paragraph">
<p>A crucial difference between Spring pooling and SLSB pooling is that Spring pooling can be applied to any POJO. As with Spring in general, this service can be applied in a non-invasive way.</p>
</div>
<div class="paragraph">
<p>Spring provides out-of-the-box support for Jakarta Commons Pool 1.3, which provides a fairly efficient pooling implementation.
You&#8217;ll need the commons-pool Jar on your application&#8217;s classpath to use this feature.
It&#8217;s also possible to subclass <code>org.springframework.aop.target.AbstractPoolingTargetSource</code> to support any other pooling API.</p>
</div>
<div class="paragraph">
<p>Sample configuration is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="businessObjectTarget" class="com.mycompany.MyBusinessObject"
    scope="prototype"&gt;
  ... properties omitted
&lt;/bean&gt;

&lt;bean id="poolTargetSource" class="org.springframework.aop.target.CommonsPoolTargetSource"&gt;
  &lt;property name="targetBeanName" value="businessObjectTarget"/&gt;
  &lt;property name="maxSize" value="25"/&gt;
&lt;/bean&gt;

&lt;bean id="businessObject" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="targetSource" ref="poolTargetSource"/&gt;
  &lt;property name="interceptorNames" value="myInterceptor"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the target object - "businessObjectTarget" in the example - <em>must</em> be a prototype.
This allows the <code>PoolingTargetSource</code> implementation to create new instances of the target to grow the pool as necessary.
See the javadoc for <code>AbstractPoolingTargetSource</code> and the concrete subclass you wish to use for information about its properties: "maxSize" is the most basic, and always guaranteed to be present.</p>
</div>
<div class="paragraph">
<p>In this case, "myInterceptor" is the name of an interceptor that would need to be defined in the same IoC context.
However, it isn&#8217;t necessary to specify interceptors to use pooling.
If you want only pooling, and no other advice, don&#8217;t set the interceptorNames property at all.</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to configure Spring so as to be able to cast any pooled object to the <code>org.springframework.aop.target.PoolingConfig</code> interface, which exposes information about the configuration and current size of the pool through an introduction.
You&#8217;ll need to define an advisor like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="poolConfigAdvisor" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean"&gt;
  &lt;property name="targetObject" ref="poolTargetSource"/&gt;
  &lt;property name="targetMethod" value="getPoolingConfigMixin"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This advisor is obtained by calling a convenience method on the <code>AbstractPoolingTargetSource</code> class, hence the use of MethodInvokingFactoryBean.
This advisor&#8217;s name ("poolConfigAdvisor" here) must be in the list of interceptors names in the ProxyFactoryBean exposing the pooled object.</p>
</div>
<div class="paragraph">
<p>The cast will look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>PoolingConfig conf = (PoolingConfig) beanFactory.getBean("businessObject");
System.out.println("Max pool size is " + conf.getMaxSize());</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Pooling stateless service objects is not usually necessary.
We don&#8217;t believe it should be the default choice, as most stateless objects are naturally thread safe, and instance pooling is problematic if resources are cached.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Simpler pooling is available using auto-proxying.
It&#8217;s possible to set the TargetSources used by any auto-proxy creator.</p>
</div>
</div>
<div class="sect2">
<h3 id="prototype-target-sources"><a class="anchor" href="#prototype-target-sources"></a>Prototype target sources</h3>
<div class="paragraph">
<p>Setting up a "prototype" target source is similar to a pooling TargetSource.
In this case, a new instance of the target will be created on every method invocation.
Although the cost of creating a new object isn&#8217;t high in a modern JVM, the cost of wiring up the new object (satisfying its IoC dependencies) may be more expensive.
Thus you shouldn&#8217;t use this approach without very good reason.</p>
</div>
<div class="paragraph">
<p>To do this, you could modify the <code>poolTargetSource</code> definition shown above as follows.
(I&#8217;ve also changed the name, for clarity.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="prototypeTargetSource" class="org.springframework.aop.target.PrototypeTargetSource"&gt;
  &lt;property name="targetBeanName" ref="businessObjectTarget"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s only one property: the name of the target bean.
Inheritance is used in the TargetSource implementations to ensure consistent naming.
As with the pooling target source, the target bean must be a prototype bean definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-threadlocal-code-target-sources"><a class="anchor" href="#code-class-class-threadlocal-code-target-sources"></a><code class="class">ThreadLocal</code> target sources</h3>
<div class="paragraph">
<p><code class="class">ThreadLocal</code> target sources are useful if you need an object to be created for each incoming request (per thread that is).
The concept of a <code class="class">ThreadLocal</code> provide a JDK-wide facility to transparently store resource alongside a thread.
Setting up a <code class="class">ThreadLocalTargetSource</code> is pretty much the same as was explained for the other types of target source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="threadlocalTargetSource" class="org.springframework.aop.target.ThreadLocalTargetSource"&gt;
  &lt;property name="targetBeanName" value="businessObjectTarget"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
ThreadLocals come with serious issues (potentially resulting in memory leaks) when incorrectly using them in a multi-threaded and multi-classloader environments.
One should always consider wrapping a threadlocal in some other class and never directly use the <code class="class">ThreadLocal</code> itself (except of course in the wrapper class).
Also, one should always remember to correctly set and unset (where the latter simply involved a call to <code>ThreadLocal.set(null)</code>) the resource local to the thread.
Unsetting should be done in any case since not unsetting it might result in problematic behavior.
Spring&#8217;s ThreadLocal support does this for you and should always be considered in favor of using ThreadLocals without other proper handling code.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="defining-new-code-class-interface-advice-code-types"><a class="anchor" href="#defining-new-code-class-interface-advice-code-types"></a>Defining new <code class="interface">Advice</code> types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring AOP is designed to be extensible.
While the interception implementation strategy is presently used internally, it is possible to support arbitrary advice types in addition to the out-of-the-box interception around advice, before, throws advice and after returning advice.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.aop.framework.adapter</code> package is an SPI package allowing support for new custom advice types to be added without changing the core framework.
The only constraint on a custom <code class="interface">Advice</code> type is that it must implement the <code class="interface">org.aopalliance.aop.Advice</code> tag interface.</p>
</div>
<div class="paragraph">
<p>Please refer to the <code>org.springframework.aop.framework.adapter</code> package&#8217;s Javadocs for further information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="further-resources"><a class="anchor" href="#further-resources"></a>Further resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Please refer to the Spring sample applications for further examples of Spring AOP:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The JPetStore&#8217;s default configuration illustrates the use of the <code class="class">TransactionProxyFactoryBean</code> for declarative transaction management.</p>
</li>
<li>
<p>The <code>/attributes</code> directory of the JPetStore illustrates the use of attribute-driven declarative transaction management.</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="testing" class="sect0"><a class="anchor" href="#testing"></a>Testing</h1>
<div class="sect1">
<h2 id="introduction-to-spring-testing"><a class="anchor" href="#introduction-to-spring-testing"></a>Introduction to Spring Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Testing is an integral part of enterprise software development.
This chapter focuses on the value-add of the IoC principle to <a href="#unit-testing">unit testing</a> and on the benefits of the Spring Framework&#8217;s support for <a href="#integration-testing">integration
    testing</a>.
<em>(A thorough treatment of testing in the enterprise
    is beyond the scope of this reference manual.)</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="unit-testing"><a class="anchor" href="#unit-testing"></a>Unit Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dependency Injection should make your code less dependent on the container than it would be with traditional Java EE development.
The POJOs that make up your application should be testable in JUnit or TestNG tests, with objects simply instantiated using the <code>new</code> operator, <em>without Spring or any other container</em>.
You can use <a href="#mock-objects">mock objects</a> (in conjunction with other valuable testing techniques) to test your code in isolation.
If you follow the architecture recommendations for Spring, the resulting clean layering and componentization of your codebase will facilitate easier unit testing.
For example, you can test service layer objects by stubbing or mocking DAO or Repository interfaces, without needing to access persistent data while running unit tests.</p>
</div>
<div class="paragraph">
<p>True unit tests typically run extremely quickly, as there is no runtime infrastructure to set up.
Emphasizing true unit tests as part of your development methodology will boost your productivity.
You may not need this section of the testing chapter to help you write effective unit tests for your IoC-based applications.
For certain unit testing scenarios, however, the Spring Framework provides the following mock objects and testing support classes.</p>
</div>
<div class="sect2">
<h3 id="mock-objects"><a class="anchor" href="#mock-objects"></a>Mock Objects</h3>
<div class="sect3">
<h4 id="environment"><a class="anchor" href="#environment"></a>Environment</h4>
<div class="paragraph">
<p>The <code>org.springframework.mock.env</code> package contains mock implementations of the <code class="interface">Environment</code> and <code class="interface">PropertySource</code> abstractions introduced in Spring 3.1 (see <a href="#new-in-3.1-environment-abstraction">[new-in-3.1-environment-abstraction]</a> and <a href="#new-in-3.1-property-source-abstraction">[new-in-3.1-property-source-abstraction]</a>).
<code class="class">MockEnvironment</code> and <code class="class">MockPropertySource</code> are useful for developing <em>out-of-container</em> tests for code that depends on environment-specific properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="jndi"><a class="anchor" href="#jndi"></a>JNDI</h4>
<div class="paragraph">
<p>The <code>org.springframework.mock.jndi</code> package contains an implementation of the JNDI SPI, which you can use to set up a simple JNDI environment for test suites or stand-alone applications.
If, for example, JDBC [class]`DataSource`s get bound to the same JNDI names in test code as within a Java EE container, you can reuse both application code and configuration in testing scenarios without modification.</p>
</div>
</div>
<div class="sect3">
<h4 id="servlet-api"><a class="anchor" href="#servlet-api"></a>Servlet API</h4>
<div class="paragraph">
<p>The <code>org.springframework.mock.web</code> package contains a comprehensive set of Servlet API mock objects, targeted at usage with Spring&#8217;s Web MVC framework, which are useful for testing web contexts and controllers.
These mock objects are generally more convenient to use than dynamic mock objects such as &lt;&lt;,EasyMock&gt;&gt; or existing Servlet API mock objects such as &lt;&lt;,MockObjects&gt;&gt;.</p>
</div>
</div>
<div class="sect3">
<h4 id="portlet-api"><a class="anchor" href="#portlet-api"></a>Portlet API</h4>
<div class="paragraph">
<p>The <code>org.springframework.mock.web.portlet</code> package contains a set of Portlet API mock objects, targeted at usage with Spring&#8217;s Portlet MVC framework.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unit-testing-support-classes"><a class="anchor" href="#unit-testing-support-classes"></a>Unit Testing support Classes</h3>
<div class="sect3">
<h4 id="general-utilities"><a class="anchor" href="#general-utilities"></a>General utilities</h4>
<div class="paragraph">
<p>The <code>org.springframework.test.util</code> package contains <code class="class">ReflectionTestUtils</code>, which is a collection of reflection-based utility methods.
Developers use these methods in unit and integration testing scenarios in which they need to set a non-<code>public</code> field or invoke a non-<code>public</code> setter method when testing application code involving, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ORM frameworks such as JPA and Hibernate that condone <code>private</code> or <code>protected</code> field access as opposed to <code>public</code> setter methods for properties in a domain entity.</p>
</li>
<li>
<p>Spring&#8217;s support for annotations such as <code class="interface">@Autowired</code>, <code class="interface">@Inject</code>, and <code class="interface">@Resource,</code> which provides dependency injection for <code>private</code> or <code>protected</code> fields, setter methods, and configuration methods.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="spring-mvc"><a class="anchor" href="#spring-mvc"></a>Spring MVC</h4>
<div class="paragraph">
<p>The <code>org.springframework.test.web</code> package contains <code class="class">ModelAndViewAssert</code>, which you can use in combination with JUnit, TestNG, or any other testing framework for unit tests dealing with Spring MVC <code class="class">ModelAndView</code> objects.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Unit testing Spring MVC Controllers</div>
<div class="paragraph">
<p>To test your Spring MVC <code>Controller`s, use [class]`ModelAndViewAssert</code> combined with <code>MockHttpServletRequest</code>, <code>MockHttpSession</code>, and so on from the <a href="#mock-objects-servlet"><code>org.springframework.mock.web</code></a> package.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integration-testing"><a class="anchor" href="#integration-testing"></a>Integration Testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview"><a class="anchor" href="#overview"></a>Overview</h3>
<div class="paragraph">
<p>It is important to be able to perform some integration testing without requiring deployment to your application server or connecting to other enterprise infrastructure.
This will enable you to test things such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The correct wiring of your Spring IoC container contexts.</p>
</li>
<li>
<p>Data access using JDBC or an ORM tool.
This would include such things as the correctness of SQL statements, Hibernate queries, JPA entity mappings, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Spring Framework provides first-class support for integration testing in the <code class="file">spring-test</code> module.
The name of the actual JAR file might include the release version and might also be in the long <code class="file">org.springframework.test</code> form, depending on where you get it from (see the <a href="#dependency-management">section on
      Dependency Management</a> for an explanation).
This library includes the <code>org.springframework.test</code> package, which contains valuable classes for integration testing with a Spring container.
This testing does not rely on an application server or other deployment environment.
Such tests are slower to run than unit tests but much faster than the equivalent Cactus tests or remote tests that rely on deployment to an application server.</p>
</div>
<div class="paragraph">
<p>In Spring 2.5 and later, unit and integration testing support is provided in the form of the annotation-driven <a href="#testcontext-framework">Spring TestContext Framework</a>.
The TestContext framework is agnostic of the actual testing framework in use, thus allowing instrumentation of tests in various environments including JUnit, TestNG, and so on.</p>
</div>
</div>
<div class="sect2">
<h3 id="goals-of-integration-testing"><a class="anchor" href="#goals-of-integration-testing"></a>Goals of Integration Testing</h3>
<div class="paragraph">
<p>Spring&#8217;s integration testing support has the following primary goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To manage <a href="#testing-ctx-management">Spring IoC
container caching</a> between test execution.</p>
</li>
<li>
<p>To provide <a href="#testing-fixture-di">Dependency
Injection of test fixture instances</a>.</p>
</li>
<li>
<p>To provide <a href="#testing-tx">transaction
management</a> appropriate to integration testing.</p>
</li>
<li>
<p>To supply <a href="#testing-support-classes">Spring-specific base classes</a> that assist developers in writing integration tests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next few sections describe each goal and provide links to implementation and configuration details.</p>
</div>
<div class="sect3">
<h4 id="context-management-and-caching"><a class="anchor" href="#context-management-and-caching"></a>Context management and caching</h4>
<div class="paragraph">
<p>The Spring TestContext Framework provides consistent loading of Spring [class]`ApplicationContext`s and [class]`WebApplicationContext`s as well as caching of those contexts.
Support for the caching of loaded contexts is important, because startup time can become an issue&#8201;&#8212;&#8201;not because of the overhead of Spring itself, but because the objects instantiated by the Spring container take time to instantiate.
For example, a project with 50 to 100 Hibernate mapping files might take 10 to 20 seconds to load the mapping files, and incurring that cost before running every test in every test fixture leads to slower overall test runs that reduce developer productivity.</p>
</div>
<div class="paragraph">
<p>Test classes typically declare either an array of <em>resource locations</em> for XML configuration metadata&#8201;&#8212;&#8201;often in the classpath&#8201;&#8212;&#8201;or an array of <em>annotated
        classes</em> that is used to configure the application.
These locations or classes are the same as or similar to those specified in <code>web.xml</code> or other deployment configuration files.</p>
</div>
<div class="paragraph">
<p>By default, once loaded, the configured <code class="interface">ApplicationContext</code> is reused for each test.
Thus the setup cost is incurred only once per test suite, and subsequent test execution is much faster.
In this context, the term <em>test suite</em> means all tests run in the same JVM&#8201;&#8212;&#8201;for example, all tests run from an Ant, Maven, or Gradle build for a given project or module.
In the unlikely case that a test corrupts the application context and requires reloading&#8201;&#8212;&#8201;for example, by modifying a bean definition or the state of an application object&#8201;&#8212;&#8201;the TestContext framework can be configured to reload the configuration and rebuild the application context before executing the next test.</p>
</div>
<div class="paragraph">
<p>See <a href="#testcontext-ctx-management">[testcontext-ctx-management]</a> and <a href="#testcontext-ctx-management-caching">[testcontext-ctx-management-caching]</a> with the TestContext framework.</p>
</div>
</div>
<div class="sect3">
<h4 id="dependency-injection-of-test-fixtures"><a class="anchor" href="#dependency-injection-of-test-fixtures"></a>Dependency Injection of test fixtures</h4>
<div class="paragraph">
<p>When the TestContext framework loads your application context, it can optionally configure instances of your test classes via Dependency Injection.
This provides a convenient mechanism for setting up test fixtures using preconfigured beans from your application context.
A strong benefit here is that you can reuse application contexts across various testing scenarios (e.g., for configuring Spring-managed object graphs, transactional proxies, [class]`DataSource`s, etc.), thus avoiding the need to duplicate complex test fixture setup for individual test cases.</p>
</div>
<div class="paragraph">
<p>As an example, consider the scenario where we have a class, <code class="class">HibernateTitleRepository</code>, that implements data access logic for a <code class="class">Title</code> domain entity.
We want to write integration tests that test the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Spring configuration: basically, is everything related to the configuration of the <code class="class">HibernateTitleRepository</code> bean correct and present?</p>
</li>
<li>
<p>The Hibernate mapping file configuration: is everything mapped correctly, and are the correct lazy-loading settings in place?</p>
</li>
<li>
<p>The logic of the <code class="class">HibernateTitleRepository</code>: does the configured instance of this class perform as anticipated?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See dependency injection of test fixtures with the <a href="#testcontext-fixture-di">TestContext framework</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="transaction-management"><a class="anchor" href="#transaction-management"></a>Transaction management</h4>
<div class="paragraph">
<p>One common issue in tests that access a real database is their effect on the state of the persistence store.
Even when you&#8217;re using a development database, changes to the state may affect future tests.
Also, many operations&#8201;&#8212;&#8201;such as inserting or modifying persistent data&#8201;&#8212;&#8201;cannot be performed (or verified) outside a transaction.</p>
</div>
<div class="paragraph">
<p>The TestContext framework addresses this issue.
By default, the framework will create and roll back a transaction for each test.
You simply write code that can assume the existence of a transaction.
If you call transactionally proxied objects in your tests, they will behave correctly, according to their configured transactional semantics.
In addition, if a test method deletes the contents of selected tables while running within the transaction managed for the test, the transaction will roll back by default, and the database will return to its state prior to execution of the test.
Transactional support is provided to a test via a <code class="class">PlatformTransactionManager</code> bean defined in the test&#8217;s application context.</p>
</div>
<div class="paragraph">
<p>If you want a transaction to commit&#8201;&#8212;&#8201;unusual, but occasionally useful when you want a particular test to populate or modify the database&#8201;&#8212;&#8201;the TestContext framework can be instructed to cause the transaction to commit instead of roll back via the <a href="#integration-testing-annotations"><code class="interface">@TransactionConfiguration</code></a> and <a href="#integration-testing-annotations"><code class="interface">@Rollback</code></a> annotations.</p>
</div>
<div class="paragraph">
<p>See transaction management with the <a href="#testcontext-tx">TestContext framework</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="support-classes-for-integration-testing"><a class="anchor" href="#support-classes-for-integration-testing"></a>Support classes for integration testing</h4>
<div class="paragraph">
<p>The Spring TestContext Framework provides several <code>abstract</code> support classes that simplify the writing of integration tests.
These base test classes provide well-defined hooks into the testing framework as well as convenient instance variables and methods, which enable you to access:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>ApplicationContext</code>, for performing explicit bean lookups or testing the state of the context as a whole.</p>
</li>
<li>
<p>A <code class="class">JdbcTemplate</code>, for executing SQL statements to query the database.
Such queries can be used to confirm database state both <em>prior to</em> and <em>after</em> execution of database-related application code, and Spring ensures that such queries run in the scope of the same transaction as the application code.
When used in conjunction with an ORM tool, be sure to avoid <a href="#testcontext-tx-false-positives">false
            positives</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, you may want to create your own custom, application-wide superclass with instance variables and methods specific to your project.</p>
</div>
<div class="paragraph">
<p>See support classes for the <a href="#testcontext-support-classes">TestContext
        framework</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdbc-testing-support"><a class="anchor" href="#jdbc-testing-support"></a>JDBC Testing Support</h3>
<div class="paragraph">
<p>The <code>org.springframework.test.jdbc</code> package contains <code class="class">JdbcTestUtils</code>, which is a collection of JDBC related utility functions intended to simplify standard database testing scenarios.
<em>Note that <a href="#testcontext-support-classes-junit4"><code class="class">AbstractTransactionalJUnit4SpringContextTests</code></a>
      and <a href="#testcontext-support-classes-testng"><code class="class">AbstractTransactionalTestNGSpringContextTests</code></a>
      provide convenience methods which delegate to
      <code class="class">JdbcTestUtils</code> internally.</em></p>
</div>
<div class="paragraph">
<p>The <code>spring-jdbc</code> module provides support for configuring and launching an embedded database which can be used in integration tests that interact with a database.
For details, see <a href="#jdbc-embedded-database-support">[jdbc-embedded-database-support]</a> and <a href="#jdbc-embedded-database-dao-testing">[jdbc-embedded-database-dao-testing]</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="annotations"><a class="anchor" href="#annotations"></a>Annotations</h3>
<div class="sect3">
<h4 id="spring-testing-annotations"><a class="anchor" href="#spring-testing-annotations"></a>Spring Testing Annotations</h4>
<div class="paragraph">
<p>The Spring Framework provides the following set of <em>Spring-specific</em> annotations that you can use in your unit and integration tests in conjunction with the TestContext framework.
Refer to the respective Javadoc for further information, including default attribute values, attribute aliases, and so on.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>[interface]`@ContextConfiguration`</em></p>
<div class="paragraph">
<p>Defines class-level metadata that is used to determine how to load and configure an <code class="interface">ApplicationContext</code> for integration tests.
Specifically, <code class="interface">@ContextConfiguration</code> declares <em>either</em> the application context resource  <em>or</em> the annotated  that will be used to load the context.</p>
</div>
<div class="paragraph">
<p>Resource locations are typically XML configuration files located in the classpath; whereas, annotated classes are typically <code class="interface">@Configuration</code> classes.
However, resource locations can also refer to files in the file system, and annotated classes can be component classes, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration("/test-config.xml")
public class XmlApplicationContextTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration(classes = TestConfig.class)
public class ConfigClassApplicationContextTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative or in addition to declaring resource locations or annotated classes, <code class="interface">@ContextConfiguration</code> may be used to declare <code class="interface">ApplicationContextInitializer</code> classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration(initializers = CustomContextIntializer.class)
public class ContextInitializerTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="interface">@ContextConfiguration</code> may optionally be used to declare the <code class="interface">ContextLoader</code> strategy as well.
Note, however, that you typically do not need to explicitly configure the loader since the default loader supports either resource  or annotated  as well as .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration(locations = "/test-context.xml", loader = CustomContextLoader.class)
public class CustomLoaderXmlApplicationContextTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code class="interface">@ContextConfiguration</code> provides support for <em>inheriting</em> resource locations or configuration classes as well as context initializers declared by superclasses by default.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#testcontext-ctx-management">[testcontext-ctx-management]</a> and the Javadoc for <code class="interface">@ContextConfiguration</code> for further details.</p>
</div>
</li>
<li>
<p><em>[interface]`@WebAppConfiguration`</em></p>
<div class="paragraph">
<p>A class-level annotation that is used to declare that the <code class="interface">ApplicationContext</code> loaded for an integration test should be a <code class="interface">WebApplicationContext</code>.
The mere presence of <code class="interface">@WebAppConfiguration</code> on a test class ensures that a <code class="interface">WebApplicationContext</code> will be loaded for the test, using the default value of <code>"file:src/main/webapp"</code> for the path to the root of the web application (i.e., the <em>resource base
            path</em>).
The resource base path is used behind the scenes to create a <code class="class">MockServletContext</code> which serves as the <code class="interface">ServletContext</code> for the test&#8217;s <code class="interface">WebApplicationContext</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration
@WebAppConfiguration
public class WebAppTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To override the default, specify a different base resource path via the <em>implicit</em> <code class="interface">value</code> attribute.
Both <code>classpath:</code> and <code>file:</code> resource prefixes are supported.
If no resource prefix is supplied the path is assumed to be a file system resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration
@WebAppConfiguration("classpath:test-web-resources")
public class WebAppTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code class="interface">@WebAppConfiguration</code> must be used in conjunction with <code class="interface">@ContextConfiguration</code>, either within a single test class or within a test class hierarchy.
See the Javadoc for <code class="interface">@WebAppConfiguration</code> for further details.</p>
</div>
</li>
<li>
<p><em>[interface]`@ContextHierarchy`</em></p>
<div class="paragraph">
<p>A class-level annotation that is used to define a hierarchy of <code class="interface">ApplicationContext`s for integration tests.
[interface]</code>@ContextHierarchy` should be declared with a list of one or more <code class="interface">@ContextConfiguration</code> instances, each of which defines a level in the context hierarchy.
The following examples demonstrate the use of <code class="interface">@ContextHierarchy</code> within a single test class; however, <code class="interface">@ContextHierarchy</code> can also be used within a test class hierarchy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextHierarchy({
    @ContextConfiguration("/parent-config.xml"),
    @ContextConfiguration("/child-config.xml")
})
public class ContextHierarchyTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@WebAppConfiguration
@ContextHierarchy({
    @ContextConfiguration(classes = AppConfig.class),
    @ContextConfiguration(classes = WebConfig.class)
})
public class WebIntegrationTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to merge or override the configuration for a given level of the context hierarchy within a test class hierarchy, you must explicitly name that level by supplying the same value to the  attribute in <code class="interface">@ContextConfiguration</code> at each corresponding level in the class hierarchy.
See <a href="#testcontext-ctx-management-ctx-hierarchies">[testcontext-ctx-management-ctx-hierarchies]</a> and the Javadoc for <code class="interface">@ContextHierarchy</code> for further examples.</p>
</div>
</li>
<li>
<p><em>[interface]`@ActiveProfiles`</em></p>
<div class="paragraph">
<p>A class-level annotation that is used to declare which <em>bean definition profiles</em> should be active when loading an <code class="interface">ApplicationContext</code> for test classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration
@ActiveProfiles("dev")
public class DeveloperTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration
@ActiveProfiles({"dev", "integration"})
public class DeveloperIntegrationTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code class="interface">@ActiveProfiles</code> provides support for <em>inheriting</em> active bean definition profiles declared by superclasses by default.
It is also possible to resolve active bean definition profiles programmatically by implementing a custom <code class="interface">ActiveProfilesResolver</code> and registering it via the  attribute of <code class="interface">@ActiveProfiles</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#testcontext-ctx-management-env-profiles">[testcontext-ctx-management-env-profiles]</a> and the Javadoc for <code class="interface">@ActiveProfiles</code> for examples and further details.</p>
</div>
</li>
<li>
<p><em>[interface]`@DirtiesContext`</em></p>
<div class="paragraph">
<p>Indicates that the underlying Spring <code class="interface">ApplicationContext</code> has been <em>dirtied</em> during the execution of a test (i.e., modified or corrupted in some manner&#8201;&#8212;&#8201;for example, by changing the state of a singleton bean) and should be closed, regardless of whether the test passed.
When an application context is marked <em>dirty</em>, it is removed from the testing framework&#8217;s cache and closed.
As a consequence, the underlying Spring container will be rebuilt for any subsequent test that requires a context with the same configuration metadata.</p>
</div>
<div class="paragraph">
<p><code class="interface">@DirtiesContext</code> can be used as both a class-level and method-level annotation within the same test class.
In such scenarios, the <code class="interface">ApplicationContext</code> is marked as <em>dirty</em> after any such annotated method as well as after the entire class.
If the <code class="class">ClassMode</code> is set to <code>AFTER_EACH_TEST_METHOD</code>, the context is marked dirty after each test method in the class.</p>
</div>
<div class="paragraph">
<p>The following examples explain when the context would be dirtied for various configuration scenarios:</p>
</div>
</li>
<li>
<p>After the current test class, when declared on a class with class mode set to <code>AFTER_CLASS</code> (i.e., the default class mode).</p>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@DirtiesContext
public class ContextDirtyingTests {
    // some tests that result in the Spring container being dirtied
}</code></pre>
</div>
</div>
</li>
<li>
<p>After each test method in the current test class, when declared on a class with class mode set to <code>AFTER_EACH_TEST_METHOD.</code></p>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@DirtiesContext(classMode = ClassMode.AFTER_EACH_TEST_METHOD)
public class ContextDirtyingTests {
    // some tests that result in the Spring container being dirtied
}</code></pre>
</div>
</div>
</li>
<li>
<p>After the current test, when declared on a method.</p>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@DirtiesContext
@Test
public void testProcessWhichDirtiesAppCtx() {
    // some logic that results in the Spring container being dirtied
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code class="interface">@DirtiesContext</code> is used in a test whose context is configured as part of a context hierarchy via <code class="interface">@ContextHierarchy</code>, the  flag can be used to control how the context cache is cleared.
By default an <em>exhaustive</em> algorithm will be used that clears the context cache including not only the current level but also all other context hierarchies that share an ancestor context common to the current test; all [interface]`ApplicationContext`s that reside in a sub-hierarchy of the common ancestor context will be removed from the context cache and closed.
If the <em>exhaustive</em> algorithm is overkill for a particular use case, the simpler <em>current level</em> algorithm can be specified instead, as seen below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextHierarchy({
    @ContextConfiguration("/parent-config.xml"),
    @ContextConfiguration("/child-config.xml")
})
public class BaseTests {
    // class body...
}

public class ExtendedTests extends BaseTests {

    @Test
    @DirtiesContext(hierarchyMode = HierarchyMode.CURRENT_LEVEL)
    public void test() {
        // some logic that results in the child context being dirtied
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further details regarding the <code class="constant">EXHAUSTIVE</code> and <code class="constant">CURRENT_LEVEL</code> algorithms see the Javadoc for <code class="interface">DirtiesContext.HierarchyMode</code>.</p>
</div>
</li>
<li>
<p><em>[interface]`@TestExecutionListeners`</em></p>
<div class="paragraph">
<p>Defines class-level metadata for configuring which <code class="interface">TestExecutionListener`s should be registered with the [class]`TestContextManager</code>.
Typically, <code class="interface">@TestExecutionListeners</code> is used in conjunction with <code class="interface">@ContextConfiguration</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration
@TestExecutionListeners({CustomTestExecutionListener.class, AnotherTestExecutionListener.class})
public class CustomTestExecutionListenerTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="interface">@TestExecutionListeners</code> supports <em>inherited</em> listeners by default.
See the Javadoc for an example and further details.</p>
</div>
</li>
<li>
<p><em>[interface]`@TransactionConfiguration`</em></p>
<div class="paragraph">
<p>Defines class-level metadata for configuring transactional tests.
Specifically, the bean name of the <code class="interface">PlatformTransactionManager</code> that should be used to drive transactions can be explicitly specified if there are multiple beans of type <code class="interface">PlatformTransactionManager</code> in the test&#8217;s <code class="interface">ApplicationContext</code> and if the bean name of the desired <code class="interface">PlatformTransactionManager</code> is not "transactionManager".
In addition, you can change the <code>defaultRollback</code> flag to <code>false</code>.
Typically, <code class="interface">@TransactionConfiguration</code> is used in conjunction with <code class="interface">@ContextConfiguration</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ContextConfiguration
@TransactionConfiguration(transactionManager = "txMgr", defaultRollback = false)
public class CustomConfiguredTransactionalTests {
    // class body...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If the default conventions are sufficient for your test configuration, you can avoid using <code class="interface">@TransactionConfiguration</code> altogether.
In other words, if you have only one transaction manger&#8201;&#8212;&#8201;or if you have multiple transaction mangers but the transaction manager for tests is named "transactionManager" or specified via a <code class="interface">TransactionManagementConfigurer</code>&#8201;&#8212;&#8201;and if you want transactions to roll back automatically, then there is no need to annotate your test class with <code class="interface">@TransactionConfiguration</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><em>[interface]`@Rollback`</em></p>
<div class="paragraph">
<p>Indicates whether the transaction for the annotated test method should be <em>rolled back</em> after the test method has completed.
If <code>true</code>, the transaction is rolled back; otherwise, the transaction is committed.
Use <code class="interface">@Rollback</code> to override the default rollback flag configured at the class level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Rollback(false)
@Test
public void testProcessWithoutRollback() {
    // ...
}</code></pre>
</div>
</div>
</li>
<li>
<p><em>[interface]`@BeforeTransaction`</em></p>
<div class="paragraph">
<p>Indicates that the annotated <code>public void</code> method should be executed <em>before</em> a transaction is started for test methods configured to run within a transaction via the <code class="interface">@Transactional</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@BeforeTransaction
public void beforeTransaction() {
    // logic to be executed before a transaction is started
}</code></pre>
</div>
</div>
</li>
<li>
<p><em>[interface]`@AfterTransaction`</em></p>
<div class="paragraph">
<p>Indicates that the annotated <code>public void</code> method should be executed <em>after</em> a transaction has ended for test methods configured to run within a transaction via the <code class="interface">@Transactional</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@AfterTransaction
public void afterTransaction() {
    // logic to be executed after a transaction has ended
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="standard-annotation-support"><a class="anchor" href="#standard-annotation-support"></a>Standard Annotation Support</h4>
<div class="paragraph">
<p>The following annotations are supported with standard semantics for all configurations of the Spring TestContext Framework.
Note that these annotations are not specific to tests and can be used anywhere in the Spring Framework.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>[interface]`@Autowired`</em></p>
</li>
<li>
<p><em>[interface]`@Qualifier`</em></p>
</li>
<li>
<p><em>[interface]`@Resource`</em> (javax.annotation) <em>if JSR-250 is present</em></p>
</li>
<li>
<p><em>[interface]`@Inject`</em> (javax.inject) <em>if JSR-330 is
present</em></p>
</li>
<li>
<p><em>[interface]`@Named`</em> (javax.inject) <em>if JSR-330 is
present</em></p>
</li>
<li>
<p><em>[interface]`@PersistenceContext`</em> (javax.persistence) <em>if JPA is present</em></p>
</li>
<li>
<p><em>[interface]`@PersistenceUnit`</em> (javax.persistence) <em>if JPA is present</em></p>
</li>
<li>
<p><em>[interface]`@Required`</em></p>
</li>
<li>
<p><em>[interface]`@Transactional`</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">JSR-250 Lifecycle Annotations</div>
<div class="paragraph">
<p>In the Spring TestContext Framework <code class="interface">@PostConstruct</code> and <code class="interface">@PreDestroy</code> may be used with standard semantics on any application components configured in the <code class="interface">ApplicationContext</code>; however, these lifecycle annotations have limited usage within an actual test class.</p>
</div>
<div class="paragraph">
<p>If a method within a test class is annotated with <code class="interface">@PostConstruct</code>, that method will be executed before any <em>before</em> methods of the underlying test framework (e.g., methods annotated with JUnit&#8217;s <code class="interface">@Before</code>), and that will apply for every test method in the test class.
On the other hand, if a method within a test class is annotated with <code class="interface">@PreDestroy</code>, that method will <em>never</em> be executed.
Within a test class it is therefore recommended to use test lifecycle callbacks from the underlying test framework instead of <code class="interface">@PostConstruct</code> and <code class="interface">@PreDestroy</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="spring-junit-testing-annotations"><a class="anchor" href="#spring-junit-testing-annotations"></a>Spring JUnit Testing Annotations</h4>
<div class="paragraph">
<p>The following annotations are <em>only</em> supported when used in conjunction with the <a href="#testcontext-junit4-runner">SpringJUnit4ClassRunner</a> or the <a href="#testcontext-support-classes-junit4">JUnit</a> support classes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>[interface]`@IfProfileValue`</em></p>
<div class="paragraph">
<p>Indicates that the annotated test is enabled for a specific testing environment.
If the configured <code class="class">ProfileValueSource</code> returns a matching <code>value</code> for the provided <code>name</code>, the test is enabled.
This annotation can be applied to an entire class or to individual methods.
Class-level usage overrides method-level usage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@IfProfileValue(name="java.vendor", value="Sun Microsystems Inc.")
@Test
public void testProcessWhichRunsOnlyOnSunJvm() {
    // some logic that should run only on Java VMs from Sun Microsystems
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can configure <code class="interface">@IfProfileValue</code> with a list of <code>values</code> (with <em>OR</em> semantics) to achieve TestNG-like support for <em>test groups</em> in a JUnit environment.
Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@IfProfileValue(name="test-groups", values={"unit-tests", "integration-tests"})
@Test
public void testProcessWhichRunsForUnitOrIntegrationTestGroups() {
    // some logic that should run only for unit and integration test groups
}</code></pre>
</div>
</div>
</li>
<li>
<p><em>[interface]`@ProfileValueSourceConfiguration`</em></p>
<div class="paragraph">
<p>Class-level annotation that specifies what type of <code>ProfileValueSource</code> to use when retrieving <em>profile values</em> configured through the <code class="interface">@IfProfileValue</code> annotation.
If <code class="interface">@ProfileValueSourceConfiguration</code> is not declared for a test, <code class="class">SystemProfileValueSource</code> is used by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@ProfileValueSourceConfiguration(CustomProfileValueSource.class)
public class CustomProfileValueSourceTests {
    // class body...
}</code></pre>
</div>
</div>
</li>
<li>
<p><em>[interface]`@Timed`</em></p>
<div class="paragraph">
<p>Indicates that the annotated test method must finish execution in a specified time period (in milliseconds).
If the text execution time exceeds the specified time period, the test fails.</p>
</div>
<div class="paragraph">
<p>The time period includes execution of the test method itself, any repetitions of the test (see <code class="interface">@Repeat</code>), as well as any <em>set up</em> or <em>tear down</em> of the test fixture.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Timed(millis=1000)
public void testProcessWithOneSecondTimeout() {
    // some logic that should not take longer than 1 second to execute
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring&#8217;s <code class="interface">@Timed</code> annotation has different semantics than JUnit&#8217;s <code class="interface">@Test(timeout=...)</code> support.
Specifically, due to the manner in which JUnit handles test execution timeouts (that is, by executing the test method in a separate <code class="class">Thread</code>), <code class="interface">@Test(timeout=...)</code> applies to <em>each iteration</em> in the case of repetitions and preemptively fails the test if the test takes too long.
Spring&#8217;s <code class="interface">@Timed</code>, on the other hand, times the <em>total</em> test execution time (including all repetitions) and does not preemptively fail the test but rather waits for the test to complete before failing.</p>
</div>
</li>
<li>
<p><em>[interface]`@Repeat`</em></p>
<div class="paragraph">
<p>Indicates that the annotated test method must be executed repeatedly.
The number of times that the test method is to be executed is specified in the annotation.</p>
</div>
<div class="paragraph">
<p>The scope of execution to be repeated includes execution of the test method itself as well as any <em>set up</em> or <em>tear down</em> of the test fixture.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Repeat(10)
@Test
public void testProcessRepeatedly() {
    // ...
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-testcontext-framework"><a class="anchor" href="#spring-testcontext-framework"></a>Spring TestContext Framework</h3>
<div class="paragraph">
<p>The <em>Spring <code class="class">TestContext</code>
      Framework</em> (located in the <code>org.springframework.test.context</code> package) provides generic, annotation-driven unit and integration testing support that is agnostic of the testing framework in use.
The TestContext framework also places a great deal of importance on <em>convention over
      configuration</em> with reasonable defaults that can be overridden through annotation-based configuration.</p>
</div>
<div class="paragraph">
<p>In addition to generic testing infrastructure, the TestContext framework provides explicit support for JUnit and TestNG in the form of <code>abstract</code> support classes.
For JUnit, Spring also provides a custom JUnit <code class="interface">Runner</code> that allows one to write so-called <em>POJO test classes</em>.
POJO test classes are not required to extend a particular class hierarchy.</p>
</div>
<div class="paragraph">
<p>The following section provides an overview of the internals of the TestContext framework.
If you are only interested in using the framework and not necessarily interested in extending it with your own custom listeners or custom loaders, feel free to go directly to the configuration (<a href="#testcontext-ctx-management">context management</a>, <a href="#testcontext-fixture-di">dependency injection</a>, <a href="#testcontext-tx">transaction management</a>), <a href="#testcontext-support-classes">support classes</a>, and <a href="#integration-testing-annotations">annotation support</a> sections.</p>
</div>
<div class="sect3">
<h4 id="key-abstractions"><a class="anchor" href="#key-abstractions"></a>Key abstractions</h4>
<div class="paragraph">
<p>The core of the framework consists of the <code class="class">TestContext</code> and <code class="class">TestContextManager</code> classes and the <code class="interface">TestExecutionListener</code>, <code class="interface">ContextLoader</code>, and <code class="interface">SmartContextLoader</code> interfaces.
A <code class="class">TestContextManager</code> is created on a per-test basis (e.g., for the execution of a single test method in JUnit).
The <code class="class">TestContextManager</code> in turn manages a <code class="class">TestContext</code> that holds the context of the current test.
The <code class="class">TestContextManager</code> also updates the state of the <code class="class">TestContext</code> as the test progresses and delegates to <code class="interface">TestExecutionListener`s, which instrument the actual test execution by providing dependency injection, managing transactions, and so on.
A [interface]`ContextLoader</code> (or <code class="interface">SmartContextLoader</code>) is responsible for loading an <code class="interface">ApplicationContext</code> for a given test class.
Consult the Javadoc and the Spring test suite for further information and examples of various implementations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="class">TestContext</code>: Encapsulates the context in which a test is executed, agnostic of the actual testing framework in use, and provides context management and caching support for the test instance for which it is responsible.
The <code class="class">TestContext</code> also delegates to a <code class="interface">ContextLoader</code> (or <code class="interface">SmartContextLoader</code>) to load an <code class="interface">ApplicationContext</code> if requested.</p>
</li>
<li>
<p><code class="class">TestContextManager</code>: The main entry point into the <em>Spring TestContext Framework</em>, which manages a single <code class="class">TestContext</code> and signals events to all registered [interface]`TestExecutionListener`s at well-defined test execution points:</p>
</li>
<li>
<p>prior to any <em>before class methods</em> of a particular testing framework</p>
</li>
<li>
<p>test instance preparation</p>
</li>
<li>
<p>prior to any <em>before methods</em> of a particular testing framework</p>
</li>
<li>
<p>after any <em>after methods</em> of a particular testing framework</p>
</li>
<li>
<p>after any <em>after class methods</em> of a particular testing framework</p>
</li>
<li>
<p><code class="interface">TestExecutionListener</code>: Defines a <em>listener</em> API for reacting to test execution events published by the <code class="class">TestContextManager</code> with which the listener is registered.</p>
<div class="paragraph">
<p>Spring provides four <code class="interface">TestExecutionListener</code> implementations that are configured by default: <code class="class">ServletTestExecutionListener</code>, <code class="class">DependencyInjectionTestExecutionListener</code>, <code class="class">DirtiesContextTestExecutionListener</code>, and <code class="class">TransactionalTestExecutionListener</code>.
Respectively, they support Servlet API mocks for a <code class="interface">WebApplicationContext</code>, dependency injection of the test instance, handling of the <code class="interface">@DirtiesContext</code> annotation, and transactional test execution with default rollback semantics.</p>
</div>
</li>
<li>
<p><code class="interface">ContextLoader</code>: Strategy interface introduced in Spring 2.5 for loading an <code class="interface">ApplicationContext</code> for an integration test managed by the Spring TestContext Framework.</p>
<div class="paragraph">
<p>As of Spring 3.1, implement <code class="interface">SmartContextLoader</code> instead of this interface in order to provide support for annotated classes and active bean definition profiles.</p>
</div>
</li>
<li>
<p><code class="interface">SmartContextLoader</code>: Extension of the <code class="interface">ContextLoader</code> interface introduced in Spring 3.1.</p>
<div class="paragraph">
<p>The <code class="interface">SmartContextLoader</code> SPI supersedes the <code class="interface">ContextLoader</code> SPI that was introduced in Spring 2.5.
Specifically, a <code class="interface">SmartContextLoader</code> can choose to process resource , annotated , or context .
Furthermore, a <code class="interface">SmartContextLoader</code> can set active bean definition profiles in the context that it loads.</p>
</div>
<div class="paragraph">
<p>Spring provides the following implementations:</p>
</div>
</li>
<li>
<p><code class="class">DelegatingSmartContextLoader</code>: one of two default loaders which delegates internally to an <code class="class">AnnotationConfigContextLoader</code> or a <code class="class">GenericXmlContextLoader</code> depending either on the configuration declared for the test class or on the presence of default locations or default configuration classes.</p>
</li>
<li>
<p><code class="class">WebDelegatingSmartContextLoader</code>: one of two default loaders which delegates internally to an <code class="class">AnnotationConfigWebContextLoader</code> or a <code class="class">GenericXmlWebContextLoader</code> depending either on the configuration declared for the test class or on the presence of default locations or default configuration classes.
A web <code class="interface">ContextLoader</code> will only be used if <code class="interface">@WebAppConfiguration</code> is present on the test class.</p>
</li>
<li>
<p><code class="class">AnnotationConfigContextLoader</code>: loads a standard <code class="interface">ApplicationContext</code> from <em>annotated classes</em>.</p>
</li>
<li>
<p><code class="class">AnnotationConfigWebContextLoader</code>: loads a <code class="interface">WebApplicationContext</code> from <em>annotated classes</em>.</p>
</li>
<li>
<p><code class="class">GenericXmlContextLoader</code>: loads a standard <code class="interface">ApplicationContext</code> from XML <em>resource locations</em>.</p>
</li>
<li>
<p><code class="class">GenericXmlWebContextLoader</code>: loads a <code class="interface">WebApplicationContext</code> from XML <em>resource locations</em>.</p>
</li>
<li>
<p><code class="class">GenericPropertiesContextLoader</code>: loads a standard <code class="interface">ApplicationContext</code> from Java Properties files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following sections explain how to configure the <code class="class">TestContext</code> framework through annotations and provide working examples of how to write unit and integration tests with the framework.</p>
</div>
</div>
<div class="sect3">
<h4 id="context-management"><a class="anchor" href="#context-management"></a>Context management</h4>
<div class="paragraph">
<p>Each <code class="class">TestContext</code> provides context management and caching support for the test instance it is responsible for.
Test instances do not automatically receive access to the configured <code class="interface">ApplicationContext</code>.
However, if a test class implements the <code class="interface">ApplicationContextAware</code> interface, a reference to the <code class="class">ApplicationContext</code> is supplied to the test instance.
Note that <code class="class">AbstractJUnit4SpringContextTests</code> and <code class="class">AbstractTestNGSpringContextTests</code> implement <code class="interface">ApplicationContextAware</code> and therefore provide access to the <code class="class">ApplicationContext</code> automatically.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">@Autowired ApplicationContext</div>
<div class="paragraph">
<p>As an alternative to implementing the <code class="interface">ApplicationContextAware</code> interface, you can inject the application context for your test class through the <code class="interface">@Autowired</code> annotation on either a field or setter method.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class MyTest {

    @Autowired
    private ApplicationContext applicationContext;

    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if your test is configured to load a <code class="interface">WebApplicationContext</code>, you can inject the web application context into your test as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration
public class MyWebAppTest {

    @Autowired
    private WebApplicationContext wac;

    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dependency injection via <code class="interface">@Autowired</code> is provided by the <code class="class">DependencyInjectionTestExecutionListener</code> which is configured by default (see <a href="#testcontext-fixture-di">[testcontext-fixture-di]</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Test classes that use the TestContext framework do not need to extend any particular class or implement a specific interface to configure their application context.
Instead, configuration is achieved simply by declaring the <code class="interface">@ContextConfiguration</code> annotation at the class level.
If your test class does not explicitly declare application context resource <code>locations</code> or annotated , the configured <code class="interface">ContextLoader</code> determines how to load a context from a default location or default configuration classes.
In addition to context resource  and annotated , an application context can also be configured via application context .</p>
</div>
<div class="paragraph">
<p>The following sections explain how to configure an <code class="interface">ApplicationContext</code> via XML configuration files, annotated classes (typically <code class="interface">@Configuration</code> classes), or context initializers using Spring&#8217;s <code class="interface">@ContextConfiguration</code> annotation.
Alternatively, you can implement and configure your own custom <code class="interface">SmartContextLoader</code> for advanced use cases.</p>
</div>
<div class="sect4">
<h5 id="context-configuration-with-xml-resources"><a class="anchor" href="#context-configuration-with-xml-resources"></a>Context configuration with XML resources</h5>
<div class="paragraph">
<p>To load an <code class="interface">ApplicationContext</code> for your tests using XML configuration files, annotate your test class with <code class="interface">@ContextConfiguration</code> and configure the <code>locations</code> attribute with an array that contains the resource locations of XML configuration metadata.
A plain or relative path&#8201;&#8212;&#8201;for example <code>"context.xml"</code>&#8201;&#8212;&#8201;will be treated as a classpath resource that is relative to the package in which the test class is defined.
A path starting with a slash is treated as an absolute classpath location, for example <code>"/org/example/config.xml"</code>.
A path which represents a resource URL (i.e., a path prefixed with <code>classpath:</code>, <code>file:</code>, <code>http:</code>, etc.) will be used <em>as
          is</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be loaded from "/app-config.xml" and
// "/test-config.xml" in the root of the classpath
@ContextConfiguration(locations={"/app-config.xml", "/test-config.xml"})
public class MyTest {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="interface">@ContextConfiguration</code> supports an alias for the <code>locations</code> attribute through the standard Java <code>value</code> attribute.
Thus, if you do not need to declare additional attributes in <code class="interface">@ContextConfiguration</code>, you can omit the declaration of the <code>locations</code> attribute name and declare the resource locations by using the shorthand format demonstrated in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration({"/app-config.xml", "/test-config.xml"})
public class MyTest {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you omit both the  and  attributes from the <code class="interface">@ContextConfiguration</code> annotation, the TestContext framework will attempt to detect a default XML resource location.
Specifically, <code class="class">GenericXmlContextLoader</code> detects a default location based on the name of the test class.
If your class is named <code>com.example.MyTest</code>, <code class="class">GenericXmlContextLoader</code> loads your application context from <code>"classpath:/com/example/MyTest-context.xml"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.example;

@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be loaded from
// "classpath:/com/example/MyTest-context.xml"
@ContextConfiguration
public class MyTest {
    // class body...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="context-configuration-with-annotated-classes"><a class="anchor" href="#context-configuration-with-annotated-classes"></a>Context configuration with annotated classes</h5>
<div class="paragraph">
<p>To load an <code class="interface">ApplicationContext</code> for your tests using <em>annotated classes</em> (see <a href="#beans-java">[beans-java]</a>), annotate your test class with <code class="interface">@ContextConfiguration</code> and configure the <code>classes</code> attribute with an array that contains references to annotated classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be loaded from AppConfig and TestConfig
@ContextConfiguration(classes = {AppConfig.class, TestConfig.class})
public class MyTest {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you omit the  attribute from the <code class="interface">@ContextConfiguration</code> annotation, the TestContext framework will attempt to detect the presence of default configuration classes.
Specifically, <code class="class">AnnotationConfigContextLoader</code> will detect all static inner classes of the test class that meet the requirements for configuration class implementations as specified in the Javadoc for <code class="interface">@Configuration</code>.
In the following example, the <code class="class">OrderServiceTest</code> class declares a static inner configuration class named <code class="class">Config</code> that will be automatically used to load the <code class="interface">ApplicationContext</code> for the test class.
Note that the name of the configuration class is arbitrary.
In addition, a test class can contain more than one static inner configuration class if desired.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be loaded from the
// static inner Config class
@ContextConfiguration
public class OrderServiceTest {

    @Configuration
    static class Config {

        // this bean will be injected into the OrderServiceTest class
        @Bean
        public OrderService orderService() {
            OrderService orderService = new OrderServiceImpl();
            // set properties, etc.
            return orderService;
        }
    }

    @Autowired
    private OrderService orderService;

    @Test
    public void testOrderService() {
        // test the orderService
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mixing-xml-resources-and-annotated-classes"><a class="anchor" href="#mixing-xml-resources-and-annotated-classes"></a>Mixing XML resources and annotated classes</h5>
<div class="paragraph">
<p>It may sometimes be desirable to mix XML resources and annotated classes (i.e., typically <code class="interface">@Configuration</code> classes) to configure an <code class="interface">ApplicationContext</code> for your tests.
For example, if you use XML configuration in production, you may decide that you want to use <code class="interface">@Configuration</code> classes to configure specific Spring-managed components for your tests, or vice versa.
As mentioned in <a href="#integration-testing-annotations-spring">[integration-testing-annotations-spring]</a> the TestContext framework does not allow you to declare <em>both</em> via <code class="interface">@ContextConfiguration</code>, but this does not mean that you cannot use both.</p>
</div>
<div class="paragraph">
<p>If you want to use XML <em>and</em> <code class="interface">@Configuration</code> classes to configure your tests, you will have to pick one as the <em>entry
          point</em>, and that one will have to include or import the other.
For example, in XML you can include <code class="interface">@Configuration</code> classes via component scanning or define them as normal Spring beans in XML; whereas, in a <code class="interface">@Configuration</code> class you can use <code class="interface">@ImportResource</code> to import XML configuration files.
Note that this behavior is semantically equivalent to how you configure your application in production: in production configuration you will define either a set of XML resource locations or a set of <code class="interface">@Configuration</code> classes that your production <code class="interface">ApplicationContext</code> will be loaded from, but you still have the freedom to include or import the other type of configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="context-configuration-with-context-initializers"><a class="anchor" href="#context-configuration-with-context-initializers"></a>Context configuration with context initializers</h5>
<div class="paragraph">
<p>To configure an <code class="interface">ApplicationContext</code> for your tests using context initializers, annotate your test class with <code class="interface">@ContextConfiguration</code> and configure the <code>initializers</code> attribute with an array that contains references to classes that implement <code class="interface">ApplicationContextInitializer</code>.
The declared context initializers will then be used to initialize the <code class="interface">ConfigurableApplicationContext</code> that is loaded for your tests.
Note that the concrete <code class="interface">ConfigurableApplicationContext</code> type supported by each declared initializer must be compatible with the type of <code class="interface">ApplicationContext</code> created by the <code class="interface">SmartContextLoader</code> in use (i.e., typically a <code class="class">GenericApplicationContext</code>).
Furthermore, the order in which the initializers are invoked depends on whether they implement Spring&#8217;s <code class="interface">Ordered</code> interface or are annotated with Spring&#8217;s <code class="interface">@Order</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be loaded from TestConfig
// and initialized by TestAppCtxInitializer
@ContextConfiguration(
    classes = TestConfig.class,
    initializers = TestAppCtxInitializer.class)
public class MyTest {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to omit the declaration of XML configuration files or annotated classes in <code class="interface">@ContextConfiguration</code> entirely and instead declare only <code class="interface">ApplicationContextInitializer</code> classes which are then responsible for registering beans in the context&#8201;&#8212;&#8201;for example, by programmatically loading bean definitions from XML files or configuration classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be initialized by EntireAppInitializer
// which presumably registers beans in the context
@ContextConfiguration(initializers = EntireAppInitializer.class)
public class MyTest {
    // class body...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="context-configuration-inheritance"><a class="anchor" href="#context-configuration-inheritance"></a>Context configuration inheritance</h5>
<div class="paragraph">
<p><code class="interface">@ContextConfiguration</code> supports boolean  and  attributes that denote whether resource locations or annotated classes and context initializers declared by superclasses should be <em>inherited</em>.
The default value for both flags is <code>true</code>.
This means that a test class inherits the resource locations or annotated classes as well as the context initializers declared by any superclasses.
Specifically, the resource locations or annotated classes for a test class are appended to the list of resource locations or annotated classes declared by superclasses.
Similarly, the initializers for a given test class will be added to the set of initializers defined by test superclasses.
Thus, subclasses have the option of <em>extending</em> the resource locations, annotated classes, or context initializers.</p>
</div>
<div class="paragraph">
<p>If <code class="interface">@ContextConfiguration</code>'s <code>inheritLocations</code> or  attribute is set to <code>false</code>, the resource locations or annotated classes and the context initializers, respectively, for the test class <em>shadow</em> and effectively replace the configuration defined by superclasses.</p>
</div>
<div class="paragraph">
<p>In the following example that uses XML resource locations, the <code class="interface">ApplicationContext</code> for <code class="class">ExtendedTest</code> will be loaded from <em>"base-config.xml"</em> <em>and</em> <em>"extended-config.xml"</em>, in that order.
Beans defined in <em>"extended-config.xml"</em> may therefore <em>override</em> (i.e., replace) those defined in <em>"base-config.xml"</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be loaded from "/base-config.xml"
// in the root of the classpath
@ContextConfiguration("/base-config.xml")
public class BaseTest {
    // class body...
}

// ApplicationContext will be loaded from "/base-config.xml" and
// "/extended-config.xml" in the root of the classpath
@ContextConfiguration("/extended-config.xml")
public class ExtendedTest extends BaseTest {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, in the following example that uses annotated classes, the <code class="interface">ApplicationContext</code> for <code class="class">ExtendedTest</code> will be loaded from the <code class="class">BaseConfig</code> <em>and</em> <code class="class">ExtendedConfig</code> classes, in that order.
Beans defined in <code class="class">ExtendedConfig</code> may therefore override (i.e., replace) those defined in <code class="class">BaseConfig</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be loaded from BaseConfig
@ContextConfiguration(classes = BaseConfig.class)
public class BaseTest {
    // class body...
}

// ApplicationContext will be loaded from BaseConfig and ExtendedConfig
@ContextConfiguration(classes = ExtendedConfig.class)
public class ExtendedTest extends BaseTest {
    // class body...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following example that uses context initializers, the <code class="interface">ApplicationContext</code> for <code class="class">ExtendedTest</code> will be initialized using <code class="class">BaseInitializer</code> <em>and</em> <code class="class">ExtendedInitializer</code>.
Note, however, that the order in which the initializers are invoked depends on whether they implement Spring&#8217;s <code class="interface">Ordered</code> interface or are annotated with Spring&#8217;s <code class="interface">@Order</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be initialized by BaseInitializer
@ContextConfiguration(initializers=BaseInitializer.class)
public class BaseTest {
    // class body...
}

// ApplicationContext will be initialized by BaseInitializer
// and ExtendedInitializer
@ContextConfiguration(initializers=ExtendedInitializer.class)
public class ExtendedTest extends BaseTest {
    // class body...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="context-configuration-with-environment-profiles"><a class="anchor" href="#context-configuration-with-environment-profiles"></a>Context configuration with environment profiles</h5>
<div class="paragraph">
<p>Spring 3.1 introduced first-class support in the framework for the notion of environments and profiles (a.k.a., <em>bean
          definition profiles</em>), and integration tests can be configured to activate particular bean definition profiles for various testing scenarios.
This is achieved by annotating a test class with the <code class="interface">@ActiveProfiles</code> annotation and supplying a list of profiles that should be activated when loading the <code class="interface">ApplicationContext</code> for the test.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code class="interface">@ActiveProfiles</code> may be used with any implementation of the new <code class="interface">SmartContextLoader</code> SPI, but <code class="interface">@ActiveProfiles</code> is not supported with implementations of the older <code class="interface">ContextLoader</code> SPI.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at some examples with XML configuration and <code class="interface">@Configuration</code> classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- app-config.xml --&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:jdbc="http://www.springframework.org/schema/jdbc"
    xmlns:jee="http://www.springframework.org/schema/jee"
    xsi:schemaLocation="..."&gt;

    &lt;bean id="transferService"
        class="com.bank.service.internal.DefaultTransferService"&gt;
        &lt;constructor-arg ref="accountRepository"/&gt;
        &lt;constructor-arg ref="feePolicy"/&gt;
    &lt;/bean&gt;

    &lt;bean id="accountRepository"
        class="com.bank.repository.internal.JdbcAccountRepository"&gt;
        &lt;constructor-arg ref="dataSource"/&gt;
    &lt;/bean&gt;

    &lt;bean id="feePolicy"
        class="com.bank.service.internal.ZeroFeePolicy"/&gt;

    &lt;beans profile="dev"&gt;
        &lt;jdbc:embedded-database id="dataSource"&gt;
            &lt;jdbc:script
                location="classpath:com/bank/config/sql/schema.sql"/&gt;
            &lt;jdbc:script
                location="classpath:com/bank/config/sql/test-data.sql"/&gt;
        &lt;/jdbc:embedded-database&gt;
    &lt;/beans&gt;

    &lt;beans profile="production"&gt;
        &lt;jee:jndi-lookup id="dataSource"
            jndi-name="java:comp/env/jdbc/datasource"/&gt;
    &lt;/beans&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.bank.service;

@RunWith(SpringJUnit4ClassRunner.class)
// ApplicationContext will be loaded from "classpath:/app-config.xml"
@ContextConfiguration("/app-config.xml")
@ActiveProfiles("dev")
public class TransferServiceTest {

   @Autowired
   private TransferService transferService;

   @Test
   public void testTransferService() {
       // test the transferService
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code class="class">TransferServiceTest</code> is run, its <code class="interface">ApplicationContext</code> will be loaded from the <code class="file">app-config.xml</code> configuration file in the root of the classpath.
If you inspect <code class="file">app-config.xml</code> you&#8217;ll notice that the  bean has a dependency on a  bean; however,  is not defined as a top-level bean.
Instead,  is defined twice: once in the <em>production</em> profile and once in the <em>dev</em> profile.</p>
</div>
<div class="paragraph">
<p>By annotating <code class="class">TransferServiceTest</code> with <code class="interface">@ActiveProfiles("dev")</code> we instruct the Spring TestContext Framework to load the <code class="interface">ApplicationContext</code> with the active profiles set to <code>{"dev"}</code>.
As a result, an embedded database will be created, and the  bean will be wired with a reference to the development <code class="interface">DataSource</code>.
And that&#8217;s likely what we want in an integration test.</p>
</div>
<div class="paragraph">
<p>The following code listings demonstrate how to implement the same configuration and integration test but using <code class="interface">@Configuration</code> classes instead of XML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@Profile("dev")
public class StandaloneDataConfig {

    @Bean
    public DataSource dataSource() {
        return new EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript("classpath:com/bank/config/sql/schema.sql")
            .addScript("classpath:com/bank/config/sql/test-data.sql")
            .build();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@Profile("production")
public class JndiDataConfig {

    @Bean
    public DataSource dataSource() throws Exception {
        Context ctx = new InitialContext();
        return (DataSource) ctx.lookup("java:comp/env/jdbc/datasource");
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
public class TransferServiceConfig {

    @Autowired DataSource dataSource;

    @Bean
    public TransferService transferService() {
        return new DefaultTransferService(accountRepository(),
            feePolicy());
    }

    @Bean
    public AccountRepository accountRepository() {
        return new JdbcAccountRepository(dataSource);
    }

    @Bean
    public FeePolicy feePolicy() {
        return new ZeroFeePolicy();
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.bank.service;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
   classes = {
       TransferServiceConfig.class,
       StandaloneDataConfig.class,
       JndiDataConfig.class})
@ActiveProfiles("dev")
public class TransferServiceTest {

   @Autowired
   private TransferService transferService;

   @Test
   public void testTransferService() {
      // test the transferService
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this variation, we have split the XML configuration into three independent <code class="interface">@Configuration</code> classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="class">TransferServiceConfig</code>: acquires a  via dependency injection using <code class="interface">@Autowired</code></p>
</li>
<li>
<p><code class="class">StandaloneDataConfig</code>: defines a  for an embedded database suitable for developer tests</p>
</li>
<li>
<p><code class="class">JndiDataConfig</code>: defines a  that is retrieved from JNDI in a production environment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As with the XML-based configuration example, we still annotate <code class="class">TransferServiceTest</code> with <code class="interface">@ActiveProfiles("dev")</code>, but this time we specify all three configuration classes via the [interface]`@ContextConfiguration `annotation.
The body of the test class itself remains completely unchanged.</p>
</div>
<div class="paragraph">
<p>It is often the case that a single set of profiles is used across multiple test classes within a given project.
Thus, to avoid duplicate declarations of the <code class="interface">@ActiveProfiles</code> annotation it is possible to declare <code class="interface">@ActiveProfiles</code> once on a base class, and subclasses will automatically inherit the <code class="interface">@ActiveProfiles</code> configuration from the base class.
In the following example, the declaration of <code class="interface">@ActiveProfiles</code> (as well as other annotations) has been moved to an abstract superclass, <code class="class">AbstractIntegrationTest</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.bank.service;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
    classes = {
        TransferServiceConfig.class,
        StandaloneDataConfig.class,
        JndiDataConfig.class})
@ActiveProfiles("dev")
public abstract class AbstractIntegrationTest {
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.bank.service;

// "dev" profile inherited from superclass
public class TransferServiceTest extends AbstractIntegrationTest {

   @Autowired
   private TransferService transferService;

   @Test
   public void testTransferService() {
      // test the transferService
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="interface">@ActiveProfiles</code> also supports an <code class="method">inheritProfiles</code> attribute that can be used to disable the inheritance of active profiles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.bank.service;

// "dev" profile overridden with "production"
@ActiveProfiles(profiles = "production", inheritProfiles = false)
public class ProductionTransferServiceTest extends AbstractIntegrationTest {
    // test body
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Furthermore, it is sometimes necessary to resolve active profiles for tests <em>programmatically</em> instead of declaratively&#8201;&#8212;&#8201;for example, based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the current operating system</p>
</li>
<li>
<p>whether tests are being executed on a continuous integration build server</p>
</li>
<li>
<p>the presence of certain environment variables</p>
</li>
<li>
<p>the presence of custom class-level annotations</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To resolve active bean definition profiles programmatically, simply implement a custom <code class="interface">ActiveProfilesResolver</code> and register it via the  attribute of <code class="interface">@ActiveProfiles</code>.
The following example demonstrates how to implement and register a custom <code class="class">OperatingSystemActiveProfilesResolver</code>.
For further information, refer to the respective Javadoc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.bank.service;

// "dev" profile overridden programmatically via a custom resolver
@ActiveProfiles(
    resolver = OperatingSystemActiveProfilesResolver.class,
    inheritProfiles = false)
public class TransferServiceTest extends AbstractIntegrationTest {
    // test body
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.bank.service.test;

public class OperatingSystemActiveProfilesResolver implements ActiveProfilesResolver {

    @Override
    String[] resolve(Class&lt;?&gt; testClass) {
        String profile = ...;
        // determine the value of profile based on the operating system
        return new String[] {profile};
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="loading-a-webapplicationcontext"><a class="anchor" href="#loading-a-webapplicationcontext"></a>Loading a WebApplicationContext</h5>
<div class="paragraph">
<p>Spring 3.2 introduces support for loading a <code class="interface">WebApplicationContext</code> in integration tests.
To instruct the TestContext framework to load a <code class="interface">WebApplicationContext</code> instead of a standard <code class="interface">ApplicationContext</code>, simply annotate the respective test class with <code class="interface">@WebAppConfiguration</code>.</p>
</div>
<div class="paragraph">
<p>The presence of <code class="interface">@WebAppConfiguration</code> on your test class instructs the TestContext framework (TCF) that a <code class="interface">WebApplicationContext</code> (WAC) should be loaded for your integration tests.
In the background the TCF makes sure that a <code class="interface">MockServletContext</code> is created and supplied to your test&#8217;s WAC. By default the base resource path for your <code class="interface">MockServletContext</code> will be set to <em>"src/main/webapp"</em>.
This is interpreted as a path relative to the root of your JVM (i.e., normally the path to your project).
If you&#8217;re familiar with the directory structure of a web application in a Maven project, you&#8217;ll know that <em>"src/main/webapp"</em> is the default location for the root of your WAR. If you need to override this default, simply provide an alternate path to the <code class="interface">@WebAppConfiguration</code> annotation (e.g., <code class="interface">@WebAppConfiguration("src/test/webapp")</code>).
If you wish to reference a base resource path from the classpath instead of the file system, just use Spring&#8217;s <em>classpath:</em> prefix.</p>
</div>
<div class="paragraph">
<p>Please note that Spring&#8217;s testing support for <code class="interface">WebApplicationContexts</code> is on par with its support for standard <code class="interface">ApplicationContexts</code>.
When testing with a <code class="interface">WebApplicationContext</code> you are free to declare either XML configuration files or <code class="interface">@Configuration</code> classes via <code class="interface">@ContextConfiguration</code>.
You are of course also free to use any other test annotations such as <code class="interface">@TestExecutionListeners</code>, <code class="interface">@TransactionConfiguration</code>, <code class="interface">@ActiveProfiles</code>, etc.</p>
</div>
<div class="paragraph">
<p>The following examples demonstrate some of the various configuration options for loading a <code class="interface">WebApplicationContext</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Conventions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)

// defaults to "file:src/main/webapp"
@WebAppConfiguration

// detects "WacTests-context.xml" in same package
// or static nested @Configuration class
@ContextConfiguration

public class WacTests {
    //...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example demonstrates the TestContext framework&#8217;s support for <em>convention over configuration</em>.
If you annotate a test class with <code class="interface">@WebAppConfiguration</code> without specifying a resource base path, the resource path will effectively default to <em>"file:src/main/webapp"</em>.
Similarly, if you declare <code class="interface">@ContextConfiguration</code> without specifying resource <code class="interface">locations</code>, annotated <code class="interface">classes</code>, or context <code class="interface">initializers</code>, Spring will attempt to detect the presence of your configuration using conventions (i.e., <em>"WacTests-context.xml"</em> in the same package as the <code class="interface">WacTests</code> class or static nested <code class="interface">@Configuration</code> classes).</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Default resource semantics</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)

// file system resource
@WebAppConfiguration("webapp")

// classpath resource
@ContextConfiguration("/spring/test-servlet-config.xml")

public class WacTests {
    //...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example demonstrates how to explicitly declare a resource base path with <code class="interface">@WebAppConfiguration</code> and an XML resource location with <code class="interface">@ContextConfiguration</code>.
The important thing to note here is the different semantics for paths with these two annotations.
By default, <code class="interface">@WebAppConfiguration</code> resource paths are file system based; whereas, <code class="interface">@ContextConfiguration</code> resource locations are classpath based.</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Explicit resource semantics</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)

// classpath resource
@WebAppConfiguration("classpath:test-web-resources")

// file system resource
@ContextConfiguration("file:src/main/webapp/WEB-INF/servlet-config.xml")

public class WacTests {
    //...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this third example, we see that we can override the default resource semantics for both annotations by specifying a Spring resource prefix.
Contrast the comments in this example with the previous example.</p>
</div>
<div class="sect5">
<h6 id="working-with-web-mocks"><a class="anchor" href="#working-with-web-mocks"></a>Working with Web Mocks</h6>
<div class="paragraph">
<p>To provide comprehensive web testing support, Spring 3.2 introduces a new <code class="interface">ServletTestExecutionListener</code> that is enabled by default.
When testing against a <code class="interface">WebApplicationContext</code> this <a href="#testcontext-key-abstractions">TestExecutionListener</a> sets up default thread-local state via Spring Web&#8217;s <code class="interface">RequestContextHolder</code> before each test method and creates a <code class="interface">MockHttpServletRequest</code>, <code class="interface">MockHttpServletResponse</code>, and <code class="interface">ServletWebRequest</code> based on the base resource path configured via <code class="interface">@WebAppConfiguration</code>.
<code class="interface">ServletTestExecutionListener</code> also ensures that the <code class="interface">MockHttpServletResponse</code> and <code class="interface">ServletWebRequest</code> can be injected into the test instance, and once the test is complete it cleans up thread-local state.</p>
</div>
<div class="paragraph">
<p>Once you have a <code class="interface">WebApplicationContext</code> loaded for your test you might find that you need to interact with the web mocks&#8201;&#8212;&#8201;for example, to set up your test fixture or to perform assertions after invoking your web component.
The following example demonstrates which mocks can be autowired into your test instance.
Note that the <code class="interface">WebApplicationContext</code> and <code class="interface">MockServletContext</code> are both cached across the test suite; whereas, the other mocks are managed per test method by the <code class="interface">ServletTestExecutionListener</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Injecting mocks</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@WebAppConfiguration
@ContextConfiguration
public class WacTests {

    @Autowired WebApplicationContext wac; // cached

    @Autowired MockServletContext servletContext; // cached

    @Autowired MockHttpSession session;

    @Autowired MockHttpServletRequest request;

    @Autowired MockHttpServletResponse response;

    @Autowired ServletWebRequest webRequest;

    //...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="context-caching"><a class="anchor" href="#context-caching"></a>Context caching</h5>
<div class="paragraph">
<p>Once the TestContext framework loads an <code class="interface">ApplicationContext</code> (or <code class="interface">WebApplicationContext</code>) for a test, that context will be cached and reused for <em>all</em> subsequent tests that declare the same unique context configuration within the same test suite.
To understand how caching works, it is important to understand what is meant by <em>unique</em> and <em>test
          suite</em>.</p>
</div>
<div class="paragraph">
<p>An <code class="interface">ApplicationContext</code> can be <em>uniquely</em> identified by the combination of configuration parameters that are used to load it.
Consequently, the unique combination of configuration parameters are used to generate a <em>key</em> under which the context is cached.
The TestContext framework uses the following configuration parameters to build the context cache key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>(from
@ContextConfiguration)</em></p>
</li>
<li>
<p><em>(from
@ContextConfiguration)</em></p>
</li>
<li>
<p><em>(from
@ContextConfiguration)</em></p>
</li>
<li>
<p><em>(from
@ContextConfiguration)</em></p>
</li>
<li>
<p><em>(from
@ActiveProfiles)</em></p>
</li>
<li>
<p><em>(from
@WebAppConfiguration)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if <code class="class">TestClassA</code> specifies <code>{"app-config.xml", "test-config.xml"}</code> for the  (or ) attribute of <code class="interface">@ContextConfiguration</code>, the TestContext framework will load the corresponding <code class="interface">ApplicationContext</code> and store it in a  context cache under a key that is based solely on those locations.
So if <code class="class">TestClassB</code> also defines <code>{"app-config.xml", "test-config.xml"}</code> for its locations (either explicitly or implicitly through inheritance) but does not define <code class="interface">@WebAppConfiguration</code>, a different <code class="interface">ContextLoader</code>, different active profiles, or different context initializers, then the same <code class="interface">ApplicationContext</code> will be shared by both test classes.
This means that the setup cost for loading an application context is incurred only once (per test suite), and subsequent test execution is much faster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Test suites and forked processes</div>
<div class="paragraph">
<p>The Spring TestContext framework stores application contexts in a <em>static</em> cache.
This means that the context is literally stored in a  variable.
In other words, if tests execute in separate processes the static cache will be cleared between each test execution, and this will effectively disable the caching mechanism.</p>
</div>
<div class="paragraph">
<p>To benefit from the caching mechanism, all tests must run within the same process or test suite.
This can be achieved by executing all tests as a group within an IDE. Similarly, when executing tests with a build framework such as Ant, Maven, or Gradle it is important to make sure that the build framework does not <em>fork</em> between tests.
For example, if the &lt;&lt;,forkMode&gt;&gt; for the Maven Surefire plug-in is set to <code>always</code> or <code>pertest</code>, the TestContext framework will not be able to cache application contexts between test classes and the build process will run significantly slower as a result.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the unlikely case that a test corrupts the application context and requires reloading&#8201;&#8212;&#8201;for example, by modifying a bean definition or the state of an application object&#8201;&#8212;&#8201;you can annotate your test class or test method with <code class="interface">@DirtiesContext</code> (see the discussion of <code class="interface">@DirtiesContext</code> in <a href="#integration-testing-annotations-spring">[integration-testing-annotations-spring]</a>).
This instructs Spring to remove the context from the cache and rebuild the application context before executing the next test.
Note that support for the <code class="interface">@DirtiesContext</code> annotation is provided by the <code class="class">DirtiesContextTestExecutionListener</code> which is enabled by default.</p>
</div>
</div>
<div class="sect4">
<h5 id="context-hierarchies"><a class="anchor" href="#context-hierarchies"></a>Context hierarchies</h5>
<div class="paragraph">
<p>When writing integration tests that rely on a loaded Spring <code class="interface">ApplicationContext</code>, it is often sufficient to test against a single context; however, there are times when it is beneficial or even necessary to test against a hierarchy of <code class="interface">ApplicationContext`s.
For example, if you are developing a Spring MVC web application you will typically have a root [interface]`WebApplicationContext</code> loaded via Spring&#8217;s <code class="class">ContextLoaderListener</code> and a child <code class="interface">WebApplicationContext</code> loaded via Spring&#8217;s <code class="class">DispatcherServlet</code>.
This results in a parent-child context hierarchy where shared components and infrastructure configuration are declared in the root context and consumed in the child context by web-specific components.
Another use case can be found in Spring Batch applications where you often have a parent context that provides configuration for shared batch infrastructure and a child context for the configuration of a specific batch job.</p>
</div>
<div class="paragraph">
<p>As of Spring Framework 3.2.2, it is possible to write integration tests that use context hierarchies by declaring context configuration via the <code class="interface">@ContextHierarchy</code> annotation, either on an individual test class or within a test class hierarchy.
If a context hierarchy is declared on multiple classes within a test class hierarchy it is also possible to merge or override the context configuration for a specific, named level in the context hierarchy.
When merging configuration for a given level in the hierarchy the configuration resource type (i.e., XML configuration files or annotated classes) must be consistent; otherwise, it is perfectly acceptable to have different levels in a context hierarchy configured using different resource types.</p>
</div>
<div class="paragraph">
<p>The following JUnit-based examples demonstrate common configuration scenarios for integration tests that require the use of context hierarchies.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Single test class with context hierarchy</div>
<div class="content">
<div class="paragraph">
<p><code class="class">ControllerIntegrationTests</code> represents a typical integration testing scenario for a Spring MVC web application by declaring a context hierarchy consisting of two levels, one for the <em>root</em> WebApplicationContext (loaded using the <code class="class">TestAppConfig</code> <code class="interface">@Configuration</code> class) and one for the <em>dispatcher servlet</em> <code class="interface">WebApplicationContext</code> (loaded using the <code class="class">WebConfig</code> <code class="interface">@Configuration</code> class).
The <code class="interface">WebApplicationContext</code> that is <em>autowired</em> into the test instance is the one for the child context (i.e., the lowest context in the hierarchy).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextHierarchy({
    @ContextConfiguration(classes = TestAppConfig.class),
    @ContextConfiguration(classes = WebConfig.class)
})
public class ControllerIntegrationTests {

    @Autowired
    private WebApplicationContext wac;

    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 6. Class hierarchy with implicit parent context</div>
<div class="content">
<div class="paragraph">
<p>The following test classes define a context hierarchy within a test class hierarchy.
<code class="class">AbstractWebTests</code> declares the configuration for a root <code class="interface">WebApplicationContext</code> in a Spring-powered web application.
Note, however, that <code class="class">AbstractWebTests</code> does not declare <code class="interface">@ContextHierarchy</code>; consequently, subclasses of <code class="class">AbstractWebTests</code> can optionally participate in a context hierarchy or simply follow the standard semantics for <code class="interface">@ContextConfiguration</code>.
<code class="class">SoapWebServiceTests</code> and <code class="class">RestWebServiceTests</code> both extend <code class="class">AbstractWebTests</code> and define a context hierarchy via <code class="interface">@ContextHierarchy</code>.
The result is that three application contexts will be loaded (one for each declaration of <code class="interface">@ContextConfiguration</code>), and the application context loaded based on the configuration in <code class="class">AbstractWebTests</code> will be set as the parent context for each of the contexts loaded for the concrete subclasses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration("file:src/main/webapp/WEB-INF/applicationContext.xml")
public abstract class AbstractWebTests {}

@ContextHierarchy(@ContextConfiguration("/spring/soap-ws-config.xml")
public class SoapWebServiceTests extends AbstractWebTests {}

@ContextHierarchy(@ContextConfiguration("/spring/rest-ws-config.xml")
public class RestWebServiceTests extends AbstractWebTests {}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 7. Class hierarchy with merged context hierarchy configuration</div>
<div class="content">
<div class="paragraph">
<p>The following classes demonstrate the use of <em>named</em> hierarchy levels in order to <em>merge</em> the configuration for specific levels in a context hierarchy.
<code class="class">BaseTests</code> defines two levels in the hierarchy, <code>parent</code> and <code>child</code>.
<code class="class">ExtendedTests</code> extends <code class="class">BaseTests</code> and instructs the Spring TestContext Framework to merge the context configuration for the <code>child</code> hierarchy level, simply by ensuring that the names declared via <code class="interface">ContextConfiguration</code>'s  attribute are both <code>"child"</code>.
The result is that three application contexts will be loaded: one for <code>"/app-config.xml"</code>, one for <code>"/user-config.xml"</code>, and one for <code>{"/user-config.xml", "/order-config.xml"}</code>.
As with the previous example, the application context loaded from <code>"/app-config.xml"</code> will be set as the parent context for the contexts loaded from <code>"/user-config.xml"</code> and <code>{"/user-config.xml", "/order-config.xml"}</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextHierarchy({
    @ContextConfiguration(name = "parent", locations = "/app-config.xml"),
    @ContextConfiguration(name = "child",  locations = "/user-config.xml")
})
public class BaseTests {}

@ContextHierarchy(
    @ContextConfiguration(name = "child",  locations = "/order-config.xml")
)
public class ExtendedTests extends BaseTests {}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 8. Class hierarchy with overridden context hierarchy configuration</div>
<div class="content">
<div class="paragraph">
<p>In contrast to the previous example, this example demonstrates how to <em>override</em> the configuration for a given named level in a context hierarchy by setting <code class="interface">ContextConfiguration</code>'s  flag to <code>false</code>.
Consequently, the application context for <code class="class">ExtendedTests</code> will be loaded only from <code>"/test-user-config.xml"</code> and will have its parent set to the context loaded from <code>"/app-config.xml"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextHierarchy({
    @ContextConfiguration(name = "parent", locations = "/app-config.xml"),
    @ContextConfiguration(name = "child",  locations = "/user-config.xml")
})
public class BaseTests {}

@ContextHierarchy(
    @ContextConfiguration(
        name = "child",
        locations = "/test-user-config.xml",
        inheritLocations = false
))
public class ExtendedTests extends BaseTests {}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Dirtying a context within a context hierarchy</div>
<div class="paragraph">
<p>If <code class="interface">@DirtiesContext</code> is used in a test whose context is configured as part of a context hierarchy, the  flag can be used to control how the context cache is cleared.
For further details consult the discussion of <code class="interface">@DirtiesContext</code> in <a href="#integration-testing-annotations-spring">[integration-testing-annotations-spring]</a> and the Javadoc for <code class="interface">@DirtiesContext</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dependency-injection-of-test-fixtures-2"><a class="anchor" href="#dependency-injection-of-test-fixtures-2"></a>Dependency injection of test fixtures</h4>
<div class="paragraph">
<p>When you use the <code class="class">DependencyInjectionTestExecutionListener</code>&#8201;&#8212;&#8201;which is configured by default&#8201;&#8212;&#8201;the dependencies of your test instances are <em>injected</em> from beans in the application context that you configured with <code class="interface">@ContextConfiguration</code>.
You may use setter injection, field injection, or both, depending on which annotations you choose and whether you place them on setter methods or fields.
For consistency with the annotation support introduced in Spring 2.5 and 3.0, you can use Spring&#8217;s <code class="interface">@Autowired</code> annotation or the <code class="interface">@Inject</code> annotation from JSR 300.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
The TestContext framework does not instrument the manner in which a test instance is instantiated.
Thus the use of <code class="interface">@Autowired</code> or <code class="interface">@Inject</code> for constructors has no effect for test classes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because <code class="interface">@Autowired</code> is used to perform <a href="#beans-factory-autowire"><em>autowiring by
        type</em></a>, if you have multiple bean definitions of the same type, you cannot rely on this approach for those particular beans.
In that case, you can use <code class="interface">@Autowired</code> in conjunction with <code class="interface">@Qualifier</code>.
As of Spring 3.0 you may also choose to use <code class="interface">@Inject</code> in conjunction with <code class="interface">@Named</code>.
Alternatively, if your test class has access to its <code class="class">ApplicationContext</code>, you can perform an explicit lookup by using (for example) a call to <code class="method">applicationContext.getBean("titleRepository")</code>.</p>
</div>
<div class="paragraph">
<p>If you do not want dependency injection applied to your test instances, simply do not annotate fields or setter methods with <code class="interface">@Autowired</code> or <code class="interface">@Inject</code>.
Alternatively, you can disable dependency injection altogether by explicitly configuring your class with <code class="interface">@TestExecutionListeners</code> and omitting <code>DependencyInjectionTestExecutionListener.class</code> from the list of listeners.</p>
</div>
<div class="paragraph">
<p>Consider the scenario of testing a <code class="class">HibernateTitleRepository</code> class, as outlined in the <a href="#integration-testing-goals">Goals</a> section.
The next two code listings demonstrate the use of <code class="interface">@Autowired</code> on fields and setter methods.
The application context configuration is presented after all sample code listings.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The dependency injection behavior in the following code listings is not specific to JUnit.
The same DI techniques can be used in conjunction with any testing framework.</p>
</div>
<div class="paragraph">
<p>The following examples make calls to static assertion methods such as <code>assertNotNull()</code> but without prepending the call with <code>Assert</code>.
In such cases, assume that the method was properly imported through an <code>import
          static</code> declaration that is not shown in the example.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first code listing shows a JUnit-based implementation of the test class that uses <code class="interface">@Autowired</code> for field injection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// specifies the Spring configuration to load for this test fixture
@ContextConfiguration("repository-config.xml")
public class HibernateTitleRepositoryTests {

    // this instance will be dependency injected by type
    @Autowired
    private HibernateTitleRepository titleRepository;

    @Test
    public void findById() {
        Title title = titleRepository.findById(new Long(10));
        assertNotNull(title);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can configure the class to use <code class="interface">@Autowired</code> for setter injection as seen below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
// specifies the Spring configuration to load for this test fixture
@ContextConfiguration("repository-config.xml")
public class HibernateTitleRepositoryTests {

    // this instance will be dependency injected by type
    private HibernateTitleRepository titleRepository;

    @Autowired
    public void setTitleRepository(HibernateTitleRepository titleRepository) {
        this.titleRepository = titleRepository;
    }

    @Test
    public void findById() {
        Title title = titleRepository.findById(new Long(10));
        assertNotNull(title);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding code listings use the same XML context file referenced by the <code class="interface">@ContextConfiguration</code> annotation (that is, <code>repository-config.xml</code>), which looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;!-- this bean will be injected into the HibernateTitleRepositoryTests class --&gt;
    &lt;bean id="titleRepository" class="com.foo.repository.hibernate.HibernateTitleRepository"&gt;
        &lt;property name="sessionFactory" ref="sessionFactory"/&gt;
    &lt;/bean&gt;

    &lt;bean id="sessionFactory"
            class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
        &lt;!-- configuration elided for brevity --&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are extending from a Spring-provided test base class that happens to use <code class="interface">@Autowired</code> on one of its setter methods, you might have multiple beans of the affected type defined in your application context: for example, multiple <code class="interface">DataSource</code> beans.
In such a case, you can override the setter method and use the <code class="interface">@Qualifier</code> annotation to indicate a specific target bean as follows, but make sure to delegate to the overridden method in the superclass as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// ...

    @Autowired
    @Override
    public void setDataSource(@Qualifier("myDataSource") DataSource dataSource) {
        super.setDataSource(dataSource);
    }

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The specified qualifier value indicates the specific <code class="interface">DataSource</code> bean to inject, narrowing the set of type matches to a specific bean.
Its value is matched against <code>&lt;qualifier&gt;</code> declarations within the corresponding <code>&lt;bean&gt;</code> definitions.
The bean name is used as a fallback qualifier value, so you may effectively also point to a specific bean by name there (as shown above, assuming that "myDataSource" is the bean id).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="testing-request-and-session-scoped-beans"><a class="anchor" href="#testing-request-and-session-scoped-beans"></a>Testing request and session scoped beans</h4>
<div class="paragraph">
<p><a href="#beans-factory-scopes-other">Request and session
        scoped beans</a> have been supported by Spring for several years now, but it&#8217;s always been a bit non-trivial to test them.
As of Spring 3.2 it&#8217;s now a breeze to test your request-scoped and session-scoped beans by following these steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that a <code class="interface">WebApplicationContext</code> is loaded for your test by annotating your test class with <code class="interface">@WebAppConfiguration</code>.</p>
</li>
<li>
<p>Inject the mock request or session into your test instance and prepare your test fixture as appropriate.</p>
</li>
<li>
<p>Invoke your web component that you retrieved from the configured <code class="interface">WebApplicationContext</code> (i.e., via dependency injection).</p>
</li>
<li>
<p>Perform assertions against the mocks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code snippet displays the XML configuration for a login use case.
Note that the <code>userService</code> bean has a dependency on a request-scoped <code>loginAction</code> bean.
Also, the <code class="class">LoginAction</code> is instantiated using <a href="#expressions">SpEL expressions</a> that retrieve the username and password from the current HTTP request.
In our test, we will want to configure these request parameters via the mock managed by the TestContext framework.</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Request-scoped bean configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="userService"
      class="com.example.SimpleUserService"
      c:loginAction-ref="loginAction" /&gt;

  &lt;bean id="loginAction" class="com.example.LoginAction"
      c:username="#{request.getParameter('user')}"
      c:password="#{request.getParameter('pswd')}"
      scope="request"&gt;
    &lt;aop:scoped-proxy /&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In <code class="class">RequestScopedBeanTests</code> we inject both the <code class="class">UserService</code> (i.e., the subject under test) and the <code class="class">MockHttpServletRequest</code> into our test instance.
Within our  test method we set up our test fixture by setting request parameters in the provided <code class="class">MockHttpServletRequest</code>.
When the  method is invoked on our <code>userService</code> we are assured that the user service has access to the request-scoped <code>loginAction</code> for the current <code class="class">MockHttpServletRequest</code> (i.e., the one we just set parameters in).
We can then perform assertions against the results based on the known inputs for the username and password.</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. Request-scoped bean test</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
@WebAppConfiguration
public class RequestScopedBeanTests {

    @Autowired UserService userService;
    @Autowired MockHttpServletRequest request;

    @Test
    public void requestScope() {

        request.setParameter("user", "enigma");
        request.setParameter("pswd", "$pr!ng");

        LoginResults results = userService.loginUser();

        // assert results
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following code snippet is similar to the one we saw above for a request-scoped bean; however, this time the <code>userService</code> bean has a dependency on a session-scoped <code>userPreferences</code> bean.
Note that the <code class="class">UserPreferences</code> bean is instantiated using a SpEL expression that retrieves the <em>theme</em> from the current HTTP session.
In our test, we will need to configure a theme in the mock session managed by the TestContext framework.</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. Session-scoped bean configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="userService"
      class="com.example.SimpleUserService"
      c:userPreferences-ref="userPreferences" /&gt;

  &lt;bean id="userPreferences"
      class="com.example.UserPreferences"
      c:theme="#{session.getAttribute('theme')}"
      scope="session"&gt;
    &lt;aop:scoped-proxy /&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In <code class="class">SessionScopedBeanTests</code> we inject the <code class="class">UserService</code> and the <code class="class">MockHttpSession</code> into our test instance.
Within our  test method we set up our test fixture by setting the expected "theme" attribute in the provided <code class="class">MockHttpSession</code>.
When the  method is invoked on our <code>userService</code> we are assured that the user service has access to the session-scoped <code>userPreferences</code> for the current <code class="class">MockHttpSession</code>, and we can perform assertions against the results based on the configured theme.</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Session-scoped bean test</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
@WebAppConfiguration
public class SessionScopedBeanTests {

  @Autowired UserService userService;
  @Autowired MockHttpSession session;

  @Test
  public void sessionScope() throws Exception {

    session.setAttribute("theme", "blue");

    Results results = userService.processUserPreferences();

    // assert results
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transaction-management-2"><a class="anchor" href="#transaction-management-2"></a>Transaction management</h4>
<div class="paragraph">
<p>In the TestContext framework, transactions are managed by the <code class="class">TransactionalTestExecutionListener</code>.
Note that <code class="class">TransactionalTestExecutionListener</code> is configured by default, even if you do not explicitly declare <code class="interface">@TestExecutionListeners</code> on your test class.
To enable support for transactions, however, you must provide a <code class="class">PlatformTransactionManager</code> bean in the application context loaded by <code class="interface">@ContextConfiguration</code> semantics.
In addition, you must declare <code class="interface">@Transactional</code> either at the class or method level for your tests.</p>
</div>
<div class="paragraph">
<p>For class-level transaction configuration (i.e., setting an explicit bean name for the transaction manager and the default rollback flag), see the <code class="interface">@TransactionConfiguration</code> entry in the <a href="#integration-testing-annotations">annotation
        support</a> section.</p>
</div>
<div class="paragraph">
<p>If transactions are not enabled for the entire test class, you can annotate methods explicitly with <code class="interface">@Transactional</code>.
To control whether a transaction should commit for a particular test method, you can use the <code class="interface">@Rollback</code> annotation to override the class-level default rollback setting.</p>
</div>
<div class="paragraph">
<p><em><a href="#testcontext-support-classes-junit4"><code class="class">AbstractTransactionalJUnit4SpringContextTests</code></a> and <a href="#testcontext-support-classes-testng"><code class="class">AbstractTransactionalTestNGSpringContextTests</code></a> are preconfigured for transactional support at the class
        level.</em></p>
</div>
<div class="paragraph">
<p>Occasionally you need to execute certain code before or after a transactional test method but outside the transactional context, for example, to verify the initial database state prior to execution of your test or to verify expected transactional commit behavior after test execution (if the test was configured not to roll back the transaction).
<code class="class">TransactionalTestExecutionListener</code> supports the <code class="interface">@BeforeTransaction</code> and <code class="interface">@AfterTransaction</code> annotations exactly for such scenarios.
Simply annotate any <code>public void</code> method in your test class with one of these annotations, and the <code class="class">TransactionalTestExecutionListener</code> ensures that your <em>before transaction method</em> or <em>after
        transaction method</em> is executed at the appropriate time.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Any <em>before methods</em> (such as methods annotated with JUnit&#8217;s <code class="interface">@Before</code>) and any <em>after methods</em> (such as methods annotated with JUnit&#8217;s <code class="interface">@After</code>) are executed <em>within</em> a transaction.
In addition, methods annotated with <code class="interface">@BeforeTransaction</code> or <code class="interface">@AfterTransaction</code> are naturally not executed for test methods that are not configured to run within a transaction.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following JUnit-based example displays a fictitious integration testing scenario highlighting several transaction-related annotations.
Consult the <a href="#integration-testing-annotations">annotation support</a> section for further information and configuration examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
@TransactionConfiguration(transactionManager="txMgr", defaultRollback=false)
@Transactional
public class FictitiousTransactionalTest {

    @BeforeTransaction
    public void verifyInitialDatabaseState() {
        // logic to verify the initial state before a transaction is started
    }

    @Before
    public void setUpTestDataWithinTransaction() {
        // set up test data within the transaction
    }

    @Test
    // overrides the class-level defaultRollback setting
    @Rollback(true)
    public void modifyDatabaseWithinTransaction() {
        // logic which uses the test data and modifies database state
    }

    @After
    public void tearDownWithinTransaction() {
        // execute "tear down" logic within the transaction
    }

    @AfterTransaction
    public void verifyFinalDatabaseState() {
        // logic to verify the final state after transaction has rolled back
    }

}
----[[]]

.Avoid false positives when testing ORM code
[NOTE]
====
When you test application code that manipulates the state of the Hibernate session, make sure to _flush_ the underlying session within test methods that execute that code.
Failing to flush the underlying session can produce _false
          positives_: your test may pass, but the same code throws an exception in a live, production environment.
In the following Hibernate-based example test case, one method demonstrates a false positive, and the other method correctly exposes the results of flushing the session.
Note that this applies to JPA and any other ORM frameworks that maintain an in-memory _unit of
          work_.

[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>@Autowired
private SessionFactory sessionFactory;</p>
</div>
<div class="paragraph">
<p>@Test // no expected exception!
public void falsePositive() {
    updateEntityInHibernateSession();
    // False positive: an exception will be thrown once the session is
    // finally flushed (i.e., in production code)
}</p>
</div>
<div class="paragraph">
<p>@Test(expected = GenericJDBCException.class)
public void updateWithSessionFlush() {
    updateEntityInHibernateSession();
    // Manual flush is required to avoid false positive in test
    sessionFactory.getCurrentSession().flush();
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>====

==== TestContext Framework support classes

===== JUnit support classes

The `org.springframework.test.context.junit4` package provides support classes for JUnit 4.5+ based test cases.

* [class]`AbstractJUnit4SpringContextTests`: Abstract base test class that integrates the _Spring
                TestContext Framework_ with explicit [class]`ApplicationContext` testing support in a JUnit 4.5+ environment.
+
When you extend [class]`AbstractJUnit4SpringContextTests`, you can access the following `protected` instance variable:
+
* `applicationContext`: Use this variable to perform explicit bean lookups or to test the state of the context as a whole.

* [class]`AbstractTransactionalJUnit4SpringContextTests`: Abstract _transactional_ extension of [class]`AbstractJUnit4SpringContextTests` that also adds some convenience functionality for JDBC access.
  Expects a [class]`javax.sql.DataSource` bean and a [interface]`PlatformTransactionManager` bean to be defined in the [class]`ApplicationContext`.
  When you extend [class]`AbstractTransactionalJUnit4SpringContextTests` you can access the following `protected` instance variables:
+
* `applicationContext`: Inherited from the [class]`AbstractJUnit4SpringContextTests` superclass.
  Use this variable to perform explicit bean lookups or to test the state of the context as a whole.
* `jdbcTemplate`: Use this variable to execute SQL statements to query the database.
  Such queries can be used to confirm database state both _prior
                    to_ and _after_ execution of database-related application code, and Spring ensures that such queries run in the scope of the same transaction as the application code.
  When used in conjunction with an ORM tool, be sure to avoid &lt;&lt;testcontext-tx-false-positives,false
                    positives&gt;&gt;.


TIP: These classes are a convenience for extension.
If you do not want your test classes to be tied to a Spring-specific class hierarchy -- for example, if you want to directly extend the class you are testing -- you can configure your own custom test classes by using [interface]`@RunWith(SpringJUnit4ClassRunner.class)`, [interface]`@ContextConfiguration`, [interface]`@TestExecutionListeners`, and so on.

===== Spring JUnit Runner

The _Spring TestContext Framework_ offers full integration with JUnit 4.5+ through a custom runner (tested on JUnit 4.5  4.10).
By annotating test classes with `@RunWith(SpringJUnit4ClassRunner.class)`, developers can implement standard JUnit-based unit and integration tests and simultaneously reap the benefits of the TestContext framework such as support for loading application contexts, dependency injection of test instances, transactional test method execution, and so on.
The following code listing displays the minimal requirements for configuring a test class to run with the custom Spring Runner.
[interface]`@TestExecutionListeners` is configured with an empty list in order to disable the default listeners, which otherwise would require an ApplicationContext to be configured through [interface]`@ContextConfiguration`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@RunWith(SpringJUnit4ClassRunner.class)
@TestExecutionListeners({})
public class SimpleTest {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @Test
    public void testMethod() {
        // execute test logic...
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
===== TestNG support classes

The `org.springframework.test.context.testng` package provides support classes for TestNG based test cases.

* [class]`AbstractTestNGSpringContextTests`: Abstract base test class that integrates the _Spring
                TestContext Framework_ with explicit [class]`ApplicationContext` testing support in a TestNG environment.
+
When you extend [class]`AbstractTestNGSpringContextTests`, you can access the following `protected` instance variable:
+
* `applicationContext`: Use this variable to perform explicit bean lookups or to test the state of the context as a whole.

* [class]`AbstractTransactionalTestNGSpringContextTests`: Abstract _transactional_ extension of [class]`AbstractTestNGSpringContextTests` that adds some convenience functionality for JDBC access.
  Expects a [class]`javax.sql.DataSource` bean and a [interface]`PlatformTransactionManager` bean to be defined in the [class]`ApplicationContext`.
  When you extend [class]`AbstractTransactionalTestNGSpringContextTests`, you can access the following `protected` instance variables:
+
* `applicationContext`: Inherited from the [class]`AbstractTestNGSpringContextTests` superclass.
  Use this variable to perform explicit bean lookups or to test the state of the context as a whole.
* `jdbcTemplate`: Use this variable to execute SQL statements to query the database.
  Such queries can be used to confirm database state both _prior
                    to_ and _after_ execution of database-related application code, and Spring ensures that such queries run in the scope of the same transaction as the application code.
  When used in conjunction with an ORM tool, be sure to avoid &lt;&lt;testcontext-tx-false-positives,false
                    positives&gt;&gt;.


TIP: These classes are a convenience for extension.
If you do not want your test classes to be tied to a Spring-specific class hierarchy -- for example, if you want to directly extend the class you are testing -- you can configure your own custom test classes by using [interface]`@ContextConfiguration`, [interface]`@TestExecutionListeners`, and so on, and by manually instrumenting your test class with a [class]`TestContextManager`.
See the source code of [class]`AbstractTestNGSpringContextTests` for an example of how to instrument your test class.

=== Spring MVC Test Framework

.Standalone project
****
Before inclusion in Spring Framework 3.2, the Spring MVC Test framework had already existed as a separate project on GitHub where it grew and evolved through actual use, feedback, and the contribution of many.

The standalone &lt;&lt;,spring-test-mvc
        project&gt;&gt; is still available on GitHub and can be used in conjunction with Spring Framework 3.1.x.
Applications upgrading to 3.2 should replace the [file]`spring-test-mvc` dependency with a dependency on [file]`spring-test`.

The [file]`spring-test` module uses a different package [class]`org.springframework.test.web` but otherwise is nearly identical with two exceptions.
One is support for features new in 3.2 (e.g.
asynchronous web requests).
The other relates to the options for creating a [class]`MockMvc` instance.
In Spring Framework 3.2, this can only be done through the TestContext framework, which provides caching benefits for the loaded configuration.
****

The _Spring MVC Test framework_ provides first class JUnit support for testing client and server-side Spring MVC code through a fluent API. Typically it loads the actual Spring configuration through the _TestContext framework_ and always uses the [class]`DispatcherServlet` to process requests thus approximating full integration tests without requiring a running Servlet container.

Client-side tests are [class]`RestTemplate`-based and allow tests for code that relies on the [class]`RestTemplate` without requiring a running server to respond to the requests.

==== Server-Side Tests

Before Spring Framework 3.2, the most likely way to test a Spring MVC controller was to write a unit test that instantiates the controller, injects it with mock or stub dependencies, and then calls its methods directly, using a [class]`MockHttpServletRequest` and [class]`MockHttpServletResponse` where necessary.

Although this is pretty easy to do, controllers have many annotations, and much remains untested.
Request mappings, data binding, type conversion, and validation are just a few examples of what isn't tested.
Furthermore, there are other types of annotated methods such as [interface]`@InitBinder`, [interface]`@ModelAttribute`, and [interface]`@ExceptionHandler` that get invoked as part of request processing.

The idea behind Spring MVC Test is to be able to re-write those controller tests by performing actual requests and generating responses, as they would be at runtime, along the way invoking controllers through the Spring MVC [class]`DispatcherServlet`.
Controllers can still be injected with mock dependencies, so tests can remain focused on the web layer.

Spring MVC Test builds on the familiar "mock" implementations of the Servlet API available in the [file]`spring-test` module.
This allows performing requests and generating responses without the need for running in a Servlet container.
For the most part everything should work as it does at runtime with the exception of JSP rendering, which is not available outside a Servlet container.
Furthermore, if you are familiar with how the [class]`MockHttpServletResponse` works, you'll know that forwards and redirects are not actually executed.
Instead "forwarded" and "redirected" URLs are saved and can be asserted in tests.
This means if you are using JSPs, you can verify the JSP page to which the request was forwarded.

All other means of rendering including [interface]`@ResponseBody` methods and [interface]`View` types (besides JSPs) such as Freemarker, Velocity, Thymeleaf, and others for rendering HTML, JSON, XML, and so on should work as expected, and the response will contain the generated content.

Below is an example of a test requesting account information in JSON format:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.<strong>;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.</strong>;</p>
</div>
<div class="paragraph">
<p>@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration("test-servlet-context.xml")
public class ExampleTests {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
private WebApplicationContext wac;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private MockMvc mockMvc;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Before
public void setup() {
    this.mockMvc = MockMvcBuilders.webAppContextSetup(this.wac).build();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Test
public void getAccount() throws Exception {
    this.mockMvc.perform(get("/accounts/1").accept(MediaType.parseMediaType("application/json;charset=UTF-8")))
      .andExpect(status().isOk())
      .andExpect(content().contentType("application/json"))
      .andExpect(jsonPath("$.name").value("Lee"));
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The test relies on the [interface]`WebApplicationContext` support of the _TestContext framework_.
It loads Spring configuration from an XML configuration file located in the same package as the test class (also supports JavaConfig) and injects the created [interface]`WebApplicationContext` into the test so a [class]`MockMvc` instance can be created with it.

The [class]`MockMvc` is then used to perform a request to [file]`"/accounts/1"` and verify the resulting response status is 200, the response content type is [file]`"application/json"`, and response content has a JSON property called "name" with the value "Lee".
JSON content is inspected with the help of Jayway's &lt;&lt;,JsonPath project&gt;&gt;.
There are lots of other options for verifying the result of the performed request and those will be discussed later.

===== Static Imports

The fluent API in the example above requires a few static imports such as [class]`MockMvcRequestBuilders.*`, [class]`MockMvcResultMatchers.*`, and [class]`MockMvcBuilders.*`.
An easy way to find these classes is to search for types matching _"MockMvc*"_.
If using Eclipse, be sure to add them as "favorite static members" in the Eclipse preferences under _Java -&gt; Editor -&gt; Content Assist -&gt;
          Favorites_.
That will allow use of content assist after typing the first character of the static method name.
Other IDEs (e.g.
IntelliJ) may not require any additional configuration.
Just check the support for code completion on static members.

===== Setup Options

The goal of server-side test setup is to create an instance of [class]`MockMvc` that can be used to perform requests.
There are two main options.

The first option is to point to Spring MVC configuration through the _TestContext framework_, which loads the Spring configuration and injects a [interface]`WebApplicationContext` into the test to use to create a [class]`MockMvc`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration("my-servlet-context.xml")
public class MyWebTests {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
private WebApplicationContext wac;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private MockMvc mockMvc;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Before
public void setup() {
    this.mockMvc = MockMvcBuilders.webAppContextSetup(this.wac).build();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// ...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The second option is to simply register a controller instance without loading any Spring configuration.
Instead basic Spring MVC configuration suitable for testing annotated controllers is automatically created.
The created configuration is comparable to that of the MVC JavaConfig (and the MVC namespace) and can be customized to a degree through builder-style methods:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class MyWebTests {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private MockMvc mockMvc;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Before
public void setup() {
    this.mockMvc = MockMvcBuilders.standaloneSetup(new AccountController()).build();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// ...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Which option should you use?

The _"webAppContextSetup"_ loads the actual Spring MVC configuration resulting in a more complete integration test.
Since the _TestContext framework_ caches the loaded Spring configuration, it helps to keep tests running fast even as more tests get added.
Furthermore, you can inject mock services into controllers through Spring configuration, in order to remain focused on testing the web layer.
Here is an example of declaring a mock service with Mockito:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="accountService" class="org.mockito.Mockito" factory-method="mock"&gt;
    &lt;constructor-arg value="org.example.AccountService"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Then you can inject the mock service into the test in order set up and verify expectations:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration("test-servlet-context.xml")
public class AccountTests {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
private WebApplicationContext wac;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private MockMvc mockMvc;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
private AccountService accountService;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// ...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The _"standaloneSetup"_ on the other hand is a little closer to a unit test.
It tests one controller at a time, the controller can be injected with mock dependencies manually, and it doesn't involve loading Spring configuration.
Such tests are more focused in style and make it easier to see which controller is being tested, whether any specific Spring MVC configuration is required to work, and so on.
The "standaloneSetup" is also a very convenient way to write ad-hoc tests to verify some behavior or to debug an issue.

Just like with integration vs unit testing, there is no right or wrong answer.
Using the "standaloneSetup" does imply the need for some additional "webAppContextSetup" tests to verify the Spring MVC configuration.
Alternatively, you can decide write all tests with "webAppContextSetup" and always test against actual Spring MVC configuration.

===== Performing Requests

To perform requests, use the appropriate HTTP method and additional builder-style methods corresponding to properties of [class]`MockHttpServletRequest`.
For example:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc.perform(post("/hotels/{id}", 42).accept(MediaType.APPLICATION_JSON));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In addition to all the HTTP methods, you can also perform file upload requests, which internally creates an instance of [class]`MockMultipartHttpServletRequest`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc.perform(fileUpload("/doc").file("a1", "ABC".getBytes("UTF-8")));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Query string parameters can be specified in the URI template:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc.perform(get("/hotels?foo={foo}", "bar"));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Or by adding Servlet request parameters:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc.perform(get("/hotels").param("foo", "bar"));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If application code relies on Servlet request parameters, and doesn't check the query string, as is most often the case, then it doesn't matter how parameters are added.
Keep in mind though that parameters provided in the URI template will be decoded while parameters provided through the  method are expected to be decoded.

In most cases it's preferable to leave out the context path and the Servlet path from the request URI. If you must test with the full request URI, be sure to set the  and  accordingly so that request mappings will work:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc.perform(get("/app/main/hotels/{id}").contextPath("/app").servletPath("/main"))</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Looking at the above example, it would be cumbersome to set the contextPath and servletPath with every performed request.
That's why you can define default request properties when building the [class]`MockMvc`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class MyWebTests {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private MockMvc mockMvc;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Before
public void setup() {
    mockMvc = standaloneSetup(new AccountController())
        .defaultRequest(get("/")
            .contextPath("/app").servletPath("/main")
            .accept(MediaType.APPLICATION_JSON).build();
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above properties will apply to every request performed through the [class]`MockMvc`.
If the same property is also specified on a given request, it will override the default value.
That is why, the HTTP method and URI don't matter, when setting default request properties, since they must be specified on every request.

===== Defining Expectations

Expectations can be defined by appending one or more  after call to perform the request:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc.perform(get("/accounts/1")).andExpect(status().isOk());</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
`MockMvcResultMatchers.*` defines a number of static members, some of which return types with additional methods, for asserting the result of the performed request.
The assertions fall in two general categories.

The first category of assertions verify properties of the response, i.e the response status, headers, and content.
Those are the most important things to test for.

The second category of assertions go beyond the response, and allow inspecting Spring MVC specific constructs such as which controller method processed the request, whether an exception was raised and handled, what the content of the model is, what view was selected, what flash attributes were added, and so on.
It is also possible to verify Servlet specific constructs such as request and session attributes.
The following test asserts that binding/validation failed:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc.perform(post("/persons"))
  .andExpect(status().isOk())
  .andExpect(model().attributeHasErrors("person"));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Many times when writing tests, it's useful to dump the result of the performed request.
This can be done as follows, where  is a static import from [class]`MockMvcResultHandlers`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc.perform(post("/persons"))
  .andDo(print())
  .andExpect(status().isOk())
  .andExpect(model().attributeHasErrors("person"));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
As long as request processing causes an unhandled exception, the  method will print all the available result data to `System.out`.

In some cases, you may want to get direct access to the result and verify something that cannot be verified otherwise.
This can be done by appending  at the end after all expectations:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>MvcResult mvcResult = mockMvc.perform(post("/persons")).andExpect(status().isOk()).andReturn();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
When all tests repeat the same expectations, you can define the common expectations once when building the [class]`MockMvc`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>standaloneSetup(new SimpleController())
    .alwaysExpect(status().isOk())
    .alwaysExpect(content().contentType("application/json;charset=UTF-8"))
    .build()</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that the expectation is _always_ applied and cannot be overridden without creating a separate [class]`MockMvc` instance.

When JSON response content contains hypermedia links created with &lt;&lt;,Spring
          HATEOAS&gt;&gt;, the resulting links can be verified:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc.perform(get("/people").accept(MediaType.APPLICATION_JSON))
  .andExpect(jsonPath("$.links[?(@.rel == <em>self</em>)].href").value("http://localhost:8080/people"));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
When XML response content contains hypermedia links created with &lt;&lt;,Spring
          HATEOAS&gt;&gt;, the resulting links can be verified:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Map&lt;String, String&gt; ns = Collections.singletonMap("ns", "http://www.w3.org/2005/Atom");
mockMvc.perform(get("/handle").accept(MediaType.APPLICATION_XML))
  .andExpect(xpath("/person/ns:link[@rel=<em>self</em>]/@href", ns).string("http://localhost:8080/people"));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
===== Filter Registrations

When setting up a [class]`MockMvc`, you can register one or more [interface]`Filter` instances:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>mockMvc = standaloneSetup(new PersonController()).addFilters(new CharacterEncodingFilter()).build();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Registered filters will be invoked through [class]`MockFilterChain` from [file]`spring-test` and the last filter will delegates to the [class]`DispatcherServlet`.

===== Further Server-Side Test Examples

The framework's own tests include &lt;&lt;,many
          sample tests&gt;&gt; intended to demonstrate how to use Spring MVC Test.
Browse these examples for further ideas.
Also the &lt;&lt;,spring-mvc-showcase&gt;&gt; has full test coverage based on Spring MVC Test.

==== Client-Side REST Tests

Client-side tests are for code using the [class]`RestTemplate`.
The goal is to define expected requests and provide "stub" responses:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>RestTemplate restTemplate = new RestTemplate();</p>
</div>
<div class="paragraph">
<p>MockRestServiceServer mockServer =  MockRestServiceServer.createServer(restTemplate);
mockServer.expect(requestTo("/greeting")).andRespond(withSuccess("Hello world", "text/plain"));</p>
</div>
<div class="paragraph">
<p>mockServer.verify();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In the above example, [class]`MockRestServiceServer` -- the central class for client-side REST tests -- configures the [class]`RestTemplate` with a custom [interface]`ClientHttpRequestFactory` that asserts actual requests against expectations and returns "stub" responses.
In this case we expect a single request to "/greeting" and want to return a 200 response with "text/plain" content.
We could define as many additional requests and stub responses as necessary.

Once expected requests and stub responses have been defined, the [class]`RestTemplate` can be used in client-side code as usual.
At the end of the tests `mockServer.verify()` can be used to verify that all expected requests were performed.

===== Static Imports

Just like with server-side tests, the fluent API for client-side tests requires a few static imports.
Those are easy to find by searching _"MockRest*"_.
Eclipse users should add [class]`"MockRestRequestMatchers.*"` and [class]`"MockRestResponseCreators.*"` as "favorite static members" in the Eclipse preferences under _Java -&gt;
          Editor -&gt; Content Assist -&gt; Favorites_.
That allows using content assist after typing the first character of the static method name.
Other IDEs (e.g.
IntelliJ) may not require any additional configuration.
Just check the support for code completion on static members.

===== Further Examples of Client-side REST Tests

Spring MVC Test's own tests include &lt;&lt;,example
          tests&gt;&gt; of client-side REST tests.

=== PetClinic Example

The PetClinic application, available from the &lt;&lt;new-in-3.0-samples,samples repository&gt;&gt;, illustrates several features of the _Spring TestContext Framework_ in a JUnit 4.5+ environment.
Most test functionality is included in the [class]`AbstractClinicTests`, for which a partial listing is shown below:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import static org.junit.Assert.assertEquals;</p>
</div>
<div class="paragraph">
<p>@ContextConfiguration
public abstract class AbstractClinicTests extends AbstractTransactionalJUnit4SpringContextTests {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
protected Clinic clinic;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Test
public void getVets() {
    Collection&lt;Vet&gt; vets = this.clinic.getVets();
    assertEquals("JDBC query must show the same number of vets",
        super.countRowsInTable("VETS"), vets.size());
    Vet v1 = EntityUtils.getById(vets, Vet.class, 2);
    assertEquals("Leary", v1.getLastName());
    assertEquals(1, v1.getNrOfSpecialties());
    assertEquals("radiology", (v1.getSpecialties().get(0)).getName());
    // ...
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    // ...
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Notes:

* This test case extends the [class]`AbstractTransactionalJUnit4SpringContextTests` class, from which it inherits configuration for Dependency Injection (through the [class]`DependencyInjectionTestExecutionListener`) and transactional behavior (through the [class]`TransactionalTestExecutionListener`).
* The `clinic` instance variable -- the application object being tested -- is set by Dependency Injection through [interface]`@Autowired` semantics.
* The [method]`testGetVets()` method illustrates how you can use the inherited [method]`countRowsInTable()` method to easily verify the number of rows in a given table, thus verifying correct behavior of the application code being tested.
  This allows for stronger tests and lessens dependency on the exact test data.
  For example, you can add additional rows in the database without breaking tests.
* Like many integration tests that use a database, most of the tests in [class]`AbstractClinicTests` depend on a minimum amount of data already in the database before the test cases run.
  Alternatively, you might choose to populate the database within the test fixture set up of your test cases -- again, within the same transaction as the tests.

The PetClinic application supports three data access technologies: JDBC, Hibernate, and JPA. By declaring [interface]`@ContextConfiguration` without any specific resource locations, the [class]`AbstractClinicTests` class will have its application context loaded from the default location, `AbstractClinicTests-context.xml`, which declares a common [class]`DataSource`.
Subclasses specify additional context locations that must declare a [interface]`PlatformTransactionManager` and a concrete implementation of [interface]`Clinic`.

For example, the Hibernate implementation of the PetClinic tests contains the following implementation.
For this example, [class]`HibernateClinicTests` does not contain a single line of code: we only need to declare [interface]`@ContextConfiguration`, and the tests are inherited from [class]`AbstractClinicTests`.
Because [interface]`@ContextConfiguration` is declared without any specific resource locations, the _Spring TestContext
      Framework_ loads an application context from all the beans defined in `AbstractClinicTests-context.xml` (i.e., the inherited locations) and `HibernateClinicTests-context.xml`, with `HibernateClinicTests-context.xml` possibly overriding beans defined in `AbstractClinicTests-context.xml`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@ContextConfiguration
public class HibernateClinicTests extends AbstractClinicTests { }</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In a large-scale application, the Spring configuration is often split across multiple files.
Consequently, configuration locations are typically specified in a common base class for all application-specific integration tests.
Such a base class may also add useful instance variables -- populated by Dependency Injection, naturally -- such as a [class]`SessionFactory` in the case of an application using Hibernate.

As far as possible, you should have exactly the same Spring configuration files in your integration tests as in the deployed environment.
One likely point of difference concerns database connection pooling and transaction infrastructure.
If you are deploying to a full-blown application server, you will probably use its connection pool (available through JNDI) and JTA implementation.
Thus in production you will use a [class]`JndiObjectFactoryBean` or `&lt;jee:jndi-lookup&gt;` for the [class]`DataSource` and [class]`JtaTransactionManager`.
JNDI and JTA will not be available in out-of-container integration tests, so you should use a combination like the Commons DBCP [class]`BasicDataSource` and [class]`DataSourceTransactionManager` or [class]`HibernateTransactionManager` for them.
You can factor out this variant behavior into a single XML file, having the choice between application server and a 'local' configuration separated from all other configuration, which will not vary between the test and production environments.
In addition, it is advisable to use properties files for connection settings.
See the PetClinic application for an example.

== Further Resources

Consult the following resources for more information about testing:

* &lt;&lt;,JUnit&gt;&gt;: .
  Used by the Spring Framework in its test suite.
* &lt;&lt;,TestNG&gt;&gt;: A testing framework inspired by JUnit with added support for Java 5 annotations, test groups, data-driven testing, distributed testing, etc.
* &lt;&lt;,MockObjects.com&gt;&gt;: Web site dedicated to mock objects, a technique for improving the design of code within test-driven development.
* &lt;&lt;,"Mock
          Objects"&gt;&gt;: Article in Wikipedia.
* &lt;&lt;,EasyMock&gt;&gt;: Java library  Used by the Spring Framework in its test suite.
* &lt;&lt;,JMock&gt;&gt;: Library that supports test-driven development of Java code with mock objects.
* &lt;&lt;,Mockito&gt;&gt;: Java mock library based on the &lt;&lt;,test spy&gt;&gt; pattern.
* &lt;&lt;,DbUnit&gt;&gt;: JUnit extension (also usable with Ant and Maven) targeted for database-driven projects that, among other things, puts your database into a known state between test runs.
* &lt;&lt;,The
          Grinder&gt;&gt;: Java load testing framework.


[[spring-data-tier]]
= Data Access
This part of the reference documentation is concerned with data access and the interaction between the data access layer and the business or service layer.

Spring's comprehensive transaction management support is covered in some detail, followed by thorough coverage of the various data access frameworks and technologies that the Spring Framework integrates with.


* &lt;&lt;transaction&gt;&gt;

* &lt;&lt;dao&gt;&gt;

* &lt;&lt;jdbc&gt;&gt;

* &lt;&lt;orm&gt;&gt;

* &lt;&lt;oxm&gt;&gt;




= Transaction Management

== Introduction to Spring Framework transaction management

Comprehensive transaction support is among the most compelling reasons to use the Spring Framework.
The Spring Framework provides a consistent abstraction for transaction management that delivers the following benefits:

* Consistent programming model across different transaction APIs such as Java Transaction API (JTA), JDBC, Hibernate, Java Persistence API (JPA), and Java Data Objects (JDO).
* Support for &lt;&lt;transaction-declarative,declarative
          transaction management&gt;&gt;.
* Simpler API for &lt;&lt;transaction-programmatic,programmatic&gt;&gt; transaction management than complex transaction APIs such as JTA.
* Excellent integration with Spring's data access abstractions.

The following sections describe the Spring Framework's transaction value-adds and technologies.
(The chapter also includes discussions of best practices, application server integration, and solutions to common problems.)

* &lt;&lt;transaction-motivation,Advantages of the Spring
          Framework's transaction support model&gt;&gt; describes _why_ you would use the Spring Framework's transaction abstraction instead of EJB Container-Managed Transactions (CMT) or choosing to drive local transactions through a proprietary API such as Hibernate.
* &lt;&lt;transaction-strategies,Understanding the Spring
          Framework transaction abstraction&gt;&gt; outlines the core classes and describes how to configure and obtain [interface]`DataSource` instances from a variety of sources.
* &lt;&lt;tx-resource-synchronization,Synchronizing
          resources with transactions &gt;&gt;describes how the application code ensures that resources are created, reused, and cleaned up properly.
* &lt;&lt;transaction-declarative,Declarative transaction
          management&gt;&gt; describes support for declarative transaction management.
* &lt;&lt;transaction-programmatic,Programmatic
          transaction management&gt;&gt; covers support for programmatic (that is, explicitly coded) transaction management.

== Advantages of the Spring Framework's transaction support model

Traditionally, Java EE developers have had two choices for transaction management: _global_ or _local_ transactions, both of which have profound limitations.
Global and local transaction management is reviewed in the next two sections, followed by a discussion of how the Spring Framework's transaction management support addresses the limitations of the global and local transaction models.

=== Global transactions

Global transactions enable you to work with multiple transactional resources, typically relational databases and message queues.
The application server manages global transactions through the JTA, which is a cumbersome API to use (partly due to its exception model).
Furthermore, a JTA [interface]`UserTransaction` normally needs to be sourced from JNDI, meaning that you _also_ need to use JNDI in order to use JTA. Obviously the use of global transactions would limit any potential reuse of application code, as JTA is normally only available in an application server environment.

Previously, the preferred way to use global transactions was via EJB _CMT_ (_Container Managed
      Transaction_): CMT is a form of _declarative transaction management_ (as distinguished from _programmatic transaction
      management_).
EJB CMT removes the need for transaction-related JNDI lookups, although of course the use of EJB itself necessitates the use of JNDI. It removes most but not all of the need to write Java code to control transactions.
The significant downside is that CMT is tied to JTA and an application server environment.
Also, it is only available if one chooses to implement business logic in EJBs, or at least behind a transactional EJB facade.
The negatives of EJB in general are so great that this is not an attractive proposition, especially in the face of compelling alternatives for declarative transaction management.

=== Local transactions

Local transactions are resource-specific, such as a transaction associated with a JDBC connection.
Local transactions may be easier to use, but have significant disadvantages: they cannot work across multiple transactional resources.
For example, code that manages transactions using a JDBC connection cannot run within a global JTA transaction.
Because the application server is not involved in transaction management, it cannot help ensure correctness across multiple resources.
(It is worth noting that most applications use a single transaction resource.) Another downside is that local transactions are invasive to the programming model.

=== Spring Framework's consistent programming model

Spring resolves the disadvantages of global and local transactions.
It enables application developers to use a _consistent_ programming model _in any
      environment_.
You write your code once, and it can benefit from different transaction management strategies in different environments.
The Spring Framework provides both declarative and programmatic transaction management.
Most users prefer declarative transaction management, which is recommended in most cases.

With programmatic transaction management, developers work with the Spring Framework transaction abstraction, which can run over any underlying transaction infrastructure.
With the preferred declarative model, developers typically write little or no code related to transaction management, and hence do not depend on the Spring Framework transaction API, or any other transaction API.

.Do you need an application server for transaction management?
****
The Spring Framework's transaction management support changes traditional rules as to when an enterprise Java application requires an application server.

In particular, you do not need an application server simply for declarative transactions through EJBs.
In fact, even if your application server has powerful JTA capabilities, you may decide that the Spring Framework's declarative transactions offer more power and a more productive programming model than EJB CMT.

Typically you need an application server's JTA capability only if your application needs to handle transactions across multiple resources, which is not a requirement for many applications.
Many high-end applications use a single, highly scalable database (such as Oracle RAC) instead.
Standalone transaction managers such as &lt;&lt;,Atomikos Transactions&gt;&gt; and &lt;&lt;,JOTM&gt;&gt; are other options.
Of course, you may need other application server capabilities such as Java Message Service (JMS) and J2EE Connector Architecture (JCA).

The Spring Framework _gives you the choice of when to
        scale your application to a fully loaded application
        server_.
Gone are the days when the only alternative to using EJB CMT or JTA was to write code with local transactions such as those on JDBC connections, and face a hefty rework if you need that code to run within global, container-managed transactions.
With the Spring Framework, only some of the bean definitions in your configuration file, rather than your code, need to change.
****

== Understanding the Spring Framework transaction abstraction

The key to the Spring transaction abstraction is the notion of a _transaction strategy_.
A transaction strategy is defined by the [interface]`org.springframework.transaction.PlatformTransactionManager` interface:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface PlatformTransactionManager {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TransactionStatus getTransaction(TransactionDefinition definition)
  throws TransactionException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void commit(TransactionStatus status) throws TransactionException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  void rollback(TransactionStatus status) throws TransactionException;
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
This is primarily a service provider interface (SPI), although it can be used &lt;&lt;transaction-programmatic-ptm,programmatically&gt;&gt; from your application code.
Because [interface]`PlatformTransactionManager` is an _interface_, it can be easily mocked or stubbed as necessary.
It is not tied to a lookup strategy such as JNDI. [interface]`PlatformTransactionManager` implementations are defined like any other object (or bean) in the Spring Framework IoC container.
This benefit alone makes Spring Framework transactions a worthwhile abstraction even when you work with JTA. Transactional code can be tested much more easily than if it used JTA directly.

Again in keeping with Spring's philosophy, the  that can be thrown by any of the [interface]`PlatformTransactionManager` interface's methods is _unchecked_ (that is, it extends the  class).
Transaction infrastructure failures are almost invariably fatal.
In rare cases where application code can actually recover from a transaction failure, the application developer can still choose to catch and handle .
The salient point is that developers are not _forced_ to do so.

The [method]`getTransaction(..)` method returns a [interface]`TransactionStatus` object, depending on a [interface]`TransactionDefinition` parameter.
The returned [interface]`TransactionStatus` might represent a new transaction, or can represent an existing transaction if a matching transaction exists in the current call stack.
The implication in this latter case is that, as with Java EE transaction contexts, a [interface]`TransactionStatus` is associated with a _thread_ of execution.

The [interface]`TransactionDefinition` interface specifies:

* _Isolation_: The degree to which this transaction is isolated from the work of other transactions.
  For example, can this transaction see uncommitted writes from other transactions?
* _Propagation_: Typically, all code executed within a transaction scope will run in that transaction.
  However, you have the option of specifying the behavior in the event that a transactional method is executed when a transaction context already exists.
  For example, code can continue running in the existing transaction (the common case); or the existing transaction can be suspended and a new transaction created.
  _Spring offers all of the transaction
          propagation options familiar from EJB CMT_.
  To read about the semantics of transaction propagation in Spring, see &lt;&lt;tx-propagation&gt;&gt;.
* _Timeout_: How long this transaction runs before timing out and being rolled back automatically by the underlying transaction infrastructure.
* _Read-only status_: A read-only transaction can be used when your code reads but does not modify data.
  Read-only transactions can be a useful optimization in some cases, such as when you are using Hibernate.

These settings reflect standard transactional concepts.
If necessary, refer to resources that discuss transaction isolation levels and other core transaction concepts.
Understanding these concepts is essential to using the Spring Framework or any transaction management solution.

The [interface]`TransactionStatus` interface provides a simple way for transactional code to control transaction execution and query transaction status.
The concepts should be familiar, as they are common to all transaction APIs:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface TransactionStatus extends SavepointManager {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean isNewTransaction();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean hasSavepoint();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void setRollbackOnly();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean isRollbackOnly();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void flush();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>boolean isCompleted();</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Regardless of whether you opt for declarative or programmatic transaction management in Spring, defining the correct [interface]`PlatformTransactionManager` implementation is absolutely essential.
You typically define this implementation through dependency injection.

[interface]`PlatformTransactionManager` implementations normally require knowledge of the environment in which they work: JDBC, JTA, Hibernate, and so on.
The following examples show how you can define a local [interface]`PlatformTransactionManager` implementation.
(This example works with plain JDBC.)

You define a JDBC [interface]`DataSource`

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
  &lt;property name="driverClassName" value="${jdbc.driverClassName}" /&gt;
  &lt;property name="url" value="${jdbc.url}" /&gt;
  &lt;property name="username" value="${jdbc.username}" /&gt;
  &lt;property name="password" value="${jdbc.password}" /&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The related [interface]`PlatformTransactionManager` bean definition will then have a reference to the [interface]`DataSource` definition.
It will look like this:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
  &lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If you use JTA in a Java EE container then you use a container [interface]`DataSource`, obtained through JNDI, in conjunction with Spring's [class]`JtaTransactionManager`.
This is what the JTA and JNDI lookup version would look like:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:jee="http://www.springframework.org/schema/jee"
     xsi:schemaLocation="
     <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
     <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
     <a href="http://www.springframework.org/schema/jee">http://www.springframework.org/schema/jee</a>
     <a href="http://www.springframework.org/schema/jee/spring-jee.xsd"&gt;">http://www.springframework.org/schema/jee/spring-jee.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;jee:jndi-lookup id="dataSource" jndi-name="jdbc/jpetstore"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="txManager" class="org.springframework.transaction.jta.JtaTransactionManager" /&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- other &lt;bean/&gt; definitions here --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The [class]`JtaTransactionManager` does not need to know about the [interface]`DataSource`, or any other specific resources, because it uses the container's global transaction management infrastructure.

NOTE: The above definition of the `dataSource` bean uses the `&lt;jndi-lookup/&gt;` tag from the `jee` namespace.
For more information on schema-based configuration, see &lt;&lt;xsd-config&gt;&gt;, and for more information on the `&lt;jee/&gt;` tags see the section entitled &lt;&lt;xsd-config-body-schemas-jee&gt;&gt;.

You can also use Hibernate local transactions easily, as shown in the following examples.
In this case, you need to define a Hibernate [class]`LocalSessionFactoryBean`, which your application code will use to obtain Hibernate [interface]`Session` instances.

The [interface]`DataSource` bean definition will be similar to the local JDBC example shown previously and thus is not shown in the following example.

NOTE: If the [interface]`DataSource`, used by any non-JTA transaction manager, is looked up via JNDI and managed by a Java EE container, then it should be non-transactional because the Spring Framework, rather than the Java EE container, will manage the transactions.

The `txManager` bean in this case is of the [class]`HibernateTransactionManager` type.
In the same way as the [class]`DataSourceTransactionManager` needs a reference to the [interface]`DataSource`, the [class]`HibernateTransactionManager` needs a reference to the [interface]`SessionFactory`.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
  &lt;property name="dataSource" ref="dataSource" /&gt;
  &lt;property name="mappingResources"&gt;
  &lt;list&gt;
    &lt;value&gt;org/springframework/samples/petclinic/hibernate/petclinic.hbm.xml&lt;/value&gt;
  &lt;/list&gt;
  &lt;/property&gt;
  &lt;property name="hibernateProperties"&gt;
    &lt;value&gt;
      hibernate.dialect=${hibernate.dialect}
    &lt;/value&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="txManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
  &lt;property name="sessionFactory" ref="sessionFactory" /&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If you are using Hibernate and Java EE container-managed JTA transactions, then you should simply use the same [class]`JtaTransactionManager` as in the previous JTA example for JDBC.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="txManager" class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: If you use JTA , then your transaction manager definition will look the same regardless of what data access technology you use, be it JDBC, Hibernate JPA or any other supported technology.
This is due to the fact that JTA transactions are global transactions, which can enlist any transactional resource.

In all these cases, application code does not need to change.
You can change how transactions are managed merely by changing configuration, even if that change means moving from local to global transactions or vice versa.

== Synchronizing resources with transactions

It should now be clear how you create different transaction managers, and how they are linked to related resources that need to be synchronized to transactions (for example [class]`DataSourceTransactionManager` to a JDBC [interface]`DataSource`, [class]`HibernateTransactionManager` to a Hibernate [interface]`SessionFactory`, and so forth).
This section describes how the application code, directly or indirectly using a persistence API such as JDBC, Hibernate, or JDO, ensures that these resources are created, reused, and cleaned up properly.
The section also discusses how transaction synchronization is triggered (optionally) through the relevant [interface]`PlatformTransactionManager`.

=== High-level synchronization approach

The preferred approach is to use Spring's highest level template based persistence integration APIs or to use native ORM APIs with transaction- aware factory beans or proxies for managing the native resource factories.
These transaction-aware solutions internally handle resource creation and reuse, cleanup, optional transaction synchronization of the resources, and exception mapping.
Thus user data access code does not have to address these tasks, but can be focused purely on non-boilerplate persistence logic.
Generally, you use the native ORM API or take a _template_ approach for JDBC access by using the [class]`JdbcTemplate`.
These solutions are detailed in subsequent chapters of this reference documentation.

=== Low-level synchronization approach

Classes such as [class]`DataSourceUtils` (for JDBC), [class]`EntityManagerFactoryUtils` (for JPA), [class]`SessionFactoryUtils` (for Hibernate), [class]`PersistenceManagerFactoryUtils` (for JDO), and so on exist at a lower level.
When you want the application code to deal directly with the resource types of the native persistence APIs, you use these classes to ensure that proper Spring Framework-managed instances are obtained, transactions are (optionally) synchronized, and exceptions that occur in the process are properly mapped to a consistent API.

For example, in the case of JDBC, instead of the traditional JDBC approach of calling the `getConnection()` method on the [interface]`DataSource`, you instead use Spring's [class]`org.springframework.jdbc.datasource.DataSourceUtils` class as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Connection conn = DataSourceUtils.getConnection(dataSource);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If an existing transaction already has a connection synchronized (linked) to it, that instance is returned.
Otherwise, the method call triggers the creation of a new connection, which is (optionally) synchronized to any existing transaction, and made available for subsequent reuse in that same transaction.
As mentioned, any  is wrapped in a Spring Framework , one of the Spring Framework's hierarchy of unchecked DataAccessExceptions.
This approach gives you more information than can be obtained easily from the , and ensures portability across databases, even across different persistence technologies.

This approach also works without Spring transaction management (transaction synchronization is optional), so you can use it whether or not you are using Spring for transaction management.

Of course, once you have used Spring's JDBC support, JPA support or Hibernate support, you will generally prefer not to use [class]`DataSourceUtils` or the other helper classes, because you will be much happier working through the Spring abstraction than directly with the relevant APIs.
For example, if you use the Spring [class]`JdbcTemplate` or `jdbc.object` package to simplify your use of JDBC, correct connection retrieval occurs behind the scenes and you won't need to write any special code.

=== [class]`TransactionAwareDataSourceProxy`

At the very lowest level exists the [class]`TransactionAwareDataSourceProxy` class.
This is a proxy for a target [interface]`DataSource`, which wraps the target [interface]`DataSource` to add awareness of Spring-managed transactions.
In this respect, it is similar to a transactional JNDI [interface]`DataSource` as provided by a Java EE server.

It should almost never be necessary or desirable to use this class, except when existing code must be called and passed a standard JDBC [interface]`DataSource` interface implementation.
In that case, it is possible that this code is usable, but participating in Spring managed transactions.
It is preferable to write your new code by using the higher level abstractions mentioned above.

== Declarative transaction management

NOTE: Most Spring Framework users choose declarative transaction management.
This option has the least impact on application code, and hence is most consistent with the ideals of a _non-invasive_ lightweight container.

The Spring Framework's declarative transaction management is made possible with Spring aspect-oriented programming (AOP), although, as the transactional aspects code comes with the Spring Framework distribution and may be used in a boilerplate fashion, AOP concepts do not generally have to be understood to make effective use of this code.

The Spring Framework's declarative transaction management is similar to EJB CMT in that you can specify transaction behavior (or lack of it) down to individual method level.
It is possible to make a [method]`setRollbackOnly()` call within a transaction context if necessary.
The differences between the two types of transaction management are:

* Unlike EJB CMT, which is tied to JTA, the Spring Framework's declarative transaction management works in any environment.
  It can work with JTA transactions or local transactions using JDBC, JPA, Hibernate or JDO by simply adjusting the configuration files.
* You can apply the Spring Framework declarative transaction management to any class, not merely special classes such as EJBs.
* The Spring Framework offers declarative &lt;&lt;transaction-declarative-rolling-back,"_rollback
          rules_, "&gt;&gt;a feature with no EJB equivalent.
  Both programmatic and declarative support for rollback rules is provided.
* The Spring Framework enables you to customize transactional behavior, by using AOP. For example, you can insert custom behavior in the case of transaction rollback.
  You can also add arbitrary advice, along with the transactional advice.
  With EJB CMT, you cannot influence the container's transaction management except with [method]`setRollbackOnly()`.
* The Spring Framework does not support propagation of transaction contexts across remote calls, as do high-end application servers.
  If you need this feature, we recommend that you use EJB. However, consider carefully before using such a feature, because normally, one does not want transactions to span remote calls.

.Where is [class]`TransactionProxyFactoryBean`?
****
Declarative transaction configuration in versions of Spring 2.0 and above differs considerably from previous versions of Spring.
The main difference is that there is no longer any need to configure [class]`TransactionProxyFactoryBean` beans.

The pre-Spring 2.0 configuration style is still 100% valid configuration; think of the new `&lt;tx:tags/&gt;` as simply defining [class]`TransactionProxyFactoryBean` beans on your behalf.
****

The concept of rollback rules is important: they enable you to specify which exceptions (and throwables) should cause automatic rollback.
You specify this declaratively, in configuration, not in Java code.
So, although you can still call [method]`setRollbackOnly()`on the [interface]`TransactionStatus` object to roll back the current transaction back, most often you can specify a rule that  must always result in rollback.
The significant advantage to this option is that business objects do not depend on the transaction infrastructure.
For example, they typically do not need to import Spring transaction APIs or other Spring APIs.

Although EJB container default behavior automatically rolls back the transaction on a _system exception_ (usually a runtime exception), EJB CMT does not roll back the transaction automatically on an _application exception_ (that is, a checked exception other than ).
While the Spring default behavior for declarative transaction management follows EJB convention (roll back is automatic only on unchecked exceptions), it is often useful to customize this behavior.

=== Understanding the Spring Framework's declarative transaction implementation

It is not sufficient to tell you simply to annotate your classes with the [interface]`@Transactional` annotation, add [interface]`@EnableTransactionManagement` to your configuration, and then expect you to understand how it all works.
This section explains the inner workings of the Spring Framework's declarative transaction infrastructure in the event of transaction-related issues.

The most important concepts to grasp with regard to the Spring Framework's declarative transaction support are that this support is enabled &lt;&lt;aop-understanding-aop-proxies,_via AOP
      proxies_&gt;&gt;, and that the transactional advice is driven by _metadata_ (currently XML- or annotation-based).
The combination of AOP with transactional metadata yields an AOP proxy that uses a [class]`TransactionInterceptor` in conjunction with an appropriate [class]`PlatformTransactionManager` implementation to drive transactions _around method
      invocations_.

NOTE: Spring AOP is covered in &lt;&lt;aop&gt;&gt;.

Conceptually, calling a method on a transactional proxy looks like this...



=== Example of declarative transaction implementation

Consider the following interface, and its attendant implementation.
This example uses [class]`Foo` and [class]`Bar` classes as placeholders so that you can concentrate on the transaction usage without focusing on a particular domain model.
For the purposes of this example, the fact that the [class]`DefaultFooService` class throws  instances in the body of each implemented method is good; it allows you to see transactions created and then rolled back in response to the  instance.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package x.y.service;</p>
</div>
<div class="paragraph">
<p>public interface FooService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Foo getFoo(String fooName);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Foo getFoo(String fooName, String barName);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void insertFoo(Foo foo);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void updateFoo(Foo foo);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package x.y.service;</p>
</div>
<div class="paragraph">
<p>public class DefaultFooService implements FooService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public Foo getFoo(String fooName) {
  throw new UnsupportedOperationException();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Foo getFoo(String fooName, String barName) {
  throw new UnsupportedOperationException();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void insertFoo(Foo foo) {
  throw new UnsupportedOperationException();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void updateFoo(Foo foo) {
  throw new UnsupportedOperationException();
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Assume that the first two methods of the [interface]`FooService` interface`,
      getFoo(String)` and `getFoo(String, String),
      `must execute in the context of a transaction with read-only semantics, and that the other methods`,insertFoo(Foo)` and `updateFoo(Foo),` must execute in the context of a transaction with read-write semantics.
The following configuration is explained in detail in the next few paragraphs.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- from the file <em>context.xml</em> -&#8594;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:tx="http://www.springframework.org/schema/tx"
     xsi:schemaLocation="
     <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
     <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
     <a href="http://www.springframework.org/schema/tx">http://www.springframework.org/schema/tx</a>
     <a href="http://www.springframework.org/schema/tx/spring-tx.xsd">http://www.springframework.org/schema/tx/spring-tx.xsd</a>
     <a href="http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop</a>
     <a href="http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;">http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- this is the service object that we want to make transactional --&gt;
&lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- the transactional advice (what 'happens'; see the &lt;aop:advisor/&gt; bean below) --&gt;
&lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
&lt;!-- the transactional semantics... --&gt;
&lt;tx:attributes&gt;
  &lt;!-- all methods starting with 'get' are read-only --&gt;
  &lt;tx:method name="get*" read-only="true"/&gt;
  &lt;!-- other methods use the default transaction settings (see below) --&gt;
  &lt;tx:method name="*"/&gt;
&lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- ensure that the above transactional advice runs for any execution
  of an operation defined by the FooService interface --&gt;
&lt;aop:config&gt;
&lt;aop:pointcut id="fooServiceOperation" expression="execution(* x.y.service.FooService.*(..))"/&gt;
&lt;aop:advisor advice-ref="txAdvice" pointcut-ref="fooServiceOperation"/&gt;
&lt;/aop:config&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- don't forget the DataSource --&gt;
&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
&lt;property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/&gt;
&lt;property name="url" value="jdbc:oracle:thin:@rj-t42:1521:elvis"/&gt;
&lt;property name="username" value="scott"/&gt;
&lt;property name="password" value="tiger"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- similarly, don't forget the PlatformTransactionManager --&gt;
&lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
&lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- other &lt;bean/&gt; definitions here --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Examine the preceding configuration.
You want to make a service object, the `fooService` bean, transactional.
The transaction semantics to apply are encapsulated in the `&lt;tx:advice/&gt;` definition.
The `&lt;tx:advice/&gt;` definition reads as .
The `transaction-manager` attribute of the `&lt;tx:advice/&gt;` tag is set to the name of the [interface]`PlatformTransactionManager` bean that is going to _drive_ the transactions, in this case, the `txManager` bean.

TIP: You can omit the `transaction-manager` attribute in the transactional advice (`&lt;tx:advice/&gt;`) if the bean name of the [interface]`PlatformTransactionManager` that you want to wire in has the name `transactionManager`.
If the [interface]`PlatformTransactionManager` bean that you want to wire in has any other name, then you must use the `transaction-manager` attribute explicitly, as in the preceding example.

The `&lt;aop:config/&gt;` definition ensures that the transactional advice defined by the `txAdvice` bean executes at the appropriate points in the program.
First you define a pointcut that matches the execution of any operation defined in the [interface]`FooService` interface (`fooServiceOperation`).
Then you associate the pointcut with the `txAdvice` using an advisor.
The result indicates that at the execution of a `fooServiceOperation`, the advice defined by `txAdvice` will be run.

The expression defined within the `&lt;aop:pointcut/&gt;` element is an AspectJ pointcut expression; see &lt;&lt;aop&gt;&gt; for more details on pointcut expressions in Spring 2.0.

A common requirement is to make an entire service layer transactional.
The best way to do this is simply to change the pointcut expression to match any operation in your service layer.
For example:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;aop:config&gt;
  &lt;aop:pointcut id="fooServiceMethods" expression="execution(* x.y.service.<strong>.</strong>(..))"/&gt;
  &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="fooServiceMethods"/&gt;
&lt;/aop:config&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>


NOTE: _In this example it is assumed that all your service
          interfaces are defined in the `x.y.service`
          package; see &lt;&lt;aop&gt;&gt; for more
          details._

Now that we've analyzed the configuration, you may be asking yourself, .

The above configuration will be used to create a transactional proxy around the object that is created from the `fooService` bean definition.
The proxy will be configured with the transactional advice, so that when an appropriate method is invoked _on the proxy_, a transaction is started, suspended, marked as read-only, and so on, depending on the transaction configuration associated with that method.
Consider the following program that test drives the above configuration:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public final class Boot {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  public static void main(final String[] args) throws Exception {
    ApplicationContext ctx = new ClassPathXmlApplicationContext("context.xml", Boot.class);
    FooService fooService = (FooService) ctx.getBean("fooService");
    fooService.insertFoo (new Foo());
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The output from running the preceding program will resemble the following.
(The Log4J output and the stack trace from the UnsupportedOperationException thrown by the insertFoo(..) method of the DefaultFooService class have been truncated for clarity.)

[source,xml]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;!-- the Spring container is starting up... --&gt;
[AspectJInvocationContextExposingAdvisorAutoProxyCreator] - Creating implicit proxy
    for bean 'fooService' with 0 common interceptors and 1 specific interceptors
  &lt;!-- the DefaultFooService is actually proxied --&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- ... the insertFoo(..) method is now being invoked on the proxy --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>[TransactionInterceptor] - Getting transaction for x.y.service.FooService.insertFoo
  &lt;!-- the transactional advice kicks in here&#8230; -&#8594;</p>
</div>
<div class="paragraph">
<p>[DataSourceTransactionManager] - Acquired Connection
    [org.apache.commons.dbcp.PoolableConnection@a53de4] for JDBC transaction</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;!-- the insertFoo(..) method from DefaultFooService throws an exception... --&gt;
[RuleBasedTransactionAttribute] - Applying rules to determine whether transaction should
    rollback on java.lang.UnsupportedOperationException
[TransactionInterceptor] - Invoking rollback for transaction on x.y.service.FooService.insertFoo
    due to throwable [java.lang.UnsupportedOperationException]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>   &lt;!-- and the transaction is rolled back (by default, RuntimeException instances cause rollback) --&gt;
[DataSourceTransactionManager] - Rolling back JDBC transaction on Connection
    [org.apache.commons.dbcp.PoolableConnection@a53de4]
[DataSourceTransactionManager] - Releasing JDBC Connection after transaction
[DataSourceUtils] - Returning JDBC Connection to DataSource</pre>
</div>
</div>
<div class="paragraph">
<p>Exception in thread "main" java.lang.UnsupportedOperationException
    at x.y.service.DefaultFooService.insertFoo(DefaultFooService.java:14)
   &lt;!-- AOP infrastructure stack trace elements removed for clarity -&#8594;
    at $Proxy0.insertFoo(Unknown Source)
    at Boot.main(Boot.java:11)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Rolling back a declarative transaction

The previous section outlined the basics of how to specify transactional settings for classes, typically service layer classes, declaratively in your application.
This section describes how you can control the rollback of transactions in a simple declarative fashion.

The recommended way to indicate to the Spring Framework's transaction infrastructure that a transaction's work is to be rolled back is to throw an  from code that is currently executing in the context of a transaction.
The Spring Framework's transaction infrastructure code will catch any unhandled  as it bubbles up the call stack, and make a determination whether to mark the transaction for rollback.

In its default configuration, the Spring Framework's transaction infrastructure code _only_ marks a transaction for rollback in the case of runtime, unchecked exceptions; that is, when the thrown exception is an instance or subclass of .
(s will also - by default - result in a rollback).
Checked exceptions that are thrown from a transactional method do _not_ result in rollback in the default configuration.

You can configure exactly which  types mark a transaction for rollback, including checked exceptions.
The following XML snippet demonstrates how you configure rollback for a checked, application-specific  type.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
  &lt;tx:attributes&gt;
  &lt;tx:method name="get*" read-only="true" rollback-for="NoProductInStockException"/&gt;
  &lt;tx:method name="*"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
You can also specify 'no rollback rules', if you do _not_ want a transaction rolled back when an exception is thrown.
The following example tells the Spring Framework's transaction infrastructure to commit the attendant transaction even in the face of an unhandled .

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;tx:advice id="txAdvice"&gt;
  &lt;tx:attributes&gt;
  &lt;tx:method name="updateStock" no-rollback-for="InstrumentNotFoundException"/&gt;
  &lt;tx:method name="*"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
When the Spring Framework's transaction infrastructure catches an exception and is consults configured rollback rules to determine whether to mark the transaction for rollback, the _strongest_ matching rule wins.
So in the case of the following configuration, any exception other than an  results in a rollback of the attendant transaction.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;tx:advice id="txAdvice"&gt;
  &lt;tx:attributes&gt;
  &lt;tx:method name="*" rollback-for="Throwable" no-rollback-for="InstrumentNotFoundException"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
You can also indicate a required rollback _programmatically_.
Although very simple, this process is quite invasive, and tightly couples your code to the Spring Framework's transaction infrastructure:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public void resolvePosition() {
  try {
    // some business logic&#8230;
  } catch (NoProductInStockException ex) {
    // trigger rollback programmatically
    TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
  }
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
You are strongly encouraged to use the declarative approach to rollback if at all possible.
Programmatic rollback is available should you absolutely need it, but its usage flies in the face of achieving a clean POJO-based architecture.

=== Configuring different transactional semantics for different beans

Consider the scenario where you have a number of service layer objects, and you want to apply a _totally different_ transactional configuration to each of them.
You do this by defining distinct `&lt;aop:advisor/&gt;` elements with differing `pointcut` and `advice-ref` attribute values.

As a point of comparison, first assume that all of your service layer classes are defined in a root `x.y.service` package.
To make all beans that are instances of classes defined in that package (or in subpackages) and that have names ending in `Service` have the default transactional configuration, you would write the following:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:aop="http://www.springframework.org/schema/aop"
  xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="
  <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
  <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
  <a href="http://www.springframework.org/schema/tx">http://www.springframework.org/schema/tx</a>
  <a href="http://www.springframework.org/schema/tx/spring-tx.xsd">http://www.springframework.org/schema/tx/spring-tx.xsd</a>
  <a href="http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop</a>
  <a href="http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;">http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:config&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="serviceOperation"
      expression="execution(* x.y.service..*Service.*(..))"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:advisor pointcut-ref="serviceOperation" advice-ref="txAdvice"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/aop:config&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- these two beans will be transactional... --&gt;
&lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;
&lt;bean id="barService" class="x.y.service.extras.SimpleBarService"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- ... and these two beans won't --&gt;
&lt;bean id="anotherService" class="org.xyz.SomeService"/&gt; &lt;!-- (not in the right package) --&gt;
&lt;bean id="barManager" class="x.y.service.SimpleBarManager"/&gt; &lt;!-- (doesn't end in 'Service') --&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;tx:advice id="txAdvice"&gt;
  &lt;tx:attributes&gt;
    &lt;tx:method name="get*" read-only="true"/&gt;
    &lt;tx:method name="*"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- other transaction infrastructure beans such as a PlatformTransactionManager omitted... --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The following example shows how to configure two distinct beans with totally different transactional settings.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:aop="http://www.springframework.org/schema/aop"
  xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="
  <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
  <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
  <a href="http://www.springframework.org/schema/tx">http://www.springframework.org/schema/tx</a>
  <a href="http://www.springframework.org/schema/tx/spring-tx.xsd">http://www.springframework.org/schema/tx/spring-tx.xsd</a>
  <a href="http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop</a>
  <a href="http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;">http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:config&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="defaultServiceOperation"
      expression="execution(* x.y.service.*Service.*(..))"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="noTxServiceOperation"
      expression="execution(* x.y.service.ddl.DefaultDdlManager.*(..))"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:advisor pointcut-ref="defaultServiceOperation" advice-ref="defaultTxAdvice"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:advisor pointcut-ref="noTxServiceOperation" advice-ref="noTxAdvice"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/aop:config&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- this bean will be transactional (see the 'defaultServiceOperation' pointcut) --&gt;
&lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- this bean will also be transactional, but with totally different transactional settings --&gt;
&lt;bean id="anotherFooService" class="x.y.service.ddl.DefaultDdlManager"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;tx:advice id="defaultTxAdvice"&gt;
  &lt;tx:attributes&gt;
    &lt;tx:method name="get*" read-only="true"/&gt;
    &lt;tx:method name="*"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;tx:advice id="noTxAdvice"&gt;
  &lt;tx:attributes&gt;
    &lt;tx:method name="*" propagation="NEVER"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- other transaction infrastructure beans such as a PlatformTransactionManager omitted... --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== `&lt;tx:advice/&gt;` settings

This section summarizes the various transactional settings that can be specified using the `&lt;tx:advice/&gt;` tag.
The default `&lt;tx:advice/&gt;` settings are:



* &lt;&lt;tx-propagation,Propagation setting&gt;&gt; is `REQUIRED.`
* Isolation level is `DEFAULT.`
* Transaction is read/write.
* Transaction timeout defaults to the default timeout of the underlying transaction system, or none if timeouts are not supported.
* Any  triggers rollback, and any checked  does not.

You can change these default settings; the various attributes of the `&lt;tx:method/&gt;` tags that are nested within `&lt;tx:advice/&gt;` and `&lt;tx:attributes/&gt;` tags are summarized below:



.`&lt;tx:method/&gt;` settings
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Default
| Description
| name
| Method name(s) with which the transaction
                attributes are to be associated. The wildcard (*) character
                can be used to associate the same transaction attribute
                settings with a number of methods; for example,
                get*, handle*,
                on*Event, and so forth.

| propagation

| isolation

| timeout

| read-only

| rollback-for
| Exception(s) that trigger
                rollback; comma-delimited. For example,
                com.foo.MyBusinessException,ServletException.

| no-rollback-for
| Exception(s) that do
                not trigger rollback; comma-delimited.
                For example,
                com.foo.MyBusinessException,ServletException.
|===

=== Using [interface]`@Transactional`

In addition to the XML-based declarative approach to transaction configuration, you can use an annotation-based approach.
Declaring transaction semantics directly in the Java source code puts the declarations much closer to the affected code.
There is not much danger of undue coupling, because code that is meant to be used transactionally is almost always deployed that way anyway.

The ease-of-use afforded by the use of the [interface]`@Transactional` annotation is best illustrated with an example, which is explained in the text that follows.
Consider the following class definition:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Transactional
public class DefaultFooService implements FooService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Foo getFoo(String fooName);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Foo getFoo(String fooName, String barName);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void insertFoo(Foo foo);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  void updateFoo(Foo foo);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
When the above POJO is defined as a bean in a Spring IoC container, the bean instance can be made transactional by adding merely _one_ line of XML configuration:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- from the file <em>context.xml</em> -&#8594;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:tx="http://www.springframework.org/schema/tx"
     xsi:schemaLocation="
     <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
     <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
     <a href="http://www.springframework.org/schema/tx">http://www.springframework.org/schema/tx</a>
     <a href="http://www.springframework.org/schema/tx/spring-tx.xsd">http://www.springframework.org/schema/tx/spring-tx.xsd</a>
     <a href="http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop</a>
     <a href="http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;">http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- this is the service object that we want to make transactional --&gt;
&lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- enable the configuration of transactional behavior based on annotations --&gt;
&lt;tx:annotation-driven transaction-manager="txManager"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- a PlatformTransactionManager is still required --&gt;
&lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
&lt;!-- (this dependency is defined somewhere else) --&gt;
&lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- other &lt;bean/&gt; definitions here --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
TIP: You can omit the `transaction-manager` attribute in the `&lt;tx:annotation-driven/&gt;` tag if the bean name of the [interface]`PlatformTransactionManager` that you want to wire in has the name `transactionManager`.
If the [interface]`PlatformTransactionManager` bean that you want to dependency-inject has any other name, then you have to use the `transaction-manager` attribute explicitly, as in the preceding example.

NOTE: The [interface]`@EnableTransactionManagement` annotation provides equivalent support if you are using Java based configuration.
Simply add the annotation to a [interface]`@Configuration` class.
See Javadoc for full details.

.Method visibility and [interface]`@Transactional`
[sidebar]When using proxies, you should apply the [interface]`@Transactional` annotation only to methods with _public_ visibility.
If you do annotate protected, private or package-visible methods with the [interface]`@Transactional` annotation, no error is raised, but the annotated method does not exhibit the configured transactional settings.
Consider the use of AspectJ (see below) if you need to annotate non-public methods.

You can place the [interface]`@Transactional` annotation before an interface definition, a method on an interface, a class definition, or a _public_ method on a class.
However, the mere presence of the [interface]`@Transactional` annotation is not enough to activate the transactional behavior.
The [interface]`@Transactional` annotation is simply metadata that can be consumed by some runtime infrastructure that is [interface]`@Transactional`-aware and that can use the metadata to configure the appropriate beans with transactional behavior.
In the preceding example, the `&lt;tx:annotation-driven/&gt;` element _switches on_ the transactional behavior.



TIP: Spring recommends that you only annotate concrete classes (and methods of concrete classes) with the [interface]`@Transactional` annotation, as opposed to annotating interfaces.
You certainly can place the [interface]`@Transactional` annotation on an interface (or an interface method), but this works only as you would expect it to if you are using interface-based proxies.
The fact that Java annotations are _not inherited from interfaces_ means that if you are using class-based proxies (`proxy-target-class="true"`) or the weaving-based aspect (`mode="aspectj"`), then the transaction settings are not recognized by the proxying and weaving infrastructure, and the object will not be wrapped in a transactional proxy, which would be decidedly _bad_.

NOTE: In proxy mode (which is the default), only external method calls coming in through the proxy are intercepted.
This means that self-invocation, in effect, a method within the target object calling another method of the target object, will not lead to an actual transaction at runtime even if the invoked method is marked with [interface]`@Transactional`.

Consider the use of AspectJ mode (see mode attribute in table below) if you expect self-invocations to be wrapped with transactions as well.
In this case, there will not be a proxy in the first place; instead, the target class will be weaved (that is, its byte code will be modified) in order to turn [interface]`@Transactional` into runtime behavior on any kind of method.



.Annotation driven transaction settings
[cols="1,1,1,1", options="header"]
|===
| XML Attribute
| Annotation Attribute
| Default
| Description
| transaction-manager
| N/A (See
                TransactionManagementConfigurer
                Javadoc)
| Name of transaction manager to use. Only required
                if the name of the transaction manager is not
                transactionManager, as in the example
                above.

| mode
| mode
| The default mode "proxy" processes annotated
                beans to be proxied using Spring's AOP framework (following
                proxy semantics, as discussed above, applying to method calls
                coming in through the proxy only). The alternative mode
                "aspectj" instead weaves the affected classes with Spring's
                AspectJ transaction aspect, modifying the target class byte
                code to apply to any kind of method call. AspectJ weaving
                requires spring-aspects.jar in the classpath as well as
                load-time weaving (or compile-time weaving) enabled. (See
                 for details on how to set
                up load-time weaving.)

| proxy-target-class
| proxyTargetClass
| Applies to proxy mode only. Controls what type of
                transactional proxies are created for classes annotated with
                the @Transactional annotation.
                If the proxy-target-class attribute is set
                to true, then class-based proxies are
                created. If proxy-target-class is
                false or if the attribute is omitted, then
                standard JDK interface-based proxies are created. (See  for a detailed examination of the
                different proxy types.)

| order
| order
| Defines the order of the transaction advice that
                is applied to beans annotated with
                @Transactional. (For more
                information about the rules related to ordering of AOP advice,
                see .) No
                specified ordering means that the AOP subsystem determines the
                order of the advice.
|===

NOTE: The `proxy-target-class` attribute controls what type of transactional proxies are created for classes annotated with the [interface]`@Transactional` annotation.
If `proxy-target-class` is set to `true`, class-based proxies are created.
If `proxy-target-class` is `false` or if the attribute is omitted, standard JDK interface-based proxies are created.
(See &lt;&lt;aop-proxying&gt;&gt; for a discussion of the different proxy types.)

NOTE: [interface]`@EnableTransactionManagement` and `&lt;tx:annotation-driven/&gt;` only looks for [interface]`@Transactional` on beans in the same application context they are defined in.
This means that, if you put annotation driven configuration in a [interface]`WebApplicationContext` for a [class]`DispatcherServlet`, it only checks for [interface]`@Transactional` beans in your controllers, and not your services.
See &lt;&lt;mvc-servlet&gt;&gt; for more information.

The most derived location takes precedence when evaluating the transactional settings for a method.
In the case of the following example, the [class]`DefaultFooService` class is annotated at the class level with the settings for a read-only transaction, but the [interface]`@Transactional` annotation on the [method]`updateFoo(Foo)` method in the same class takes precedence over the transactional settings defined at the class level.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Transactional(readOnly = true)
public class DefaultFooService implements FooService {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public Foo getFoo(String fooName) {
  // do something
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  // these settings have precedence for this method
  @Transactional(readOnly = false, propagation = Propagation.REQUIRES_NEW)
  public void updateFoo(Foo foo) {
    // do something
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== [interface]`@Transactional` settings

The [interface]`@Transactional` annotation is metadata that specifies that an interface, class, or method must have transactional semantics; for example, .
The default [interface]`@Transactional` settings are as follows:

* Propagation setting is `PROPAGATION_REQUIRED.`
* Isolation level is `ISOLATION_DEFAULT.`
* Transaction is read/write.
* Transaction timeout defaults to the default timeout of the underlying transaction system, or to none if timeouts are not supported.
* Any  triggers rollback, and any checked  does not.

These default settings can be changed; the various properties of the [interface]`@Transactional` annotation are summarized in the following table:



.[interface]`@Transactional` properties
[cols="1,1,1", options="header"]
|===
| Property
| Type
| Description
| value

| propagation
| enum: Propagation

| isolation
| enum: Isolation

| readOnly

| timeout

| rollbackFor
| Array of Class objects, which
                  must be derived from
                  Throwable.
| Optional array of exception classes that must cause rollback.

| rollbackForClassName
| Array of class names. Classes must be derived from
                  Throwable.
| Optional array of names of exception classes that
                  must cause
                  rollback.

| noRollbackFor
| Array of Class objects, which
                  must be derived from
                  Throwable.
| Optional array of exception classes that must not cause rollback.

| noRollbackForClassName
| Array of String class names,
                  which must be derived from
                  Throwable.
| Optional array of names of exception classes that
                  must not cause
                  rollback.
|===

Currently you cannot have explicit control over the name of a transaction, where 'name' means the transaction name that will be shown in a transaction monitor, if applicable (for example, WebLogic's transaction monitor), and in logging output.
For declarative transactions, the transaction name is always the fully-qualified class name + "." + method name of the transactionally-advised class.
For example, if the [method]`handlePayment(..)` method of the [class]`BusinessService` class started a transaction, the name of the transaction would be: `com.foo.BusinessService.handlePayment`.

==== Multiple Transaction Managers with [interface]`@Transactional`

 Most Spring applications only need a single transaction manager, but there may be situations where you want multiple independent transaction managers in a single application.
The value attribute of the [interface]`@Transactional` annotation can be used to optionally specify the identity of the [class]`PlatformTransactionManager` to be used.
This can either be the bean name or the qualifier value of the transaction manager bean.
For example, using the qualifier notation, the following Java code
[source,java]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public class TransactionalService {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Transactional("order")
public void setSomething(String name) { ... }</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    @Transactional("account")
    public void doSomething() { ... }
  }
---- could be combined with the following transaction manager bean declarations in the application context.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
  &lt;tx:annotation-driven/&gt;

  &lt;bean id="transactionManager1" class="org.springframework.jdbc.DataSourceTransactionManager"&gt;
    ...
    &lt;qualifier value="order"/&gt;
  &lt;/bean&gt;

  &lt;bean id="transactionManager2" class="org.springframework.jdbc.DataSourceTransactionManager"&gt;
    ...
    &lt;qualifier value="account"/&gt;
  &lt;/bean&gt;
---- In this case, the two methods on `TransactionalService` will run under separate transaction managers, differentiated by the "order" and "account" qualifiers.
The default `&lt;tx:annotation-driven&gt;` target bean name `transactionManager` will still be used if no specifically qualified PlatformTransactionManager bean is found.


==== Custom shortcut annotations

 If you find you are repeatedly using the same attributes with [interface]`@Transactional` on many different methods, then Spring's meta-annotation support allows you to define custom shortcut annotations for your specific use cases.
For example, defining the following annotations
[source,java]</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Transactional("order")
public @interface OrderTx {
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  @Target({ElementType.METHOD, ElementType.TYPE})
  @Retention(RetentionPolicy.RUNTIME)
  @Transactional("account")
  public @interface AccountTx {
  }
---- allows us to write the example from the previous section as</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
  public class TransactionalService {

    @OrderTx
    public void setSomething(String name) { ... }

    @AccountTx
    public void doSomething() { ... }
  }
---- Here we have used the syntax to define the transaction manager qualifier, but could also have included propagation behavior, rollback rules, timeouts etc.


=== Transaction propagation

This section describes some semantics of transaction propagation in Spring.
Please note that this section is not an introduction to transaction propagation proper; rather it details some of the semantics regarding transaction propagation in Spring.

In Spring-managed transactions, be aware of the difference between _physical_ and _logical_ transactions, and how the propagation setting applies to this difference.

==== Required



When the propagation setting is `PROPAGATION_REQUIRED`, a _logical_ transaction scope is created for each method upon which the setting is applied.
Each such logical transaction scope can determine rollback-only status individually, with an outer transaction scope being logically independent from the inner transaction scope.
Of course, in case of standard `PROPAGATION_REQUIRED` behavior, all these scopes will be mapped to the same physical transaction.
So a rollback-only marker set in the inner transaction scope does affect the outer transaction's chance to actually commit (as you would expect it to).

However, in the case where an inner transaction scope sets the rollback-only marker, the outer transaction has not decided on the rollback itself, and so the rollback (silently triggered by the inner transaction scope) is unexpected.
A corresponding [class]`UnexpectedRollbackException` is thrown at that point.
This is _expected behavior_ so that the caller of a transaction can never be misled to assume that a commit was performed when it really was not.
So if an inner transaction (of which the outer caller is not aware) silently marks a transaction as rollback-only, the outer caller still calls commit.
The outer caller needs to receive an [class]`UnexpectedRollbackException` to indicate clearly that a rollback was performed instead.

==== RequiresNew



`PROPAGATION_REQUIRES_NEW`, in contrast to , uses a _completely_ independent transaction for each affected transaction scope.
In that case, the underlying physical transactions are different and hence can commit or roll back independently, with an outer transaction not affected by an inner transaction's rollback status.

==== Nested

`PROPAGATION_NESTED` uses a _single_ physical transaction with multiple savepoints that it can roll back to.
Such partial rollbacks allow an inner transaction scope to trigger a rollback _for its
        scope_, with the outer transaction being able to continue the physical transaction despite some operations having been rolled back.
This setting is typically mapped onto JDBC savepoints, so will only work with JDBC resource transactions.
See Spring's [class]`DataSourceTransactionManager`.

=== Advising transactional operations

Suppose you want to execute _both_ transactional _and_ some basic profiling advice.
How do you effect this in the context of `&lt;tx:annotation-driven/&gt;`?

When you invoke the [method]`updateFoo(Foo)` method, you want to see the following actions:

[]
. Configured profiling aspect starts up.
. Transactional advice executes.
. Method on the advised object executes.
. Transaction commits.
. Profiling aspect reports exact duration of the whole transactional method invocation.

NOTE: This chapter is not concerned with explaining AOP in any great detail (except as it applies to transactions).
See &lt;&lt;aop&gt;&gt; for detailed coverage of the following AOP configuration and AOP in general.

Here is the code for a simple profiling aspect discussed above.
The ordering of advice is controlled through the [interface]`Ordered` interface.
For full details on advice ordering, see &lt;&lt;aop-ataspectj-advice-ordering&gt;&gt;.

[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>package x.y;</p>
</div>
<div class="paragraph">
<p>import org.aspectj.lang.ProceedingJoinPoint;
import org.springframework.util.StopWatch;
import org.springframework.core.Ordered;</p>
</div>
<div class="paragraph">
<p>public class SimpleProfiler implements Ordered {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private int order;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// allows us to control the ordering of advice
public int getOrder() {
  return this.order;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setOrder(int order) {
  this.order = order;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  // this method *is* the around advice
  public Object profile(ProceedingJoinPoint call) throws Throwable {
    Object returnValue;
    StopWatch clock = new StopWatch(getClass().getName());
    try {
      clock.start(call.toShortString());
      returnValue = call.proceed();
    } finally {
      clock.stop();
      System.out.println(clock.prettyPrint());
    }
    return returnValue;
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:tx="http://www.springframework.org/schema/tx"
     xsi:schemaLocation="
   <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
   <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
   <a href="http://www.springframework.org/schema/tx">http://www.springframework.org/schema/tx</a>
   <a href="http://www.springframework.org/schema/tx/spring-tx.xsd">http://www.springframework.org/schema/tx/spring-tx.xsd</a>
   <a href="http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop</a>
   <a href="http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;">http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- this is the aspect --&gt;
&lt;bean id="profiler" class="x.y.SimpleProfiler"&gt;
  &lt;!-- execute before the transactional advice (hence the lower order number) --&gt;
  &lt;property name="order" value="1"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;tx:annotation-driven transaction-manager="txManager" order="200"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:config&gt;
  &lt;!-- this advice will execute around the transactional advice --&gt;
  &lt;aop:aspect id="profilingAspect" ref="profiler"&gt;
    &lt;aop:pointcut id="serviceMethodWithReturnValue"
            expression="execution(!void x.y..*Service.*(..))"/&gt;
    &lt;aop:around method="profile" pointcut-ref="serviceMethodWithReturnValue"/&gt;
  &lt;/aop:aspect&gt;
&lt;/aop:config&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
  &lt;property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/&gt;
  &lt;property name="url" value="jdbc:oracle:thin:@rj-t42:1521:elvis"/&gt;
  &lt;property name="username" value="scott"/&gt;
  &lt;property name="password" value="tiger"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
  &lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The result of the above configuration is a `fooService` bean that has profiling and transactional aspects applied to it _in the desired order_.
You configure any number of additional aspects in similar fashion.

The following example effects the same setup as above, but uses the purely XML declarative approach.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:tx="http://www.springframework.org/schema/tx"
     xsi:schemaLocation="
   <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
   <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
   <a href="http://www.springframework.org/schema/tx">http://www.springframework.org/schema/tx</a>
   <a href="http://www.springframework.org/schema/tx/spring-tx.xsd">http://www.springframework.org/schema/tx/spring-tx.xsd</a>
   <a href="http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop</a>
   <a href="http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;">http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- the profiling advice --&gt;
&lt;bean id="profiler" class="x.y.SimpleProfiler"&gt;
  &lt;!-- execute before the transactional advice (hence the lower order number) --&gt;
  &lt;property name="order" value="1"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:config&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:pointcut id="entryPointMethod" expression="execution(* x.y..*Service.*(..))"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- will execute after the profiling advice (c.f. the order attribute) --&gt;
&lt;aop:advisor
    advice-ref="txAdvice"
    pointcut-ref="entryPointMethod"
    order="2"/&gt; &lt;!-- order value is higher than the profiling aspect --&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;aop:aspect id="profilingAspect" ref="profiler"&gt;
  &lt;aop:pointcut id="serviceMethodWithReturnValue"
          expression="execution(!void x.y..*Service.*(..))"/&gt;
  &lt;aop:around method="profile" pointcut-ref="serviceMethodWithReturnValue"/&gt;
&lt;/aop:aspect&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/aop:config&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
  &lt;tx:attributes&gt;
    &lt;tx:method name="get*" read-only="true"/&gt;
    &lt;tx:method name="*"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- other &lt;bean/&gt; definitions such as a DataSource and a PlatformTransactionManager here --&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The result of the above configuration will be a `fooService` bean that has profiling and transactional aspects applied to it _in that order_.
If you want the profiling advice to execute _after_ the transactional advice on the way in, and _before_ the transactional advice on the way out, then you simply swap the value of the profiling aspect bean's `order` property so that it is higher than the transactional advice's order value.

You configure additional aspects in similar fashion.

=== Using [interface]`@Transactional` with AspectJ

It is also possible to use the Spring Framework's [interface]`@Transactional` support outside of a Spring container by means of an AspectJ aspect.
To do so, you first annotate your classes (and optionally your classes' methods) with the [interface]`@Transactional` annotation, and then you link (weave) your application with the [class]`org.springframework.transaction.aspectj.AnnotationTransactionAspect` defined in the [file]`spring-aspects.jar` file.
The aspect must also be configured with a transaction manager.
You can of course use the Spring Framework's IoC container to take care of dependency-injecting the aspect.
The simplest way to configure the transaction management aspect is to use the `&lt;tx:annotation-driven/&gt;` element and specify the `mode` attribute to `aspectj` as described in &lt;&lt;transaction-declarative-annotations&gt;&gt;.
Because we're focusing here on applications running outside of a Spring container, we'll show you how to do it programmatically.

NOTE: Prior to continuing, you may want to read &lt;&lt;transaction-declarative-annotations&gt;&gt; and &lt;&lt;aop&gt;&gt; respectively.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>DataSourceTransactionManager txManager = new DataSourceTransactionManager(getDataSource());</p>
</div>
<div class="paragraph">
<p>AnnotationTransactionAspect.aspectOf().setTransactionManager(txManager);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: When using this aspect, you must annotate the _implementation_ class (and/or methods within that class), _not_ the interface (if any) that the class implements.
AspectJ follows Java's rule that annotations on interfaces are _not inherited_.

The [interface]`@Transactional` annotation on a class specifies the default transaction semantics for the execution of any method in the class.

The [interface]`@Transactional` annotation on a method within the class overrides the default transaction semantics given by the class annotation (if present).
Any method may be annotated, regardless of visibility.

To weave your applications with the [class]`AnnotationTransactionAspect` you must either build your application with AspectJ (see the &lt;&lt;,AspectJ
      Development Guide&gt;&gt;) or use load-time weaving.
See &lt;&lt;aop-aj-ltw&gt;&gt; for a discussion of load-time weaving with AspectJ.

== Programmatic transaction management

The Spring Framework provides two means of programmatic transaction management:

* Using the [class]`TransactionTemplate`.
* Using a [interface]`PlatformTransactionManager` implementation directly.

The Spring team generally recommends the [class]`TransactionTemplate` for programmatic transaction management.
The second approach is similar to using the JTA [interface]`UserTransaction` API, although exception handling is less cumbersome.

=== Using the [class]`TransactionTemplate`

The [class]`TransactionTemplate` adopts the same approach as other Spring _templates_ such as the [class]`JdbcTemplate`.
It uses a callback approach, to free application code from having to do the boilerplate acquisition and release of transactional resources, and results in code that is intention driven, in that the code that is written focuses solely on what the developer wants to do.

NOTE: As you will see in the examples that follow, using the [class]`TransactionTemplate` absolutely couples you to Spring's transaction infrastructure and APIs.
Whether or not programmatic transaction management is suitable for your development needs is a decision that you will have to make yourself.

Application code that must execute in a transactional context, and that will use the [class]`TransactionTemplate` explicitly, looks like the following.
You, as an application developer, write a [interface]`TransactionCallback` implementation (typically expressed as an anonymous inner class) that contains the code that you need to execute in the context of a transaction.
You then pass an instance of your custom [interface]`TransactionCallback` to the [method]`execute(..)` method exposed on the [class]`TransactionTemplate`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class SimpleService implements Service {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// single TransactionTemplate shared amongst all methods in this instance
private final TransactionTemplate transactionTemplate;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// use constructor-injection to supply the PlatformTransactionManager
public SimpleService(PlatformTransactionManager transactionManager) {
  Assert.notNull(transactionManager, "The 'transactionManager' argument must not be null.");
  this.transactionTemplate = new TransactionTemplate(transactionManager);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Object someServiceMethod() {
  return transactionTemplate.execute(new TransactionCallback() {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>      // the code in this method executes in a transactional context
      public Object doInTransaction(TransactionStatus status) {
        updateOperation1();
        return resultOfUpdateOperation2();
      }
    });
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
If there is no return value, use the convenient [class]`TransactionCallbackWithoutResult` class with an anonymous class as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>transactionTemplate.execute(new TransactionCallbackWithoutResult() {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  protected void doInTransactionWithoutResult(TransactionStatus status) {
    updateOperation1();
    updateOperation2();
  }
});</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Code within the callback can roll the transaction back by calling the `setRollbackOnly()` method on the supplied [interface]`TransactionStatus` object:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>transactionTemplate.execute(new TransactionCallbackWithoutResult() {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  protected void doInTransactionWithoutResult(TransactionStatus status) {
    try {
      updateOperation1();
      updateOperation2();
    } catch (SomeBusinessExeption ex) {
      status.setRollbackOnly();
    }
  }
});</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== Specifying transaction settings

You can specify transaction settings such as the propagation mode, the isolation level, the timeout, and so forth on the [class]`TransactionTemplate` either programmatically or in configuration.
[class]`TransactionTemplate` instances by default have the &lt;&lt;transaction-declarative-txadvice-settings,default
        transactional settings&gt;&gt;.
The following example shows the programmatic customization of the transactional settings for a specific [class]`TransactionTemplate:`

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class SimpleService implements Service {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private final TransactionTemplate transactionTemplate;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public SimpleService(PlatformTransactionManager transactionManager) {
  Assert.notNull(transactionManager, "The 'transactionManager' argument must not be null.");
  this.transactionTemplate = new TransactionTemplate(transactionManager);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    // the transaction settings can be set here explicitly if so desired
    this.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED);
    this.transactionTemplate.setTimeout(30); // 30 seconds
    // and so forth...
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The following example defines a [class]`TransactionTemplate` with some custom transactional settings, using Spring XML configuration.
The `sharedTransactionTemplate` can then be injected into as many services as are required.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="sharedTransactionTemplate"
    class="org.springframework.transaction.support.TransactionTemplate"&gt;
  &lt;property name="isolationLevelName" value="ISOLATION_READ_UNCOMMITTED"/&gt;
  &lt;property name="timeout" value="30"/&gt;
&lt;/bean&gt;"</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Finally, instances of the [class]`TransactionTemplate` class are threadsafe, in that instances do not maintain any conversational state.
[class]`TransactionTemplate` instances _do_ however maintain configuration state, so while a number of classes may share a single instance of a [class]`TransactionTemplate`, if a class needs to use a [class]`TransactionTemplate` with different settings (for example, a different isolation level), then you need to create two distinct [class]`TransactionTemplate` instances.

=== Using the [interface]`PlatformTransactionManager`

You can also use the [interface]`org.springframework.transaction.PlatformTransactionManager` directly to manage your transaction.
Simply pass the implementation of the [interface]`PlatformTransactionManager` you are using to your bean through a bean reference.
Then, using the [interface]`TransactionDefinition` and [interface]`TransactionStatus` objects you can initiate transactions, roll back, and commit.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>DefaultTransactionDefinition def = new DefaultTransactionDefinition();
def.setName("SomeTxName");
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);</p>
</div>
<div class="paragraph">
<p>TransactionStatus status = txManager.getTransaction(def);
try {
  // execute your business logic here
}
catch (MyException ex) {
  txManager.rollback(status);
  throw ex;
}
txManager.commit(status);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Choosing between programmatic and declarative transaction management

Programmatic transaction management is usually a good idea only if you have a small number of transactional operations.
For example, if you have a web application that require transactions only for certain update operations, you may not want to set up transactional proxies using Spring or any other technology.
In this case, using the [class]`TransactionTemplate` _may_ be a good approach.
Being able to set the transaction name explicitly is also something that can only be done using the programmatic approach to transaction management.

On the other hand, if your application has numerous transactional operations, declarative transaction management is usually worthwhile.
It keeps transaction management out of business logic, and is not difficult to configure.
When using the Spring Framework, rather than EJB CMT, the configuration cost of declarative transaction management is greatly reduced.

== Application server-specific integration

Spring's transaction abstraction generally is application server agnostic.
Additionally, Spring's [class]`JtaTransactionManager` class, which can optionally perform a JNDI lookup for the JTA [interface]`UserTransaction` and [interface]`TransactionManager` objects, autodetects the location for the latter object, which varies by application server.
Having access to the JTA [interface]`TransactionManager` allows for enhanced transaction semantics, in particular supporting transaction suspension.
See the [class]`JtaTransactionManager` Javadocs for details.

Spring's [class]`JtaTransactionManager` is the standard choice to run on Java EE application servers, and is known to work on all common servers.
Advanced functionality such as transaction suspension works on many servers as well -- including GlassFish, JBoss and Geronimo -- without any special configuration required.
However, for fully supported transaction suspension and further advanced integration, Spring ships special adapters for WebLogic Server and WebSphere.
These adapters are discussed in the following sections.

_For standard scenarios, including WebLogic Server and
    WebSphere, consider using the convenient
    `&lt;tx:jta-transaction-manager/&gt;` configuration
    element._ When configured, this element automatically detects the underlying server and chooses the best transaction manager available for the platform.
This means that you won't have to configure server-specific adapter classes (as discussed in the following sections) explicitly; rather, they are chosen automatically, with the standard [class]`JtaTransactionManager` as default fallback.

=== IBM WebSphere

On WebSphere 6.1.0.9 and above, the recommended Spring JTA transaction manager to use is [class]`WebSphereUowTransactionManager`.
This special adapter leverages IBM's [interface]`UOWManager` API, which is available in WebSphere Application Server 6.0.2.19 and later and 6.1.0.9 and later.
With this adapter, Spring-driven transaction suspension (suspend/resume as initiated by `PROPAGATION_REQUIRES_NEW`) is officially supported by IBM!

=== Oracle WebLogic Server

On WebLogic Server 9.0 or above, you typically would use the [class]`WebLogicJtaTransactionManager` instead of the stock [class]`JtaTransactionManager` class.
This special WebLogic-specific subclass of the normal [class]`JtaTransactionManager` supports the full power of Spring's transaction definitions in a WebLogic-managed transaction environment, beyond standard JTA semantics: Features include transaction names, per-transaction isolation levels, and proper resuming of transactions in all cases.

== Solutions to common problems

=== Use of the wrong transaction manager for a specific [interface]`DataSource`

Use the _correct_ [interface]`PlatformTransactionManager` implementation based on your choice of transactional technologies and requirements. Used properly, the Spring Framework merely provides a straightforward and portable abstraction.
If you are using global transactions, you _must_ use the [class]`org.springframework.transaction.jta.JtaTransactionManager` class (or an &lt;&lt;transaction-application-server-integration,application
      server-specific subclass&gt;&gt; of it) for all your transactional operations.
Otherwise the transaction infrastructure attempts to perform local transactions on resources such as container [interface]`DataSource` instances.
Such local transactions do not make sense, and a good application server treats them as errors.

== Further Resources

For more information about the Spring Framework's transaction support:

* &lt;&lt;,"Distributed
          transactions in Spring, with and without XA"&gt;&gt; is a JavaWorld presentation in which SpringSource's David Syer guides you through seven patterns for distributed transactions in Spring applications, three of them with XA and four without.
* &lt;&lt;,Java
          Transaction Design Strategies&gt;&gt; is a book available from &lt;&lt;,InfoQ&gt;&gt; that provides a well-paced introduction to transactions in Java.
  It also includes side-by-side examples of how to configure and use transactions with both the Spring Framework and EJB3.


= DAO support

== Introduction

The Data Access Object (DAO) support in Spring is aimed at making it easy to work with data access technologies like JDBC, Hibernate, JPA or JDO in a consistent way.
This allows one to switch between the aforementioned persistence technologies fairly easily and it also allows one to code without worrying about catching exceptions that are specific to each technology.

== Consistent exception hierarchy

Spring provides a convenient translation from technology-specific exceptions like [class]`SQLException` to its own exception class hierarchy with the [class]`DataAccessException` as the root exception.
These exceptions wrap the original exception so there is never any risk that one might lose any information as to what might have gone wrong.

In addition to JDBC exceptions, Spring can also wrap Hibernate-specific exceptions, converting them from proprietary, checked exceptions (in the case of versions of Hibernate prior to Hibernate 3.0), to a set of focused runtime exceptions (the same is true for JDO and JPA exceptions).
This allows one to handle most persistence exceptions, which are non-recoverable, only in the appropriate layers, without having annoying boilerplate catch-and-throw blocks and exception declarations in one's DAOs.
(One can still trap and handle exceptions anywhere one needs to though.) As mentioned above, JDBC exceptions (including database-specific dialects) are also converted to the same hierarchy, meaning that one can perform some operations with JDBC within a consistent programming model.

The above holds true for the various template classes in Springs support for various ORM frameworks.
If one uses the interceptor-based classes then the application must care about handling [class]`HibernateExceptions` and [class]`JDOExceptions` itself, preferably via delegating to [class]`SessionFactoryUtils`' [method]`convertHibernateAccessException(..)` or [method]`convertJdoAccessException()` methods respectively.
These methods convert the exceptions to ones that are compatible with the exceptions in the `org.springframework.dao` exception hierarchy.
As [class]`JDOExceptions` are unchecked, they can simply get thrown too, sacrificing generic DAO abstraction in terms of exceptions though.

The exception hierarchy that Spring provides can be seen below.
(Please note that the class hierarchy detailed in the image shows only a subset of the entire [class]`DataAccessException` hierarchy.)

== Annotations used for configuring DAO or Repository classes

The best way to guarantee that your Data Access Objects (DAOs) or repositories provide exception translation is to use the [interface]`@Repository` annotation.
This annotation also allows the component scanning support to find and configure your DAOs and repositories without having to provide XML configuration entries for them.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Repository
public class SomeMovieFinder implements MovieFinder {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// ...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Any DAO or repository implementation will need to access to a persistence resource, depending on the persistence technology used; for example, a JDBC-based repository will need access to a JDBC [interface]`DataSource`; a JPA-based repository will need access to an [interface]`EntityManager`.
The easiest way to accomplish this is to have this resource dependency injected using one of the [interface]`@Autowired,`, [interface]`@Inject`, [interface]`@Resource` or [interface]`@PersistenceContext` annotations.
Here is an example for a JPA repository:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Repository
public class JpaMovieFinder implements MovieFinder {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@PersistenceContext
private EntityManager entityManager;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// ...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If you are using the classic Hibernate APIs than you can inject the SessionFactory:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Repository
public class HibernateMovieFinder implements MovieFinder {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private SessionFactory sessionFactory;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
public void setSessionFactory(SessionFactory sessionFactory) {
    this.sessionFactory = sessionFactory;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// ...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Last example we will show here is for typical JDBC support.
You would have the [class]`DataSource` injected into an initialization method where you would create a [class]`JdbcTemplate` and other data access support classes like [class]`SimpleJdbcCall` etc using this [class]`DataSource`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Repository
public class JdbcMovieFinder implements MovieFinder {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private JdbcTemplate jdbcTemplate;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
public void init(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// ...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: Please see the specific coverage of each persistence technology for details on how to configure the application context to take advantage of these annotations.



= Data access with JDBC

== Introduction to Spring Framework JDBC

The value-add provided by the Spring Framework JDBC abstraction is perhaps best shown by the sequence of actions outlined in the table below.
The table shows what actions Spring will take care of and which actions are the responsibility of you, the application developer.

.Spring JDBC - who does what?
[cols="1,1,1", options="header"]
|===
| Action
| Spring
| You
|









|===

The Spring Framework takes care of all the low-level details that can make JDBC such a tedious API to develop with.

=== Choosing an approach for JDBC database access

You can choose among several approaches to form the basis for your JDBC database access.
In addition to three flavors of the JdbcTemplate, a new SimpleJdbcInsert and SimplejdbcCall approach optimizes database metadata, and the RDBMS Object style takes a more object-oriented approach similar to that of JDO Query design.
Once you start using one of these approaches, you can still mix and match to include a feature from a different approach.
All approaches require a JDBC 2.0-compliant driver, and some advanced features require a JDBC 3.0 driver.

NOTE: Spring 3.0 updates all of the following approaches with Java 5 support such as generics and varargs.

* _JdbcTemplate_ is the classic Spring JDBC approach and the most popular.
  This "lowest level" approach and all others use a JdbcTemplate under the covers, and all are updated with Java 5 support such as generics and varargs.
* _NamedParameterJdbcTemplate_ wraps a `JdbcTemplate` to provide named parameters instead of the traditional JDBC "?" placeholders.
  This approach provides better documentation and ease of use when you have multiple parameters for an SQL statement.
* _SimpleJdbcInsert and
            SimpleJdbcCall_ optimize database metadata to limit the amount of necessary configuration.
  This approach simplifies coding so that you only need to provide the name of the table or procedure and provide a map of parameters matching the column names.
  This only works if the database provides adequate metadata.
  If the database doesn't provide this metadata, you will have to provide explicit configuration of the parameters.
* _RDBMS Objects including MappingSqlQuery,
            SqlUpdate and StoredProcedure_ requires you to create reusable and thread-safe objects during initialization of your data access layer.
  This approach is modeled after JDO Query wherein you define your query string, declare parameters, and compile the query.
  Once you do that, execute methods can be called multiple times with various parameter values passed in.

=== Package hierarchy

The Spring Framework's JDBC abstraction framework consists of four different packages, namely `core`, `datasource`, `object`, and `support`.

The `org.springframework.jdbc.core` package contains the [class]`JdbcTemplate` class and its various callback interfaces, plus a variety of related classes.
A subpackage named `org.springframework.jdbc.core.simple` contains the [class]`SimpleJdbcInsert` and [class]`SimpleJdbcCall` classes.
Another subpackage named `org.springframework.jdbc.core.namedparam` contains the [class]`NamedParameterJdbcTemplate` class and the related support classes.
See &lt;&lt;jdbc-core&gt;&gt;, &lt;&lt;jdbc-advanced-jdbc&gt;&gt;, and &lt;&lt;jdbc-simple-jdbc&gt;&gt;

The `org.springframework.jdbc.datasource` package contains a utility class for easy [interface]`DataSource` access, and various simple [interface]`DataSource` implementations that can be used for testing and running unmodified JDBC code outside of a Java EE container.
A subpackage named `org.springfamework.jdbc.datasource.embedded` provides support for creating in-memory database instances using Java database engines such as HSQL and H2.
See &lt;&lt;jdbc-connections&gt;&gt; and &lt;&lt;jdbc-embedded-database-support&gt;&gt;

The `org.springframework.jdbc.object` package contains classes that represent RDBMS queries, updates, and stored procedures as thread safe, reusable objects.
See &lt;&lt;jdbc-object&gt;&gt;.This approach is modeled by JDO, although of course objects returned by queries are  from the database.
This higher level of JDBC abstraction depends on the lower-level abstraction in the `org.springframework.jdbc.core` package.

The `org.springframework.jdbc.support` package provides [class]`SQLException` translation functionality and some utility classes.
Exceptions thrown during JDBC processing are translated to exceptions defined in the `org.springframework.dao` package.
This means that code using the Spring JDBC abstraction layer does not need to implement JDBC or RDBMS-specific error handling.
All translated exceptions are unchecked, which gives you the option of catching the exceptions from which you can recover while allowing other exceptions to be propagated to the caller.
See &lt;&lt;jdbc-SQLExceptionTranslator&gt;&gt;.

== Using the JDBC core classes to control basic JDBC processing and error handling

=== [class]`JdbcTemplate`

The [class]`JdbcTemplate` class is the central class in the JDBC core package.
It handles the creation and release of resources, which helps you avoid common errors such as forgetting to close the connection.
It performs the basic tasks of the core JDBC workflow such as statement creation and execution, leaving application code to provide SQL and extract results.
The [class]`JdbcTemplate` class executes SQL queries, update statements and stored procedure calls, performs iteration over [interface]`ResultSet`s and extraction of returned parameter values. It also catches JDBC exceptions and translates them to the generic, more informative, exception hierarchy defined in the `org.springframework.dao` package.

When you use the [class]`JdbcTemplate` for your code, you only need to implement callback interfaces, giving them a clearly defined contract.
The [interface]`PreparedStatementCreator` callback interface creates a prepared statement given a [interface]`Connection` provided by this class, providing SQL and any necessary parameters.
The same is true for the [interface]`CallableStatementCreator` interface, which creates callable statements.
The [interface]`RowCallbackHandler` interface extracts values from each row of a [interface]`ResultSet`.

The [class]`JdbcTemplate` can be used within a DAO implementation through direct instantiation with a [interface]`DataSource` reference, or be configured in a Spring IoC container and given to DAOs as a bean reference.


NOTE: The [interface]`DataSource` should always be configured as a bean in the Spring IoC container.
In the first case the bean is given to the service directly; in the second case it is given to the prepared template.

All SQL issued by this class is logged at the `DEBUG` level under the category corresponding to the fully qualified class name of the template instance (typically [class]`JdbcTemplate`, but it may be different if you are using a custom subclass of the [class]`JdbcTemplate` class).

==== Examples of JdbcTemplate class usage

This section provides some examples of [class]`JdbcTemplate` class usage.
These examples are not an exhaustive list of all of the functionality exposed by the [class]`JdbcTemplate`; see the attendant Javadocs for that.

===== Querying (SELECT)

Here is a simple query for getting the number of rows in a relation:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>int rowCount = this.jdbcTemplate.queryForObject("select count(*) from t_actor", Integer.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
A simple query using a bind variable:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>int countOfActorsNamedJoe = this.jdbcTemplate.queryForObject(
        "select count(*) from t_actor where first_name = ?", Integer.class, "Joe");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Querying for a [class]`String`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>String lastName = this.jdbcTemplate.queryForObject(
        "select last_name from t_actor where id = ?",
        new Object[]{1212l}, String.class);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Querying and populating a _single_ domain object:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Actor actor = this.jdbcTemplate.queryForObject(
        "select first_name, last_name from t_actor where id = ?",
        new Object[]{1212l},
        new RowMapper&lt;Actor&gt;() {
            public Actor mapRow(ResultSet rs, int rowNum) throws SQLException {
                Actor actor = new Actor();
                actor.setFirstName(rs.getString("first_name"));
                actor.setLastName(rs.getString("last_name"));
                return actor;
            }
        });</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Querying and populating a number of domain objects:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>List&lt;Actor&gt; actors = this.jdbcTemplate.query(
        "select first_name, last_name from t_actor",
        new RowMapper&lt;Actor&gt;() {
            public Actor mapRow(ResultSet rs, int rowNum) throws SQLException {
                Actor actor = new Actor();
                actor.setFirstName(rs.getString("first_name"));
                actor.setLastName(rs.getString("last_name"));
                return actor;
            }
        });</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If the last two snippets of code actually existed in the same application, it would make sense to remove the duplication present in the two [interface]`RowMapper` anonymous inner classes, and extract them out into a single class (typically a `static` inner class) that can then be referenced by DAO methods as needed.
For example, it may be better to write the last code snippet as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public List&lt;Actor&gt; findAllActors() {
    return this.jdbcTemplate.query( "select first_name, last_name from t_actor", new ActorMapper());
}</p>
</div>
<div class="paragraph">
<p>private static final class ActorMapper implements RowMapper&lt;Actor&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public Actor mapRow(ResultSet rs, int rowNum) throws SQLException {
        Actor actor = new Actor();
        actor.setFirstName(rs.getString("first_name"));
        actor.setLastName(rs.getString("last_name"));
        return actor;
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
===== Updating (INSERT/UPDATE/DELETE) with jdbcTemplate

You use the [method]`update(..)` method to perform insert, update and delete operations.
Parameter values are usually provided as var args or alternatively as an object array.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>this.jdbcTemplate.update(
        "insert into t_actor (first_name, last_name) values (?, ?)",
        "Leonor", "Watling");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>this.jdbcTemplate.update(
        "update t_actor set last_name = ? where id = ?",
        "Banjo", 5276L);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>this.jdbcTemplate.update(
        "delete from actor where id = ?",
        Long.valueOf(actorId));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
===== Other jdbcTemplate operations

You can use the [method]`execute(..)` method to execute any arbitrary SQL, and as such the method is often used for DDL statements.
It is heavily overloaded with variants taking callback interfaces, binding variable arrays, and so on.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>this.jdbcTemplate.execute("create table mytable (id integer, name varchar(100))");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The following example invokes a simple stored procedure.
More sophisticated stored procedure support is &lt;&lt;jdbc-StoredProcedure,covered later&gt;&gt;.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>this.jdbcTemplate.update(
        "call SUPPORT.REFRESH_ACTORS_SUMMARY(?)",
        Long.valueOf(unionId));</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== [class]`JdbcTemplate` best practices

Instances of the [class]`JdbcTemplate` class are _threadsafe once configured_.
This is important because it means that you can configure a single instance of a [class]`JdbcTemplate` and then safely inject this _shared_ reference into multiple DAOs (or repositories).
The [class]`JdbcTemplate` is stateful, in that it maintains a reference to a [interface]`DataSource`, but this state is _not_ conversational state.

A common practice when using the [class]`JdbcTemplate` class (and the associated &lt;&lt;jdbc-NamedParameterJdbcTemplate,[class]`NamedParameterJdbcTemplate`&gt;&gt; classes) is to configure a [interface]`DataSource` in your Spring configuration file, and then dependency-inject that shared [interface]`DataSource` bean into your DAO classes; the [class]`JdbcTemplate` is created in the setter for the [interface]`DataSource`.
This leads to DAOs that look in part like the following:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class JdbcCorporateEventDao implements CorporateEventDao {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private JdbcTemplate jdbcTemplate;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    // JDBC-backed implementations of the methods on the CorporateEventDao follow...
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The corresponding configuration might look like this.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
        <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
        <a href="http://www.springframework.org/schema/context">http://www.springframework.org/schema/context</a>
        <a href="http://www.springframework.org/schema/context/spring-context.xsd"&gt;">http://www.springframework.org/schema/context/spring-context.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="corporateEventDao" class="com.example.JdbcCorporateEventDao"&gt;
    &lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="url" value="${jdbc.url}"/&gt;
    &lt;property name="username" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;context:property-placeholder location="jdbc.properties"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
An alternative to explicit configuration is to use component-scanning and annotation support for dependency injection.
In this case you annotate the class with [interface]`@Repository` (which makes it a candidate for component-scanning) and annotate the [class]`DataSource` setter method with [interface]`@Autowired`.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>@Repository
public class JdbcCorporateEventDao implements CorporateEventDao {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private JdbcTemplate jdbcTemplate;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    // JDBC-backed implementations of the methods on the CorporateEventDao follow...
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The corresponding XML configuration file would look like the following:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
        <a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>
        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
        <a href="http://www.springframework.org/schema/context">http://www.springframework.org/schema/context</a>
        <a href="http://www.springframework.org/schema/context/spring-context.xsd"&gt;">http://www.springframework.org/schema/context/spring-context.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- Scans within the base package of the application for @Components to configure as beans --&gt;
&lt;context:component-scan base-package="org.springframework.docs.test" /&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="url" value="${jdbc.url}"/&gt;
    &lt;property name="username" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;context:property-placeholder location="jdbc.properties"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;
----If you are using Spring&#8217;s <code class="class">JdbcDaoSupport</code> class, and your various JDBC-backed DAO classes extend from it, then your sub-class inherits a <code class="method">setDataSource(..)</code> method from the <code class="class">JdbcDaoSupport</code> class.
You can choose whether to inherit from this class.
The <code class="class">JdbcDaoSupport</code> class is provided as a convenience only.</p>
</div>
<div class="paragraph">
<p>Regardless of which of the above template initialization styles you choose to use (or not), it is seldom necessary to create a new instance of a <code class="class">JdbcTemplate</code> class each time you want to execute SQL. Once configured, a <code class="class">JdbcTemplate</code> instance is threadsafe.
You may want multiple <code class="class">JdbcTemplate</code> instances if your application accesses multiple databases, which requires multiple <code class="interface">DataSources</code>, and subsequently multiple differently configured <code class="class">JdbcTemplates</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-namedparameterjdbctemplate-code"><a class="anchor" href="#code-class-class-namedparameterjdbctemplate-code"></a><code class="class">NamedParameterJdbcTemplate</code></h3>
<div class="paragraph">
<p>The <code class="class">NamedParameterJdbcTemplate</code> class adds support for programming JDBC statements using named parameters, as opposed to programming JDBC statements using only classic placeholder (<code>'?'</code>) arguments.
The <code class="class">NamedParameterJdbcTemplate</code> class wraps a <code class="class">JdbcTemplate</code>, and delegates to the wrapped <code class="class">JdbcTemplate</code> to do much of its work.
This section describes only those areas of the <code class="class">NamedParameterJdbcTemplate</code> class that differ from the <code class="class">JdbcTemplate</code> itself; namely, programming JDBC statements using named parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// some JDBC-backed DAO class...
private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}

public int countOfActorsByFirstName(String firstName) {

    String sql = "select count(*) from T_ACTOR where first_name = :first_name";

    SqlParameterSource namedParameters = new MapSqlParameterSource("first_name", firstName);

    return this.namedParameterJdbcTemplate.queryForObject(sql, Integer.class, namedParameters);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the use of the named parameter notation in the value assigned to the <code>sql</code> variable, and the corresponding value that is plugged into the <code>namedParameters</code> variable (of type <code class="class">MapSqlParameterSource</code>).</p>
</div>
<div class="paragraph">
<p>Alternatively, you can pass along named parameters and their corresponding values to a <code class="class">NamedParameterJdbcTemplate</code> instance by using the <code class="interface">Map</code>-based style.The remaining methods exposed by the <code class="interface">NamedParameterJdbcOperations</code> and implemented by the <code class="class">NamedParameterJdbcTemplate</code> class follow a similar pattern and are not covered here.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of the <code class="interface">Map</code>-based style.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// some JDBC-backed DAO class...
private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}

public int countOfActorsByFirstName(String firstName) {

    String sql = "select count(*) from T_ACTOR where first_name = :first_name";

    Map&lt;String, String&gt; namedParameters = Collections.singletonMap("first_name", firstName);

    return this.namedParameterJdbcTemplate.queryForObject(sql, Integer.class, namedParameters);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One nice feature related to the <code class="class">NamedParameterJdbcTemplate</code> (and existing in the same Java package) is the <code class="class">SqlParameterSource</code> interface.
You have already seen an example of an implementation of this interface in one of the previous code snippet (the <code class="class">MapSqlParameterSource</code> class).
 An <code class="class">SqlParameterSource</code> is a source of named parameter values to a <code class="class">NamedParameterJdbcTemplate</code>.
The <code class="class">MapSqlParameterSource</code> class is a very simple implementation that is simply an adapter around a <code class="interface">java.util.Map</code>, where the keys are the parameter names and the values are the parameter values.</p>
</div>
<div class="paragraph">
<p>Another <code class="interface">SqlParameterSource</code> implementation is the <code class="class">BeanPropertySqlParameterSource</code> class.
This class wraps an arbitrary JavaBean (that is, an instance of a class that adheres to &lt;&lt;,the JavaBean
      conventions&gt;&gt;), and uses the properties of the wrapped JavaBean as the source of named parameter values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class Actor {

    private Long id;
    private String firstName;
    private String lastName;

    public String getFirstName() {
        return this.firstName;
    }

    public String getLastName() {
        return this.lastName;
    }

    public Long getId() {
        return this.id;
    }

    // setters omitted...

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// some JDBC-backed DAO class...
private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}

public int countOfActors(Actor exampleActor) {

    // notice how the named parameters match the properties of the above 'Actor' class
    String sql =
        "select count(*) from T_ACTOR where first_name = :firstName and last_name = :lastName";

    SqlParameterSource namedParameters = new BeanPropertySqlParameterSource(exampleActor);

    return this.namedParameterJdbcTemplate.queryForObject(sql, Integer.class, namedParameters);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that the <code class="class">NamedParameterJdbcTemplate</code> class <em>wraps</em> a classic <code class="class">JdbcTemplate</code> template; if you need access to the wrapped <code class="class">JdbcTemplate</code> instance to access functionality only present in the <code class="class">JdbcTemplate</code> class, you can use the <code class="method">getJdbcOperations()</code> method to access the wrapped <code class="class">JdbcTemplate</code> through the <code class="interface">JdbcOperations</code> interface.</p>
</div>
<div class="paragraph">
<p>See also <a href="#jdbc-JdbcTemplate-idioms">[jdbc-JdbcTemplate-idioms]</a> for guidelines on using the <code class="class">NamedParameterJdbcTemplate</code> class in the context of an application.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-interface-sqlexceptiontranslator-code"><a class="anchor" href="#code-class-interface-sqlexceptiontranslator-code"></a><code class="interface">SQLExceptionTranslator</code></h3>
<div class="paragraph">
<p><code class="interface">SQLExceptionTranslator</code> is an interface to be implemented by classes that can translate between <code class="class">SQLExceptions</code> and Spring&#8217;s own <code class="class">org.springframework.dao.DataAccessException</code>, which is agnostic in regard to data access strategy.
Implementations can be generic (for example, using SQLState codes for JDBC) or proprietary (for example, using Oracle error codes) for greater precision.</p>
</div>
<div class="paragraph">
<p><code class="class">SQLErrorCodeSQLExceptionTranslator</code> is the implementation of <code class="interface">SQLExceptionTranslator</code> that is used by default.
This implementation uses specific vendor codes.
It is more precise than the <code>SQLState</code> implementation.
The error code translations are based on codes held in a JavaBean type class called <code class="class">SQLErrorCodes</code>.
This class is created and populated by an <code class="class">SQLErrorCodesFactory</code> which as the name suggests is a factory for creating <code class="class">SQLErrorCodes</code> based on the contents of a configuration file named <code class="file">sql-error-codes.xml</code>.
This file is populated with vendor codes and based on the <code>DatabaseProductName</code> taken from the <code class="interface">DatabaseMetaData</code>.
The codes for the actual database you are using are used.</p>
</div>
<div class="paragraph">
<p>The <code class="class">SQLErrorCodeSQLExceptionTranslator</code> applies matching rules in the following sequence:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The <code class="class">SQLErrorCodesFactory</code> is used by default to define Error codes and custom exception translations.
They are looked up in a file named <code class="file">sql-error-codes.xml</code> from the classpath and the matching <code class="class">SQLErrorCodes</code> instance is located based on the database name from the database metadata of the database in use.
. Any custom translation implemented by a subclass.
  Normally the provided concrete <code class="class">SQLErrorCodeSQLExceptionTranslator</code> is used so this rule does not apply.
  It only applies if you have actually provided a subclass implementation.
. Any custom implementation of the <code class="class">SQLExceptionTranslator</code> interface that is provided as the <code class="class">customSqlExceptionTranslator</code> property of the <code class="class">SQLErrorCodes</code> class.
. The list of instances of the <code class="class">CustomSQLErrorCodesTranslation</code> class, provided for the <code class="class">customTranslations</code> property of the <code class="class">SQLErrorCodes</code> class, are searched for a match.
. Error code matching is applied.
. Use the fallback translator.
  <code class="class">SQLExceptionSubclassTranslator</code> is the default fallback translator.
  If this translation is not available then the next fallback translator is the <code class="class">SQLStateSQLExceptionTranslator</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can extend <code class="class">SQLErrorCodeSQLExceptionTranslator:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class CustomSQLErrorCodesTranslator extends SQLErrorCodeSQLExceptionTranslator {

    protected DataAccessException customTranslate(String task, String sql, SQLException sqlex) {
        if (sqlex.getErrorCode() == -12345) {
            return new DeadlockLoserDataAccessException(task, sqlex);
        }
        return null;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the specific error code <code>-12345</code> is translated and other errors are left to be translated by the default translator implementation.
To use this custom translator, it is necessary to pass it to the <code class="class">JdbcTemplate</code> through the method <code>setExceptionTranslator</code> and to use this <code class="class">JdbcTemplate</code> for all of the data access processing where this translator is needed.
Here is an example of how this custom translator can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>private JdbcTemplate jdbcTemplate;

public void setDataSource(DataSource dataSource) {
    // create a JdbcTemplate and set data source
    this.jdbcTemplate = new JdbcTemplate();
    this.jdbcTemplate.setDataSource(dataSource);
    // create a custom translator and set the DataSource for the default translation lookup
    CustomSQLErrorCodesTranslator tr = new CustomSQLErrorCodesTranslator();
    tr.setDataSource(dataSource);
    this.jdbcTemplate.setExceptionTranslator(tr);
}

public void updateShippingCharge(long orderId, long pct) {
    // use the prepared JdbcTemplate for this update
    this.jdbcTemplate.update(
        "update orders" +
            " set shipping_charge = shipping_charge * ? / 100" +
            " where id = ?"
        pct, orderId);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom translator is passed a data source in order to look up the error codes in <code>sql-error-codes.xml</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="executing-statements"><a class="anchor" href="#executing-statements"></a>Executing statements</h3>
<div class="paragraph">
<p>Executing an SQL statement requires very little code.
You need a <code class="interface">DataSource</code> and a <code class="class">JdbcTemplate</code>, including the convenience methods that are provided with the <code class="class">JdbcTemplate</code>.
The following example shows what you need to include for a minimal but fully functional class that creates a new table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import javax.sql.DataSource;
import org.springframework.jdbc.core.JdbcTemplate;

public class ExecuteAStatement {

    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public void doExecute() {
        this.jdbcTemplate.execute("create table mytable (id integer, name varchar(100))");
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-queries"><a class="anchor" href="#running-queries"></a>Running queries</h3>
<div class="paragraph">
<p>Some query methods return a single value.
To retrieve a count or a specific value from one row, use <code class="method">queryForObject(..)</code>.
The latter converts the returned JDBC <code class="class">Type</code> to the Java class that is passed in as an argument.
If the type conversion is invalid, then an  is thrown.
Here is an example that contains two query methods, one for an <code class="class">int</code> and one that queries for a <code class="class">String</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import javax.sql.DataSource;
import org.springframework.jdbc.core.JdbcTemplate;

public class RunAQuery {

    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public int getCount() {
        return this.jdbcTemplate.queryForObject("select count(*) from mytable", Integer.class);
    }

    public String getName() {
        return this.jdbcTemplate.queryForObject("select name from mytable", String.class);
    }

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the single result query methods, several methods return a list with an entry for each row that the query returned.
The most generic method is <code class="method">queryForList(..)</code> which returns a <code class="interface">List</code> where each entry is a <code class="interface">Map</code> with each entry in the map representing the column value for that row.
If you add a method to the above example to retrieve a list of all the rows, it would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
private JdbcTemplate jdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
}

public List&lt;Map&lt;String, Object&gt;&gt; getList() {
    return this.jdbcTemplate.queryForList("select * from mytable");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The list returned would look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>[{name=Bob, id=1}, {name=Mary, id=2}]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="updating-the-database"><a class="anchor" href="#updating-the-database"></a>Updating the database</h3>
<div class="paragraph">
<p>The following example shows a column updated for a certain primary key.
In this example, an SQL statement has placeholders for row parameters.
The parameter values can be passed in as varargs or alternatively as an array of objects.
Thus primitives should be wrapped in the primitive wrapper classes explicitly or using auto-boxing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import javax.sql.DataSource;

import org.springframework.jdbc.core.JdbcTemplate;

public class ExecuteAnUpdate {

    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public void setName(int id, String name) {
        this.jdbcTemplate.update(
                "update mytable set name = ? where id = ?",
                name, id);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-auto-generated-keys"><a class="anchor" href="#retrieving-auto-generated-keys"></a>Retrieving auto-generated keys</h3>
<div class="paragraph">
<p>An <code class="method">update()</code> convenience method supports the retrieval of primary keys generated by the database.
This support is part of the JDBC 3.0 standard; see Chapter 13.6 of the specification for details.
The method takes a <code class="class">PreparedStatementCreator</code> as its first argument, and this is the way the required insert statement is specified.
The other argument is a <code class="class">KeyHolder</code>, which contains the generated key on successful return from the update.
There is not a standard single way to create an appropriate <code class="class">PreparedStatement</code> (which explains why the method signature is the way it is).
The following example works on Oracle but may not work on other platforms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>final String INSERT_SQL = "insert into my_test (name) values(?)";
final String name = "Rob";

KeyHolder keyHolder = new GeneratedKeyHolder();
jdbcTemplate.update(
    new PreparedStatementCreator() {
        public PreparedStatement createPreparedStatement(Connection connection) throws SQLException {
            PreparedStatement ps =
                connection.prepareStatement(INSERT_SQL, new String[] {"id"});
            ps.setString(1, name);
            return ps;
        }
    },
    keyHolder);

// keyHolder.getKey() now contains the generated key</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controlling-database-connections"><a class="anchor" href="#controlling-database-connections"></a>Controlling database connections</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="code-class-interface-datasource-code"><a class="anchor" href="#code-class-interface-datasource-code"></a><code class="interface">DataSource</code></h3>
<div class="paragraph">
<p>Spring obtains a connection to the database through a <code class="interface">DataSource</code>.
A <code class="interface">DataSource</code> is part of the JDBC specification and is a generalized connection factory.
It allows a container or a framework to hide connection pooling and transaction management issues from the application code.
As a developer, you need not know details about how to connect to the database; that is the responsibility of the administrator that sets up the datasource.
You most likely fill both roles as you develop and test code, but you do not necessarily have to know how the production data source is configured.</p>
</div>
<div class="paragraph">
<p>When using Spring&#8217;s JDBC layer, you obtain a data source from JNDI or you configure your own with a connection pool implementation provided by a third party.
Popular implementations are Apache Jakarta Commons DBCP and C3P0.
Implementations in the Spring distribution are meant only for testing purposes and do not provide pooling.</p>
</div>
<div class="paragraph">
<p>This section uses Spring&#8217;s <code class="class">DriverManagerDataSource</code> implementation, and several additional implementations are covered later.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Only use the <code class="class">DriverManagerDataSource</code> class should only be used for testing purposes since it does not provide pooling and will perform poorly when multiple requests for a connection are made.You obtain a connection with <code class="class">DriverManagerDataSource</code> as you typically obtain a JDBC connection.
Specify the fully qualified classname of the JDBC driver so that the <code class="class">DriverManager</code> can load the driver class.
Next, provide a URL that varies between JDBC drivers.
(Consult the documentation for your driver for the correct value.) Then provide a username and a password to connect to the database.
Here is an example of how to configure a <code class="class">DriverManagerDataSource</code> in Java code:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>DriverManagerDataSource dataSource = new DriverManagerDataSource();
dataSource.setDriverClassName("org.hsqldb.jdbcDriver");
dataSource.setUrl("jdbc:hsqldb:hsql://localhost:");
dataSource.setUsername("sa");
dataSource.setPassword("");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the corresponding XML configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>&lt;bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
    &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="url" value="${jdbc.url}"/&gt;
    &lt;property name="username" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
&lt;/bean&gt;

&lt;context:property-placeholder location="jdbc.properties"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following examples show the basic connectivity and configuration for DBCP and C3P0.
To learn about more options that help control the pooling features, see the product documentation for the respective connection pooling implementations.</p>
</div>
<div class="paragraph">
<p>DBCP configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>&lt;bean id="dataSource"
        class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="url" value="${jdbc.url}"/&gt;
    &lt;property name="username" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
&lt;/bean&gt;

&lt;context:property-placeholder location="jdbc.properties"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>C3P0 configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>&lt;bean id="dataSource"
        class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close"&gt;
    &lt;property name="driverClass" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="jdbcUrl" value="${jdbc.url}"/&gt;
    &lt;property name="user" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
&lt;/bean&gt;

&lt;context:property-placeholder location="jdbc.properties"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-datasourceutils-code"><a class="anchor" href="#code-class-class-datasourceutils-code"></a><code class="class">DataSourceUtils</code></h3>
<div class="paragraph">
<p>The <code class="class">DataSourceUtils</code> class is a convenient and powerful helper class that provides <code>static</code> methods to obtain connections from JNDI and close connections if necessary.
It supports thread-bound connections with, for example, <code class="class">DataSourceTransactionManager</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-interface-smartdatasource-code"><a class="anchor" href="#code-class-interface-smartdatasource-code"></a><code class="interface">SmartDataSource</code></h3>
<div class="paragraph">
<p>The <code class="interface">SmartDataSource</code> interface should be implemented by classes that can provide a connection to a relational database.
It extends the <code class="interface">DataSource</code> interface to allow classes using it to query whether the connection should be closed after a given operation.
This usage is efficient when you know that you will reuse a connection.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-abstractdatasource-code"><a class="anchor" href="#code-class-class-abstractdatasource-code"></a><code class="class">AbstractDataSource</code></h3>
<div class="paragraph">
<p><code>AbstractDataSource</code> is an <code>abstract</code> base class for Spring&#8217;s <code class="interface">DataSource</code> implementations that implements code that is common to all <code class="class">DataSource</code> implementations. You extend the <code class="class">AbstractDataSource</code> class if you are writing your own <code class="interface">DataSource</code> implementation.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-singleconnectiondatasource-code"><a class="anchor" href="#code-class-class-singleconnectiondatasource-code"></a><code class="class">SingleConnectionDataSource</code></h3>
<div class="paragraph">
<p>The <code class="class">SingleConnectionDataSource</code> class is an implementation of the <code class="interface">SmartDataSource</code> interface that wraps a <em>single</em> <code class="interface">Connection</code> that is <em>not</em> closed after each use.
Obviously, this is not multi-threading capable.</p>
</div>
<div class="paragraph">
<p>If any client code calls  in the assumption of a pooled connection, as when using persistence tools, set the <code>suppressClose</code> property to <code>true</code>.
This setting returns a close-suppressing proxy wrapping the physical connection.
Be aware that you will not be able to cast this to a native Oracle <code class="interface">Connection</code> or the like anymore.</p>
</div>
<div class="paragraph">
<p>This is primarily a test class.
For example, it enables easy testing of code outside an application server, in conjunction with a simple JNDI environment.
In contrast to <code class="class">DriverManagerDataSource</code>, it reuses the same connection all the time, avoiding excessive creation of physical connections.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-drivermanagerdatasource-code"><a class="anchor" href="#code-class-class-drivermanagerdatasource-code"></a><code class="class">DriverManagerDataSource</code></h3>
<div class="paragraph">
<p>The <code class="class">DriverManagerDataSource</code> class is an implementation of the standard <code class="interface">DataSource</code> interface that configures a plain JDBC driver through bean properties, and returns a new <code class="interface">Connection</code> every time.</p>
</div>
<div class="paragraph">
<p>This implementation is useful for test and stand-alone environments outside of a Java EE container, either as a <code class="interface">DataSource</code> bean in a Spring IoC container, or in conjunction with a simple JNDI environment.
Pool-assuming <code>Connection.close()</code> calls will simply close the connection, so any <code class="interface">DataSource</code>-aware persistence code should work.
However, using JavaBean-style connection pools such as <code>commons-dbcp</code> is so easy, even in a test environment, that it is almost always preferable to use such a connection pool over <code class="class">DriverManagerDataSource</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-transactionawaredatasourceproxy-code"><a class="anchor" href="#code-class-class-transactionawaredatasourceproxy-code"></a><code class="class">TransactionAwareDataSourceProxy</code></h3>
<div class="paragraph">
<p><code class="class">TransactionAwareDataSourceProxy</code> is a proxy for a target <code class="interface">DataSource</code>, which wraps that target <code class="interface">DataSource</code> to add awareness of Spring-managed transactions.
In this respect, it is similar to a transactional JNDI <code class="interface">DataSource</code> as provided by a Java EE server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
It is rarely desirable to use this class, except when already existing code that must be called and passed a standard JDBC <code class="interface">DataSource</code> interface implementation.
In this case, it&#8217;s possible to still have this code be usable, and at the same time have this code participating in Spring managed transactions.
It is generally preferable to write your own new code using the higher level abstractions for resource management, such as <code class="class">JdbcTemplate</code> or <code class="class">DataSourceUtils</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>(See the
      <code class="class">TransactionAwareDataSourceProxy</code> Javadocs for more
      details.)</em></p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-datasourcetransactionmanager-code"><a class="anchor" href="#code-class-class-datasourcetransactionmanager-code"></a><code class="class">DataSourceTransactionManager</code></h3>
<div class="paragraph">
<p>The <code class="class">DataSourceTransactionManager</code> class is a <code class="interface">PlatformTransactionManager</code> implementation for single JDBC datasources.
It binds a JDBC connection from the specified data source to the currently executing thread, potentially allowing for one thread connection per data source.</p>
</div>
<div class="paragraph">
<p>Application code is required to retrieve the JDBC connection through <code>DataSourceUtils.getConnection(DataSource)</code> instead of Java EE&#8217;s standard <code>DataSource.getConnection</code>.
It throws unchecked <code>org.springframework.dao</code> exceptions instead of checked .
All framework classes like <code class="class">JdbcTemplate</code> use this strategy implicitly.
If not used with this transaction manager, the lookup strategy behaves exactly like the common one - it can thus be used in any case.</p>
</div>
<div class="paragraph">
<p>The <code class="class">DataSourceTransactionManager</code> class supports custom isolation levels, and timeouts that get applied as appropriate JDBC statement query timeouts.
To support the latter, application code must either use <code class="class">JdbcTemplate</code> or call the <code>DataSourceUtils.applyTransactionTimeout(..)</code> method for each created statement.</p>
</div>
<div class="paragraph">
<p>This implementation can be used instead of <code class="class">JtaTransactionManager</code> in the single resource case, as it does not require the container to support JTA. Switching between both is just a matter of configuration, if you stick to the required connection lookup pattern.
JTA does not support custom isolation levels!</p>
</div>
</div>
<div class="sect2">
<h3 id="nativejdbcextractor"><a class="anchor" href="#nativejdbcextractor"></a>NativeJdbcExtractor</h3>
<div class="paragraph">
<p>Sometimes you need to access vendor specific JDBC methods that differ from the standard JDBC API. This can be problematic if you are running in an application server or with a <code class="class">DataSource</code> that wraps the <code class="class">Connection</code>, <code class="class">Statement</code> and <code class="class">ResultSet</code> objects with its own wrapper objects.
To gain access to the native objects you can configure your <code class="class">JdbcTemplate</code> or <code class="class">OracleLobHandler</code> with a <code class="class">NativeJdbcExtractor</code>.</p>
</div>
<div class="paragraph">
<p>The <code>NativeJdbcExtractor</code> comes in a variety of flavors to match your execution environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SimpleNativeJdbcExtractor</p>
</li>
<li>
<p>C3P0NativeJdbcExtractor</p>
</li>
<li>
<p>CommonsDbcpNativeJdbcExtractor</p>
</li>
<li>
<p>JBossNativeJdbcExtractor</p>
</li>
<li>
<p>WebLogicNativeJdbcExtractor</p>
</li>
<li>
<p>WebSphereNativeJdbcExtractor</p>
</li>
<li>
<p>XAPoolNativeJdbcExtractor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Usually the <code class="class">SimpleNativeJdbcExtractor</code> is sufficient for unwrapping a <code class="class">Connection</code> object in most environments.
See the Javadocs for more details.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jdbc-batch-operations"><a class="anchor" href="#jdbc-batch-operations"></a>JDBC batch operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most JDBC drivers provide improved performance if you batch multiple calls to the same prepared statement.
By grouping updates into batches you limit the number of round trips to the database.</p>
</div>
<div class="sect2">
<h3 id="basic-batch-operations-with-the-jdbctemplate"><a class="anchor" href="#basic-batch-operations-with-the-jdbctemplate"></a>Basic batch operations with the JdbcTemplate</h3>
<div class="paragraph">
<p>You accomplish <code class="class">JdbcTemplate</code> batch processing by implementing two methods of a special interface, <code class="class">BatchPreparedStatementSetter</code>, and passing that in as the second parameter in your <code class="class">batchUpdate</code> method call.
Use the <code class="class">getBatchSize</code> method to provide the size of the current batch.
Use the <code class="class">setValues</code> method to set the values for the parameters of the prepared statement.
This method will be called the number of times that you specified in the <code class="class">getBatchSize</code> call.
The following example updates the actor table based on entries in a list.
The entire list is used as the batch in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public int[] batchUpdate(final List&lt;Actor&gt; actors) {
        int[] updateCounts = jdbcTemplate.batchUpdate(
                "update t_actor set first_name = ?, last_name = ? where id = ?",
                new BatchPreparedStatementSetter() {
                    public void setValues(PreparedStatement ps, int i) throws SQLException {
                        ps.setString(1, actors.get(i).getFirstName());
                        ps.setString(2, actors.get(i).getLastName());
                        ps.setLong(3, actors.get(i).getId().longValue());
                    }

                    public int getBatchSize() {
                        return actors.size();
                    }
                } );
        return updateCounts;
    }

    //  ... additional methods
}
----If you are processing a stream of updates or reading from a file, then you might have a preferred batch size, but the last batch might not have that number of entries.
In this case you can use the [class]`InterruptibleBatchPreparedStatementSetter` interface, which allows you to interrupt a batch once the input source is exhausted.
The [class]`isBatchExhausted` method allows you to signal the end of the batch.

=== Batch operations with a List of objects

Both the [class]`JdbcTemplate` and the [class]`NamedParameterJdbcTemplate` provides an alternate way of providing the batch update.
Instead of implementing a special batch interface, you provide all parameter values in the call as a list.
The framework loops over these values and uses an internal prepared statement setter.
The API varies depending on whether you use named parameters.
For the named parameters you provide an array of [class]`SqlParameterSource`, one entry for each member of the batch.
You can use the [class]`SqlParameterSource.createBatch` method to create this array, passing in either an array of JavaBeans or an array of Maps containing the parameter values.

This example shows a batch update using named parameters:


[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>public class JdbcActorDao implements ActorDao {
    private NamedParameterTemplate namedParameterJdbcTemplate;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public int[] batchUpdate(final List&lt;Actor&gt; actors) {
    SqlParameterSource[] batch = SqlParameterSourceUtils.createBatch(actors.toArray());
    int[] updateCounts = namedParameterJdbcTemplate.batchUpdate(
        "update t_actor set first_name = :firstName, last_name = :lastName where id = :id",
        batch);
    return updateCounts;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    //  ... additional methods
}
----For an SQL statement using the classic "?" placeholders, you pass in a list containing an object array with the update values.
This object array must have one entry for each placeholder in the SQL statement, and they must be in the same order as they are defined in the SQL statement.</pre>
</div>
</div>
<div class="paragraph">
<p>The same example using classic JDBC "?" placeholders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public int[] batchUpdate(final List&lt;Actor&gt; actors) {
        List&lt;Object[]&gt; batch = new ArrayList&lt;Object[]&gt;();
        for (Actor actor : actors) {
            Object[] values = new Object[] {
                    actor.getFirstName(),
                    actor.getLastName(),
                    actor.getId()};
            batch.add(values);
        }
        int[] updateCounts = jdbcTemplate.batchUpdate(
                "update t_actor set first_name = ?, last_name = ? where id = ?",
                batch);
        return updateCounts;
    }

    //  ... additional methods
}
----All of the above batch update methods return an int array containing the number of affected rows for each batch entry.
This count is reported by the JDBC driver.
If the count is not available, the JDBC driver returns a -2 value.

=== Batch operations with multiple batches

The last example of a batch update deals with batches that are so large that you want to break them up into several smaller batches.
You can of course do this with the methods mentioned above by making multiple calls to the [class]`batchUpdate` method, but there is now a more convenient method.
This method takes, in addition to the SQL statement, a Collection of objects containing the parameters, the number of updates to make for each batch and a [class]`ParameterizedPreparedStatementSetter` to set the values for the parameters of the prepared statement.
The framework loops over the provided values and breaks the update calls into batches of the size specified.

This example shows a batch update using a batch size of 100:


[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public int[][] batchUpdate(final Collection&lt;Actor&gt; actors) {
    int[][] updateCounts = jdbcTemplate.batchUpdate(
            "update t_actor set first_name = ?, last_name = ? where id = ?",
            actors,
            100,
            new ParameterizedPreparedStatementSetter&lt;Actor&gt;() {
                public void setValues(PreparedStatement ps, Actor argument) throws SQLException {
                    ps.setString(1, argument.getFirstName());
                    ps.setString(2, argument.getLastName());
                    ps.setLong(3, argument.getId().longValue());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>                 }
             } );
    return updateCounts;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    //  ... additional methods
}
----The batch update methods for this call returns an array of int arrays containing an array entry for each batch with an array of the number of affected rows for each update.
The top level array's length indicates the number of batches executed and the second level array's length indicates the number of updates in that batch.
The number of updates in each batch should be the the batch size provided for all batches except for the last one that might be less, depending on the total number of update objects provided.
The update count for each update statement is the one reported by the JDBC driver.
If the count is not available, the JDBC driver returns a -2 value.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simplifying-jdbc-operations-with-the-simplejdbc-classes"><a class="anchor" href="#simplifying-jdbc-operations-with-the-simplejdbc-classes"></a>Simplifying JDBC operations with the SimpleJdbc classes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code class="class">SimpleJdbcInsert</code> and <code class="class">SimpleJdbcCall</code> classes provide a simplified configuration by taking advantage of database metadata that can be retrieved through the JDBC driver.
This means there is less to configure up front, although you can override or turn off the metadata processing if you prefer to provide all the details in your code.</p>
</div>
<div class="sect2">
<h3 id="inserting-data-using-simplejdbcinsert"><a class="anchor" href="#inserting-data-using-simplejdbcinsert"></a>Inserting data using SimpleJdbcInsert</h3>
<div class="paragraph">
<p>Let&#8217;s start by looking at the <code class="class">SimpleJdbcInsert</code> class with the minimal amount of configuration options.
You should instantiate the <code class="class">SimpleJdbcInsert</code> in the data access layer&#8217;s initialization method.
For this example, the initializing method is the <code class="class">setDataSource</code> method.
You do not need to subclass the <code class="class">SimpleJdbcInsert</code> class; simply create a new instance and set the table name using the <code class="class">withTableName</code> method.
Configuration methods for this class follow the "fluid" style that returns the instance of the <code class="class">SimpleJdbcInsert</code>, which allows you to chain all configuration methods.
This example uses only one configuration method; you will see examples of multiple ones later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;
    private SimpleJdbcInsert insertActor;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
        this.insertActor =
                new SimpleJdbcInsert(dataSource).withTableName("t_actor");
    }

    public void add(Actor actor) {
        Map&lt;String, Object&gt; parameters = new HashMap&lt;String, Object&gt;(3);
        parameters.put("id", actor.getId());
        parameters.put("first_name", actor.getFirstName());
        parameters.put("last_name", actor.getLastName());
        insertActor.execute(parameters);
    }

    //  ... additional methods
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The execute method used here takes a plain <code class="class">java.utils.Map</code> as its only parameter.
The important thing to note here is that the keys used for the Map must match the column names of the table as defined in the database.
This is because we read the metadata in order to construct the actual insert statement.</p>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-auto-generated-keys-using-simplejdbcinsert"><a class="anchor" href="#retrieving-auto-generated-keys-using-simplejdbcinsert"></a>Retrieving auto-generated keys using SimpleJdbcInsert</h3>
<div class="paragraph">
<p>This example uses the same insert as the preceding, but instead of passing in the id it retrieves the auto-generated key and sets it on the new Actor object.
When you create the <code class="class">SimpleJdbcInsert</code>, in addition to specifying the table name, you specify the name of the generated key column with the <code class="class">usingGeneratedKeyColumns</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;
    private SimpleJdbcInsert insertActor;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
        this.insertActor =
                new SimpleJdbcInsert(dataSource)
                        .withTableName("t_actor")
                        .usingGeneratedKeyColumns("id");
    }

    public void add(Actor actor) {
        Map&lt;String, Object&gt; parameters = new HashMap&lt;String, Object&gt;(2);
        parameters.put("first_name", actor.getFirstName());
        parameters.put("last_name", actor.getLastName());
        Number newId = insertActor.executeAndReturnKey(parameters);
        actor.setId(newId.longValue());
    }

    //  ... additional methods
}
----The main difference when executing the insert by this second approach is that you do not add the id to the Map and you call the `executeReturningKey` method.
This returns a `java.lang.Number` object with which you can create an instance of the numerical type that is used in our domain class.You cannot rely on all databases to return a specific Java class here; `java.lang.Number` is the base class that you can rely on.
If you have multiple auto-generated columns, or the generated values are non-numeric, then you can use a `KeyHolder` that is returned from the `executeReturningKeyHolder` method.

=== Specifying columns for a SimpleJdbcInsert

You can limit the columns for an insert by specifying a list of column names with the [class]`usingColumns` method:


[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;
    private SimpleJdbcInsert insertActor;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
    this.insertActor =
            new SimpleJdbcInsert(dataSource)
                    .withTableName("t_actor")
                    .usingColumns("first_name", "last_name")
                    .usingGeneratedKeyColumns("id");
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void add(Actor actor) {
    Map&lt;String, Object&gt; parameters = new HashMap&lt;String, Object&gt;(2);
    parameters.put("first_name", actor.getFirstName());
    parameters.put("last_name", actor.getLastName());
    Number newId = insertActor.executeAndReturnKey(parameters);
    actor.setId(newId.longValue());
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    //  ... additional methods
}
----The execution of the insert is the same as if you had relied on the metadata to determine which columns to use.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-sqlparametersource-to-provide-parameter-values"><a class="anchor" href="#using-sqlparametersource-to-provide-parameter-values"></a>Using SqlParameterSource to provide parameter values</h3>
<div class="paragraph">
<p>Using a <code class="class">Map</code> to provide parameter values works fine, but it&#8217;s not the most convenient class to use.
Spring provides a couple of implementations of the <code class="class">SqlParameterSource</code> interface that can be used instead.The first one is <code class="class">BeanPropertySqlParameterSource</code>, which is a very convenient class if you have a JavaBean-compliant class that contains your values.
It will use the corresponding getter method to extract the parameter values.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;
    private SimpleJdbcInsert insertActor;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
        this.insertActor =
                new SimpleJdbcInsert(dataSource)
                        .withTableName("t_actor")
                        .usingGeneratedKeyColumns("id");
    }

    public void add(Actor actor) {
        SqlParameterSource parameters = new BeanPropertySqlParameterSource(actor);
        Number newId = insertActor.executeAndReturnKey(parameters);
        actor.setId(newId.longValue());
    }

    //  ... additional methods
}
----Another option is the [class]`MapSqlParameterSource` that resembles a Map but provides a more convenient [class]`addValue` method that can be chained.


[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;
    private SimpleJdbcInsert insertActor;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
    this.insertActor =
            new SimpleJdbcInsert(dataSource)
                    .withTableName("t_actor")
                    .usingGeneratedKeyColumns("id");
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void add(Actor actor) {
    SqlParameterSource parameters = new MapSqlParameterSource()
            .addValue("first_name", actor.getFirstName())
            .addValue("last_name", actor.getLastName());
    Number newId = insertActor.executeAndReturnKey(parameters);
    actor.setId(newId.longValue());
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    //  ... additional methods
}
----As you can see, the configuration is the same; only the executing code has to change to use these alternative input classes.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="calling-a-stored-procedure-with-simplejdbccall"><a class="anchor" href="#calling-a-stored-procedure-with-simplejdbccall"></a>Calling a stored procedure with SimpleJdbcCall</h3>
<div class="paragraph">
<p>The <code class="class">SimpleJdbcCall</code> class leverages metadata in the database to look up names of <code>in</code> and <code>out</code> parameters, so that you do not have to declare them explicitly.
You can declare parameters if you prefer to do that, or if you have parameters such as <code>ARRAY</code> or <code>STRUCT</code> that do not have an automatic mapping to a Java class.
The first example shows a simple procedure that returns only scalar values in <code>VARCHAR</code> and <code>DATE</code> format from a MySQL database.
The example procedure reads a specified actor entry and returns <code>first_name</code>, <code>last_name</code>, and <code>birth_date</code> columns in the form of <code>out</code> parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>CREATE PROCEDURE read_actor (
  IN in_id INTEGER,
  OUT out_first_name VARCHAR(100),
  OUT out_last_name VARCHAR(100),
  OUT out_birth_date DATE)
BEGIN
  SELECT first_name, last_name, birth_date
  INTO out_first_name, out_last_name, out_birth_date
  FROM t_actor where id = in_id;
END;
----The `in_id` parameter contains the `id` of the actor you are looking up.
The `out` parameters return the data read from the table.

The [class]`SimpleJdbcCall` is declared in a similar manner to the [class]`SimpleJdbcInsert`.
You should instantiate and configure the class in the initialization method of your data access layer.
Compared to the StoredProcedure class, you don't have to create a subclass and you don't have to declare parameters that can be looked up in the database metadata.
Following is an example of a SimpleJdbcCall configuration using the above stored procedure.
The only configuration option, in addition to the [class]`DataSource`, is the name of the stored procedure.


[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;
    private SimpleJdbcCall procReadActor;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
    this.procReadActor =
            new SimpleJdbcCall(dataSource)
                    .withProcedureName("read_actor");
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Actor readActor(Long id) {
    SqlParameterSource in = new MapSqlParameterSource()
            .addValue("in_id", id);
    Map out = procReadActor.execute(in);
    Actor actor = new Actor();
    actor.setId(id);
    actor.setFirstName((String) out.get("out_first_name"));
    actor.setLastName((String) out.get("out_last_name"));
    actor.setBirthDate((Date) out.get("out_birth_date"));
    return actor;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    //  ... additional methods
}
----The code you write for the execution of the call involves creating an [class]`SqlParameterSource` containing the IN parameter.
It's important to match the name provided for the input value with that of the parameter name declared in the stored procedure.
The case does not have to match because you use metadata to determine how database objects should be referred to in a stored procedure.
What is specified in the source for the stored procedure is not necessarily the way it is stored in the database.
Some databases transform names to all upper case while others use lower case or use the case as specified.</pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">execute</code> method takes the IN parameters and returns a Map containing any <code>out</code> parameters keyed by the name as specified in the stored procedure.
In this case they are <code class="class">out_first_name, out_last_name</code> and <code class="class">out_birth_date</code>.</p>
</div>
<div class="paragraph">
<p>The last part of the <code class="class">execute</code> method creates an Actor instance to use to return the data retrieved.
Again, it is important to use the names of the <code>out</code> parameters as they are declared in the stored procedure.
Also, the case in the names of the <code>out</code> parameters stored in the results map matches that of the <code>out</code> parameter names in the database, which could vary between databases.
To make your code more portable you should do a case-insensitive lookup or instruct Spring to use a <code class="class">CaseInsensitiveMap</code> from the Jakarta Commons project.
To do the latter, you create your own <code class="class">JdbcTemplate</code> and set the <code class="class">setResultsMapCaseInsensitive</code> property to <code class="class">true</code>.
Then you pass this customized <code class="class">JdbcTemplate</code> instance into the constructor of your <code class="class">SimpleJdbcCall</code>.
You must include the <code class="class">commons-collections.jar</code> in your classpath for this to work.
Here is an example of this configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class JdbcActorDao implements ActorDao {
    private SimpleJdbcCall procReadActor;

    public void setDataSource(DataSource dataSource) {
        JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);
        jdbcTemplate.setResultsMapCaseInsensitive(true);
        this.procReadActor =
                new SimpleJdbcCall(jdbcTemplate)
                        .withProcedureName("read_actor");
    }


    //  ... additional methods
}
----By taking this action, you avoid conflicts in the case used for the names of your returned `out` parameters.

=== Explicitly declaring parameters to use for a SimpleJdbcCall

You have seen how the parameters are deduced based on metadata, but you can declare then explicitly if you wish.
You do this by creating and configuring [class]`SimpleJdbcCall` with the [class]`declareParameters` method, which takes a variable number of [class]`SqlParameter` objects as input.
See the next section for details on how to define an [class]`SqlParameter`.



NOTE: Explicit declarations are necessary if the database you use is not a Spring-supported database.
Currently Spring supports metadata lookup of stored procedure calls for the following databases: Apache Derby, DB2, MySQL, Microsoft SQL Server, Oracle, and Sybase.
We also support metadata lookup of stored functions for: MySQL, Microsoft SQL Server, and Oracle.

You can opt to declare one, some, or all the parameters explicitly.
The parameter metadata is still used where you do not declare parameters explicitly.
To bypass all processing of metadata lookups for potential parameters and only use the declared parameters, you call the method [class]`withoutProcedureColumnMetaDataAccess` as part of the declaration.
Suppose that you have two or more different call signatures declared for a database function.
In this case you call the [class]`useInParameterNames` to specify the list of IN parameter names to include for a given signature.

The following example shows a fully declared procedure call, using the information from the preceding example.


[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>public class JdbcActorDao implements ActorDao {
    private SimpleJdbcCall procReadActor;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setDataSource(DataSource dataSource) {
    JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);
    jdbcTemplate.setResultsMapCaseInsensitive(true);
    this.procReadActor =
            new SimpleJdbcCall(jdbcTemplate)
                    .withProcedureName("read_actor")
                    .withoutProcedureColumnMetaDataAccess()
                    .useInParameterNames("in_id")
                    .declareParameters(
                            new SqlParameter("in_id", Types.NUMERIC),
                            new SqlOutParameter("out_first_name", Types.VARCHAR),
                            new SqlOutParameter("out_last_name", Types.VARCHAR),
                            new SqlOutParameter("out_birth_date", Types.DATE)
                    );
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    //  ... additional methods
}
----The execution and end results of the two examples are the same; this one specifies all details explicitly rather than relying on metadata.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-define-sqlparameters"><a class="anchor" href="#how-to-define-sqlparameters"></a>How to define SqlParameters</h3>
<div class="paragraph">
<p>To define a parameter for the SimpleJdbc classes and also for the RDBMS operations classes, covered in <a href="#jdbc-object">[jdbc-object]</a>, you use an <code class="class">SqlParameter</code> or one of its subclasses.
You typically specify the parameter name and SQL type in the constructor.
The SQL type is specified using the <code class="class">java.sql.Types</code> constants.
We have already seen declarations like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>   new SqlParameter("in_id", Types.NUMERIC),
   new SqlOutParameter("out_first_name", Types.VARCHAR),</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line with the <code class="class">SqlParameter</code> declares an IN parameter.
IN parameters can be used for both stored procedure calls and for queries using the <code class="class">SqlQuery</code> and its subclasses covered in the following section.</p>
</div>
<div class="paragraph">
<p>The second line with the <code class="class">SqlOutParameter</code> declares an <code>out</code> parameter to be used in a stored procedure call.
There is also an <code class="class">SqlInOutParameter</code> for <code>InOut</code> parameters, parameters that provide an <code>IN</code> value to the procedure and that also return a value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Only parameters declared as <code class="class">SqlParameter</code> and <code class="class">SqlInOutParameter</code> will be used to provide input values.
This is different from the <code class="class">StoredProcedure</code> class, which for backwards compatibility reasons allows input values to be provided for parameters declared as <code class="class">SqlOutParameter</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For IN parameters, in addition to the name and the SQL type, you can specify a scale for numeric data or a type name for custom database types.
For <code>out</code> parameters, you can provide a <code class="class">RowMapper</code> to handle mapping of rows returned from a <code>REF</code> cursor.
Another option is to specify an <code class="class">SqlReturnType</code> that provides an opportunity to define customized handling of the return values.</p>
</div>
</div>
<div class="sect2">
<h3 id="calling-a-stored-function-using-simplejdbccall"><a class="anchor" href="#calling-a-stored-function-using-simplejdbccall"></a>Calling a stored function using SimpleJdbcCall</h3>
<div class="paragraph">
<p>You call a stored function in almost the same way as you call a stored procedure, except that you provide a function name rather than a procedure name.
You use the <code class="class">withFunctionName</code> method as part of the configuration to indicate that we want to make a call to a function, and the corresponding string for a function call is generated.
A specialized execute call, <code class="class">executeFunction,</code> is used to execute the function and it returns the function return value as an object of a specified type, which means you do not have to retrieve the return value from the results map.
A similar convenience method named <code class="class">executeObject</code> is also available for stored procedures that only have one <code>out</code> parameter.
The following example is based on a stored function named <code class="class">get_actor_name</code> that returns an actor&#8217;s full name.
Here is the MySQL source for this function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>CREATE FUNCTION get_actor_name (in_id INTEGER)
RETURNS VARCHAR(200) READS SQL DATA
BEGIN
  DECLARE out_name VARCHAR(200);
  SELECT concat(first_name, ' ', last_name)
    INTO out_name
    FROM t_actor where id = in_id;
  RETURN out_name;
END;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To call this function we again create a <code class="class">SimpleJdbcCall</code> in the initialization method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class JdbcActorDao implements ActorDao {
    private JdbcTemplate jdbcTemplate;
    private SimpleJdbcCall funcGetActorName;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
        JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);
        jdbcTemplate.setResultsMapCaseInsensitive(true);
        this.funcGetActorName =
                new SimpleJdbcCall(jdbcTemplate)
                        .withFunctionName("get_actor_name");
    }

    public String getActorName(Long id) {
        SqlParameterSource in = new MapSqlParameterSource()
                .addValue("in_id", id);
        String name = funcGetActorName.executeFunction(String.class, in);
        return name;
    }

    //  ... additional methods
}
----The execute method used returns a [class]`String` containing the return value from the function call.

=== Returning ResultSet/REF Cursor from a SimpleJdbcCall

Calling a stored procedure or function that returns a result set is a bit tricky.
Some databases return result sets during the JDBC results processing while others require an explicitly registered `out` parameter of a specific type.
Both approaches need additional processing to loop over the result set and process the returned rows.
With the [class]`SimpleJdbcCall` you use the [class]`returningResultSet` method and declare a [class]`RowMapper` implementation to be used for a specific parameter.
In the case where the result set is returned during the results processing, there are no names defined, so the returned results will have to match the order in which you declare the [class]`RowMapper` implementations.
The name specified is still used to store the processed list of results in the results map that is returned from the execute statement.

The next example uses a stored procedure that takes no IN parameters and returns all rows from the t_actor table.
Here is the MySQL source for this procedure:


[source]</code></pre>
</div>
</div>
<div class="paragraph">
<p>CREATE PROCEDURE read_all_actors()
BEGIN
 SELECT a.id, a.first_name, a.last_name, a.birth_date FROM t_actor a;
END;
----To call this procedure you declare the <code class="class">RowMapper</code>.
Because the class you want to map to follows the JavaBean rules, you can use a <code class="class">ParameterizedBeanPropertyRowMapper</code> that is created by passing in the required class to map to in the <code class="class">newInstance</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class JdbcActorDao implements ActorDao {
    private SimpleJdbcCall procReadAllActors;

    public void setDataSource(DataSource dataSource) {
        JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);
        jdbcTemplate.setResultsMapCaseInsensitive(true);
        this.procReadAllActors =
                new SimpleJdbcCall(jdbcTemplate)
                        .withProcedureName("read_all_actors")
                        .returningResultSet("actors",
                                ParameterizedBeanPropertyRowMapper.newInstance(Actor.class));
    }

    public List getActorsList() {
        Map m = procReadAllActors.execute(new HashMap&lt;String, Object&gt;(0));
        return (List) m.get("actors");
    }

    //  ... additional methods
}
----The execute call passes in an empty Map because this call does not take any parameters.
The list of Actors is then retrieved from the results map and returned to the caller.

== Modeling JDBC operations as Java objects

The `org.springframework.jdbc.object` package contains classes that allow you to access the database in a more object-oriented manner.
As an example, you can execute queries and get the results back as a list containing business objects with the relational column data mapped to the properties of the business object.
You can also execute stored procedures and run update, delete, and insert statements.

[NOTE]
====
Many Spring developers believe that the various RDBMS operation classes described below (with the exception of the &lt;&lt;jdbc-StoredProcedure,[class]`StoredProcedure`&gt;&gt; class) can often be replaced with straight [class]`JdbcTemplate` calls.
Often it is simpler to write a DAO method that simply calls a method on a [class]`JdbcTemplate` directly (as opposed to encapsulating a query as a full-blown class).

However, if you are getting measurable value from using the RDBMS operation classes, continue using these classes.
====

=== [class]`SqlQuery`

[class]`SqlQuery` is a reusable, threadsafe class that encapsulates an SQL query.
Subclasses must implement the [method]`newRowMapper(..)` method to provide a [interface]`RowMapper` instance that can create one object per row obtained from iterating over the [interface]`ResultSet` that is created during the execution of the query.
The [class]`SqlQuery` class is rarely used directly because the [class]`MappingSqlQuery` subclass provides a much more convenient implementation for mapping rows to Java classes.
Other implementations that extend [class]`SqlQuery` are [class]`MappingSqlQueryWithParameters` and [class]`UpdatableSqlQuery`.

=== [class]`MappingSqlQuery`

[class]`MappingSqlQuery` is a reusable query in which concrete subclasses must implement the abstract [method]`mapRow(..)` method to convert each row of the supplied [interface]`ResultSet` into an object of the type specified.
The following example shows a custom query that maps the data from the `t_actor` relation to an instance of the [class]`Actor` class.

[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>public class ActorMappingQuery extends MappingSqlQuery&lt;Actor&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public ActorMappingQuery(DataSource ds) {
    super(ds, "select id, first_name, last_name from t_actor where id = ?");
    super.declareParameter(new SqlParameter("id", Types.INTEGER));
    compile();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Override
protected Actor mapRow(ResultSet rs, int rowNumber) throws SQLException {
    Actor actor = new Actor();
    actor.setId(rs.getLong("id"));
    actor.setFirstName(rs.getString("first_name"));
    actor.setLastName(rs.getString("last_name"));
    return actor;
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The class extends [class]`MappingSqlQuery` parameterized with the [class]`Actor` type.
The constructor for this customer query takes the [interface]`DataSource` as the only parameter.
In this constructor you call the constructor on the superclass with the [interface]`DataSource` and the SQL that should be executed to retrieve the rows for this query.
This SQL will be used to create a [interface]`PreparedStatement` so it may contain place holders for any parameters to be passed in during execution.You must declare each parameter using the `declareParameter` method passing in an [class]`SqlParameter`.
The [class]`SqlParameter` takes a name and the JDBC type as defined in [class]`java.sql.Types`.
After you define all parameters, you call the `compile()` method so the statement can be prepared and later executed.
This class is thread-safe after it is compiled, so as long as these instances are created when the DAO is initialized they can be kept as instance variables and be reused.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>private ActorMappingQuery actorMappingQuery;</p>
</div>
<div class="paragraph">
<p>@Autowired
public void setDataSource(DataSource dataSource) {
    this.actorMappingQuery = new ActorMappingQuery(dataSource);
}</p>
</div>
<div class="paragraph">
<p>public Customer getCustomer(Long id) {
    return actorMappingQuery.findObject(id);
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The method in this example retrieves the customer with the id that is passed in as the only parameter.
Since we only want one object returned we simply call the convenience method `findObject` with the id as parameter.
If we had instead a query that returned a list of objects and took additional parameters then we would use one of the execute methods that takes an array of parameter values passed in as varargs.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public List&lt;Actor&gt; searchForActors(int age, String namePattern) {
    List&lt;Actor&gt; actors = actorSearchMappingQuery.execute(age, namePattern);
    return actors;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== [class]`SqlUpdate`

The [class]`SqlUpdate` class encapsulates an SQL update.
Like a query, an update object is reusable, and like all [class]`RdbmsOperation` classes, an update can have parameters and is defined in SQL. This class provides a number of [method]`update(..)` methods analogous to the [method]`execute(..)` methods of query objects.
The [class]`SQLUpdate` class is concrete.
It can be subclassed, for example, to add a custom update method, as in the following snippet where it's simply called [class]`execute`.
However, you don't have to subclass the [class]`SqlUpdate` class since it can easily be parameterized by setting SQL and declaring parameters.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import java.sql.Types;</p>
</div>
<div class="paragraph">
<p>import javax.sql.DataSource;</p>
</div>
<div class="paragraph">
<p>import org.springframework.jdbc.core.SqlParameter;
import org.springframework.jdbc.object.SqlUpdate;</p>
</div>
<div class="paragraph">
<p>public class UpdateCreditRating extends SqlUpdate {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public UpdateCreditRating(DataSource ds) {
    setDataSource(ds);
    setSql("update customer set credit_rating = ? where id = ?");
    declareParameter(new SqlParameter("creditRating", Types.NUMERIC));
    declareParameter(new SqlParameter("id", Types.NUMERIC));
    compile();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    /**
     * @param id for the Customer to be updated
     * @param rating the new value for credit rating
     * @return number of rows updated
     */
    public int execute(int id, int rating) {
        return update(rating, id);
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== [class]`StoredProcedure`

The [class]`StoredProcedure` class is a superclass for object abstractions of RDBMS stored procedures.
This class is `abstract`, and its various `execute(..)` methods have `protected` access, preventing use other than through a subclass that offers tighter typing.

The inherited `sql` property will be the name of the stored procedure in the RDBMS.

To define a parameter for the [class]`StoredProcedure` class, you use an [class]`SqlParameter` or one of its subclasses.
You must specify the parameter name and SQL type in the constructor like in the following code snippet.
The SQL type is specified using the [class]`java.sql.Types` constants.


[source,java]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>new SqlParameter("in_id", Types.NUMERIC),
new SqlOutParameter("out_first_name", Types.VARCHAR),</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The first line with the [class]`SqlParameter` declares an IN parameter.
IN parameters can be used for both stored procedure calls and for queries using the [class]`SqlQuery` and its subclasses covered in the following section.

The second line with the [class]`SqlOutParameter` declares an `out` parameter to be used in the stored procedure call.
There is also an [class]`SqlInOutParameter` for `I``nOut` parameters, parameters that provide an `in` value to the procedure and that also return a value.

For `i``n` parameters, in addition to the name and the SQL type, you can specify a scale for numeric data or a type name for custom database types.
For `out` parameters you can provide a [class]`RowMapper` to handle mapping of rows returned from a REF cursor.
Another option is to specify an [class]`SqlReturnType` that enables you to define customized handling of the return values.

Here is an example of a simple DAO that uses a [class]`StoredProcedure` to call a function, `sysdate()`,which comes with any Oracle database.
To use the stored procedure functionality you have to create a class that extends [class]`StoredProcedure`.
In this example, the [class]`StoredProcedure` class is an inner class, but if you need to reuse the [class]`StoredProcedure` you declare it as a top-level class.
This example has no input parameters, but an output parameter is declared as a date type using the class [class]`SqlOutParameter`.
The `execute()` method executes the procedure and extracts the returned date from the results [class]`Map`.
The results [class]`Map` has an entry for each declared output parameter, in this case only one, using the parameter name as the key.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import java.sql.Types;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;</p>
</div>
<div class="paragraph">
<p>import javax.sql.DataSource;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.SqlOutParameter;
import org.springframework.jdbc.object.StoredProcedure;</p>
</div>
<div class="paragraph">
<p>public class StoredProcedureDao {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private GetSysdateProcedure getSysdate;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
public void init(DataSource dataSource) {
    this.getSysdate = new GetSysdateProcedure(dataSource);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Date getSysdate() {
    return getSysdate.execute();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private class GetSysdateProcedure extends StoredProcedure {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private static final String SQL = "sysdate";</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public GetSysdateProcedure(DataSource dataSource) {
    setDataSource(dataSource);
    setFunction(true);
    setSql(SQL);
    declareParameter(new SqlOutParameter("date", Types.DATE));
    compile();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public Date execute() {
        // the 'sysdate' sproc has no input parameters, so an empty Map is supplied...
        Map&lt;String, Object&gt; results = execute(new HashMap&lt;String, Object&gt;());
        Date sysdate = (Date) results.get("date");
        return sysdate;
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The following example of a [class]`StoredProcedure` has two output parameters (in this case, Oracle REF cursors).

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import oracle.jdbc.OracleTypes;
import org.springframework.jdbc.core.SqlOutParameter;
import org.springframework.jdbc.object.StoredProcedure;</p>
</div>
<div class="paragraph">
<p>import javax.sql.DataSource;
import java.util.HashMap;
import java.util.Map;</p>
</div>
<div class="paragraph">
<p>public class TitlesAndGenresStoredProcedure extends StoredProcedure {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private static final String SPROC_NAME = "AllTitlesAndGenres";</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public TitlesAndGenresStoredProcedure(DataSource dataSource) {
    super(dataSource, SPROC_NAME);
    declareParameter(new SqlOutParameter("titles", OracleTypes.CURSOR, new TitleMapper()));
    declareParameter(new SqlOutParameter("genres", OracleTypes.CURSOR, new GenreMapper()));
    compile();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public Map&lt;String, Object&gt; execute() {
        // again, this sproc has no input parameters, so an empty Map is supplied
        return super.execute(new HashMap&lt;String, Object&gt;());
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Notice how the overloaded variants of the `declareParameter(..)` method that have been used in the [class]`TitlesAndGenresStoredProcedure` constructor are passed [interface]`RowMapper` implementation instances; this is a very convenient and powerful way to reuse existing functionality.
The code for the two [interface]`RowMapper` implementations is provided below.

The [class]`TitleMapper` class maps a [interface]`ResultSet` to a [class]`Title` domain object for each row in the supplied [interface]`ResultSet`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.springframework.jdbc.core.RowMapper;</p>
</div>
<div class="paragraph">
<p>import java.sql.ResultSet;
import java.sql.SQLException;</p>
</div>
<div class="paragraph">
<p>import com.foo.domain.Title;</p>
</div>
<div class="paragraph">
<p>public final class TitleMapper implements RowMapper&lt;Title&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public Title mapRow(ResultSet rs, int rowNum) throws SQLException {
        Title title = new Title();
        title.setId(rs.getLong("id"));
        title.setName(rs.getString("name"));
        return title;
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The [class]`GenreMapper` class maps a [interface]`ResultSet` to a [class]`Genre` domain object for each row in the supplied [interface]`ResultSet`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import org.springframework.jdbc.core.RowMapper;</p>
</div>
<div class="paragraph">
<p>import java.sql.ResultSet;
import java.sql.SQLException;</p>
</div>
<div class="paragraph">
<p>import com.foo.domain.Genre;</p>
</div>
<div class="paragraph">
<p>public final class GenreMapper implements RowMapper&lt;Genre&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public Genre mapRow(ResultSet rs, int rowNum) throws SQLException {
        return new Genre(rs.getString("name"));
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
To pass parameters to a stored procedure that has one or more input parameters in its definition in the RDBMS, you can code a strongly typed `execute(..)` method that would delegate to the superclass' untyped `execute(Map parameters)` method (which has `protected` access); for example:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>import oracle.jdbc.OracleTypes;
import org.springframework.jdbc.core.SqlOutParameter;
import org.springframework.jdbc.core.SqlParameter;
import org.springframework.jdbc.object.StoredProcedure;</p>
</div>
<div class="paragraph">
<p>import javax.sql.DataSource;</p>
</div>
<div class="paragraph">
<p>import java.sql.Types;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;</p>
</div>
<div class="paragraph">
<p>public class TitlesAfterDateStoredProcedure extends StoredProcedure {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private static final String SPROC_NAME = "TitlesAfterDate";
private static final String CUTOFF_DATE_PARAM = "cutoffDate";</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public TitlesAfterDateStoredProcedure(DataSource dataSource) {
    super(dataSource, SPROC_NAME);
    declareParameter(new SqlParameter(CUTOFF_DATE_PARAM, Types.DATE);
    declareParameter(new SqlOutParameter("titles", OracleTypes.CURSOR, new TitleMapper()));
    compile();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public Map&lt;String, Object&gt; execute(Date cutoffDate) {
        Map&lt;String, Object&gt; inputs = new HashMap&lt;String, Object&gt;();
        inputs.put(CUTOFF_DATE_PARAM, cutoffDate);
        return super.execute(inputs);
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Common problems with parameter and data value handling

Common problems with parameters and data values exist in the different approaches provided by the Spring Framework JDBC.

=== Providing SQL type information for parameters

Usually Spring determines the SQL type of the parameters based on the type of parameter passed in.
It is possible to explicitly provide the SQL type to be used when setting parameter values.
This is sometimes necessary to correctly set NULL values.

You can provide SQL type information in several ways:

* Many update and query methods of the [class]`JdbcTemplate` take an additional parameter in the form of an `int `array.
  This array is used to indicate the SQL type of the corresponding parameter using constant values from the [class]`java.sql.Types` class.
  Provide one entry for each parameter.

* You can use the [class]`SqlParameterValue` class to wrap the parameter value that needs this additional information.
  Create a new instance for each value and pass in the SQL type and parameter value in the constructor.
  You can also provide an optional scale parameter for numeric values.

* For methods working with named parameters, use the [class]`SqlParameterSource` classes [class]`BeanPropertySqlParameterSource` or [class]`MapSqlParameterSource`.
  They both have methods for registering the SQL type for any of the named parameter values.

=== Handling BLOB and CLOB objects

You can store images, other binary objects, and large chunks of text.
These large object are called BLOB for binary data and CLOB for character data.
In Spring you can handle these large objects by using the JdbcTemplate directly and also when using the higher abstractions provided by RDBMS Objects and the `SimpleJdbc` classes.
All of these approaches use an implementation of the [class]`LobHandler` interface for the actual management of the LOB data.
The [class]`LobHandler` provides access to a [class]`LobCreator` class, through the [class]`getLobCreator` method, used for creating new LOB objects to be inserted.

The [class]`LobCreator/LobHandler` provides the following support for LOB input and output:



* BLOB
+
* byte[]  getBlobAsBytes and setBlobAsBytes
* InputStream  getBlobAsBinaryStream and setBlobAsBinaryStream


* CLOB
+
* String  getClobAsString and setClobAsString
* InputStream  getClobAsAsciiStream and setClobAsAsciiStream
* Reader  getClobAsCharacterStream and setClobAsCharacterStream


The next example shows how to create and insert a BLOB. Later you will see how to read it back from the database.

This example uses a `JdbcTemplate` and an implementation of the `AbstractLobCreatingPreparedStatementCallbac``k`.
It implements one method, `setValues`.
This method provides a `LobCreator` that you use to set the values for the LOB columns in your SQL insert statement.

For this example we assume that there is a variable, `lobHandle``r`, that already is set to an instance of a [class]`DefaultLobHandler`.
You typically set this value through dependency injection.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>final File blobIn = new File("spring2004.jpg");
final InputStream blobIs = new FileInputStream(blobIn);
final File clobIn = new File("large.txt");
final InputStream clobIs = new FileInputStream(clobIn);
final InputStreamReader clobReader = new InputStreamReader(clobIs);
jdbcTemplate.execute(
  "INSERT INTO lob_table (id, a_clob, a_blob) VALUES (?, ?, ?)",
  new AbstractLobCreatingPreparedStatementCallback(lobHandler) {
      protected void setValues(PreparedStatement ps, LobCreator lobCreator)
          throws SQLException {
        ps.setLong(1, 1L);
        lobCreator.setClobAsCharacterStream(ps, 2, clobReader, (int)clobIn.length());
        lobCreator.setBlobAsBinaryStream(ps, 3, blobIs, (int)blobIn.length());
      }
  }
);
blobIs.close();
clobReader.close();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Now it's time to read the LOB data from the database.
Again, you use a `JdbcTemplate` with the same instance variable `l``obHandler `and a reference to a [class]`DefaultLobHandler`.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>List&lt;Map&lt;String, Object&gt;&gt; l = jdbcTemplate.query("select id, a_clob, a_blob from lob_table",
        new RowMapper&lt;Map&lt;String, Object&gt;&gt;() {
          public Map&lt;String, Object&gt; mapRow(ResultSet rs, int i) throws SQLException {
            Map&lt;String, Object&gt; results = new HashMap&lt;String, Object&gt;();
            String clobText = lobHandler.getClobAsString(rs, "a_clob");
            results.put("CLOB", clobText);
            byte[] blobBytes = lobHandler.getBlobAsBytes(rs, "a_blob");
            results.put("BLOB", blobBytes);
            return results;
          }
        });</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Passing in lists of values for IN clause

The SQL standard allows for selecting rows based on an expression that includes a variable list of values.
A typical example would be `select * from T_ACTOR where id in (1, 2, 3)`.
This variable list is not directly supported for prepared statements by the JDBC standard; you cannot declare a variable number of placeholders.
You need a number of variations with the desired number of placeholders prepared, or you need to generate the SQL string dynamically once you know how many placeholders are required.
The named parameter support provided in the [class]`NamedParameterJdbcTemplate` and [class]`JdbcTemplate` takes the latter approach.
Pass in the values as a [class]`java.util.List` of primitive objects.
This list will be used to insert the required placeholders and pass in the values during the statement execution.

NOTE: Be careful when passing in many values.
The JDBC standard does not guarantee that you can use more than 100 values for an `in` expression list.
Various databases exceed this number, but they usually have a hard limit for how many values are allowed.
Oracle's limit is 1000.

In addition to the primitive values in the value list, you can create a [class]`java.util.List` of object arrays.
This list would support multiple expressions defined for the `in` clause such as `select * from T_ACTOR where (id, last_name) in ((1,
      'Johnson'), (2, 'Harrop'))`.
This of course requires that your database supports this syntax.

=== Handling complex types for stored procedure calls

When you call stored procedures you can sometimes use complex types specific to the database.
To accommodate these types, Spring provides a [class]`SqlReturnType` for handling them when they are returned from the stored procedure call and [class]`SqlTypeValue` when they are passed in as a parameter to the stored procedure.

Here is an example of returning the value of an Oracle `STRUCT` object of the user declared type `ITEM_TYPE`.
The [class]`SqlReturnType` interface has a single method named [class]`getTypeValue` that must be implemented.
This interface is used as part of the declaration of an [class]`SqlOutParameter`.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>final TestItem = new TestItem(123L, "A test item",
        new SimpleDateFormat("yyyy-M-d").parse("2010-12-31"));</p>
</div>
<div class="paragraph">
<p>declareParameter(new SqlOutParameter("item", OracleTypes.STRUCT, "ITEM_TYPE",
    new SqlReturnType() {
      public Object getTypeValue(CallableStatement cs, int colIndx, int sqlType, String typeName)
          throws SQLException {
        STRUCT struct = (STRUCT) cs.getObject(colIndx);
        Object[] attr = struct.getAttributes();
        TestItem item = new TestItem();
        item.setId(Number) attr[0]).longValue(;
        item.setDescriptionString) attr[1]);         item.setExpirationDate((java.util.Date) attr[2]);         return item;       }     };
----You use the <code class="class">SqlTypeValue</code> to pass in the value of a Java object like <code class="class">TestItem</code> into a stored procedure.
The <code class="class">SqlTypeValue</code> interface has a single method named <code class="class">createTypeValue</code> that you must implement.
The active connection is passed in, and you can use it to create database-specific objects such as [class]`StructDescriptor`s, as shown in the following example, or [class]`ArrayDescriptor`s.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>final TestItem = new TestItem(123L, "A test item",
        new SimpleDateFormat("yyyy-M-d").parse("2010-12-31"));

SqlTypeValue value = new AbstractSqlTypeValue() {
  protected Object createTypeValue(Connection conn, int sqlType, String typeName) throws SQLException {
    StructDescriptor itemDescriptor = new StructDescriptor(typeName, conn);
    Struct item = new STRUCT(itemDescriptor, conn,
        new Object[] {
            testItem.getId(),
            testItem.getDescription(),
            new java.sql.Date(testItem.getExpirationDate().getTime())
        });
    return item;
  }
};
----This [class]`SqlTypeValue` can now be added to the Map containing the input parameters for the execute call of the stored procedure.

Another use for the [class]`SqlTypeValue` is passing in an array of values to an Oracle stored procedure.
Oracle has its own internal [class]`ARRAY` class that must be used in this case, and you can use the [class]`SqlTypeValue` to create an instance of the Oracle [class]`ARRAY` and populate it with values from the Java `ARRAY`.

[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>final Long[] ids = new Long[] {1L, 2L};</p>
</div>
<div class="paragraph">
<p>SqlTypeValue value = new AbstractSqlTypeValue() {
  protected Object createTypeValue(Connection conn, int sqlType, String typeName) throws SQLException {
    ArrayDescriptor arrayDescriptor = new ArrayDescriptor(typeName, conn);
    ARRAY idArray = new ARRAY(arrayDescriptor, conn, ids);
    return idArray;
  }
};</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Embedded database support

The `org.springframework.jdbc.datasource.embedded` package provides support for embedded Java database engines.
Support for &lt;&lt;,HSQL&gt;&gt;, &lt;&lt;,H2&gt;&gt;, and &lt;&lt;,Derby&gt;&gt; is provided natively.
You can also use an extensible API to plug in new embedded database types and [class]`DataSource` implementations.

=== Why use an embedded database?

An embedded database is useful during the development phase of a project because of its lightweight nature.
Benefits include ease of configuration, quick startup time, testability, and the ability to rapidly evolve SQL during development.

=== Creating an embedded database instance using Spring XML

If you want to expose an embedded database instance as a bean in a Spring ApplicationContext, use the embedded-database tag in the spring-jdbc namespace:
[source,xml]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;jdbc:embedded-database id="dataSource"&gt;
    &lt;jdbc:script location="classpath:schema.sql"/&gt;
    &lt;jdbc:script location="classpath:test-data.sql"/&gt;
&lt;/jdbc:embedded-database&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The preceding configuration creates an embedded HSQL database populated with SQL from schema.sql and testdata.sql resources in the classpath.
The database instance is made available to the Spring container as a bean of type [class]`javax.sql.DataSource`.
This bean can then be injected into data access objects as needed.

=== Creating an embedded database instance programmatically

The [class]`EmbeddedDatabaseBuilder` class provides a fluent API for constructing an embedded database programmatically.
Use this when you need to create an embedded database instance in a standalone environment, such as a data access object unit test:
[source,java]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>EmbeddedDatabaseBuilder builder = new EmbeddedDatabaseBuilder();
EmbeddedDatabase db = builder.setType(H2).addScript("my-schema.sql").addScript("my-test-data.sql").build();
// do stuff against the db (EmbeddedDatabase extends javax.sql.DataSource)
db.shutdown()</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Extending the embedded database support

Spring JDBC embedded database support can be extended in two ways:

[]
. Implement [class]`EmbeddedDatabaseConfigurer` to support a new embedded database type, such as Apache Derby.
. Implement [class]`DataSourceFactory` to support a new DataSource implementation, such as a connection pool, to manage embedded database connections.

You are encouraged to contribute back extensions to the Spring community at &lt;&lt;,jira.springframework.org&gt;&gt;.

=== Using HSQL

Spring supports HSQL 1.8.0 and above.
HSQL is the default embedded database if no type is specified explicitly.
To specify HSQL explicitly, set the `type` attribute of the `embedded-database` tag to `HSQL`.
If you are using the builder API, call the `setType(EmbeddedDatabaseType)` method with `EmbeddedDatabaseType.HSQL`.

=== Using H2

Spring supports the H2 database as well.
To enable H2, set the `type` attribute of the `embedded-database` tag to `H2`.
If you are using the builder API, call the `setType(EmbeddedDatabaseType)` method with `EmbeddedDatabaseType.H2`.

=== Using Derby

Spring also supports Apache Derby 10.5 and above.
To enable Derby, set the `type` attribute of the `embedded-database` tag to `Derby`.
If using the builder API, call the `setType(EmbeddedDatabaseType)` method with `EmbeddedDatabaseType.Derby`.

=== Testing data access logic with an embedded database

Embedded databases provide a lightweight way to test data access code.
The following is a data access unit test template that uses an embedded database:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class DataAccessUnitTestTemplate {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private EmbeddedDatabase db;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Before
public void setUp() {
    // creates an HSQL in-memory database populated from default scripts
    // classpath:schema.sql and classpath:data.sql
    db = new EmbeddedDatabaseBuilder().addDefaultScripts().build();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Test
public void testDataAccess() {
    JdbcTemplate template = new JdbcTemplate(db);
    template.query(...);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@After
public void tearDown() {
    db.shutdown();
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Initializing a DataSource

The `org.springframework.jdbc.datasource.init` package provides support for initializing an existing [class]`DataSource`.
The embedded database support provides one option for creating and initializing a [class]`DataSource` for an application, but sometimes you need to initialize an instance running on a server somewhere.

=== Initializing a database instance using Spring XML

If you want to initialize a database and you can provide a reference to a DataSource bean, use the `initialize-database` tag in the `spring-jdbc` namespace:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jdbc:initialize-database data-source="dataSource"&gt;
  &lt;jdbc:script location="classpath:com/foo/sql/db-schema.sql"/&gt;
  &lt;jdbc:script location="classpath:com/foo/sql/db-test-data.sql"/&gt;
&lt;/jdbc:initialize-database&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The example above runs the two scripts specified against the database: the first script is a schema creation, and the second is a test data set insert.
The script locations can also be patterns with wildcards in the usual ant style used for resources in Spring (e.g.
`classpath*:/com/foo/**/sql/*-data.sql`).
If a pattern is used the scripts are executed in lexical order of their URL or filename.

The default behavior of the database initializer is to unconditionally execute the scripts provided.
This will not always be what you want, for instance if running against an existing database that already has test data in it.
The likelihood of accidentally deleting data is reduced by the commonest pattern (as shown above) that creates the tables first and then inserts the data - the first step will fail if the tables already exist.

However, to get more control over the creation and deletion of existing data, the XML namespace provides a couple more options.
The first is flag to switch the initialization on and off.
This can be set according to the environment (e.g.
to pull a boolean value from system properties or an environment bean), e.g.

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jdbc:initialize-database data-source="dataSource"
    enabled="#{systemProperties.INITIALIZE_DATABASE}"&gt;
  &lt;jdbc:script location="&#8230;"/&gt;
&lt;/jdbc:initialize-database&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The second option to control what happens with existing data is to be more tolerant of failures.
To this end you can control the ability of the initializer to ignore certain errors in the SQL it executes from the scripts, e.g.


[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jdbc:initialize-database data-source="dataSource" ignore-failures="DROPS"&gt;
  &lt;jdbc:script location="&#8230;"/&gt;
&lt;/jdbc:initialize-database&gt;
----In this example we are saying we expect that sometimes the scripts will be run against an empty database and there are some DROP statements in the scripts which would therefore fail.
So failed SQL <code>DROP</code> statements will be ignored, but other failures will cause an exception.
This is useful if your SQL dialect doesn&#8217;t support <code>DROP ... IF EXISTS</code> (or similar) but you want to unconditionally remove all test data before re-creating it.
In that case the first script is usually a set of drops, followed by a set of <code>CREATE</code> statements.</p>
</div>
<div class="paragraph">
<p>The <code>ignore-failures</code> option can be set to <code>NONE</code> (the default), <code>DROPS</code> (ignore failed drops) or <code>ALL</code> (ignore all failures).</p>
</div>
<div class="paragraph">
<p>If you need more control than you get from the XML namespace, you can simply use the <code class="class">DataSourceInitializer</code> directly, and define it as a component in your application.</p>
</div>
<div class="sect3">
<h4 id="initialization-of-other-components-that-depend-on-the-database"><a class="anchor" href="#initialization-of-other-components-that-depend-on-the-database"></a>Initialization of Other Components that Depend on the Database</h4>
<div class="paragraph">
<p>A large class of applications can just use the database initializer with no further complications: those that do not use the database until after the Spring context has started.
If your application is <em>not</em> one of those then you might need to read the rest of this section.</p>
</div>
<div class="paragraph">
<p>The database initializer depends on a data source instance and runs the scripts provided in its initialization callback (c.f.
<code>init-method</code> in an XML bean definition or <code>InitializingBean</code>).
If other beans depend on the same data source and also use the data source in an initialization callback then there might be a problem because the data has not yet been initialized.
A common example of this is a cache that initializes eagerly and loads up data from the database on application startup.</p>
</div>
<div class="paragraph">
<p>To get round this issue you two options: change your cache initialization strategy to a later phase, or ensure that the database initializer is initialized first.</p>
</div>
<div class="paragraph">
<p>The first option might be easy if the application is in your control, and not otherwise.
Some suggestions for how to implement this are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make the cache initialize lazily on first usage, which improves application startup time</p>
</li>
<li>
<p>Have your cache or a separate component that initializes the cache implement <code>Lifecycle</code> or <code>SmartLifecycle</code>.
When the application context starts up a <code>SmartLifecycle</code> can be automatically started if its <code>autoStartup</code> flag is set, and a <code>Lifecycle</code> can be started manually by calling <code>ConfigurableApplicationContext.start()</code> on the enclosing context.</p>
</li>
<li>
<p>Use a Spring <code>ApplicationEvent</code> or similar custom observer mechanism to trigger the cache initialization.
<code>ContextRefreshedEvent</code> is always published by the context when it is ready for use (after all beans have been initialized), so that is often a useful hook (this is how the <code>SmartLifecycle</code> works by default).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The second option can also be easy.
Some suggestions on how to implement this are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rely on Spring BeanFactory default behavior, which is that beans are initialized in registration order.
You can easily arrange that by adopting the common practice of a set of &lt;import/&gt; elements that order your application modules, and ensure that the database and database initialization are listed first</p>
</li>
<li>
<p>Separate the datasource and the business components that use it and control their startup order by putting them in separate ApplicationContext instances (e.g.
parent has the datasource and child has the business components).
This structure is common in Spring web applications, but can be more generally applied.</p>
</li>
<li>
<p>Use a modular runtime like SpringSource dm Server and separate the data source and the components that depend on it.
E.g.
specify the bundle start up order as datasource &#8594; initializer &#8594; business components.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<h1 id="object-relational-mapping-orm-data-access" class="sect0"><a class="anchor" href="#object-relational-mapping-orm-data-access"></a>Object Relational Mapping (ORM) Data Access</h1>
<div class="sect1">
<h2 id="introduction-to-orm-with-spring"><a class="anchor" href="#introduction-to-orm-with-spring"></a>Introduction to ORM with Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Framework supports integration with Hibernate, Java Persistence API (JPA), Java Data Objects (JDO) and iBATIS SQL Maps for resource management, data access object (DAO) implementations, and transaction strategies.
For example, for Hibernate there is first-class support with several convenient IoC features that address many typical Hibernate integration issues.
You can configure all of the supported features for O/R (object relational) mapping tools through Dependency Injection.
They can participate in Spring&#8217;s resource and transaction management, and they comply with Spring&#8217;s generic transaction and DAO exception hierarchies.
The recommended integration style is to code DAOs against plain Hibernate, JPA, and JDO APIs.
The older style of using Spring&#8217;s DAO templates is no longer recommended; however, coverage of this style can be found in the <a href="#classic-spring-orm">[classic-spring-orm]</a> in the appendices.</p>
</div>
<div class="paragraph">
<p>Spring adds significant enhancements to the ORM layer of your choice when you create data access applications.
You can leverage as much of the integration support as you wish, and you should compare this integration effort with the cost and risk of building a similar infrastructure in-house.
You can use much of the ORM support as you would a library, regardless of technology, because everything is designed as a set of reusable JavaBeans.
ORM in a Spring IoC container facilitates configuration and deployment.
Thus most examples in this section show configuration inside a Spring container.</p>
</div>
<div class="paragraph">
<p>Benefits of using the Spring Framework to create your ORM DAOs include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Easier testing.</em> Spring&#8217;s IoC approach makes it easy to swap the implementations and configuration locations of Hibernate <code class="interface">SessionFactory</code> instances, JDBC <code class="interface">DataSource</code> instances, transaction managers, and mapped object implementations (if needed).
This in turn makes it much easier to test each piece of persistence-related code in isolation.</p>
</li>
<li>
<p><em>Common data access exceptions.</em> Spring can wrap exceptions from your ORM tool, converting them from proprietary (potentially checked) exceptions to a common runtime DataAccessException hierarchy.
This feature allows you to handle most persistence exceptions, which are non-recoverable, only in the appropriate layers, without annoying boilerplate catches, throws, and exception declarations.
You can still trap and handle exceptions as necessary.
Remember that JDBC exceptions (including DB-specific dialects) are also converted to the same hierarchy, meaning that you can perform some operations with JDBC within a consistent programming model.</p>
</li>
<li>
<p><em>General resource management.</em> Spring application contexts can handle the location and configuration of Hibernate <code class="interface">SessionFactory</code> instances, JPA <code class="interface">EntityManagerFactory</code> instances, JDBC <code class="interface">DataSource</code> instances, iBATIS SQL Maps configuration objects, and other related resources.
This makes these values easy to manage and change.
Spring offers efficient, easy, and safe handling of persistence resources.
For example, related code that uses Hibernate generally needs to use the same Hibernate <code class="interface">Session</code> to ensure efficiency and proper transaction handling.
Spring makes it easy to create and bind a <code class="interface">Session</code> to the current thread transparently, by exposing a current <code class="interface">Session</code> through the Hibernate <code class="interface">SessionFactory</code>.
Thus Spring solves many chronic problems of typical Hibernate usage, for any local or JTA transaction environment.</p>
</li>
<li>
<p><em>Integrated transaction management.</em> You can wrap your ORM code with a declarative, aspect-oriented programming (AOP) style method interceptor either through the <code class="interface">@Transactional</code> annotation or by explicitly configuring the transaction AOP advice in an XML configuration file.
In both cases, transaction semantics and exception handling (rollback, and so on) are handled for you.
As discussed below, in <a href="#orm-resource-mngmnt">Resource and transaction
        management</a>, you can also swap various transaction managers, without affecting your ORM-related code.
For example, you can swap between local transactions and JTA, with the same full services (such as declarative transactions) available in both scenarios.
Additionally, JDBC-related code can fully integrate transactionally with the code you use to do ORM. This is useful for data access that is not suitable for ORM, such as batch processing and BLOB streaming, which still need to share common transactions with ORM operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>TODO:
    provide links to current samples</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="general-orm-integration-considerations"><a class="anchor" href="#general-orm-integration-considerations"></a>General ORM integration considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section highlights considerations that apply to all ORM technologies.
The <a href="#orm-hibernate">[orm-hibernate]</a> section provides more details and also show these features and configurations in a concrete context.</p>
</div>
<div class="paragraph">
<p>The major goal of Spring&#8217;s ORM integration is clear application layering, with any data access and transaction technology, and for loose coupling of application objects.
No more business service dependencies on the data access or transaction strategy, no more hard-coded resource lookups, no more hard-to-replace singletons, no more custom service registries.
One simple and consistent approach to wiring up application objects, keeping them as reusable and free from container dependencies as possible.
All the individual data access features are usable on their own but integrate nicely with Spring&#8217;s application context concept, providing XML-based configuration and cross-referencing of plain JavaBean instances that need not be Spring-aware.
In a typical Spring application, many important objects are JavaBeans: data access templates, data access objects, transaction managers, business services that use the data access objects and transaction managers, web view resolvers, web controllers that use the business services,and so on.</p>
</div>
<div class="sect2">
<h3 id="resource-and-transaction-management"><a class="anchor" href="#resource-and-transaction-management"></a>Resource and transaction management</h3>
<div class="paragraph">
<p>Typical business applications are cluttered with repetitive resource management code.
Many projects try to invent their own solutions, sometimes sacrificing proper handling of failures for programming convenience.
Spring advocates simple solutions for proper resource handling, namely IoC through templating in the case of JDBC and applying AOP interceptors for the ORM technologies.</p>
</div>
<div class="paragraph">
<p>The infrastructure provides proper resource handling and appropriate conversion of specific API exceptions to an unchecked infrastructure exception hierarchy.
Spring introduces a DAO exception hierarchy, applicable to any data access strategy.
For direct JDBC, the <code class="class">JdbcTemplate</code> class mentioned in a previous section provides connection handling and proper conversion of <code class="class">SQLException</code> to the <code class="class">DataAccessException</code> hierarchy, including translation of database-specific SQL error codes to meaningful exception classes.
For ORM technologies, see the next section for how to get the same exception translation benefits.</p>
</div>
<div class="paragraph">
<p>When it comes to transaction management, the <code class="class">JdbcTemplate</code> class hooks in to the Spring transaction support and supports both JTA and JDBC transactions, through respective Spring transaction managers.
For the supported ORM technologies Spring offers Hibernate, JPA and JDO support through the Hibernate, JPA, and JDO transaction managers as well as JTA support.
For details on transaction support, see the <a href="#transaction">[transaction]</a> chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="exception-translation"><a class="anchor" href="#exception-translation"></a>Exception translation</h3>
<div class="paragraph">
<p>When you use Hibernate, JPA, or JDO in a DAO, you must decide how to handle the persistence technology&#8217;s native exception classes.
The DAO throws a subclass of a <code class="class">HibernateException</code>, <code class="class">PersistenceException</code> or <code class="interface">JDOException</code> depending on the technology.
These exceptions are all run-time exceptions and do not have to be declared or caught.
You may also have to deal with <code class="class">IllegalArgumentException</code> and <code class="class">IllegalStateException</code>.
This means that callers can only treat exceptions as generally fatal, unless they want to depend on the persistence technology&#8217;s own exception structure.
Catching specific causes such as an optimistic locking failure is not possible without tying the caller to the implementation strategy.
This trade off might be acceptable to applications that are strongly ORM-based and/or do not need any special exception treatment.
However, Spring enables exception translation to be applied transparently through the <code class="interface">@Repository</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Repository
public class ProductDaoImpl implements ProductDao {

    // class body here...

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;!-- Exception translation bean post processor --&gt;
  &lt;bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The postprocessor automatically looks for all exception translators (implementations of the <code class="interface">PersistenceExceptionTranslator</code> interface) and advises all beans marked with the <code class="interface">@Repository</code> annotation so that the discovered translators can intercept and apply the appropriate translation on the thrown exceptions.</p>
</div>
<div class="paragraph">
<p>In summary: you can implement DAOs based on the plain persistence technology&#8217;s API and annotations, while still benefiting from Spring-managed transactions, dependency injection, and transparent exception conversion (if desired) to Spring&#8217;s custom exception hierarchies.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hibernate"><a class="anchor" href="#hibernate"></a>Hibernate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will start with a coverage of &lt;&lt;,Hibernate 3&gt;&gt; in a Spring environment, using it to demonstrate the approach that Spring takes towards integrating O/R mappers.
This section will cover many issues in detail and show different variations of DAO implementations and transaction demarcation.
Most of these patterns can be directly translated to all other supported ORM tools.
The following sections in this chapter will then cover the other ORM technologies, showing briefer examples there.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
As of Spring 3.0, Spring requires Hibernate 3.2 or later.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="code-class-interface-sessionfactory-code-setup-in-a-spring-container"><a class="anchor" href="#code-class-interface-sessionfactory-code-setup-in-a-spring-container"></a><code class="interface">SessionFactory</code> setup in a Spring container</h3>
<div class="paragraph">
<p>To avoid tying application objects to hard-coded resource lookups, you can define resources such as a JDBC <code class="interface">DataSource</code> or a Hibernate <code class="interface">SessionFactory</code> as beans in the Spring container.
Application objects that need to access resources receive references to such predefined instances through bean references, as illustrated in the DAO definition in the next section.</p>
</div>
<div class="paragraph">
<p>The following excerpt from an XML application context definition shows how to set up a JDBC <code class="class">DataSource</code> and a Hibernate <code class="interface">SessionFactory</code> on top of it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="org.hsqldb.jdbcDriver"/&gt;
    &lt;property name="url" value="jdbc:hsqldb:hsql://localhost:9001"/&gt;
    &lt;property name="username" value="sa"/&gt;
    &lt;property name="password" value=""/&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="myDataSource"/&gt;
    &lt;property name="mappingResources"&gt;
      &lt;list&gt;
        &lt;value&gt;product.hbm.xml&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.HSQLDialect
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Switching from a local Jakarta Commons DBCP <code class="class">BasicDataSource</code> to a JNDI-located <code class="interface">DataSource</code> (usually managed by an application server) is just a matter of configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;jee:jndi-lookup id="myDataSource" jndi-name="java:comp/env/jdbc/myds"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also access a JNDI-located <code class="interface">SessionFactory</code>, using Spring&#8217;s <code class="class">JndiObjectFactoryBean</code> / <code>&lt;jee:jndi-lookup&gt;</code> to retrieve and expose it.
However, that is typically not common outside of an EJB context.</p>
</div>
</div>
<div class="sect2">
<h3 id="implementing-daos-based-on-plain-hibernate-3-api"><a class="anchor" href="#implementing-daos-based-on-plain-hibernate-3-api"></a>Implementing DAOs based on plain Hibernate 3 API</h3>
<div class="paragraph">
<p>Hibernate 3 has a feature called contextual sessions, wherein Hibernate itself manages one current <code class="interface">Session</code> per transaction.
This is roughly equivalent to Spring&#8217;s synchronization of one Hibernate <code class="interface">Session</code> per transaction.
A corresponding DAO implementation resembles the following example, based on the plain Hibernate API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl implements ProductDao {

    private SessionFactory sessionFactory;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.sessionFactory = sessionFactory;
    }

    public Collection loadProductsByCategory(String category) {
        return this.sessionFactory.getCurrentSession()
                .createQuery("from test.Product product where product.category=?")
                .setParameter(0, category)
                .list();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is similar to that of the Hibernate reference documentation and examples, except for holding the <code class="interface">SessionFactory</code> in an instance variable.
We strongly recommend such an instance-based setup over the old-school <code>static</code> <code class="class">HibernateUtil</code> class from Hibernate&#8217;s CaveatEmptor sample application.
(In general, do not keep any resources in <code>static</code> variables unless <em>absolutely</em> necessary.)</p>
</div>
<div class="paragraph">
<p>The above DAO follows the dependency injection pattern: it fits nicely into a Spring IoC container, just as it would if coded against Spring&#8217;s <code class="class">HibernateTemplate</code>.
Of course, such a DAO can also be set up in plain Java (for example, in unit tests).
Simply instantiate it and call <code class="method">setSessionFactory(..)</code> with the desired factory reference.
As a Spring bean definition, the DAO would resemble the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main advantage of this DAO style is that it depends on Hibernate API only; no import of any Spring class is required.
This is of course appealing from a non-invasiveness perspective, and will no doubt feel more natural to Hibernate developers.</p>
</div>
<div class="paragraph">
<p>However, the DAO throws plain <code class="class">HibernateException</code> (which is unchecked, so does not have to be declared or caught), which means that callers can only treat exceptions as generally fatal - unless they want to depend on Hibernate&#8217;s own exception hierarchy.
Catching specific causes such as an optimistic locking failure is not possible without tying the caller to the implementation strategy.
This trade off might be acceptable to applications that are strongly Hibernate-based and/or do not need any special exception treatment.</p>
</div>
<div class="paragraph">
<p>Fortunately, Spring&#8217;s <code class="class">LocalSessionFactoryBean</code> supports Hibernate&#8217;s <code class="method">SessionFactory.getCurrentSession()</code> method for any Spring transaction strategy, returning the current Spring-managed transactional <code class="interface">Session</code> even with <code class="class">HibernateTransactionManager</code>.
Of course, the standard behavior of that method remains the return of the current <code class="interface">Session</code> associated with the ongoing JTA transaction, if any.
This behavior applies regardless of whether you are using Spring&#8217;s <code class="class">JtaTransactionManager</code>, EJB container managed transactions (CMTs), or JTA.</p>
</div>
<div class="paragraph">
<p>In summary: you can implement DAOs based on the plain Hibernate 3 API, while still being able to participate in Spring-managed transactions.</p>
</div>
</div>
<div class="sect2">
<h3 id="declarative-transaction-demarcation"><a class="anchor" href="#declarative-transaction-demarcation"></a>Declarative transaction demarcation</h3>
<div class="paragraph">
<p>We recommend that you use Spring&#8217;s declarative transaction support, which enables you to replace explicit transaction demarcation API calls in your Java code with an AOP transaction interceptor.
This transaction interceptor can be configured in a Spring container using either Java annotations or XML.This declarative transaction capability allows you to keep business services free of repetitive transaction demarcation code and to focus on adding business logic, which is the real value of your application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Prior to continuing, you are <em>strongly</em> encouraged to read <a href="#transaction-declarative">[transaction-declarative]</a> if you have not done so.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Furthermore, transaction semantics like propagation behavior and isolation level can be changed in a configuration file and do not affect the business service implementations.</p>
</div>
<div class="paragraph">
<p>The following example shows how you can configure an AOP transaction interceptor, using XML, for a simple service class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;

  &lt;!-- SessionFactory, DataSource, etc. omitted --&gt;

  &lt;bean id="transactionManager"
            class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="sessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods"
            expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="myTxManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  &lt;bean id="myProductService" class="product.SimpleProductService"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the service class that is advised:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductServiceImpl implements ProductService {

    private ProductDao productDao;

    public void setProductDao(ProductDao productDao) {
        this.productDao = productDao;
    }

    // notice the absence of transaction demarcation code in this method
    // Spring's declarative transaction infrastructure will be demarcating
    // transactions on your behalf
    public void increasePriceOfAllProductsInCategory(final String category) {
        List productsToChange = this.productDao.loadProductsByCategory(category);
        // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also show an attribute-support based configuration, in the following example.
You annotate the service layer with @Transactional annotations and instruct the Spring container to find these annotations and provide transactional semantics for these annotated methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductServiceImpl implements ProductService {

    private ProductDao productDao;

    public void setProductDao(ProductDao productDao) {
        this.productDao = productDao;
    }

    @Transactional
    public void increasePriceOfAllProductsInCategory(final String category) {
        List productsToChange = this.productDao.loadProductsByCategory(category);
        // ...
    }

    @Transactional(readOnly = true)
    public List&lt;Product&gt; findAllProducts() {
        return this.productDao.findAllProducts();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the following configuration example, the configuration is much simplified, compared to the XML example above, while still providing the same functionality driven by the annotations in the service layer code.
All you need to provide is the TransactionManager implementation and a "&lt;tx:annotation-driven/&gt;" entry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;

  &lt;!-- SessionFactory, DataSource, etc. omitted --&gt;

  &lt;bean id="transactionManager"
            class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="sessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;tx:annotation-driven/&gt;

  &lt;bean id="myProductService" class="product.SimpleProductService"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="programmatic-transaction-demarcation"><a class="anchor" href="#programmatic-transaction-demarcation"></a>Programmatic transaction demarcation</h3>
<div class="paragraph">
<p>You can demarcate transactions in a higher level of the application, on top of such lower-level data access services spanning any number of operations.
Nor do restrictions exist on the implementation of the surrounding business service; it just needs a Spring <code class="class">PlatformTransactionManager</code>.
Again, the latter can come from anywhere, but preferably as a bean reference through a <code class="method">setTransactionManager(..)</code> method, just as the <code class="class">productDAO</code> should be set by a <code class="method">setProductDao(..)</code> method.
The following snippets show a transaction manager and a business service definition in a Spring application context, and an example for a business method implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="transactionManager" ref="myTxManager"/&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductServiceImpl implements ProductService {

    private TransactionTemplate transactionTemplate;
    private ProductDao productDao;

    public void setTransactionManager(PlatformTransactionManager transactionManager) {
        this.transactionTemplate = new TransactionTemplate(transactionManager);
    }

    public void setProductDao(ProductDao productDao) {
        this.productDao = productDao;
    }

    public void increasePriceOfAllProductsInCategory(final String category) {
        this.transactionTemplate.execute(new TransactionCallbackWithoutResult() {

                public void doInTransactionWithoutResult(TransactionStatus status) {
                    List productsToChange = this.productDao.loadProductsByCategory(category);
                    // do the price increase...
                }
            }
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring&#8217;s <code class="class">TransactionInterceptor</code> allows any checked application exception to be thrown with the callback code, while <code class="class">TransactionTemplate</code> is restricted to unchecked exceptions within the callback.
<code class="class">TransactionTemplate</code> triggers a rollback in case of an unchecked application exception, or if the transaction is marked rollback-only by the application (via <code class="class">TransactionStatus</code>).
<code class="class">TransactionInterceptor</code> behaves the same way by default but allows configurable rollback policies per method.</p>
</div>
</div>
<div class="sect2">
<h3 id="transaction-management-strategies"><a class="anchor" href="#transaction-management-strategies"></a>Transaction management strategies</h3>
<div class="paragraph">
<p>Both <code class="class">TransactionTemplate</code> and <code class="class">TransactionInterceptor</code> delegate the actual transaction handling to a <code class="class">PlatformTransactionManager</code> instance, which can be a <code class="class">HibernateTransactionManager</code> (for a single Hibernate <code class="interface">SessionFactory</code>, using a <code class="class">ThreadLocal</code> <code class="interface">Session</code> under the hood) or a <code class="class">JtaTransactionManager</code> (delegating to the JTA subsystem of the container) for Hibernate applications.
You can even use a custom <code class="class">PlatformTransactionManager</code> implementation.
Switching from native Hibernate transaction management to JTA, such as when facing distributed transaction requirements for certain deployments of your application, is just a matter of configuration.
Simply replace the Hibernate transaction manager with Spring&#8217;s JTA transaction implementation.
Both transaction demarcation and data access code will work without changes, because they just use the generic transaction management APIs.</p>
</div>
<div class="paragraph">
<p>For distributed transactions across multiple Hibernate session factories, simply combine <code class="class">JtaTransactionManager</code> as a transaction strategy with multiple <code class="class">LocalSessionFactoryBean</code> definitions.
Each DAO then gets one specific <code class="interface">SessionFactory</code> reference passed into its corresponding bean property.
If all underlying JDBC data sources are transactional container ones, a business service can demarcate transactions across any number of DAOs and any number of session factories without special regard, as long as it is using <code class="class">JtaTransactionManager</code> as the strategy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;jee:jndi-lookup id="dataSource1" jndi-name="java:comp/env/jdbc/myds1"/&gt;

  &lt;jee:jndi-lookup id="dataSource2" jndi-name="java:comp/env/jdbc/myds2"/&gt;

  &lt;bean id="mySessionFactory1"
            class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="myDataSource1"/&gt;
    &lt;property name="mappingResources"&gt;
      &lt;list&gt;
        &lt;value&gt;product.hbm.xml&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.MySQLDialect
        hibernate.show_sql=true
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory2"
            class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="myDataSource2"/&gt;
    &lt;property name="mappingResources"&gt;
      &lt;list&gt;
        &lt;value&gt;inventory.hbm.xml&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.OracleDialect
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="myTxManager" class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory1"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myInventoryDao" class="product.InventoryDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory2"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
    &lt;property name="inventoryDao" ref="myInventoryDao"/&gt;
  &lt;/bean&gt;

  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods"
                expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="myTxManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code class="class">HibernateTransactionManager</code> and <code class="class">JtaTransactionManager</code> allow for proper JVM-level cache handling with Hibernate, without container-specific transaction manager lookup or a JCA connector (if you are not using EJB to initiate transactions).</p>
</div>
<div class="paragraph">
<p><code class="class">HibernateTransactionManager</code> can export the Hibernate JDBC <code class="interface">Connection</code> to plain JDBC access code, for a specific <code class="interface">DataSource</code>.
This capability allows for high-level transaction demarcation with mixed Hibernate and JDBC data access completely without JTA, if you are accessing only one database.
<code class="class">HibernateTransactionManager</code> automatically exposes the Hibernate transaction as a JDBC transaction if you have set up the passed-in <code class="interface">SessionFactory</code> with a <code class="interface">DataSource</code> through the <code class="class">dataSource</code> property of the <code class="class">LocalSessionFactoryBean</code> class.
Alternatively, you can specify explicitly the <code class="interface">DataSource</code> for which the transactions are supposed to be exposed through the <code class="class">dataSource</code> property of the <code class="class">HibernateTransactionManager</code> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="comparing-container-managed-and-locally-defined-resources"><a class="anchor" href="#comparing-container-managed-and-locally-defined-resources"></a>Comparing container-managed and locally defined resources</h3>
<div class="paragraph">
<p>You can switch between a container-managed JNDI <code class="interface">SessionFactory</code> and a locally defined one, without having to change a single line of application code.
Whether to keep resource definitions in the container or locally within the application is mainly a matter of the transaction strategy that you use.
Compared to a Spring-defined local <code class="interface">SessionFactory</code>, a manually registered JNDI <code class="interface">SessionFactory</code> does not provide any benefits.
Deploying a <code class="interface">SessionFactory</code> through Hibernate&#8217;s JCA connector provides the added value of participating in the Java EE server&#8217;s management infrastructure, but does not add actual value beyond that.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s transaction support is not bound to a container.
Configured with any strategy other than JTA, transaction support also works in a stand-alone or test environment.
Especially in the typical case of single-database transactions, Spring&#8217;s single-resource local transaction support is a lightweight and powerful alternative to JTA. When you use local EJB stateless session beans to drive transactions, you depend both on an EJB container and JTA, even if you access only a single database, and only use stateless session beans to provide declarative transactions through container-managed transactions.
Also, direct use of JTA programmatically requires a Java EE environment as well.
JTA does not involve only container dependencies in terms of JTA itself and of JNDI <code class="interface">DataSource</code> instances.
For non-Spring, JTA-driven Hibernate transactions, you have to use the Hibernate JCA connector, or extra Hibernate transaction code with the <code class="interface">TransactionManagerLookup</code> configured for proper JVM-level caching.</p>
</div>
<div class="paragraph">
<p>Spring-driven transactions can work as well with a locally defined Hibernate <code class="interface">SessionFactory</code> as they do with a local JDBC [interface]`DataSource `if they are accessing a single database.
Thus you only have to use Spring&#8217;s JTA transaction strategy when you have distributed transaction requirements.
A JCA connector requires container-specific deployment steps, and obviously JCA support in the first place.
This configuration requires more work than deploying a simple web application with local resource definitions and Spring-driven transactions.
Also, you often need the Enterprise Edition of your container if you are using, for example, WebLogic Express, which does not provide JCA. A Spring application with local resources and transactions spanning one single database works in any Java EE web container (without JTA, JCA, or EJB) such as Tomcat, Resin, or even plain Jetty.
Additionally, you can easily reuse such a middle tier in desktop applications or test suites.</p>
</div>
<div class="paragraph">
<p>All things considered, if you do not use EJBs, stick with local <code class="interface">SessionFactory</code> setup and Spring&#8217;s <code class="class">HibernateTransactionManager</code> or <code class="class">JtaTransactionManager</code>.
You get all of the benefits, including proper transactional JVM-level caching and distributed transactions, without the inconvenience of container deployment.
JNDI registration of a Hibernate <code class="interface">SessionFactory</code> through the JCA connector only adds value when used in conjunction with EJBs.</p>
</div>
</div>
<div class="sect2">
<h3 id="spurious-application-server-warnings-with-hibernate"><a class="anchor" href="#spurious-application-server-warnings-with-hibernate"></a>Spurious application server warnings with Hibernate</h3>
<div class="paragraph">
<p>In some JTA environments with very strict <code class="interface">XADataSource</code> implementations&#8201;&#8212;&#8201;currently only some WebLogic Server and WebSphere versions&#8201;&#8212;&#8201;when Hibernate is configured without regard to the JTA <code class="interface">PlatformTransactionManager</code> object for that environment, it is possible for spurious warning or exceptions to show up in the application server log.
These warnings or exceptions indicate that the connection being accessed is no longer valid, or JDBC access is no longer valid, possibly because the transaction is no longer active.
As an example, here is an actual exception from WebLogic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>java.sql.SQLException: The transaction is no longer active - status: 'Committed'.
   No further JDBC access is allowed within this transaction.</code></pre>
</div>
</div>
<div class="paragraph">
<p>You resolve this warning by simply making Hibernate aware of the JTA <code class="interface">PlatformTransactionManager</code> instance, to which it will synchronize (along with Spring).
You have two options for doing this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If in your application context you are already directly obtaining the JTA <code class="interface">PlatformTransactionManager</code> object (presumably from JNDI through <code>JndiObjectFactoryBean</code> or <code>&lt;jee:jndi-lookup&gt;</code>) and feeding it, for example, to Spring&#8217;s <code class="class">JtaTransactionManager</code>, then the easiest way is to specify a reference to the bean defining this JTA <code class="interface">PlatformTransactionManager</code> instance as the value of the  property for <code class="class">LocalSessionFactoryBean.</code> Spring then makes the object available to Hibernate.</p>
</li>
<li>
<p>More likely you do not already have the JTA <code class="interface">PlatformTransactionManager</code> instance, because Spring&#8217;s <code class="class">JtaTransactionManager</code> can find it itself.
Thus you need to configure Hibernate to look up JTA <code class="interface">PlatformTransactionManager</code> directly.
You do this by configuring an application server- specific <code>TransactionManagerLookup</code> class in the Hibernate configuration, as described in the Hibernate manual.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The remainder of this section describes the sequence of events that occur with and without Hibernate&#8217;s awareness of the JTA <code class="interface">PlatformTransactionManager</code>.</p>
</div>
<div class="paragraph">
<p>When Hibernate is not configured with any awareness of the JTA <code class="interface">PlatformTransactionManager</code>, the following events occur when a JTA transaction commits:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The JTA transaction commits.</p>
</li>
<li>
<p>Spring&#8217;s <code class="class">JtaTransactionManager</code> is synchronized to the JTA transaction, so it is called back through an <em>afterCompletion</em> callback by the JTA transaction manager.</p>
</li>
<li>
<p>Among other activities, this synchronization can trigger a callback by Spring to Hibernate, through Hibernate&#8217;s <code>afterTransactionCompletion</code> callback (used to clear the Hibernate cache), followed by an explicit <code>close()</code> call on the Hibernate Session, which causes Hibernate to attempt to <code>close()</code> the JDBC Connection.</p>
</li>
<li>
<p>In some environments, this <code class="method">Connection.close()</code> call then triggers the warning or error, as the application server no longer considers the <code class="interface">Connection</code> usable at all, because the transaction has already been committed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When Hibernate is configured with awareness of the JTA <code class="interface">PlatformTransactionManager</code>, the following events occur when a JTA transaction commits:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the JTA transaction is ready to commit.</p>
</li>
<li>
<p>Spring&#8217;s <code class="class">JtaTransactionManager</code> is synchronized to the JTA transaction, so the transaction is called back through a <em>beforeCompletion</em> callback by the JTA transaction manager.</p>
</li>
<li>
<p>Spring is aware that Hibernate itself is synchronized to the JTA transaction, and behaves differently than in the previous scenario.
Assuming the Hibernate <code class="interface">Session</code> needs to be closed at all, Spring will close it now.</p>
</li>
<li>
<p>The JTA transaction commits.</p>
</li>
<li>
<p>Hibernate is synchronized to the JTA transaction, so the transaction is called back through an <em>afterCompletion</em> callback by the JTA transaction manager, and can properly clear its cache.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jdo"><a class="anchor" href="#jdo"></a>JDO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring supports the standard JDO 2.0 and 2.1 APIs as data access strategy, following the same style as the Hibernate support.
The corresponding integration classes reside in the <code>org.springframework.orm.jdo</code> package.</p>
</div>
<div class="sect2">
<h3 id="code-class-interface-persistencemanagerfactory-code-setup"><a class="anchor" href="#code-class-interface-persistencemanagerfactory-code-setup"></a><code class="interface">PersistenceManagerFactory</code> setup</h3>
<div class="paragraph">
<p>Spring provides a <code class="class">LocalPersistenceManagerFactoryBean</code> class that allows you to define a local JDO <code class="interface">PersistenceManagerFactory</code> within a Spring application context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myPmf" class="org.springframework.orm.jdo.LocalPersistenceManagerFactoryBean"&gt;
    &lt;property name="configLocation" value="classpath:kodo.properties"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can set up a <code class="interface">PersistenceManagerFactory</code> through direct instantiation of a <code class="interface">PersistenceManagerFactory</code> implementation class.
A JDO <code class="interface">PersistenceManagerFactory</code> implementation class follows the JavaBeans pattern, just like a JDBC <code class="interface">DataSource</code> implementation class, which is a natural fit for a configuration that uses Spring.
This setup style usually supports a Spring-defined JDBC <code class="interface">DataSource</code>, passed into the <code class="class">connectionFactory</code> property.
For example, for the open source JDO implementation DataNucleus (formerly JPOX) (&lt;&lt;,http://www.datanucleus.org/&gt;&gt;), this is the XML configuration of the <code class="interface">PersistenceManagerFactory</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

 &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
   &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
   &lt;property name="url" value="${jdbc.url}"/&gt;
   &lt;property name="username" value="${jdbc.username}"/&gt;
   &lt;property name="password" value="${jdbc.password}"/&gt;
 &lt;/bean&gt;

 &lt;bean id="myPmf" class="org.datanucleus.jdo.JDOPersistenceManagerFactory" destroy-method="close"&gt;
   &lt;property name="connectionFactory" ref="dataSource"/&gt;
   &lt;property name="nontransactionalRead" value="true"/&gt;
 &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set up JDO <code class="interface">PersistenceManagerFactory</code> in the JNDI environment of a Java EE application server, usually through the JCA connector provided by the particular JDO implementation.
Spring&#8217;s standard <code>JndiObjectFactoryBean</code> or <code>&lt;jee:jndi-lookup&gt;</code> can be used to retrieve and expose such a <code class="interface">PersistenceManagerFactory</code>.
However, outside an EJB context, no real benefit exists in holding the <code class="interface">PersistenceManagerFactory</code> in JNDI: only choose such a setup for a good reason.
See <a href="#orm-hibernate-resources">[orm-hibernate-resources]</a> for a discussion; the arguments there apply to JDO as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="implementing-daos-based-on-the-plain-jdo-api"><a class="anchor" href="#implementing-daos-based-on-the-plain-jdo-api"></a>Implementing DAOs based on the plain JDO API</h3>
<div class="paragraph">
<p>DAOs can also be written directly against plain JDO API, without any Spring dependencies, by using an injected <code class="interface">PersistenceManagerFactory</code>.
The following is an example of a corresponding DAO implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl implements ProductDao {

    private PersistenceManagerFactory persistenceManagerFactory;

    public void setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        this.persistenceManagerFactory = pmf;
    }

    public Collection loadProductsByCategory(String category) {
        PersistenceManager pm = this.persistenceManagerFactory.getPersistenceManager();
        try {
            Query query = pm.newQuery(Product.class, "category = pCategory");
            query.declareParameters("String pCategory");
            return query.execute(category);
        }
        finally {
          pm.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the above DAO follows the dependency injection pattern, it fits nicely into a Spring container, just as it would if coded against Spring&#8217;s <code class="class">JdoTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main problem with such DAOs is that they always get a new <code class="interface">PersistenceManager</code> from the factory.
To access a Spring-managed transactional <code class="interface">PersistenceManager</code>, define a <code class="class">TransactionAwarePersistenceManagerFactoryProxy</code> (as included in Spring) in front of your target <code class="interface">PersistenceManagerFactory</code>, then passing a reference to that proxy into your DAOs as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myPmfProxy"
      class="org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy"&gt;
    &lt;property name="targetPersistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmfProxy"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your data access code will receive a transactional <code class="interface">PersistenceManager</code> (if any) from the <code class="method">PersistenceManagerFactory.getPersistenceManager()</code> method that it calls.
The latter method call goes through the proxy, which first checks for a current transactional <code class="interface">PersistenceManager</code> before getting a new one from the factory.
Any <code class="method">close()</code> calls on the <code class="interface">PersistenceManager</code> are ignored in case of a transactional <code class="interface">PersistenceManager</code>.</p>
</div>
<div class="paragraph">
<p>If your data access code always runs within an active transaction (or at least within active transaction synchronization), it is safe to omit the <code class="method">PersistenceManager.close()</code> call and thus the entire <code>finally</code> block, which you might do to keep your DAO implementations concise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl implements ProductDao {

    private PersistenceManagerFactory persistenceManagerFactory;

    public void setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        this.persistenceManagerFactory = pmf;
    }

    public Collection loadProductsByCategory(String category) {
        PersistenceManager pm = this.persistenceManagerFactory.getPersistenceManager();
        Query query = pm.newQuery(Product.class, "category = pCategory");
        query.declareParameters("String pCategory");
        return query.execute(category);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With such DAOs that rely on active transactions, it is recommended that you enforce active transactions through turning off <code class="class">TransactionAwarePersistenceManagerFactoryProxy</code>'s <code class="class">allowCreate</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myPmfProxy"
      class="org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy"&gt;
    &lt;property name="targetPersistenceManagerFactory" ref="myPmf"/&gt;
    &lt;property name="allowCreate" value="false"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmfProxy"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main advantage of this DAO style is that it depends on JDO API only; no import of any Spring class is required.
This is of course appealing from a non-invasiveness perspective, and might feel more natural to JDO developers.</p>
</div>
<div class="paragraph">
<p>However, the DAO throws plain  (which is unchecked, so does not have to be declared or caught), which means that callers can only treat exceptions as fatal, unless you want to depend on JDO&#8217;s own exception structure.
Catching specific causes such as an optimistic locking failure is not possible without tying the caller to the implementation strategy.
This trade off might be acceptable to applications that are strongly JDO-based and/or do not need any special exception treatment.</p>
</div>
<div class="paragraph">
<p>In summary, you can DAOs based on the plain JDO API, and they can still participate in Spring-managed transactions.
This strategy might appeal to you if you are already familiar with JDO. However, such DAOs throw plain , and you would have to convert explicitly to Spring&#8217;s  (if desired).</p>
</div>
</div>
<div class="sect2">
<h3 id="transaction-management-3"><a class="anchor" href="#transaction-management-3"></a>Transaction management</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
You are <em>strongly</em> encouraged to read <a href="#transaction-declarative">[transaction-declarative]</a> if you have not done so, to get a more detailed coverage of Spring&#8217;s declarative transaction support.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To execute service operations within transactions, you can use Spring&#8217;s common declarative transaction facilities.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans
        xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:aop="http://www.springframework.org/schema/aop"
        xmlns:tx="http://www.springframework.org/schema/tx"
        xsi:schemaLocation="
   http://www.springframework.org/schema/beans
   http://www.springframework.org/schema/beans/spring-beans.xsd
   http://www.springframework.org/schema/tx
   http://www.springframework.org/schema/tx/spring-tx.xsd
   http://www.springframework.org/schema/aop
   http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.jdo.JdoTransactionManager"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods"
            expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>JDO requires an active transaction to modify a persistent object.
The non-transactional flush concept does not exist in JDO, in contrast to Hibernate.
For this reason, you need to set up the chosen JDO implementation for a specific environment.
Specifically, you need to set it up explicitly for JTA synchronization, to detect an active JTA transaction itself.
This is not necessary for local transactions as performed by Spring&#8217;s <code class="class">JdoTransactionManager</code>, but it is necessary to participate in JTA transactions, whether driven by Spring&#8217;s <code class="class">JtaTransactionManager</code> or by EJB CMT and plain JTA.</p>
</div>
<div class="paragraph">
<p><code class="class">JdoTransactionManager</code> is capable of exposing a JDO transaction to JDBC access code that accesses the same JDBC <code class="interface">DataSource</code>, provided that the registered <code class="class">JdoDialect</code> supports retrieval of the underlying JDBC <code class="interface">Connection</code>.
This is the case for JDBC-based JDO 2.0 implementations by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-interface-jdodialect-code"><a class="anchor" href="#code-class-interface-jdodialect-code"></a><code class="interface">JdoDialect</code></h3>
<div class="paragraph">
<p>As an advanced feature, both <code class="class">JdoTemplate</code> and <code class="class">JdoTransactionManager</code> support a custom <code class="interface">JdoDialect</code> that can be passed into the <code>jdoDialect</code> bean property.
In this scenario, the DAOs will not receive a <code class="interface">PersistenceManagerFactory</code> reference but rather a full <code class="class">JdoTemplate</code> instance (for example, passed into the <code>jdoTemplate</code> property of <code class="class">JdoDaoSupport</code>).
Using a <code class="interface">JdoDialect</code> implementation, you can enable advanced features supported by Spring, usually in a vendor-specific manner:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applying specific transaction semantics such as custom isolation level or transaction timeout</p>
</li>
<li>
<p>Retrieving the transactional JDBC <code class="interface">Connection</code> for exposure to JDBC-based DAOs</p>
</li>
<li>
<p>Applying query timeouts, which are automatically calculated from Spring-managed transaction timeouts</p>
</li>
<li>
<p>Eagerly flushing a <code class="interface">PersistenceManager,</code> to make transactional changes visible to JDBC-based data access code</p>
</li>
<li>
<p>Advanced translation of <code>JDOExceptions</code> to Spring <code>DataAccessExceptions</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <code class="class">JdoDialect</code> Javadoc for more details on its operations and how to use them within Spring&#8217;s JDO support.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jpa"><a class="anchor" href="#jpa"></a>JPA</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring JPA, available under the <code>org.springframework.orm.jpa</code> package, offers comprehensive support for the &lt;&lt;,Java
    Persistence API&gt;&gt; in a similar manner to the integration with Hibernate or JDO, while being aware of the underlying implementation in order to provide additional features.</p>
</div>
<div class="sect2">
<h3 id="three-options-for-jpa-setup-in-a-spring-environment"><a class="anchor" href="#three-options-for-jpa-setup-in-a-spring-environment"></a>Three options for JPA setup in a Spring environment</h3>
<div class="paragraph">
<p>The Spring JPA support offers three ways of setting up the JPA <code class="interface">EntityManagerFactory</code> that will be used by the application to obtain an entity manager.</p>
</div>
<div class="sect3">
<h4 id="code-class-class-localentitymanagerfactorybean-code"><a class="anchor" href="#code-class-class-localentitymanagerfactorybean-code"></a><code class="class">LocalEntityManagerFactoryBean</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Only use this option in simple deployment environments such as stand-alone applications and integration tests.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code class="class">LocalEntityManagerFactoryBean</code> creates an <code class="interface">EntityManagerFactory</code> suitable for simple deployment environments where the application uses only JPA for data access.
The factory bean uses the JPA <code class="interface">PersistenceProvider</code> autodetection mechanism (according to JPA&#8217;s Java SE bootstrapping) and, in most cases, requires you to specify only the persistence unit name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

   &lt;bean id="myEmf" class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean"&gt;
      &lt;property name="persistenceUnitName" value="myPersistenceUnit"/&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This form of JPA deployment is the simplest and the most limited.
You cannot refer to an existing JDBC <code class="interface">DataSource</code> bean definition and no support for global transactions exists.
Furthermore, weaving (byte-code transformation) of persistent classes is provider-specific, often requiring a specific JVM agent to specified on startup.
This option is sufficient only for stand-alone applications and test environments, for which the JPA specification is designed.</p>
</div>
</div>
<div class="sect3">
<h4 id="obtaining-an-code-class-class-entitymanagerfactory-code-from-jndi"><a class="anchor" href="#obtaining-an-code-class-class-entitymanagerfactory-code-from-jndi"></a>Obtaining an <code class="class">EntityManagerFactory</code> from JNDI</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Use this option when deploying to a Java EE 5 server.
Check your server&#8217;s documentation on how to deploy a custom JPA provider into your server, allowing for a different provider than the server&#8217;s default.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Obtaining an <code class="interface">EntityManagerFactory</code> from JNDI (for example in a Java EE 5 environment), is simply a matter of changing the XML configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

    &lt;jee:jndi-lookup id="myEmf" jndi-name="persistence/myPersistenceUnit"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This action assumes standard Java EE 5 bootstrapping: the Java EE server autodetects persistence units (in effect, <code>META-INF/persistence.xml</code> files in application jars) and <code>persistence-unit-ref</code> entries in the Java EE deployment descriptor (for example, <code>web.xml</code>) and defines environment naming context locations for those persistence units.</p>
</div>
<div class="paragraph">
<p>In such a scenario, the entire persistence unit deployment, including the weaving (byte-code transformation) of persistent classes, is up to the Java EE server.
The JDBC <code class="interface">DataSource</code> is defined through a JNDI location in the <code>META-INF/persistence.xml</code> file; EntityManager transactions are integrated with the server&#8217;s JTA subsystem.
Spring merely uses the obtained <code class="interface">EntityManagerFactory</code>, passing it on to application objects through dependency injection, and managing transactions for the persistence unit, typically through <code class="class">JtaTransactionManager</code>.</p>
</div>
<div class="paragraph">
<p>If multiple persistence units are used in the same application, the bean names of such JNDI-retrieved persistence units should match the persistence unit names that the application uses to refer to them, for example, in <code>@PersistenceUnit</code> and <code>@PersistenceContext</code> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-class-class-localcontainerentitymanagerfactorybean-code"><a class="anchor" href="#code-class-class-localcontainerentitymanagerfactorybean-code"></a><code class="class">LocalContainerEntityManagerFactoryBean</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Use this option for full JPA capabilities in a Spring-based application environment.
This includes web containers such as Tomcat as well as stand-alone applications and integration tests with sophisticated persistence requirements.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code class="class">LocalContainerEntityManagerFactoryBean</code> gives full control over <code class="interface">EntityManagerFactory</code> configuration and is appropriate for environments where fine-grained customization is required.
The <code class="class">LocalContainerEntityManagerFactoryBean</code> creates a <code class="interface">PersistenceUnitInfo</code> instance based on the <code>persistence.xml</code> file, the supplied <code>dataSourceLookup</code> strategy, and the specified <code>loadTimeWeaver</code>.
It is thus possible to work with custom data sources outside of JNDI and to control the weaving process.
The following example shows a typical bean definition for a <code class="interface">LocalContainerEntityManagerFactoryBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

 &lt;bean id="myEmf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="dataSource" ref="someDataSource"/&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver"/&gt;
  &lt;/property&gt;
 &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows a typical <code>persistence.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence" version="1.0"&gt;

  &lt;persistence-unit name="myUnit" transaction-type="RESOURCE_LOCAL"&gt;
    &lt;mapping-file&gt;META-INF/orm.xml&lt;/mapping-file&gt;
    &lt;exclude-unlisted-classes/&gt;
  &lt;/persistence-unit&gt;

&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The <code>exclude-unlisted-classes</code> element always indicates that <em>no</em> scanning for annotated entity classes is supposed to occur, in order to support the <code>&lt;exclude-unlisted-classes/&gt;</code> shortcut.
This is in line with the JPA specification, which suggests that shortcut, but unfortunately is in conflict with the JPA XSD, which implies <code>false</code> for that shortcut.
Consequently, <code>&lt;exclude-unlisted-classes&gt; false
          &lt;/exclude-unlisted-classes/&gt;</code> is not supported.
Simply omit the <code>exclude-unlisted-classes</code> element if you want entity class scanning to occur.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the <code class="class">LocalContainerEntityManagerFactoryBean</code> is the most powerful JPA setup option, allowing for flexible local configuration within the application.
It supports links to an existing JDBC <code class="interface">DataSource</code>, supports both local and global transactions, and so on.
However, it also imposes requirements on the runtime environment, such as the availability of a weaving-capable class loader if the persistence provider demands byte-code transformation.</p>
</div>
<div class="paragraph">
<p>This option may conflict with the built-in JPA capabilities of a Java EE 5 server.
In a full Java EE 5 environment, consider obtaining your <code class="interface">EntityManagerFactory</code> from JNDI. Alternatively, specify a custom <code class="class">persistenceXmlLocation</code> on your <code class="class">LocalContainerEntityManagerFactoryBean</code> definition, for example, META-INF/my-persistence.xml, and only include a descriptor with that name in your application jar files.
Because the Java EE 5 server only looks for default <code>META-INF/persistence.xml</code> files, it ignores such custom persistence units and hence avoid conflicts with a Spring-driven JPA setup upfront.
(This applies to Resin 3.1, for example.)</p>
</div>
<div class="paragraph">
<div class="title">When is load-time weaving required?</div>
<p>[sidebar]Not all JPA providers require a JVM agent ; Hibernate is an example of one that does not.
If your provider does not require an agent or you have other alternatives, such as applying enhancements at build time through a custom compiler or an ant task, the load-time weaver <em>should not</em> be used.</p>
</div>
<div class="paragraph">
<p>The <code class="interface">LoadTimeWeaver</code> interface is a Spring-provided class that allows JPA <code class="interface">ClassTransformer</code> instances to be plugged in a specific manner, depending whether the environment is a web container or application server.
 Hooking <code>ClassTransformers</code> through a Java 5 &lt;&lt;,agent&gt;&gt; typically is not efficient.
The agents work against the <em>entire virtual machine</em> and inspect <em>every</em> class that is loaded, which is usually undesirable in a production server environment.</p>
</div>
<div class="paragraph">
<p>Spring provides a number of <code class="interface">LoadTimeWeaver</code> implementations for various environments, allowing <code class="interface">ClassTransformer</code> instances to be applied only <em>per class loader</em> and not per VM.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="#aop-aj-ltw-spring">[aop-aj-ltw-spring]</a> in the AOP chapter for more insight regarding the <code class="interface">LoadTimeWeaver</code> implementations and their setup, either generic or customized to various platforms (such as Tomcat, WebLogic, GlassFish, Resin and JBoss).</p>
</div>
<div class="paragraph">
<p>As described in the aforementioned section, you can configure a context-wide <code class="interface">LoadTimeWeaver</code> using the <code class="interface">@EnableLoadTimeWeaving</code> annotation of <code>context:load-time-weaver</code> XML element.
Such a global weaver is picked up by all JPA <code class="class">LocalContainerEntityManagerFactoryBeans</code> automatically.
This is the preferred way of setting up a load-time weaver, delivering autodetection of the platform (WebLogic, GlassFish, Tomcat, Resin, JBoss or VM agent) and automatic propagation of the weaver to all weaver-aware beans:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;context:load-time-weaver/&gt;
&lt;bean id="emf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
    ...
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>However, if needed, one can manually specify a dedicated weaver through the `loadTimeWeaver` property:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="emf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>No matter how the LTW is configured, using this technique, JPA applications relying on instrumentation can run in the target platform (ex: Tomcat) without needing an agent.
This is important especially when the hosting applications rely on different JPA implementations because the JPA transformers are applied only at class loader level and thus are isolated from each other.</p>
</div>
</div>
<div class="sect3">
<h4 id="dealing-with-multiple-persistence-units"><a class="anchor" href="#dealing-with-multiple-persistence-units"></a>Dealing with multiple persistence units</h4>
<div class="paragraph">
<p>For applications that rely on multiple persistence units locations, stored in various JARS in the classpath, for example, Spring offers the <code class="interface">PersistenceUnitManager</code> to act as a central repository and to avoid the persistence units discovery process, which can be expensive.
The default implementation allows multiple locations to be specified that are parsed and later retrieved through the persistence unit name.
(By default, the classpath is searched for <code class="file">META-INF/persistence.xml</code> files.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="pum" class="org.springframework.orm.jpa.persistenceunit.DefaultPersistenceUnitManager"&gt;
  &lt;property name="persistenceXmlLocations"&gt;
    &lt;list&gt;
     &lt;value&gt;org/springframework/orm/jpa/domain/persistence-multi.xml&lt;/value&gt;
     &lt;value&gt;classpath:/my/package/**/custom-persistence.xml&lt;/value&gt;
     &lt;value&gt;classpath*:META-INF/persistence.xml&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
  &lt;property name="dataSources"&gt;
   &lt;map&gt;
    &lt;entry key="localDataSource" value-ref="local-db"/&gt;
    &lt;entry key="remoteDataSource" value-ref="remote-db"/&gt;
   &lt;/map&gt;
  &lt;/property&gt;
  &lt;!-- if no datasource is specified, use this one --&gt;
  &lt;property name="defaultDataSource" ref="remoteDataSource"/&gt;
&lt;/bean&gt;

&lt;bean id="emf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="persistenceUnitManager" ref="pum"/&gt;
  &lt;property name="persistenceUnitName" value="myCustomUnit"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default implementation allows customization of the <code class="interface">PersistenceUnitInfo</code> instances, before they are fed to the JPA provider, declaratively through its properties, which affect <em>all</em> hosted units, or programmatically, through the <code class="interface">PersistenceUnitPostProcessor</code>, which allows persistence unit selection.
If no <code class="interface">PersistenceUnitManager</code> is specified, one is created and used internally by <code class="class">LocalContainerEntityManagerFactoryBean</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implementing-daos-based-on-plain-jpa"><a class="anchor" href="#implementing-daos-based-on-plain-jpa"></a>Implementing DAOs based on plain JPA</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Although <code class="interface">EntityManagerFactory</code> instances are thread-safe, <code class="interface">EntityManager</code> instances are not.
The injected JPA <code class="interface">EntityManager</code> behaves like an <code class="interface">EntityManager</code> fetched from an application server&#8217;s JNDI environment, as defined by the JPA specification.
It delegates all calls to the current transactional <code class="interface">EntityManager</code>, if any; otherwise, it falls back to a newly created <code class="interface">EntityManager</code> per operation, in effect making its usage thread-safe.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to write code against the plain JPA without any Spring dependencies, by using an injected <code class="interface">EntityManagerFactory</code> or <code class="interface">EntityManager</code>.
Spring can understand <code class="interface">@PersistenceUnit</code> and <code class="interface">@PersistenceContext</code> annotations both at field and method level if a <code class="class">PersistenceAnnotationBeanPostProcessor</code> is enabled.
A plain JPA DAO implementation using the <code class="interface">@PersistenceUnit</code> annotation might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl implements ProductDao {

    private EntityManagerFactory emf;

    @PersistenceUnit
    public void setEntityManagerFactory(EntityManagerFactory emf) {
        this.emf = emf;
    }

    public Collection loadProductsByCategory(String category) {
        EntityManager em = this.emf.createEntityManager();
        try {
             Query query = em.createQuery("from Product as p where p.category = ?1");
             query.setParameter(1, category);
             return query.getResultList();
        }
        finally {
            if (em != null) {
                em.close();
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The DAO above has no dependency on Spring and still fits nicely into a Spring application context.
Moreover, the DAO takes advantage of annotations to require the injection of the default <code class="interface">EntityManagerFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;!-- bean post-processor for JPA annotations --&gt;
  &lt;bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor"/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to defining a <code class="class">PersistenceAnnotationBeanPostProcessor</code> explicitly, consider using the Spring <code>context:annotation-config</code> XML element in your application context configuration.
Doing so automatically registers all Spring standard post-processors for annotation-based configuration, including <code class="class">CommonAnnotationBeanPostProcessor</code> and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;!-- post-processors for all standard config annotations --&gt;
  &lt;context:annotation-config/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main problem with such a DAO is that it always creates a new <code class="interface">EntityManager</code> through the factory.
You can avoid this by requesting a transactional <code class="interface">EntityManager</code> (also called "shared EntityManager" because it is a shared, thread-safe proxy for the actual transactional EntityManager) to be injected instead of the factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl implements ProductDao {

    @PersistenceContext
    private EntityManager em;

    public Collection loadProductsByCategory(String category) {
       Query query = em.createQuery("from Product as p where p.category = :category");
       query.setParameter("category", category);
       return query.getResultList();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PersistenceContext</code> annotation has an optional attribute <code>type</code>, which defaults to <code>PersistenceContextType.TRANSACTION</code>.
This default is what you need to receive a shared EntityManager proxy.
The alternative, <code>PersistenceContextType.EXTENDED</code>, is a completely different affair: This results in a so-called extended EntityManager, which is <em>not thread-safe</em> and hence must not be used in a concurrently accessed component such as a Spring-managed singleton bean.
Extended EntityManagers are only supposed to be used in stateful components that, for example, reside in a session, with the lifecycle of the EntityManager not tied to a current transaction but rather being completely up to the application.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Method- and field-level Injection</div>
<div class="paragraph">
<p>Annotations that indicate dependency injections (such as <code>@PersistenceUnit</code> and <code>@PersistenceContext</code>) can be applied on field or methods inside a class, hence the expressions <em>method-level
        injection</em> and <em>field-level injection</em>.
Field-level annotations are concise and easier to use while method-level allows for further processing of the injected dependency.
In both cases the member visibility (public, protected, private) does not matter.</p>
</div>
<div class="paragraph">
<p>What about class-level annotations?</p>
</div>
<div class="paragraph">
<p>On the Java EE 5 platform, they are used for dependency declaration and not for resource injection.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The injected <code class="interface">EntityManager</code> is Spring-managed (aware of the ongoing transaction).
It is important to note that even though the new DAO implementation uses method level injection of an <code class="interface">EntityManager</code> instead of an <code class="interface">EntityManagerFactory</code>, no change is required in the application context XML due to annotation usage.</p>
</div>
<div class="paragraph">
<p>The main advantage of this DAO style is that it only depends on Java Persistence API; no import of any Spring class is required.
Moreover, as the JPA annotations are understood, the injections are applied automatically by the Spring container.
This is appealing from a non-invasiveness perspective, and might feel more natural to JPA developers.</p>
</div>
</div>
<div class="sect2">
<h3 id="transaction-management-4"><a class="anchor" href="#transaction-management-4"></a>Transaction Management</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
You are <em>strongly</em> encouraged to read <a href="#transaction-declarative">[transaction-declarative]</a> if you have not done so, to get a more detailed coverage of Spring&#8217;s declarative transaction support.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To execute service operations within transactions, you can use Spring&#8217;s common declarative transaction facilities.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
    &lt;property name="entityManagerFactory" ref="myEmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods" expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="myTxManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring JPA allows a configured <code class="class">JpaTransactionManager</code> to expose a JPA transaction to JDBC access code that accesses the same JDBC <code class="interface">DataSource</code>, provided that the registered <code class="interface">JpaDialect</code> supports retrieval of the underlying JDBC <code class="interface">Connection</code>.
Out of the box, Spring provides dialects for the Toplink, Hibernate and OpenJPA JPA implementations.
See the next section for details on the <code class="interface">JpaDialect</code> mechanism.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-interface-jpadialect-code"><a class="anchor" href="#code-class-interface-jpadialect-code"></a><code class="interface">JpaDialect</code></h3>
<div class="paragraph">
<p>As an advanced feature <code class="class">JpaTemplate</code>, <code class="class">JpaTransactionManager</code> and subclasses of <code class="class">AbstractEntityManagerFactoryBean</code> support a custom <code class="interface">JpaDialect</code>, to be passed into the  bean property.
In such a scenario, the DAOs do not receive an <code class="interface">EntityManagerFactory</code> reference but rather a full <code class="class">JpaTemplate</code> instance (for example, passed into the  property[class]` of
      JpaDaoSupport`).
A <code class="interface">JpaDialect</code> implementation can enable some advanced features supported by Spring, usually in a vendor-specific manner:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applying specific transaction semantics such as custom isolation level or transaction timeout)</p>
</li>
<li>
<p>Retrieving the transactional JDBC <code class="interface">Connection</code> for exposure to JDBC-based DAOs)</p>
</li>
<li>
<p>Advanced translation of <code>PersistenceExceptions</code> to Spring <code>DataAccessExceptions</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is particularly valuable for special transaction semantics and for advanced translation of exception.
The default implementation used (<code class="class">DefaultJpaDialect</code>) does not provide any special capabilities and if the above features are required, you have to specify the appropriate dialect.</p>
</div>
<div class="paragraph">
<p>See the <code class="interface">JpaDialect</code> Javadoc for more details of its operations and how they are used within Spring&#8217;s JPA support.</p>
</div>
</div>
</div>
</div>
<h1 id="marshalling-xml-using-o-x-mappers" class="sect0"><a class="anchor" href="#marshalling-xml-using-o-x-mappers"></a>Marshalling XML using O/X Mappers</h1>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> In this chapter, we will describe Spring's Object/XML Mapping support.
Object/XML Mapping, or O/X mapping for short, is the act of converting an XML document to and from an object.
This conversion process is also known as XML Marshalling, or XML Serialization.
This chapter uses these terms interchangeably.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Within the field of O/X mapping, a _marshaller_ is responsible for serializing an object (graph) to XML. In similar fashion, an _unmarshaller_ deserializes the XML to an object graph.
This XML can take the form of a DOM document, an input or output stream, or a SAX handler.</pre>
</div>
</div>
<div class="paragraph">
<p>Some of the benefits of using Spring for your O/X mapping needs are:</p>
</div>
<div class="literalblock">
<div class="title">Ease of configuration</div>
<div class="content">
<pre> Spring's bean factory makes it easy to configure marshallers, without needing to construct JAXB context, JiBX binding factories, etc.
The marshallers can be configured as any other bean in your application context.
Additionally, XML Schema-based configuration is available for a number of marshallers, making the configuration even simpler.</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Consistent Interfaces</div>
<div class="content">
<pre> Spring's O/X mapping operates through two global interfaces: the [interface]`Marshaller` and [interface]`Unmarshaller` interface.
These abstractions allow you to switch O/X mapping frameworks with relative ease, with little or no changes required on the classes that do the marshalling.
This approach has the additional benefit of making it possible to do XML marshalling with a mix-and-match approach (e.g.
some marshalling performed using JAXB, other using XMLBeans) in a non-intrusive fashion, leveraging the strength of each technology.</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Consistent Exception Hierarchy</div>
<div class="content">
<pre> Spring provides a conversion from exceptions from the underlying O/X mapping tool to its own exception hierarchy with the [class]`XmlMappingException` as the root exception.
As can be expected, these runtime exceptions wrap the original exception so no information is lost.</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="marshaller-and-unmarshaller"><a class="anchor" href="#marshaller-and-unmarshaller"></a>Marshaller and Unmarshaller</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> As stated in the introduction, a _marshaller_ serializes an object to XML, and an _unmarshaller_ deserializes XML stream to an object.
In this section, we will describe the two Spring interfaces used for this purpose.</pre>
</div>
</div>
<div class="sect2">
<h3 id="marshaller"><a class="anchor" href="#marshaller"></a>Marshaller</h3>
<div class="literalblock">
<div class="content">
<pre>Spring abstracts all marshalling operations behind the [interface]`org.springframework.oxm.Marshaller` interface, the main methods of which is listed below.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
public interface Marshaller {

    /**
     * Marshals the object graph with the given root into the provided Result.
     */
    void marshal(Object graph, Result result)
        throws XmlMappingException, IOException;
}
---- The [interface]`Marshaller` interface has one main method, which marshals the given object to a given [interface]`javax.xml.transform.Result`.
Result is a tagging interface that basically represents an XML output abstraction: concrete implementations wrap various XML representations, as indicated in the table below.


[cols="1,1", options="header"]
|===
| Result implementation
| Wraps XML representation

| DOMResult
| org.w3c.dom.Node

| SAXResult
| org.xml.sax.ContentHandler

| StreamResult
|
                                    java.io.File,
                                    java.io.OutputStream, or
                                    java.io.Writer

|===

NOTE:  Although the [method]`marshal()` method accepts a plain object as its first parameter, most [class]`Marshaller` implementations cannot handle arbitrary objects.
Instead, an object class must be mapped in a mapping file, marked with an annotation, registered with the marshaller, or have a common base class.
Refer to the further sections in this chapter to determine how your O/X technology of choice manages this.


=== Unmarshaller

 Similar to the [interface]`Marshaller`, there is the [interface]`org.springframework.oxm.Unmarshaller` interface.

[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>public interface Unmarshaller {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    /**
     * Unmarshals the given provided Source into an object graph.
     */
    Object unmarshal(Source source)
        throws XmlMappingException, IOException;
}
---- This interface also has one method, which reads from the given [interface]`javax.xml.transform.Source` (an XML input abstraction), and returns the object read.
As with Result, Source is a tagging interface that has three concrete implementations.
Each wraps a different XML representation, as indicated in the table below.</pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Source implementation</th>
<th class="tableblock halign-left valign-top">Wraps XML representation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOMSource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.w3c.dom.Node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAXSource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.xml.sax.InputSource, and
                                    org.xml.sax.XMLReader</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StreamSource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.File,
                                    java.io.InputStream, or
                                    java.io.Reader</p></td>
</tr>
</tbody>
</table>

<div class="literalblock">
<div class="content">
<pre> Even though there are two separate marshalling interfaces ([interface]`Marshaller` and [interface]`Unmarshaller`), all implementations found in Spring-WS implement both in one class.
This means that you can wire up one marshaller class and refer to it both as a marshaller and an unmarshaller in your [file]`applicationContext.xml`.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xmlmappingexception"><a class="anchor" href="#xmlmappingexception"></a>XmlMappingException</h3>
<div class="literalblock">
<div class="content">
<pre> Spring converts exceptions from the underlying O/X mapping tool to its own exception hierarchy with the [class]`XmlMappingException` as the root exception.
As can be expected, these runtime exceptions wrap the original exception so no information will be lost.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Additionally, the [class]`MarshallingFailureException` and [class]`UnmarshallingFailureException` provide a distinction between marshalling and unmarshalling operations, even though the underlying O/X mapping tool does not do so.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>The O/X Mapping exception hierarchy is shown in the following figure:</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-marshaller-and-unmarshaller"><a class="anchor" href="#using-marshaller-and-unmarshaller"></a>Using Marshaller and Unmarshaller</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> Spring's OXM can be used for a wide variety of situations.
In the following example, we will use it to marshal the settings of a Spring-managed application as an XML file.
We will use a simple JavaBean to represent the settings:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
public class Settings {
    private boolean fooEnabled;

    public boolean isFooEnabled() {
        return fooEnabled;
    }

    public void setFooEnabled(boolean fooEnabled) {
        this.fooEnabled = fooEnabled;
    }
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The application class uses this bean to store its settings.
Besides a main method, the class has two methods: [method]`saveSettings()` saves the settings bean to a file named [file]`settings.xml`, and [method]`loadSettings()` loads these settings again.
A [method]`main()` method constructs a Spring application context, and calls these two methods.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import javax.xml.transform.stream.StreamResult;
import javax.xml.transform.stream.StreamSource;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.oxm.Marshaller;
import org.springframework.oxm.Unmarshaller;

public class Application {
    private static final String FILE_NAME = "settings.xml";
    private Settings settings = new Settings();
    private Marshaller marshaller;
    private Unmarshaller unmarshaller;

    public void setMarshaller(Marshaller marshaller) {
        this.marshaller = marshaller;
    }

    public void setUnmarshaller(Unmarshaller unmarshaller) {
        this.unmarshaller = unmarshaller;
    }

    public void saveSettings() throws IOException {
        FileOutputStream os = null;
        try {
            os = new FileOutputStream(FILE_NAME);
            this.marshaller.marshal(settings, new StreamResult(os));
        } finally {
            if (os != null) {
                os.close();
            }
        }
    }

    public void loadSettings() throws IOException {
        FileInputStream is = null;
        try {
            is = new FileInputStream(FILE_NAME);
            this.settings = (Settings) this.unmarshaller.unmarshal(new StreamSource(is));
        } finally {
            if (is != null) {
                is.close();
            }
        }
    }

    public static void main(String[] args) throws IOException {
        ApplicationContext appContext =
            new ClassPathXmlApplicationContext("applicationContext.xml");
        Application application = (Application) appContext.getBean("application");
        application.saveSettings();
        application.loadSettings();
    }
}
---- The [class]`Application` requires both a  and  property to be set.
We can do so using the following [file]`applicationContext.xml`:
[source,xml]</code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;beans&gt;
    &lt;bean id="application" class="Application"&gt;
        &lt;property name="marshaller" ref="castorMarshaller" /&gt;
        &lt;property name="unmarshaller" ref="castorMarshaller" /&gt;
    &lt;/bean&gt;
    &lt;bean id="castorMarshaller" class="org.springframework.oxm.castor.CastorMarshaller"/&gt;
&lt;/beans&gt;
---- This application context uses Castor, but we could have used any of the other marshaller instances described later in this chapter.
Note that Castor does not require any further configuration by default, so the bean definition is rather simple.
Also note that the <code class="class">CastorMarshaller</code> implements both <code class="interface">Marshaller</code> and <code class="interface">Unmarshaller</code>, so we can refer to the  bean in both the  and  property of the application.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>This sample application produces the following [file]`settings.xml` file:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;settings foo-enabled="false"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xml-schema-based-configuration"><a class="anchor" href="#xml-schema-based-configuration"></a>XML Schema-based Configuration</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> Marshallers could be configured more concisely using tags from the OXM namespace.
To make these tags available, the appropriate schema has to be referenced first in the preamble of the XML configuration file.
Note the 'oxm' related text below:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:oxm="http://www.springframework.org/schema/oxm"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/oxm
    http://www.springframework.org/schema/oxm/spring-oxm.xsd"&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Currently, the following tags are available:</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#oxm-jaxb2-xsd"><code>jaxb2-marshaller</code></a></p>
</li>
<li>
<p><a href="#oxm-xmlbeans-xsd"><code>xmlbeans-marshaller</code></a></p>
</li>
<li>
<p><a href="#oxm-castor-xsd"><code>castor-marshaller</code></a></p>
</li>
<li>
<p><a href="#oxm-jibx-xsd"><code>jibx-marshaller</code></a></p>
<div class="literalblock">
<div class="content">
<pre> Each tag will be explained in its respective marshaller's section.
As an example though, here is how the configuration of a JAXB2 marshaller might look like:</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;oxm:jaxb2-marshaller id="marshaller" contextPath="org.springframework.ws.samples.airline.schema"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jaxb"><a class="anchor" href="#jaxb"></a>JAXB</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> The JAXB binding compiler translates a W3C XML Schema into one or more Java classes, a [file]`jaxb.properties` file, and possibly some resource files.
JAXB also offers a way to generate a schema from annotated Java classes.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Spring supports the JAXB 2.0 API as XML marshalling strategies, following the [interface]`Marshaller` and [interface]`Unmarshaller` interfaces described in &lt;&lt;oxm-marshaller-unmarshaller&gt;&gt;.
The corresponding integration classes reside in the  package.</pre>
</div>
</div>
<div class="sect2">
<h3 id="jaxb2marshaller"><a class="anchor" href="#jaxb2marshaller"></a>Jaxb2Marshaller</h3>
<div class="literalblock">
<div class="content">
<pre> The [class]`Jaxb2Marshaller` class implements both the Spring [interface]`Marshaller` and [interface]`Unmarshaller`interface.
It requires a context path to operate, which you can set using the  property.
The context path is a list of colon (:) separated Java package names that contain schema derived classes.
It also offers a  property, which allows you to set an array of classes to be supported by the marshaller.
Schema validation is performed by specifying one or more schema resource to the bean, like so:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;beans&gt;

    &lt;bean id="jaxb2Marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller"&gt;
        &lt;property name="classesToBeBound"&gt;
            &lt;list&gt;
                &lt;value&gt;org.springframework.oxm.jaxb.Flight&lt;/value&gt;
                &lt;value&gt;org.springframework.oxm.jaxb.Flights&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
        &lt;property name="schema" value="classpath:org/springframework/oxm/schema.xsd"/&gt;
    &lt;/bean&gt;
    ...

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="xml-schema-based-configuration-2"><a class="anchor" href="#xml-schema-based-configuration-2"></a>XML Schema-based Configuration</h4>
<div class="literalblock">
<div class="content">
<pre> The `jaxb2-marshaller` tag configures a [class]`org.springframework.oxm.jaxb.Jaxb2Marshaller`.
Here is an example:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;oxm:jaxb2-marshaller id="marshaller" contextPath="org.springframework.ws.samples.airline.schema"/&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Alternatively, the list of classes to bind can be provided to the marshaller via the `class-to-be-bound` child tag:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;oxm:jaxb2-marshaller id="marshaller"&gt;
    &lt;oxm:class-to-be-bound name="org.springframework.ws.samples.airline.schema.Airport"/&gt;
    &lt;oxm:class-to-be-bound name="org.springframework.ws.samples.airline.schema.Flight"/&gt;
    ...
&lt;/oxm:jaxb2-marshaller&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Available attributes are:</pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
</table>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="castor"><a class="anchor" href="#castor"></a>Castor</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> Castor XML mapping is an open source XML binding framework.
It allows you to transform the data contained in a java object model into/from an XML document.
By default, it does not require any further configuration, though a mapping file can be used to have more control over the behavior of Castor.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> For more information on Castor, refer to the &lt;&lt;,&gt;&gt;.
The Spring integration classes reside in the  package.</pre>
</div>
</div>
<div class="sect2">
<h3 id="castormarshaller"><a class="anchor" href="#castormarshaller"></a>CastorMarshaller</h3>
<div class="literalblock">
<div class="content">
<pre> As with JAXB, the [class]`CastorMarshaller` implements both the [interface]`Marshaller` and [interface]`Unmarshaller` interface.
It can be wired up as follows:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;beans&gt;

    &lt;bean id="castorMarshaller" class="org.springframework.oxm.castor.CastorMarshaller" /&gt;
    ...

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapping"><a class="anchor" href="#mapping"></a>Mapping</h3>
<div class="literalblock">
<div class="content">
<pre> Although it is possible to rely on Castor's default marshalling behavior, it might be necessary to have more control over it.
This can be accomplished using a Castor mapping file.
For more information, refer to &lt;&lt;,Castor XML Mapping&gt;&gt;.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>The mapping can be set using the  resource property, indicated below with a classpath resource.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;beans&gt;
    &lt;bean id="castorMarshaller" class="org.springframework.oxm.castor.CastorMarshaller" &gt;
        &lt;property name="mappingLocation" value="classpath:mapping.xml" /&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="xml-schema-based-configuration-3"><a class="anchor" href="#xml-schema-based-configuration-3"></a>XML Schema-based Configuration</h4>
<div class="literalblock">
<div class="content">
<pre> The `castor-marshaller` tag configures a [class]`org.springframework.oxm.castor.CastorMarshaller`.
Here is an example:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
                    &lt;oxm:castor-marshaller id="marshaller" mapping-location="classpath:org/springframework/oxm/castor/mapping.xml"/&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The marshaller instance can be configured in two ways, by specifying either the location of a mapping file (through the  property), or by identifying Java POJOs (through the  or  properties) for which there exist corresponding XML descriptor classes.
The latter way is usually used in conjunction with XML code generation from XML schemas.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Available attributes are:</pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">target-class</p></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xmlbeans"><a class="anchor" href="#xmlbeans"></a>XMLBeans</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> XMLBeans is an XML binding tool that has full XML Schema support, and offers full XML Infoset fidelity.
It takes a different approach to that of most other O/X mapping frameworks, in that all classes that are generated from an XML Schema are all derived from [interface]`XmlObject`, and contain XML binding information in them.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> For more information on XMLBeans, refer to the &lt;&lt;,&gt;&gt;.
The Spring-WS integration classes reside in the  package.</pre>
</div>
</div>
<div class="sect2">
<h3 id="xmlbeansmarshaller"><a class="anchor" href="#xmlbeansmarshaller"></a>XmlBeansMarshaller</h3>
<div class="literalblock">
<div class="content">
<pre> The [class]`XmlBeansMarshaller` implements both the [interface]`Marshaller` and [interface]`Unmarshaller` interfaces.
It can be configured as follows:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;beans&gt;

    &lt;bean id="xmlBeansMarshaller" class="org.springframework.oxm.xmlbeans.XmlBeansMarshaller" /&gt;
    ...

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Note that the <code class="class">XmlBeansMarshaller</code> can only marshal objects of type <code class="interface">XmlObject</code>, and not every <code class="class">java.lang.Object</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="xml-schema-based-configuration-4"><a class="anchor" href="#xml-schema-based-configuration-4"></a>XML Schema-based Configuration</h4>
<div class="literalblock">
<div class="content">
<pre> The `xmlbeans-marshaller` tag configures a [class]`org.springframework.oxm.xmlbeans.XmlBeansMarshaller`.
Here is an example:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;oxm:xmlbeans-marshaller id="marshaller"/&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Available attributes are:</pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the bean name of the XmlOptions that is to be used for this marshaller. Typically a
                                    XmlOptionsFactoryBean definition</p></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jibx"><a class="anchor" href="#jibx"></a>JiBX</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>The JiBX framework offers a solution similar to that which JDO provides for ORM: a binding definition defines the rules for how your Java objects are converted to or from XML. After preparing the binding and compiling the classes, a JiBX binding compiler enhances the class files, and adds code to handle converting instances of the classes from or to XML.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> For more information on JiBX, refer to the &lt;&lt;,&gt;&gt;.
The Spring integration classes reside in the  package.</pre>
</div>
</div>
<div class="sect2">
<h3 id="jibxmarshaller"><a class="anchor" href="#jibxmarshaller"></a>JibxMarshaller</h3>
<div class="literalblock">
<div class="content">
<pre> The [class]`JibxMarshaller` class implements both the [interface]`Marshaller` and [interface]`Unmarshaller` interface.
To operate, it requires the name of the class to marshal in, which you can set using the  property.
Optionally, you can set the binding name using the  property.
In the next sample, we bind the [class]`Flights` class:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;beans&gt;

    &lt;bean id="jibxFlightsMarshaller" class="org.springframework.oxm.jibx.JibxMarshaller"&gt;
        &lt;property name="targetClass"&gt;org.springframework.oxm.jibx.Flights&lt;/property&gt;
    &lt;/bean&gt;

    ...</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> A [class]`JibxMarshaller` is configured for a single class.
If you want to marshal multiple classes, you have to configure multiple [class]`JibxMarshaller`s with different  property values.</pre>
</div>
</div>
<div class="sect3">
<h4 id="xml-schema-based-configuration-5"><a class="anchor" href="#xml-schema-based-configuration-5"></a>XML Schema-based Configuration</h4>
<div class="literalblock">
<div class="content">
<pre> The `jibx-marshaller` tag configures a [class]`org.springframework.oxm.jibx.JibxMarshaller`.
Here is an example:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;oxm:jibx-marshaller id="marshaller" target-class="org.springframework.ws.samples.airline.schema.Flight"/&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Available attributes are:</pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">target-class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bindingName</p></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xstream"><a class="anchor" href="#xstream"></a>XStream</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> XStream is a simple library to serialize objects to XML and back again.
It does not require any mapping, and generates clean XML.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> For more information on XStream, refer to the &lt;&lt;,&gt;&gt;.
The Spring integration classes reside in the  package.</pre>
</div>
</div>
<div class="sect2">
<h3 id="xstreammarshaller"><a class="anchor" href="#xstreammarshaller"></a>XStreamMarshaller</h3>
<div class="literalblock">
<div class="content">
<pre> The [class]`XStreamMarshaller` does not require any configuration, and can be configured in an application context directly.
To further customize the XML, you can set an _alias map_, which consists of string aliases mapped to classes:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;beans&gt;

    &lt;bean id="xstreamMarshaller" class="org.springframework.oxm.xstream.XStreamMarshaller"&gt;
        &lt;property name="aliases"&gt;
            &lt;props&gt;
                &lt;prop key="Flight"&gt;org.springframework.oxm.xstream.Flight&lt;/prop&gt;
            &lt;/props&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
    ...

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="literalblock">
<div class="content">
<pre> By default, XStream allows for arbitrary classes to be unmarshalled, which can result in security vulnerabilities.
As such, it is _not recommended to use the [class]`XStreamMarshaller` to
                  unmarshal XML from external sources_ (i.e.
the Web), as this can result in _security vulnerabilities_.
If you do use the [class]`XStreamMarshaller` to unmarshal XML from an external source, set the  property on the [class]`XStreamMarshaller`, like so:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="xstreamMarshaller" class="org.springframework.oxm.xstream.XStreamMarshaller"&gt;
    &lt;property name="supportedClasses" value="org.springframework.oxm.xstream.Flight"/&gt;
    ...
&lt;/bean&gt;
---- This will make sure that only the registered classes are eligible for unmarshalling.


 Additionally, you can register &lt;&lt;,
                  custom converters&gt;&gt; to make sure that only your supported classes can be unmarshalled.
You might want to add a [class]`CatchAllConverter` as the last converter in the list, in addition to converters that explicitly support the domain classes that should be supported.
As a result, default XStream converters with lower priorities and possible security vulnerabilities do not get invoked.
</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Note that XStream is an XML serialization library, not a data binding library.
Therefore, it has limited namespace support.
As such, it is rather unsuitable for usage within Web services.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<h1 id="spring-web" class="sect0"><a class="anchor" href="#spring-web"></a>The Web</h1>
<div class="paragraph">
<p>This part of the reference documentation covers the Spring Framework&#8217;s support for the presentation tier (and specifically web-based presentation tiers).</p>
</div>
<div class="paragraph">
<p>The Spring Framework&#8217;s own web framework, <a href="#mvc">Spring Web MVC</a>, is covered in the first couple of chapters. A number of the remaining chapters in this part of the reference documentation are concerned with the Spring Framework&#8217;s integration with other web technologies, such as <a href="#struts">Struts</a> and <a href="#jsf">JSF</a> (to name but two).</p>
</div>
<div class="paragraph">
<p>This section concludes with coverage of Spring&#8217;s MVC <a href="#portlet">portlet framework</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mvc">[mvc]</a></p>
</li>
<li>
<p><a href="#view">[view]</a></p>
</li>
<li>
<p><a href="#web-integration">[web-integration]</a></p>
</li>
<li>
<p><a href="#portlet">[portlet]</a></p>
</li>
</ul>
</div>
<h1 id="web-mvc-framework" class="sect0"><a class="anchor" href="#web-mvc-framework"></a>Web MVC framework</h1>
<div class="sect1">
<h2 id="introduction-to-spring-web-mvc-framework"><a class="anchor" href="#introduction-to-spring-web-mvc-framework"></a>Introduction to Spring Web MVC framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Web model-view-controller (MVC) framework is designed around a <code class="class">DispatcherServlet</code> that dispatches requests to handlers, with configurable handler mappings, view resolution, locale and theme resolution as well as support for uploading files.
The default handler is based on the <code class="interface">@Controller</code> and <code class="interface">@RequestMapping</code> annotations, offering a wide range of flexible handling methods.
With the introduction of Spring 3.0, the <code class="interface">@Controller</code> mechanism also allows you to create RESTful Web sites and applications, through the <code class="interface">@PathVariable</code> annotation and other features.</p>
</div>
<div class="paragraph">
<p>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>A key design principle in Spring Web MVC and in Spring in general is the  principle.</p>
</div>
<div class="paragraph">
<p>Some methods in the core classes of Spring Web MVC are marked <code>final</code>.
As a developer you cannot override these methods to supply your own behavior.
This has not been done arbitrarily, but specifically with this principle in mind.</p>
</div>
<div class="paragraph">
<p>For an explanation of this principle, refer to <em>Expert
      Spring Web MVC and Web Flow</em> by Seth Ladd and others; specifically see the section "A Look At Design," on page 117 of the first edition.
Alternatively, see</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>&lt;&lt;,"Bob
Martin, The Open-Closed Principle (PDF)"&gt;&gt;</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You cannot add advice to final methods when you use Spring MVC. For example, you cannot add advice to the <code>AbstractController.setSynchronizeOnSession()</code> method.
Refer to <a href="#aop-understanding-aop-proxies">[aop-understanding-aop-proxies]</a> for more information on AOP proxies and why you cannot add advice to final methods.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In Spring Web MVC you can use any object as a command or form-backing object; you do not need to implement a framework-specific interface or base class.
Spring&#8217;s data binding is highly flexible: for example, it treats type mismatches as validation errors that can be evaluated by the application, not as system errors.
Thus you need not duplicate your business objects' properties as simple, untyped strings in your form objects simply to handle invalid submissions, or to convert the Strings properly.
Instead, it is often preferable to bind directly to your business objects.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s view resolution is extremely flexible.
A <code class="interface">Controller</code> is typically responsible for preparing a model <code class="class">Map</code> with data and selecting a view name but it can also write directly to the response stream and complete the request.
View name resolution is highly configurable through file extension or Accept header content type negotiation, through bean names, a properties file, or even a custom <code class="interface">ViewResolver</code> implementation.
The model (the M in MVC) is a <code class="interface">Map</code> interface, which allows for the complete abstraction of the view technology.
You can integrate directly with template based rendering technologies such as JSP, Velocity and Freemarker, or directly generate XML, JSON, Atom, and many other types of content.
The model <code class="interface">Map</code> is simply transformed into an appropriate format, such as JSP request attributes, a Velocity template model.</p>
</div>
<div class="sect2">
<h3 id="features-of-spring-web-mvc"><a class="anchor" href="#features-of-spring-web-mvc"></a>Features of Spring Web MVC</h3>
<div class="paragraph">
<p>Spring&#8217;s web module includes many unique web support features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Clear separation of roles</em>.
Each role&#8201;&#8212;&#8201;controller, validator, command object, form object, model object, <code class="class">DispatcherServlet</code>, handler mapping, view resolver, and so on&#8201;&#8212;&#8201;can be fulfilled by a specialized object.</p>
</li>
<li>
<p><em>Powerful and straightforward configuration of both
          framework and application classes as JavaBeans</em>.
This configuration capability includes easy referencing across contexts, such as from web controllers to business objects and validators.</p>
</li>
<li>
<p><em>Adaptability, non-intrusiveness, and
flexibility.</em> Define any controller method signature you need, possibly using one of the parameter annotations (such as @RequestParam, @RequestHeader, @PathVariable, and more) for a given scenario.</p>
</li>
<li>
<p><em>Reusable business code</em>,_ no need
          for duplication_.
Use existing business objects as command or form objects instead of mirroring them to extend a particular framework base class.</p>
</li>
<li>
<p><em>Customizable binding and validation</em>.
Type mismatches as application-level validation errors that keep the offending value, localized date and number binding, and so on instead of String-only form objects with manual parsing and conversion to business objects.</p>
</li>
<li>
<p><em>Customizable handler mapping and view
          resolution</em>.
Handler mapping and view resolution strategies range from simple URL-based configuration, to sophisticated, purpose-built resolution strategies.
Spring is more flexible than web MVC frameworks that mandate a particular technique.</p>
</li>
<li>
<p><em>Flexible model transfer</em>.
Model transfer with a name/value <code class="interface">Map</code> supports easy integration with any view technology.</p>
</li>
<li>
<p><em>Customizable locale and theme resolution, support
for JSPs with or without Spring tag library, support for JSTL,
support for Velocity without the need for extra bridges, and so
on.</em></p>
</li>
<li>
<p><em>A simple yet powerful JSP tag library known as the
          Spring tag library that provides support for features such as data
          binding and themes</em>.
The custom tags allow for maximum flexibility in terms of markup code.
For information on the tag library descriptor, see the appendix entitled <a href="#spring.tld">[spring.tld]</a></p>
</li>
<li>
<p><em>A JSP form tag library, introduced in Spring 2.0,
that makes writing forms in JSP pages much easier.</em> For information on the tag library descriptor, see the appendix entitled <a href="#spring-form.tld">[spring-form.tld]</a></p>
</li>
<li>
<p><em>Beans whose lifecycle is scoped to the current HTTP
          request or HTTP <code class="interface">Session</code>.</em> This is not a specific feature of Spring MVC itself, but rather of the <code class="interface">WebApplicationContext</code> container(s) that Spring MVC uses.
These bean scopes are described in <a href="#beans-factory-scopes-other">[beans-factory-scopes-other]</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="pluggability-of-other-mvc-implementations"><a class="anchor" href="#pluggability-of-other-mvc-implementations"></a>Pluggability of other MVC implementations</h3>
<div class="paragraph">
<p>Non-Spring MVC implementations are preferable for some projects.
Many teams expect to leverage their existing investment in skills and tools.
A large body of knowledge and experience exist for the Struts framework.
If you can abide Struts' architectural flaws, it can be a viable choice for the web layer; the same applies to WebWork and other web MVC frameworks.</p>
</div>
<div class="paragraph">
<p>If you do not want to use Spring&#8217;s web MVC, but intend to leverage other solutions that Spring offers, you can integrate the web MVC framework of your choice with Spring easily.
Simply start up a Spring root application context through its <code class="class">ContextLoaderListener</code>, and access it through its <code class="interface">ServletContext</code> attribute (or Spring&#8217;s respective helper method) from within a Struts or WebWork action.
No "plug-ins" are involved, so no dedicated integration is necessary.
From the web layer&#8217;s point of view, you simply use Spring as a library, with the root application context instance as the entry point.</p>
</div>
<div class="paragraph">
<p>Your registered beans and Spring&#8217;s services can be at your fingertips even without Spring&#8217;s Web MVC. Spring does not compete with Struts or WebWork in this scenario.
It simply addresses the many areas that the pure web MVC frameworks do not, from bean configuration to data access and transaction handling.
So you can enrich your application with a Spring middle tier and/or data access tier, even if you just want to use, for example, the transaction abstraction with JDBC or Hibernate.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-code-class-class-dispatcherservlet-code"><a class="anchor" href="#the-code-class-class-dispatcherservlet-code"></a>The <code class="class">DispatcherServlet</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring&#8217;s web MVC framework is, like many other web MVC frameworks, request-driven, designed around a central Servlet that dispatches requests to controllers and offers other functionality that facilitates the development of web applications.
Spring&#8217;s <code class="class">DispatcherServlet</code> however, does more than just that.
It is completely integrated with the Spring IoC container and as such allows you to use every other feature that Spring has.</p>
</div>
<div class="paragraph">
<p>The request processing workflow of the Spring Web MVC <code class="class">DispatcherServlet</code> is illustrated in the following diagram.
The pattern-savvy reader will recognize that the <code class="class">DispatcherServlet</code> is an expression of the  design pattern (this is a pattern that Spring Web MVC shares with many other leading web frameworks).</p>
</div>
<div class="paragraph">
<p>The <code class="class">DispatcherServlet</code> is an actual <code class="interface">Servlet</code> (it inherits from the <code class="class">HttpServlet</code> base class), and as such is declared in the <code>web.xml</code> of your web application.
You need to map requests that you want the <code class="class">DispatcherServlet</code> to handle, by using a URL mapping in the same <code>web.xml</code> file.
This is standard Java EE Servlet configuration; the following example shows such a <code class="class">DispatcherServlet</code> declaration and mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;web-app&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;example&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;example&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/example/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, all requests starting with <code>/example</code> will be handled by the <code class="class">DispatcherServlet</code> instance named <code>example</code>.
In a Servlet 3.0+ environment, you also have the option of configuring the Servlet container programmatically.
Below is the code based equivalent of the above <code class="file">web.xml</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyWebApplicationInitializer implements WebApplicationInitializer {

    @Override
    public void onStartup(ServletContext container) {
        ServletRegistration.Dynamic registration = container.addServlet("dispatcher", new DispatcherServlet());
        registration.setLoadOnStartup(1);
        registration.addMapping("/example/*");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="interface">WebApplicationInitializer</code> is an interface provided by Spring MVC that ensures your code-based configuration is detected and automatically used to initialize any Servlet 3 container.
An abstract base class implementation of this interace named <code class="class">AbstractDispatcherServletInitializer</code> makes it even easier to register the <code class="class">DispatcherServlet</code> by simply specifying its servlet mapping.
See <a href="#mvc-container-config">Code-based Servlet container initialization</a> for more details.</p>
</div>
<div class="paragraph">
<p>The above is only the first step in setting up Spring Web MVC. You now need to configure the various beans used by the Spring Web MVC framework (over and above the <code class="class">DispatcherServlet</code> itself).</p>
</div>
<div class="paragraph">
<p>As detailed in <a href="#context-introduction">[context-introduction]</a>, <code class="interface">ApplicationContext</code> instances in Spring can be scoped.
In the Web MVC framework, each <code class="class">DispatcherServlet</code> has its own <code class="interface">WebApplicationContext</code>, which inherits all the beans already defined in the root <code class="interface">WebApplicationContext</code>.
These inherited beans can be overridden in the servlet-specific scope, and you can define new scope-specific beans local to a given Servlet instance.</p>
</div>
<div class="paragraph">
<p>Upon initialization of a <code class="class">DispatcherServlet</code>, Spring MVC looks for a file named <em>`[servlet-name]-servlet.xml`</em> in the <code>WEB-INF</code> directory of your web application and creates the beans defined there, overriding the definitions of any beans defined with the same name in the global scope.</p>
</div>
<div class="paragraph">
<p>Consider the following <code class="class">DispatcherServlet</code> Servlet configuration (in the <code>web.xml</code> file):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;web-app&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;golfing&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;golfing&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/golfing/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above Servlet configuration in place, you will need to have a file called <code>/WEB-INF/`_golfing_</code>-servlet.xml` in your application; this file will contain all of your Spring Web MVC-specific components (beans).
You can change the exact location of this configuration file through a Servlet initialization parameter (see below for details).</p>
</div>
<div class="paragraph">
<p>The <code class="interface">WebApplicationContext</code> is an extension of the plain <code class="interface">ApplicationContext</code> that has some extra features necessary for web applications.
It differs from a normal <code class="interface">ApplicationContext</code> in that it is capable of resolving themes (see <a href="#mvc-themeresolver">[mvc-themeresolver]</a>), and that it knows which Servlet it is associated with (by having a link to the <code class="interface">ServletContext</code>).
The <code class="interface">WebApplicationContext</code> is bound in the <code class="interface">ServletContext</code>, and by using static methods on the <code class="class">RequestContextUtils</code> class you can always look up the <code class="interface">WebApplicationContext</code> if you need access to it.</p>
</div>
<div class="sect2">
<h3 id="special-bean-types-in-the-code-class-interface-webapplicationcontext-code"><a class="anchor" href="#special-bean-types-in-the-code-class-interface-webapplicationcontext-code"></a>Special Bean Types In the <code class="interface">WebApplicationContext</code></h3>
<div class="paragraph">
<p>The Spring <code class="class">DispatcherServlet</code> uses special beans to process requests and render the appropriate views.
These beans are part of Spring MVC. You can choose which special beans to use by simply configuring one or more of them in the <code class="interface">WebApplicationContext</code>.
However, you don&#8217;t need to do that initially since Spring MVC maintains a list of default beans to use if you don&#8217;t configure any.
More on that in the next section.
First see the table below listing the special bean types the <code class="class">DispatcherServlet</code> relies on.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 2. Special bean types in the <code class="interface">WebApplicationContext</code></caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bean type</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HandlerMapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maps incoming requests to handlers and a list of
                pre- and post-processors (handler interceptors) based on some
                criteria the details of which vary by HandlerMapping
                implementation. The most popular implementation supports
                annotated controllers but other implementations exists as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helps the DispatcherServlet to
                invoke a handler mapped to a request regardless of the handler
                is actually invoked. For example, invoking an annotated controller
                requires resolving various annotations. Thus the main purpose
                of a HandlerAdapter is to shield the
                DispatcherServlet from such details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HandlerExceptionResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ViewResolver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves logical String-based view names to actual
                View types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocaleResolver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ThemeResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MultipartResolver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FlashMapManager</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="default-dispatcherservlet-configuration"><a class="anchor" href="#default-dispatcherservlet-configuration"></a>Default DispatcherServlet Configuration</h3>
<div class="paragraph">
<p>As mentioned in the previous section for each special bean the <code class="class">DispatcherServlet</code> maintains a list of implementations to use by default.
This information is kept in the file <code class="file">DispatcherServlet.properties</code> in the package <code class="class">org.springframework.web.servlet</code>.</p>
</div>
<div class="paragraph">
<p>All special beans have  some reasonable defaults of their own.
Sooner or later though you&#8217;ll need to customize one or more of the properties these beans provide.
For example it&#8217;s quite common to configure an <code class="class">InternalResourceViewResolver</code> settings its <code>prefix</code> property to the parent location of view files.</p>
</div>
<div class="paragraph">
<p>Regardless of the details, the important concept to understand here is that once you	configure a special bean such as an <code class="class">InternalResourceViewResolver</code> in your <code class="class">WebApplicationContext</code>, you effectively override the list of default implementations that would have been used otherwise for that special bean type.
For example if you configure an <code class="class">InternalResourceViewResolver</code>, the default list of <code class="interface">ViewResolver</code> implementations is ignored.</p>
</div>
<div class="paragraph">
<p>In <a href="#mvc-config">[mvc-config]</a> you&#8217;ll learn about other options for configuring Spring MVC including MVC Java config and the MVC XML namespace both of which provide a simple starting point and assume little knowledge of how Spring MVC works.
Regardless of how you choose to configure your application, the concepts explained in this section are fundamental should be of help to you.</p>
</div>
</div>
<div class="sect2">
<h3 id="dispatcherservlet-processing-sequence"><a class="anchor" href="#dispatcherservlet-processing-sequence"></a>DispatcherServlet Processing Sequence</h3>
<div class="paragraph">
<p>After you set up a <code class="class">DispatcherServlet</code>, and a request comes in for that specific <code class="class">DispatcherServlet</code>, the <code class="class">DispatcherServlet</code> starts processing the request as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code class="interface">WebApplicationContext</code> is searched for and bound in the request as an attribute that the controller and other elements in the process can use.
It is bound by default under the key <code>DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE</code>.</p>
</li>
<li>
<p>The locale resolver is bound to the request to enable elements in the process to resolve the locale to use when processing the request (rendering the view, preparing data, and so on).
If you do not need locale resolving, you do not need it.</p>
</li>
<li>
<p>The theme resolver is bound to the request to let elements such as views determine which theme to use.
If you do not use themes, you can ignore it.</p>
</li>
<li>
<p>If you specify a multipart file resolver, the request is inspected for multiparts; if multiparts are found, the request is wrapped in a <code class="class">MultipartHttpServletRequest</code> for further processing by other elements in the process.
See <a href="#mvc-multipart">[mvc-multipart]</a> for further information about multipart handling.</p>
</li>
<li>
<p>An appropriate handler is searched for.
If a handler is found, the execution chain associated with the handler (preprocessors, postprocessors, and controllers) is executed in order to prepare a model or rendering.</p>
</li>
<li>
<p>If a model is returned, the view is rendered.
If no model is returned, (may be due to a preprocessor or postprocessor intercepting the request, perhaps for security reasons), no view is rendered, because the request could already have been fulfilled.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Handler exception resolvers that are declared in the <code class="interface">WebApplicationContext</code> pick up exceptions that are thrown during processing of the request.
Using these exception resolvers allows you to define custom behaviors to address exceptions.</p>
</div>
<div class="paragraph">
<p>The Spring <code class="class">DispatcherServlet</code> also supports the return of the <em>last-modification-date</em>, as specified by the Servlet API. The process of determining the last modification date for a specific request is straightforward: the <code class="class">DispatcherServlet</code> looks up an appropriate handler mapping and tests whether the handler that is found implements the _[interface]<code>LastModified`_ interface.
If so, the value of the `long
        getLastModified(request)</code> method of the <code class="interface">LastModified</code> interface is returned to the client.</p>
</div>
<div class="paragraph">
<p>You can customize individual <code class="class">DispatcherServlet</code> instances by adding Servlet initialization parameters (<code>init-param</code> elements) to the Servlet declaration in the <code>web.xml</code> file.
See the following table for the list of supported parameters.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 3. <code class="class">DispatcherServlet</code> initialization parameters</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contextClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that implements
                WebApplicationContext, which
                instantiates the context used by this Servlet. By default, the
                XmlWebApplicationContext is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contextConfigLocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String that is passed to the context instance (specified by
                contextClass) to indicate where context(s) can
                be found. The string consists potentially of multiple strings
                (using a comma as a delimiter) to support multiple contexts. In
                case of multiple context locations with beans that are defined
                twice, the latest location takes precedence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace of the
                WebApplicationContext. Defaults to
                [servlet-name]-servlet.</p></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-controllers"><a class="anchor" href="#implementing-controllers"></a>Implementing Controllers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controllers provide access to the application behavior that you typically define through a service interface.
Controllers interpret user input and transform it into a model that is represented to the user by the view.
Spring implements a controller in a very abstract way, which enables you to create a wide variety of controllers.</p>
</div>
<div class="paragraph">
<p>Spring 2.5 introduced an annotation-based programming model for MVC controllers that uses annotations such as <code class="interface">@RequestMapping</code>, <code class="interface">@RequestParam</code>, <code class="interface">@ModelAttribute</code>, and so on.
This annotation support is available for both Servlet MVC and Portlet MVC. Controllers implemented in this style do not have to extend specific base classes or implement specific interfaces.
Furthermore, they do not usually have direct dependencies on Servlet or Portlet APIs, although you can easily configure access to Servlet or Portlet facilities.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Available in the <a href="#new-in-3.0-samples">samples
      repository</a>, a number of web applications leverage the annotation support described in this section including <em>MvcShowcase</em>, <em>MvcAjax</em>, <em>MvcBasic</em>, <em>PetClinic</em>, <em>PetCare</em>, and others.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
public class HelloWorldController {

    @RequestMapping("/helloWorld")
    public String helloWorld(Model model) {
        model.addAttribute("message", "Hello World!");
        return "helloWorld";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code class="interface">@Controller</code> and <code class="interface">@RequestMapping</code> annotations allow flexible method names and signatures.
In this particular example the method accepts a <code class="class">Model</code> and returns a view name as a <code class="class">String</code>, but various other method parameters and return values can be used as explained later in this section.
<code class="interface">@Controller</code> and <code class="interface">@RequestMapping</code> and a number of other annotations form the basis for the Spring MVC implementation.
This section documents these annotations and how they are most commonly used in a Servlet environment.</p>
</div>
<div class="sect2">
<h3 id="defining-a-controller-with-code-class-interface-controller-code"><a class="anchor" href="#defining-a-controller-with-code-class-interface-controller-code"></a>Defining a controller with <code class="interface">@Controller</code></h3>
<div class="paragraph">
<p>The <code class="interface">@Controller</code> annotation indicates that a particular class serves the role of a <em>controller</em>.
Spring does not require you to extend any controller base class or reference the Servlet API. However, you can still reference Servlet-specific features if you need to.</p>
</div>
<div class="paragraph">
<p>The <code class="interface">@Controller</code> annotation acts as a stereotype for the annotated class, indicating its role.
The dispatcher scans such annotated classes for mapped methods and detects <code class="interface">@RequestMapping</code> annotations (see the next section).</p>
</div>
<div class="paragraph">
<p>You can define annotated controller beans explicitly, using a standard Spring bean definition in the dispatcher&#8217;s context.
However, the <code class="interface">@Controller</code> stereotype also allows for autodetection, aligned with Spring general support for detecting component classes in the classpath and auto-registering bean definitions for them.</p>
</div>
<div class="paragraph">
<p>To enable autodetection of such annotated controllers, you add component scanning to your configuration.
Use the <em>spring-context</em> schema as shown in the following XML snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"&gt;

    &lt;context:component-scan base-package="org.springframework.samples.petclinic.web"/&gt;

    &lt;!-- ... --&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapping-requests-with-code-class-interface-requestmapping-code"><a class="anchor" href="#mapping-requests-with-code-class-interface-requestmapping-code"></a>Mapping Requests With <code class="interface">@RequestMapping</code></h3>
<div class="paragraph">
<p>You use the <code class="interface">@RequestMapping</code> annotation to map URLs such as <code class="file">/appointments</code> onto an entire class or a particular handler method.
Typically the class-level annotation maps a specific request path (or path pattern) onto a form controller, with additional method-level annotations narrowing the primary mapping for a specific HTTP method request method ("GET", "POST", etc.) or an HTTP request parameter condition.</p>
</div>
<div class="paragraph">
<p>The following example from the <em>Petcare</em> sample shows a controller in a Spring MVC application that uses this annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("/appointments")
public class AppointmentsController {

    private final AppointmentBook appointmentBook;

    @Autowired
    public AppointmentsController(AppointmentBook appointmentBook) {
        this.appointmentBook = appointmentBook;
    }

    @RequestMapping(method = RequestMethod.GET)
    public Map&lt;String, Appointment&gt; get() {
        return appointmentBook.getAppointmentsForToday();
    }

    @RequestMapping(value="/{day}", method = RequestMethod.GET)
    public Map&lt;String, Appointment&gt; getForDay(@PathVariable @DateTimeFormat(iso=ISO.DATE) Date day, Model model) {
        return appointmentBook.getAppointmentsForDay(day);
    }

    @RequestMapping(value="/new", method = RequestMethod.GET)
    public AppointmentForm getNewForm() {
        return new AppointmentForm();
    }

    @RequestMapping(method = RequestMethod.POST)
    public String add(@Valid AppointmentForm appointment, BindingResult result) {
        if (result.hasErrors()) {
            return "appointments/new";
        }
        appointmentBook.addAppointment(appointment);
        return "redirect:/appointments";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, the <code class="interface">@RequestMapping</code> is used in a number of places.
The first usage is on the type (class) level, which indicates that all handling methods on this controller are relative to the <code class="file">/appointments</code> path.
The <code class="method">get()</code> method has a further <code class="interface">@RequestMapping</code> refinement: it only accepts GET requests, meaning that an HTTP GET for <code class="file">/appointments</code> invokes this method.
The <code class="method">post()</code> has a similar refinement, and the <code class="method">getNewForm()</code> combines the definition of HTTP method and path into one, so that GET requests for <code class="file">appointments/new</code> are handled by that method.</p>
</div>
<div class="paragraph">
<p>The <code class="method">getForDay()</code> method shows another usage of <code class="interface">@RequestMapping</code>: URI templates.
(See <a href="#mvc-ann-requestmapping-uri-templates">the next
      section</a>).</p>
</div>
<div class="paragraph">
<p>A <code class="interface">@RequestMapping</code> on the class level is not required.
Without it, all paths are simply absolute, and not relative.
The following example from the <em>PetClinic</em> sample application shows a multi-action controller using <code class="class">@RequestMapping</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
public class ClinicController {

    private final Clinic clinic;

    @Autowired
    public ClinicController(Clinic clinic) {
        this.clinic = clinic;
    }

    @RequestMapping("/")
    public void welcomeHandler() {
    }

    @RequestMapping("/vets")
    public ModelMap vetsHandler() {
        return new ModelMap(this.clinic.getVets());
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using <code class="interface">@RequestMapping</code> On Interface Methods</div>
<div class="paragraph">
<p>A common pitfall when working with annotated controller classes happens when applying functionality that requires creating a proxy for the controller object (e.g.
<code class="interface">@Transactional</code> methods).
Usually you will introduce an interface for the controller in order to use JDK dynamic proxies.
To make this work you must move the <code class="interface">@RequestMapping</code> annotations, as well as any other type and method-level annotations (e.g.
<code class="interface">@ModelAttribute</code>, <code class="interface">@InitBinder</code>) to the interface as well as the mapping mechanism can only "see" the interface exposed by the proxy.
Alternatively, you could activate <code>proxy-target-class="true"</code> in the configuration for the functionality applied to the controller (in our transaction scenario in <code>&lt;tx:annotation-driven /&gt;</code>).
Doing so indicates that CGLIB-based subclass proxies should be used instead of interface-based JDK proxies.
For more information on various proxying mechanisms see <a href="#aop-proxying">[aop-proxying]</a>.</p>
</div>
<div class="paragraph">
<p>Note however that method argument annotations, e.g.
<code class="interface">@RequestParam</code>, must be present in the method signatures of the controller class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="new-support-classes-for-code-class-class-requestmapping-code-methods-in-spring-mvc-3-1"><a class="anchor" href="#new-support-classes-for-code-class-class-requestmapping-code-methods-in-spring-mvc-3-1"></a>New Support Classes for <code class="class">@RequestMapping</code> methods in Spring MVC 3.1</h4>
<div class="paragraph">
<p>Spring 3.1 introduced a new set of support classes for <code class="class">@RequestMapping</code> methods called <code class="class">RequestMappingHandlerMapping</code> and <code class="class">RequestMappingHandlerAdapter</code> respectively.
They are recommended for use and even required to take advantage of new features in Spring MVC 3.1 and going forward.
The new support classes are enabled by default by the MVC namespace and the MVC Java config but must be configured explicitly if using neither.
This section describes a few important differences between the old and the new support classes.</p>
</div>
<div class="paragraph">
<p>Prior to Spring 3.1, type and method-level request mappings were examined in two separate stages&#8201;&#8212;&#8201;a controller was selected first by the <code class="class">DefaultAnnotationHandlerMapping</code> and the actual method to invoke was narrowed down second by the <code class="class">AnnotationMethodHandlerAdapter</code>.</p>
</div>
<div class="paragraph">
<p>With the new support classes in Spring 3.1, the <code class="class">RequestMappingHandlerMapping</code> is the only place where a decision is made about which method should process the request.
Think of controller methods as a collection of unique endpoints with mappings for each method derived from type and method-level <code class="class">@RequestMapping</code> information.</p>
</div>
<div class="paragraph">
<p>This enables some new possibilities.
For once a <code class="class">HandlerInterceptor</code> or a <code class="class">HandlerExceptionResolver</code> can now expect the Object-based handler to be a <code class="class">HandlerMethod</code>, which allows them to examine the exact method, its parameters and associated annotations.
The processing for a URL no longer needs to be split across different controllers.</p>
</div>
<div class="paragraph">
<p>There are also several things no longer possible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select a controller first with a <code class="class">SimpleUrlHandlerMapping</code> or <code class="class">BeanNameUrlHandlerMapping</code> and then narrow the method based on <code class="class">@RequestMapping</code> annotations.</p>
</li>
<li>
<p>Rely on method names as a fall-back mechanism to disambiguate between two <code class="class">@RequestMapping</code> methods that don&#8217;t have an explicit path mapping URL path but otherwise match equally, e.g.
by HTTP method.
In the new support classes <code class="class">@RequestMapping</code> methods have to be mapped uniquely.</p>
</li>
<li>
<p>Have a single default method (without an explicit path mapping) with which requests are processed if no other controller method matches more concretely.
In the new support classes if a matching method is not found a 404 error is raised.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above features are still supported with the existing support classes.
However to take advantage of new Spring MVC 3.1 features you&#8217;ll need to use the new support classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="uri-template-patterns"><a class="anchor" href="#uri-template-patterns"></a>URI Template Patterns</h4>
<div class="paragraph">
<p><em>URI templates</em> can be used for convenient access to selected parts of a URL in a <code class="interface">@RequestMapping</code> method.</p>
</div>
<div class="paragraph">
<p>A URI Template is a URI-like string, containing one or more variable names.
When you substitute values for these variables, the template becomes a URI. The &lt;&lt;,proposed
        RFC&gt;&gt; for URI Templates defines how a URI is parameterized.
For example, the URI Template <code>http://www.example.com/users/{userId}</code> contains the variable <em>userId</em>.
Assigning the value <em>fred</em> to the variable yields <code>http://www.example.com/users/fred</code>.</p>
</div>
<div class="paragraph">
<p>In Spring MVC you can use the <code class="interface">@PathVariable</code> annotation on a method argument to bind it to the value of a URI template variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(value="/owners/{ownerId}", method=RequestMethod.GET)
public String findOwner(@PathVariable String ownerId, Model model) {
  Owner owner = ownerService.findOwner(ownerId);
  model.addAttribute("owner", owner);
  return "displayOwner";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The URI Template "<code>/owners/{ownerId}</code>" specifies the variable name <code>ownerId</code>.
When the controller handles this request, the value of <code>ownerId</code> is set to the value found in the appropriate part of the URI. For example, when a request comes in for <code>/owners/fred</code>, the value of <code>ownerId</code> is <code>fred</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To process the @PathVariable annotation, Spring MVC needs to find the matching URI template variable by name.
You can specify it in the annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(value="/owners/{ownerId}", method=RequestMethod.GET)
public String findOwner(@PathVariable("ownerId") String theOwner, Model model) {
  // implementation omitted
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or if the URI template variable name matches the method argument name you can omit that detail.
As long as your code is not compiled without debugging information, Spring MVC will match the method argument name to the URI template variable name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(value="/owners/{ownerId}", method=RequestMethod.GET)
public String findOwner(@PathVariable String ownerId, Model model) {
  // implementation omitted
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A method can have any number of <code class="interface">@PathVariable</code> annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(value="/owners/{ownerId}/pets/{petId}", method=RequestMethod.GET)
public String findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {
  Owner owner = ownerService.findOwner(ownerId);
  Pet pet = owner.getPet(petId);
  model.addAttribute("pet", pet);
  return "displayPet";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a <code class="interface">@PathVariable</code> annotation is used on a <code class="class">Map&lt;String, String&gt;</code> argument, the map is populated with all URI template variables.</p>
</div>
<div class="paragraph">
<p>A URI template can be assembled from type and path level <em>@RequestMapping</em> annotations.
As a result the <code class="method">findPet()</code> method can be invoked with a URL such as <code class="file">/owners/42/pets/21</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("/owners/{ownerId}")
public class RelativePathUriTemplateController {

  @RequestMapping("/pets/{petId}")
  public void findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {
    // implementation omitted
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code class="interface">@PathVariable</code> argument can be of <em>any simple type</em> such as int, long, Date, etc.
Spring automatically converts to the appropriate type or throws a <code class="class">TypeMismatchException</code> if it fails to do so.
You can also register support for parsing additional data types.
See <a href="#mvc-ann-typeconversion">[mvc-ann-typeconversion]</a> and <a href="#mvc-ann-webdatabinder">[mvc-ann-webdatabinder]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="uri-template-patterns-with-regular-expressions"><a class="anchor" href="#uri-template-patterns-with-regular-expressions"></a>URI Template Patterns with Regular Expressions</h4>
<div class="paragraph">
<p>Sometimes you need more precision in defining URI template variables.
Consider the URL <code>"/spring-web/spring-web-3.0.5.jar"</code>.
How do you break it down into multiple parts?</p>
</div>
<div class="paragraph">
<p>The <code class="interface">@RequestMapping</code> annotation supports the use of regular expressions in URI template variables.
The syntax is <code>{varName:regex}</code> where the first part defines the variable name and the second - the regular expression.For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@RequestMapping("/spring-web/{symbolicName:[a-z-]+}-{version:\\d\\.\\d\\.\\d}{extension:\\.[a-z]+}")
  public void handle(@PathVariable String version, @PathVariable String extension) {
    // ...
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="path-patterns"><a class="anchor" href="#path-patterns"></a>Path Patterns</h4>
<div class="paragraph">
<p>In addition to URI templates, the <code class="interface">@RequestMapping</code> annotation also supports Ant-style path patterns (for example, <code class="file">/myPath/*.do</code>).
A combination of URI templates and Ant-style globs is also supported (for example, <code class="file">/owners/*/pets/{petId}</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="patterns-with-placeholders"><a class="anchor" href="#patterns-with-placeholders"></a>Patterns with Placeholders</h4>
<div class="paragraph">
<p>Patterns in <code class="interface">@RequestMapping</code> annotations support ${&#8230;} placeholders against local properties and/or system properties and environment variables.
This may be useful in cases where the path a controller is mapped to may need to be customized through configuration.
For more information on placeholders see the Javadoc for <code class="class">PropertyPlaceholderConfigurer</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="matrix-variables"><a class="anchor" href="#matrix-variables"></a>Matrix Variables</h4>
<div class="paragraph">
<p>The URI specification &lt;&lt;,RFC 3986&gt;&gt; defines the possibility of including name-value pairs within path segments.
There is no specific term used in the spec.
The general "URI path parameters" could be applied although the more unique &lt;&lt;,"Matrix URIs"&gt;&gt;, originating from an old post by Tim Berners-Lee, is also frequently used and fairly well known.
Within Spring MVC these are referred to as matrix variables.</p>
</div>
<div class="paragraph">
<p>Matrix variables can appear in any path segment, each matrix variable separated with a ";" (semicolon).
For example: <code>"/cars;color=red;year=2012"</code>.
Multiple values may be either "," (comma) separated <code>"color=red,green,blue"</code> or the variable name may be repeated <code>"color=red;color=green;color=blue"</code>.</p>
</div>
<div class="paragraph">
<p>If a URL is expected to contain matrix variables, the request mapping pattern must represent them with a URI template.
This ensures the request can be matched correctly regardless of whether matrix variables are present or not and in what order they are provided.</p>
</div>
<div class="paragraph">
<p>Below is an example of extracting the matrix variable "q":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// GET /pets/42;q=11;r=22

@RequestMapping(value = "/pets/{petId}", method = RequestMethod.GET)
public void findPet(@PathVariable String petId, @MatrixVariable int q) {

  // petId == 42
  // q == 11

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since all path segments may contain matrix variables, in some cases you need to be more specific to identify where the variable is expected to be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// GET /owners/42;q=11/pets/21;q=22

@RequestMapping(value = "/owners/{ownerId}/pets/{petId}", method = RequestMethod.GET)
public void findPet(
    @MatrixVariable(value="q", pathVar="ownerId") int q1,
    @MatrixVariable(value="q", pathVar="petId") int q2) {

  // q1 == 11
  // q2 == 22

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A matrix variable may be defined as optional and a default value specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// GET /pets/42

@RequestMapping(value = "/pets/{petId}", method = RequestMethod.GET)
  public void findPet(@MatrixVariable(required=true, defaultValue="1") int q) {

    // q == 1

  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>All matrix variables may be obtained in a Map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// GET /owners/42;q=11;r=12/pets/21;q=22;s=23

@RequestMapping(value = "/owners/{ownerId}/pets/{petId}", method = RequestMethod.GET)
  public void findPet(
        @MatrixVariable Map&lt;String, String&gt; matrixVars,
        @MatrixVariable(pathVar="petId"") Map&lt;String, String&gt; petMatrixVars) {

    // matrixVars: ["q" : [11,22], "r" : 12, "s" : 23]
    // petMatrixVars: ["q" : 11, "s" : 23]

  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that to enable the use of matrix variables, you must set the <code class="class">removeSemicolonContent</code> property of <code class="class">RequestMappingHandlerMapping</code> to <code>false</code>.
By default it is set to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="consumable-media-types"><a class="anchor" href="#consumable-media-types"></a>Consumable Media Types</h4>
<div class="paragraph">
<p>You can narrow the primary mapping by specifying a list of consumable media types.
The request will be matched only if the <em>Content-Type</em> request header matches the specified media type.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping(value = "/pets", method = RequestMethod.POST, consumes="application/json")
public void addPet(@RequestBody Pet pet, Model model) {
    // implementation omitted
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consumable media type expressions can also be negated as in <em>!text/plain</em> to match to all requests other than those with <em>Content-Type</em> of <em>text/plain</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
The <em>consumes</em> condition is supported on the type and on the method level.
Unlike most other conditions, when used at the type level, method-level consumable types override rather than extend type-level consumable types.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="producible-media-types"><a class="anchor" href="#producible-media-types"></a>Producible Media Types</h4>
<div class="paragraph">
<p>You can narrow the primary mapping by specifying a list of producible media types.
The request will be matched only if the <em>Accept</em> request header matches one of these values.
Furthermore, use of the <em>produces</em> condition ensures the actual content type used to generate the response respects the media types specified in the <em>produces</em> condition.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping(value = "/pets/{petId}", method = RequestMethod.GET, produces="application/json")
@ResponseBody
public Pet getPet(@PathVariable String petId, Model model) {
    // implementation omitted
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like with <em>consumes</em>, producible media type expressions can be negated as in <em>!text/plain</em> to match to all requests other than those with an <em>Accept</em> header value of <em>text/plain</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
The <em>produces</em> condition is supported on the type and on the method level.
Unlike most other conditions, when used at the type level, method-level producible types override rather than extend type-level producible types.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="request-parameters-and-header-values"><a class="anchor" href="#request-parameters-and-header-values"></a>Request Parameters and Header Values</h4>
<div class="paragraph">
<p>You can narrow request matching through request parameter conditions such as <code>"myParam"</code>, <code>"!myParam"</code>, or <code>"myParam=myValue"</code>.
The first two test for request parameter presence/absence and the third for a specific parameter value.
Here is an example with a request parameter value condition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("/owners/{ownerId}")
public class RelativePathUriTemplateController {

  @RequestMapping(value = "/pets/{petId}", method = RequestMethod.GET, params="myParam=myValue")
  public void findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {
    // implementation omitted
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same can be done to test for request header presence/absence or to match based on a specific request header value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("/owners/{ownerId}")
public class RelativePathUriTemplateController {

@RequestMapping(value = "/pets", method = RequestMethod.GET, headers="myHeader=myValue")
  public void findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {
    // implementation omitted
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Although you can match to <em>Content-Type</em> and <em>Accept</em> header values using media type wild cards (for example <em>"content-type=text/*"</em> will match to <em>"text/plain"</em> and <em>"text/html"</em>), it is recommended to use the <em>consumes</em> and <em>produces</em> conditions respectively instead.
They are intended specifically for that purpose.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="defining-code-class-interface-requestmapping-code-handler-methods"><a class="anchor" href="#defining-code-class-interface-requestmapping-code-handler-methods"></a>Defining <code class="interface">@RequestMapping</code> handler methods</h3>
<div class="paragraph">
<p>An <code class="class">@RequestMapping</code> handler method can have a very flexible signatures.
The supported method arguments and return values are described in the following section.
Most arguments can be used in arbitrary order with the only exception of <code class="class">BindingResult</code> arguments.
This is described in the next section.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Spring 3.1 introduced a new set of support classes for <code class="class">@RequestMapping</code> methods called <code class="class">RequestMappingHandlerMapping</code> and <code class="class">RequestMappingHandlerAdapter</code> respectively.
They are recommended for use and even required to take advantage of new features in Spring MVC 3.1 and going forward.
The new support classes are enabled by default from the MVC namespace and with use of the MVC Java config but must be configured explicitly if using neither.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="supported-method-argument-types"><a class="anchor" href="#supported-method-argument-types"></a>Supported method argument types</h4>
<div class="paragraph">
<p>The following are the supported method arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Request or response objects (Servlet API).
Choose any specific request or response type, for example <code class="interface">ServletRequest</code> or <code class="interface">HttpServletRequest</code>.</p>
</li>
<li>
<p>Session object (Servlet API): of type <code class="interface">HttpSession</code>.
An argument of this type enforces the presence of a corresponding session.
As a consequence, such an argument is never <code>null</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Session access may not be thread-safe, in particular in a Servlet environment.
Consider setting the <code class="class">RequestMappingHandlerAdapter</code>'s "synchronizeOnSession" flag to "true" if multiple requests are allowed to access a session concurrently.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code class="class">org.springframework.web.context.request.WebRequest</code> or <code class="class">org.springframework.web.context.request.NativeWebRequest</code>.
Allows for generic request parameter access as well as request/session attribute access, without ties to the native Servlet/Portlet API.</p>
</li>
<li>
<p><code class="class">java.util.Locale</code> for the current request locale, determined by the most specific locale resolver available, in effect, the configured <code class="interface">LocaleResolver</code> in a Servlet environment.</p>
</li>
<li>
<p><code class="class">java.io.InputStream</code> / <code class="class">java.io.Reader</code> for access to the request&#8217;s content.
This value is the raw InputStream/Reader as exposed by the Servlet API.</p>
</li>
<li>
<p><code class="class">java.io.OutputStream</code> / <code class="class">java.io.Writer</code> for generating the response&#8217;s content.
This value is the raw OutputStream/Writer as exposed by the Servlet API.</p>
</li>
<li>
<p><code class="interface">java.security.Principal</code> containing the currently authenticated user.</p>
</li>
<li>
<p><code class="class">@PathVariable</code> annotated parameters for access to URI template variables.
See <a href="#mvc-ann-requestmapping-uri-templates">[mvc-ann-requestmapping-uri-templates]</a>.</p>
</li>
<li>
<p><code class="class">@MatrixVariable</code> annotated parameters for access to name-value pairs located in URI path segments.
See <a href="#mvc-ann-matrix-variables">[mvc-ann-matrix-variables]</a>.</p>
</li>
<li>
<p><code class="class">@RequestParam</code> annotated parameters for access to specific Servlet request parameters.
Parameter values are converted to the declared method argument type.
See <a href="#mvc-ann-requestparam">[mvc-ann-requestparam]</a>.</p>
</li>
<li>
<p><code class="interface">@RequestHeader</code> annotated parameters for access to specific Servlet request HTTP headers.
Parameter values are converted to the declared method argument type.</p>
</li>
<li>
<p><code class="interface">@RequestBody</code> annotated parameters for access to the HTTP request body.
Parameter values are converted to the declared method argument type using [interface]`HttpMessageConverter`s.
See <a href="#mvc-ann-requestbody">[mvc-ann-requestbody]</a>.</p>
</li>
<li>
<p><code class="interface">@RequestPart</code> annotated parameters for access to the content of a "multipart/form-data" request part.
See <a href="#mvc-multipart-forms-non-browsers">[mvc-multipart-forms-non-browsers]</a> and <a href="#mvc-multipart">[mvc-multipart]</a>.</p>
</li>
<li>
<p><code class="class">HttpEntity&lt;?&gt;</code> parameters for access to the Servlet request HTTP headers and contents.
The request stream will be converted to the entity body using [interface]`HttpMessageConverter`s.
See <a href="#mvc-ann-httpentity">[mvc-ann-httpentity]</a>.</p>
</li>
<li>
<p><code class="interface">java.util.Map</code> / <code class="interface">org.springframework.ui.Model</code> / <code class="class">org.springframework.ui.ModelMap</code> for enriching the implicit model that is exposed to the web view.</p>
</li>
<li>
<p><code class="interface">org.springframework.web.servlet.mvc.support.RedirectAttributes</code> to specify the exact set of attributes to use in case of a redirect and also to add flash attributes (attributes stored temporarily on the server-side to make them available to the request after the redirect).
<code>RedirectAttributes</code> is used instead of the implicit model if the method returns a "redirect:" prefixed view name or <code class="class">RedirectView</code>.</p>
</li>
<li>
<p>Command or form objects to bind request parameters to bean properties (via setters) or directly to fields, with customizable type conversion, depending on <code class="class">@InitBinder</code> methods and/or the HandlerAdapter configuration.
See the <code>webBindingInitializer</code> property on <code class="class">RequestMappingHandlerAdapter</code>.
Such command objects along with their validation results will be exposed as model attributes by default, using the command class class name - e.g.
model attribute "orderAddress" for a command object of type "some.package.OrderAddress".
The <code class="class">ModelAttribute</code> annotation can be used on a method argument to customize the model attribute name used.</p>
</li>
<li>
<p><code class="class">org.springframework.validation.Errors</code> / <code class="class">org.springframework.validation.BindingResult</code> validation results for a preceding command or form object (the immediately preceding method argument).</p>
</li>
<li>
<p><code class="class">org.springframework.web.bind.support.SessionStatus</code> status handle for marking form processing as complete, which triggers the cleanup of session attributes that have been indicated by the <code class="class">@SessionAttributes</code> annotation at the handler type level.</p>
</li>
<li>
<p><code class="class">org.springframework.web.util.UriComponentsBuilder</code> a builder for preparing a URL relative to the current request&#8217;s host, port, scheme, context path, and the literal part of the servlet mapping.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code class="interface">Errors</code> or <code class="interface">BindingResult</code> parameters have to follow the model object that is being bound immediately as the method signature might have more that one model object and Spring will create a separate <code class="interface">BindingResult</code> instance for each of them so the following sample won&#8217;t work:</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. Invalid ordering of BindingResult and @ModelAttribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(method = RequestMethod.POST)
public String processSubmit(@ModelAttribute("pet") Pet pet,
    Model model, BindingResult result) {  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note, that there is a <code class="interface">Model</code> parameter in between <code class="class">Pet</code> and <code class="interface">BindingResult</code>.
To get this working you have to reorder the parameters as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(method = RequestMethod.POST)
public String processSubmit(@ModelAttribute("pet") Pet pet,
    BindingResult result, Model model) {  }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="supported-method-return-types"><a class="anchor" href="#supported-method-return-types"></a>Supported method return types</h4>
<div class="paragraph">
<p>The following are the supported return types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code class="class">ModelAndView</code> object, with the model implicitly enriched with command objects and the results of <code>@ModelAttribute</code> annotated reference data accessor methods.</p>
</li>
<li>
<p>A <code class="interface">Model</code> object, with the view name implicitly determined through a <code class="interface">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects and the results of <code>@ModelAttribute</code> annotated reference data accessor methods.</p>
</li>
<li>
<p>A <code class="interface">Map</code> object for exposing a model, with the view name implicitly determined through a <code class="interface">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects and the results of <code>@ModelAttribute</code> annotated reference data accessor methods.</p>
</li>
<li>
<p>A <code class="interface">View</code> object, with the model implicitly determined through command objects and <code>@ModelAttribute</code> annotated reference data accessor methods.
The handler method may also programmatically enrich the model by declaring a <code class="interface">Model</code> argument (see above).</p>
</li>
<li>
<p>A <code class="class">String</code> value that is interpreted as the logical view name, with the model implicitly determined through command objects and <code>@ModelAttribute</code> annotated reference data accessor methods.
The handler method may also programmatically enrich the model by declaring a <code class="interface">Model</code> argument (see above).</p>
</li>
<li>
<p><code>void</code> if the method handles the response itself (by writing the response content directly, declaring an argument of type <code class="interface">ServletResponse</code> / <code class="interface">HttpServletResponse</code> for that purpose) or if the view name is supposed to be implicitly determined through a <code class="interface">RequestToViewNameTranslator</code> (not declaring a response argument in the handler method signature).</p>
</li>
<li>
<p>If the method is annotated with <code class="interface">@ResponseBody</code>, the return type is written to the response HTTP body.
The return value will be converted to the declared method argument type using [interface]`HttpMessageConverter`s.
See <a href="#mvc-ann-responsebody">[mvc-ann-responsebody]</a>.</p>
</li>
<li>
<p>A <code class="class">HttpEntity&lt;?&gt;</code> or <code class="class">ResponseEntity&lt;?&gt;</code> object to provide access to the Servlet response HTTP headers and contents.
The entity body will be converted to the response stream using [interface]`HttpMessageConverter`s.
See <a href="#mvc-ann-httpentity">[mvc-ann-httpentity]</a>.</p>
</li>
<li>
<p>A <code class="interface">Callable&lt;?&gt;</code> can be returned when the application wants to produce the return value asynchronously in a thread managed by Spring MVC.</p>
</li>
<li>
<p>A <code class="class">DeferredResult&lt;?&gt;</code> can be returned when the application wants to produce the return value from a thread of its own choosing.</p>
</li>
<li>
<p>Any other return type is considered to be a single model attribute to be exposed to the view, using the attribute name specified through <code>@ModelAttribute</code> at the method level (or the default attribute name based on the return type class name).
The model is implicitly enriched with command objects and the results of <code>@ModelAttribute</code> annotated reference data accessor methods.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="binding-request-parameters-to-method-parameters-with-code-class-interface-requestparam-code"><a class="anchor" href="#binding-request-parameters-to-method-parameters-with-code-class-interface-requestparam-code"></a>Binding request parameters to method parameters with <code class="interface">@RequestParam</code></h4>
<div class="paragraph">
<p>Use the <code class="class">@RequestParam</code> annotation to bind request parameters to a method parameter in your controller.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows the usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("/pets")
@SessionAttributes("pet")
public class EditPetForm {

    // ...

    @RequestMapping(method = RequestMethod.GET)
    public String setupForm(@RequestParam("petId") int petId, ModelMap model) {
        Pet pet = this.clinic.loadPet(petId);
        model.addAttribute("pet", pet);
        return "petForm";
    }

    // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameters using this annotation are required by default, but you can specify that a parameter is optional by setting <code class="interface">@RequestParam</code>'s <code>required</code> attribute to <code>false</code> (e.g., <code>@RequestParam(value="id",
        required=false)</code>).</p>
</div>
<div class="paragraph">
<p>Type conversion is applied automatically if the target method parameter type is not <code class="class">String</code>.
See <a href="#mvc-ann-typeconversion">[mvc-ann-typeconversion]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-the-request-body-with-the-requestbody-annotation"><a class="anchor" href="#mapping-the-request-body-with-the-requestbody-annotation"></a>Mapping the request body with the @RequestBody annotation</h4>
<div class="paragraph">
<p>The <code class="class">@RequestBody</code> method parameter annotation indicates that a method parameter should be bound to the value of the HTTP request body.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(value = "/something", method = RequestMethod.PUT)
public void handle(@RequestBody String body, Writer writer) throws IOException {
  writer.write(body);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You convert the request body to the method argument by using an <code class="interface">HttpMessageConverter</code>.
<code class="interface">HttpMessageConverter</code> is responsible for converting from the HTTP request message to an object and converting from an object to the HTTP response body.
The <code class="class">RequestMappingHandlerAdapter</code> supports the <code class="class">@RequestBody</code> annotation with the following default <code class="interface">HttpMessageConverters</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="class">ByteArrayHttpMessageConverter</code> converts byte arrays.</p>
</li>
<li>
<p><code class="class">StringHttpMessageConverter</code> converts strings.</p>
</li>
<li>
<p><code class="class">FormHttpMessageConverter</code> converts form data to/from a MultiValueMap&lt;String, String&gt;.</p>
</li>
<li>
<p><code class="class">SourceHttpMessageConverter</code> converts to/from a javax.xml.transform.Source.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on these converters, see <a href="#rest-message-conversion">Message Converters</a>.
Also note that if using the MVC namespace or the MVC Java config, a wider range of message converters are registered by default.
See <a href="#mvc-config-enable">Enabling the MVC Java Config or
        the MVC XML Namespace</a> for more information.</p>
</div>
<div class="paragraph">
<p>If you intend to read and write XML, you will need to configure the <code class="class">MarshallingHttpMessageConverter</code> with a specific <code class="interface">Marshaller</code> and an <code class="interface">Unmarshaller</code> implementation from the <code class="class">org.springframework.oxm</code> package.
The example below shows how to do that directly in your configuration but if your application is configured through the MVC namespace or the MVC Java config see <a href="#mvc-config-enable">Enabling
        the MVC Java Config or the MVC XML Namespace</a> instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"&gt;
    &lt;property name="messageConverters"&gt;
      &lt;util:list id="beanList"&gt;
        &lt;ref bean="stringHttpMessageConverter"/&gt;
        &lt;ref bean="marshallingHttpMessageConverter"/&gt;
      &lt;/util:list&gt;
    &lt;/property
&lt;/bean&gt;

&lt;bean id="stringHttpMessageConverter"
       class="org.springframework.http.converter.StringHttpMessageConverter"/&gt;

&lt;bean id="marshallingHttpMessageConverter"
      class="org.springframework.http.converter.xml.MarshallingHttpMessageConverter"&gt;
  &lt;property name="marshaller" ref="castorMarshaller" /&gt;
  &lt;property name="unmarshaller" ref="castorMarshaller" /&gt;
&lt;/bean&gt;

&lt;bean id="castorMarshaller" class="org.springframework.oxm.castor.CastorMarshaller"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <code class="class">@RequestBody</code> method parameter can be annotated with <code class="class">@Valid</code>, in which case it will be validated using the configured <code class="class">Validator</code> instance.
When using the MVC namespace or the MVC Java config, a JSR-303 validator is configured automatically assuming a JSR-303 implementation is available on the classpath.</p>
</div>
<div class="paragraph">
<p>Just like with <code class="class">@ModelAttribute</code> parameters, an <code class="class">Errors</code> argument can be used to examine the errors.
If such an argument is not declared, a <code class="class">MethodArgumentNotValidException</code> will be raised.
The exception is handled in the <code class="class">DefaultHandlerExceptionResolver</code>, which sends a <code>400</code> error back to the client.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Also see <a href="#mvc-config-enable">Enabling the MVC
          Java Config or the MVC XML Namespace</a> for information on configuring message converters and a validator through the MVC namespace or the MVC Java config.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="mapping-the-response-body-with-the-code-class-interface-responsebody-code-annotation"><a class="anchor" href="#mapping-the-response-body-with-the-code-class-interface-responsebody-code-annotation"></a>Mapping the response body with the <code class="interface">@ResponseBody</code> annotation</h4>
<div class="paragraph">
<p>The <code class="interface">@ResponseBody</code> annotation is similar to <code class="interface">@RequestBody</code>.
This annotation can be put on a method and indicates that the return type should be written straight to the HTTP response body (and not placed in a Model, or interpreted as a view name).
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(value = "/something", method = RequestMethod.PUT)
@ResponseBody
public String helloWorld()  {
  return "Hello World";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will result in the text <code>Hello
        World</code> being written to the HTTP response stream.</p>
</div>
<div class="paragraph">
<p>As with <code class="interface">@RequestBody</code>, Spring converts the returned object to a response body by using an <code class="interface">HttpMessageConverter</code>.
For more information on these converters, see the previous section and <a href="#rest-message-conversion">Message Converters</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-code-class-class-httpentity-code"><a class="anchor" href="#using-code-class-class-httpentity-code"></a>Using <code class="class">HttpEntity&lt;?&gt;</code></h4>
<div class="paragraph">
<p>The <code class="class">HttpEntity</code> is similar to <code class="interface">@RequestBody</code> and <code class="interface">@ResponseBody</code>.
Besides getting access to the request and response body, <code class="class">HttpEntity</code> (and the response-specific subclass <code class="class">ResponseEntity</code>) also allows access to the request and response headers, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping("/something")
public ResponseEntity&lt;String&gt; handle(HttpEntity&lt;byte[]&gt; requestEntity) throws UnsupportedEncodingException {
  String requestHeader = requestEntity.getHeaders().getFirst("MyRequestHeader"));
  byte[] requestBody = requestEntity.getBody();
  // do something with request header and body

  HttpHeaders responseHeaders = new HttpHeaders();
  responseHeaders.set("MyResponseHeader", "MyValue");
  return new ResponseEntity&lt;String&gt;("Hello World", responseHeaders, HttpStatus.CREATED);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example gets the value of the <code>MyRequestHeader</code> request header, and reads the body as a byte array.
It adds the <code>MyResponseHeader</code> to the response, writes <code>Hello World</code> to the response stream, and sets the response status code to 201 (Created).</p>
</div>
<div class="paragraph">
<p>As with <code class="interface">@RequestBody</code> and <code class="interface">@ResponseBody</code>, Spring uses <code class="interface">HttpMessageConverter</code> to convert from and to the request and response streams.
For more information on these converters, see the previous section and <a href="#rest-message-conversion">Message Converters</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-code-class-interface-modelattribute-code-on-a-method"><a class="anchor" href="#using-code-class-interface-modelattribute-code-on-a-method"></a>Using <code class="interface">@ModelAttribute</code> on a method</h4>
<div class="paragraph">
<p>The <code class="interface">@ModelAttribute</code> annotation can be used on methods or on method arguments.
This section explains its usage on methods while the next section explains its usage on method arguments.</p>
</div>
<div class="paragraph">
<p>An <code class="interface">@ModelAttribute</code> on a method indicates the purpose of that method is to add one or more model attributes.
Such methods support the same argument types as <code class="interface">@RequestMapping</code> methods but cannot be mapped directly to requests.
Instead <code class="interface">@ModelAttribute</code> methods in a controller are invoked before <code class="interface">@RequestMapping</code> methods, within the same controller.
A couple of examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
// Add one attribute
// The return value of the method is added to the model under the name "account"
// You can customize the name via @ModelAttribute("myAccount")

@ModelAttribute
public Account addAccount(@RequestParam String number) {
    return accountManager.findAccount(number);
}

// Add multiple attributes

@ModelAttribute
public void populateModel(@RequestParam String number, Model model) {
    model.addAttribute(accountManager.findAccount(number));
    // add more ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="interface">@ModelAttribute</code> methods are used to populate the model with commonly needed attributes for example to fill a drop-down with states or with pet types, or to retrieve a command object like Account in order to use it to represent the data on an HTML form.
The latter case is further discussed in the next section.</p>
</div>
<div class="paragraph">
<p>Note the two styles of <code class="interface">@ModelAttribute</code> methods.
In the first, the method adds an attribute implicitly by returning it.
In the second, the method accepts a <code class="class">Model</code> and adds any number of model attributes to it.
You can choose between the two styles depending on your needs.</p>
</div>
<div class="paragraph">
<p>A controller can have any number of <code class="interface">@ModelAttribute</code> methods.
All such methods are invoked before <code class="interface">@RequestMapping</code> methods of the same controller.</p>
</div>
<div class="paragraph">
<p><code class="interface">@ModelAttribute</code> methods can also be defined in an <code class="interface">@ControllerAdvice</code>-annotated class and such methods apply to all controllers.
The <code class="interface">@ControllerAdvice</code> annotation is a component annotation allowing implementation classes to be autodetected through classpath scanning.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
What happens when a model attribute name is not explicitly specified? In such cases a default name is assigned to the model attribute based on its type.
For example if the method returns an object of type <code class="class">Account</code>, the default name used is "account".
You can change that through the value of the <code class="interface">@ModelAttribute</code> annotation.
If adding attributes directly to the <code class="class">Model</code>, use the appropriate overloaded <code>addAttribute(..)</code> method - i.e., with or without an attribute name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code class="interface">@ModelAttribute</code> annotation can be used on <code class="interface">@RequestMapping</code> methods as well.
In that case the return value of the <code class="interface">@RequestMapping</code> method is interpreted as a model attribute rather than as a view name.
The view name is derived from view name conventions instead much like for methods returning void&#8201;&#8212;&#8201;see <a href="#mvc-coc-r2vnt">[mvc-coc-r2vnt]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-code-class-interface-modelattribute-code-on-a-method-argument"><a class="anchor" href="#using-code-class-interface-modelattribute-code-on-a-method-argument"></a>Using <code class="interface">@ModelAttribute</code> on a method argument</h4>
<div class="paragraph">
<p>As explained in the previous section <code class="interface">@ModelAttribute</code> can be used on methods or on method arguments.
This section explains its usage on method arguments.</p>
</div>
<div class="paragraph">
<p>An <code class="interface">@ModelAttribute</code> on a method argument indicates the argument should be retrieved from the model.
If not present in the model, the argument should be instantiated first and then added to the model.
Once present in the model, the argument&#8217;s fields should be populated from all request parameters that have matching names.
This is known as data binding in Spring MVC, a very useful mechanism that saves you from having to parse each form field individually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@RequestMapping(value="/owners/{ownerId}/pets/{petId}/edit", method = RequestMethod.POST)
public String processSubmit(@ModelAttribute Pet pet) {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the above example where can the Pet instance come from? There are several options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It may already be in the model due to use of <code class="interface">@SessionAttributes</code>&#8201;&#8212;&#8201;see <a href="#mvc-ann-sessionattrib">[mvc-ann-sessionattrib]</a>.</p>
</li>
<li>
<p>It may already be in the model due to an <code class="interface">@ModelAttribute</code> method in the same controller&#8201;&#8212;&#8201;as explained in the previous section.</p>
</li>
<li>
<p>It may be retrieved based on a URI template variable and type converter (explained in more detail below).</p>
</li>
<li>
<p>It may be instantiated using its default constructor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <code class="interface">@ModelAttribute</code> method is a common way to to retrieve an attribute from the database, which may optionally be stored between requests through the use of <code class="interface">@SessionAttributes</code>.
In some cases it may be convenient to retrieve the attribute by using an URI template variable and a type converter.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@RequestMapping(value="/accounts/{account}", method = RequestMethod.PUT)
public String save(@ModelAttribute("account") Account account) {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the name of the model attribute (i.e.
"account") matches the name of a URI template variable.
If you register <code class="class">Converter&lt;String, Account&gt;</code> that can turn the <code>String</code> account value into an <code class="class">Account</code> instance, then the above example will work without the need for an <code class="interface">@ModelAttribute</code> method.</p>
</div>
<div class="paragraph">
<p>The next step is data binding.
The <code class="class">WebDataBinder</code> class matches request parameter names&#8201;&#8212;&#8201;including query string parameters and form fields&#8201;&#8212;&#8201;to model attribute fields by name.
Matching fields are populated after type conversion (from String to the target field type) has been applied where necessary.
Data binding and validation are covered in <a href="#validation">[validation]</a>.
Customizing the data binding process for a controller level is covered in <a href="#mvc-ann-webdatabinder">[mvc-ann-webdatabinder]</a>.</p>
</div>
<div class="paragraph">
<p>As a result of data binding there may be errors such as missing required fields or type conversion errors.
To check for such errors add a <code class="class">BindingResult</code> argument immediately following the <code class="interface">@ModelAttribute</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@RequestMapping(value="/owners/{ownerId}/pets/{petId}/edit", method = RequestMethod.POST)
public String processSubmit(@ModelAttribute("pet") Pet pet, BindingResult result) {

    if (result.hasErrors()) {
        return "petForm";
    }

    // ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With a <code class="class">BindingResult</code> you can check if errors were found in which case it&#8217;s common to render the same form where the errors can be shown with the help of Spring&#8217;s <code>&lt;errors&gt;</code> form tag.</p>
</div>
<div class="paragraph">
<p>In addition to data binding you can also invoke validation using your own custom validator passing the same <code class="class">BindingResult</code> that was used to record data binding errors.
That allows for data binding and validation errors to be accumulated in one place and subsequently reported back to the user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@RequestMapping(value="/owners/{ownerId}/pets/{petId}/edit", method = RequestMethod.POST)
public String processSubmit(@ModelAttribute("pet") Pet pet, BindingResult result) {

    new PetValidator().validate(pet, result);
    if (result.hasErrors()) {
        return "petForm";
    }

    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can have validation invoked automatically by adding the JSR-303 <code class="interface">@Valid</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@RequestMapping(value="/owners/{ownerId}/pets/{petId}/edit", method = RequestMethod.POST)
public String processSubmit(@Valid @ModelAttribute("pet") Pet pet, BindingResult result) {

    if (result.hasErrors()) {
        return "petForm";
    }

    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#validation-beanvalidation">[validation-beanvalidation]</a> and <a href="#validation">[validation]</a> for details on how to configure and use validation.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-code-class-class-sessionattributes-code-to-store-model-attributes-in-the-http-session-between-requests"><a class="anchor" href="#using-code-class-class-sessionattributes-code-to-store-model-attributes-in-the-http-session-between-requests"></a>Using <code class="class">@SessionAttributes</code> to store model attributes in the HTTP session between requests</h4>
<div class="paragraph">
<p>The type-level <code class="class">@SessionAttributes</code> annotation declares session attributes used by a specific handler.
This will typically list the names of model attributes or types of model attributes which should be transparently stored in the session or some conversational storage, serving as form-backing beans between subsequent requests.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows the usage of this annotation, specifying the model attribute name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("/editPet.do")
@SessionAttributes("pet")
public class EditPetForm {
    // ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
When using controller interfaces (e.g., for AOP proxying), make sure to consistently put <em>all</em> your mapping annotations - such as <code class="interface">@RequestMapping</code> and <code class="interface">@SessionAttributes</code> - on the controller <em>interface</em> rather than on the implementation class.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="specifying-redirect-and-flash-attributes"><a class="anchor" href="#specifying-redirect-and-flash-attributes"></a>Specifying redirect and flash attributes</h4>
<div class="paragraph">
<p>By default all model attributes are considered to be exposed as URI template variables in the redirect URL. Of the remaining attributes those that are primitive types or collections/arrays of primitive types are automatically appended as query parameters.</p>
</div>
<div class="paragraph">
<p>In annotated controllers however the model may contain additional attributes originally added for rendering purposes (e.g.
drop-down field values).
To gain precise control over the attributes used in a redirect scenario, an <code class="interface">@RequestMapping</code> method can declare an argument of type <code class="interface">RedirectAttributes</code> and use it to add attributes for use in <code class="class">RedirectView</code>.
If the controller method does redirect, the content of <code class="interface">RedirectAttributes</code> is used.
Otherwise the content of the default <code class="interface">Model</code> is used.</p>
</div>
<div class="paragraph">
<p>The <code class="class">RequestMappingHandlerAdapter</code> provides a flag called <code>"ignoreDefaultModelOnRedirect"</code> that can be used to indicate the content of the default <code class="interface">Model</code> should never be used if a controller method redirects.
Instead the controller method should declare an attribute of type <code class="interface">RedirectAttributes</code> or if it doesn&#8217;t do so no attributes should be passed on to <code class="class">RedirectView</code>.
Both the MVC namespace and the MVC Java config keep this flag set to <code>false</code> in order to maintain backwards compatibility.
However, for new applications we recommend setting it to <code>true</code></p>
</div>
<div class="paragraph">
<p>The <code class="interface">RedirectAttributes</code> interface can also be used to add flash attributes.
Unlike other redirect attributes, which end up in the target redirect URL, flash attributes are saved in the HTTP session (and hence do not appear in the URL).
The model of the controller serving the target redirect URL automatically receives these flash attributes after which they are removed from the session.
See <a href="#mvc-flash-attributes">[mvc-flash-attributes]</a> for an overview of the general support for flash attributes in Spring MVC.</p>
</div>
</div>
<div class="sect3">
<h4 id="working-with-code-application-x-www-form-urlencoded-code-data"><a class="anchor" href="#working-with-code-application-x-www-form-urlencoded-code-data"></a>Working with <code>"application/x-www-form-urlencoded"</code> data</h4>
<div class="paragraph">
<p>The previous sections covered use of <code class="interface">@ModelAttribute</code> to support form submission requests from browser clients.
The same annotation is recommended for use with requests from non-browser clients as well.
However there is one notable difference when it comes to working with HTTP PUT requests.
Browsers can submit form data via HTTP GET or HTTP POST. Non-browser clients can also submit forms via HTTP PUT. This presents a challenge because the Servlet specification requires the <code>ServletRequest.getParameter*()</code> family of methods to support form field access only for HTTP POST, not for HTTP PUT.</p>
</div>
<div class="paragraph">
<p>To support HTTP PUT and PATCH requests, the <code>spring-web</code> module provides the filter <code class="class">HttpPutFormContentFilter</code>, which can be configured in <code class="file">web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;filter&gt;
  &lt;filter-name&gt;httpPutFormFilter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.springframework.web.filter.HttpPutFormContentFilter&lt;/filter-class&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
  &lt;filter-name&gt;httpPutFormFilter&lt;/filter-name&gt;
  &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
&lt;/filter-mapping&gt;

&lt;servlet&gt;
  &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
  &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above filter intercepts HTTP PUT and PATCH requests with content type <code>application/x-www-form-urlencoded</code>, reads the form data from the body of the request, and wraps the <code class="class">ServletRequest</code> in order to make the form data available through the <code>ServletRequest.getParameter*()</code> family of methods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
As <code class="class">HttpPutFormContentFilter</code> consumes the body of the request, it should not be configured for PUT or PATCH URLs that rely on other converters for <code>application/x-www-form-urlencoded</code>.
This includes <code>@RequestBody MultiValueMap&lt;String, String&gt;</code> and <code>HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt;</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="mapping-cookie-values-with-the-cookievalue-annotation"><a class="anchor" href="#mapping-cookie-values-with-the-cookievalue-annotation"></a>Mapping cookie values with the @CookieValue annotation</h4>
<div class="paragraph">
<p>The <code class="interface">@CookieValue</code> annotation allows a method parameter to be bound to the value of an HTTP cookie.</p>
</div>
<div class="paragraph">
<p>Let us consider that the following cookie has been received with an http request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>JSESSIONID=415A4AC178C59DACE0B2C9CA727CDD84</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code sample demonstrates how to get the value of the <code>JSESSIONID</code> cookie:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping("/displayHeaderInfo.do")
public void displayHeaderInfo(@CookieValue("JSESSIONID") String cookie)  {

  //...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Type conversion is applied automatically if the target method parameter type is not <code class="class">String</code>.
See <a href="#mvc-ann-typeconversion">[mvc-ann-typeconversion]</a>.</p>
</div>
<div class="paragraph">
<p>This annotation is supported for annotated handler methods in Servlet and Portlet environments.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-request-header-attributes-with-the-requestheader-annotation"><a class="anchor" href="#mapping-request-header-attributes-with-the-requestheader-annotation"></a>Mapping request header attributes with the @RequestHeader annotation</h4>
<div class="paragraph">
<p>The <code class="interface">@RequestHeader</code> annotation allows a method parameter to be bound to a request header.</p>
</div>
<div class="paragraph">
<p>Here is a sample request header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>
Host                    localhost:8080
Accept                  text/html,application/xhtml+xml,application/xml;q=0.9
Accept-Language         fr,en-gb;q=0.7,en;q=0.3
Accept-Encoding         gzip,deflate
Accept-Charset          ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive              300</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code sample demonstrates how to get the value of the <code>Accept-Encoding</code> and <code>Keep-Alive</code> headers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping("/displayHeaderInfo.do")
public void displayHeaderInfo(@RequestHeader("Accept-Encoding") String encoding,
                              @RequestHeader("Keep-Alive") long keepAlive)  {

  //...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Type conversion is applied automatically if the method parameter is not <code class="class">String</code>.
See <a href="#mvc-ann-typeconversion">[mvc-ann-typeconversion]</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Built-in support is available for converting a comma-separated string into an array/collection of strings or other types known to the type conversion system.
For example a method parameter annotated with <code>@RequestHeader("Accept")</code> may be of type <code class="class">String</code> but also <code class="class">String[]</code> or <code class="class">List&lt;String&gt;</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This annotation is supported for annotated handler methods in Servlet and Portlet environments.</p>
</div>
</div>
<div class="sect3">
<h4 id="method-parameters-and-type-conversion"><a class="anchor" href="#method-parameters-and-type-conversion"></a>Method Parameters And Type Conversion</h4>
<div class="paragraph">
<p>String-based values extracted from the request including request parameters, path variables, request headers, and cookie values may need to be converted to the target type of the method parameter or field (e.g., binding a request parameter to a field in an <code class="interface">@ModelAttribute</code> parameter) they&#8217;re bound to.
If the target type is not <code class="class">String</code>, Spring automatically converts to the appropriate type.
All simple types such as int, long, Date, etc.
are supported.
You can further customize the conversion process through a <code class="class">WebDataBinder</code> (see <a href="#mvc-ann-webdatabinder">[mvc-ann-webdatabinder]</a>) or by registering <code class="class">Formatters</code> with the <code class="class">FormattingConversionService</code> (see <a href="#format">[format]</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="customizing-code-class-class-webdatabinder-code-initialization"><a class="anchor" href="#customizing-code-class-class-webdatabinder-code-initialization"></a>Customizing <code class="class">WebDataBinder</code> initialization</h4>
<div class="paragraph">
<p>To customize request parameter binding with PropertyEditors through Spring&#8217;s <code class="class">WebDataBinder</code>, you can use <code class="interface">@InitBinder</code>-annotated methods within your controller, <code class="interface">@InitBinder</code> methods within an <code class="interface">@ControllerAdvice</code> class, or provide a custom <code class="interface">WebBindingInitializer</code>.</p>
</div>
<div class="sect4">
<h5 id="customizing-data-binding-with-code-class-interface-initbinder-code"><a class="anchor" href="#customizing-data-binding-with-code-class-interface-initbinder-code"></a>Customizing data binding with <code class="interface">@InitBinder</code></h5>
<div class="paragraph">
<p>Annotating controller methods with <code class="interface">@InitBinder</code> allows you to configure web data binding directly within your controller class.
<code class="interface">@InitBinder</code> identifies methods that initialize the <code class="class">WebDataBinder</code> that will be used to populate command and form object arguments of annotated handler methods.</p>
</div>
<div class="paragraph">
<p>Such init-binder methods support all arguments that <code class="interface">@RequestMapping</code> supports, except for command/form objects and corresponding validation result objects.
Init-binder methods must not have a return value.
Thus, they are usually declared as <code>void</code>.
Typical arguments include <code class="class">WebDataBinder</code> in combination with <code class="interface">WebRequest</code> or <code class="class">java.util.Locale</code>, allowing code to register context-specific editors.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates the use of <code class="interface">@InitBinder</code> to configure a <code class="class">CustomDateEditor</code> for all <code class="class">java.util.Date</code> form properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
public class MyFormController {

    @InitBinder
    public void initBinder(WebDataBinder binder) {
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
        dateFormat.setLenient(false);
        binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, false));
    }

    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuring-a-custom-code-class-interface-webbindinginitializer-code"><a class="anchor" href="#configuring-a-custom-code-class-interface-webbindinginitializer-code"></a>Configuring a custom <code class="interface">WebBindingInitializer</code></h5>
<div class="paragraph">
<p>To externalize data binding initialization, you can provide a custom implementation of the <code class="interface">WebBindingInitializer</code> interface, which you then enable by supplying a custom bean configuration for an <code class="class">AnnotationMethodHandlerAdapter</code>, thus overriding the default configuration.</p>
</div>
<div class="paragraph">
<p>The following example from the PetClinic application shows a configuration using a custom implementation of the <code class="interface">WebBindingInitializer</code> interface, <code class="class">org.springframework.samples.petclinic.web.ClinicBindingInitializer</code>, which configures PropertyEditors required by several of the PetClinic controllers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"&gt;
    &lt;property name="cacheSeconds" value="0" /&gt;
    &lt;property name="webBindingInitializer"&gt;
        &lt;bean class="org.springframework.samples.petclinic.web.ClinicBindingInitializer" /&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="customizing-data-binding-with-externalized-code-class-interface-initbinder-code-methods"><a class="anchor" href="#customizing-data-binding-with-externalized-code-class-interface-initbinder-code-methods"></a>Customizing data binding with externalized <code class="interface">@InitBinder</code> methods</h5>
<div class="paragraph">
<p><code class="interface">@InitBinder</code> methods can also be defined in an <code class="interface">@ControllerAdvice</code>-annotated class in which case they apply to all controllers.
This provides an alternative to using a <code class="interface">WebBindingInitializer</code>.</p>
</div>
<div class="paragraph">
<p>The <code class="interface">@ControllerAdvice</code> annotation is a component annotation allowing implementation classes to be autodetected through classpath scanning.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="support-for-the-em-last-modified-em-response-header-to-facilitate-content-caching"><a class="anchor" href="#support-for-the-em-last-modified-em-response-header-to-facilitate-content-caching"></a>Support for the <em>Last-Modified</em> Response Header To Facilitate Content Caching</h4>
<div class="paragraph">
<p>An <code class="interface">@RequestMapping</code> method may wish to support <code>'Last-Modified'</code> HTTP requests, as defined in the contract for the Servlet API&#8217;s <code>getLastModified</code> method, to facilitate content caching.
This involves calculating a lastModified <code>long</code> value for a given request, comparing it against the <code>'If-Modified-Since'</code> request header value, and potentially returning a response with status code 304 (Not Modified).
An annotated controller method can achieve that as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@RequestMapping
public String myHandleMethod(WebRequest webRequest, Model model) {

    long lastModified = // 1. application-specific calculation

    if (request.checkNotModified(lastModified)) {
        // 2. shortcut exit - no further processing necessary
        return null;
     }

    // 3. or otherwise further request processing, actually preparing content
    model.addAttribute(...);
    return "myViewName";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two key elements to note: calling <code>request.checkNotModified(lastModified)</code> and returning <code>null</code>.
The former sets the response status to 304 before it returns <code>true</code>.
The latter, in combination with the former, causes Spring MVC to do no further processing of the request.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="asynchronous-request-processing"><a class="anchor" href="#asynchronous-request-processing"></a>Asynchronous Request Processing</h3>
<div class="paragraph">
<p>Spring MVC 3.2 introduced Servlet 3 based asynchronous request processing.
Instead of returning a value, as usual, a controller method can now return a <code class="interface">java.util.concurrent.Callable</code> and produce the return value from a separate thread.
Meanwhile the main Servlet container thread is released and allowed to process other requests.
Spring MVC invokes the <code class="interface">Callable</code> in a separate thread with the help of a <code class="interface">TaskExecutor</code> and when the <code class="interface">Callable</code> returns, the request is dispatched back to the Servlet container to resume processing with the value returned by the <code class="interface">Callable</code>.
Here is an example controller method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@RequestMapping(method=RequestMethod.POST)
public Callable&lt;String&gt; processUpload(final MultipartFile file) {

  return new Callable&lt;String&gt;() {
    public String call() throws Exception {
      // ...
      return "someView";
    }
  };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A second option is for the controller to return an instance of <code class="class">DeferredResult</code>.
In this case the return value will also be produced from a separate thread.
However, that thread is not known to Spring MVC. For example the result may be produced in response to some external event such as a JMS message, a scheduled task, etc.
Here is an example controller method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@RequestMapping("/quotes")
@ResponseBody
public DeferredResult&lt;String&gt; quotes() {
  DeferredResult&lt;String&gt; deferredResult = new DeferredResult&lt;String&gt;();
  // Save the deferredResult in in-memory queue ...
  return deferredResult;
}

// In some other thread...
deferredResult.setResult(data);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This may be difficult to understand without any knowledge of the Servlet 3 async processing feature.
It would certainly help to read up on it.
At a very minimum consider the following basic facts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code class="interface">ServletRequest</code> can be put in asynchronous mode by calling <code>request.startAsync()</code>.
The main effect of doing so is that the Servlet, as well as any Filters, can exit but the response will remain open allowing some other thread to complete processing.</p>
</li>
<li>
<p>The call to <code>request.startAsync()</code> returns an <code class="interface">AsyncContext</code>, which can be used for further control over async processing.
For example it provides the method <code>dispatch</code>, which can be called from an application thread in order to "dispatch" the request back to the Servlet container.
An async dispatch is similar to a forward except it is made from one (application) thread to another (Servlet container) thread whereas a forward occurs synchronously in the same (Servlet container) thread.</p>
</li>
<li>
<p><code class="interface">ServletRequest</code> provides access to the current <code class="interface">DispatcherType</code>, which can be used to distinguish if a <code class="interface">Servlet</code> or a <code class="interface">Filter</code> is processing on the initial request processing thread and when it is processing in an async dispatch.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the above in mind, the following is the sequence of events for async request processing with a <code class="interface">Callable</code>: (1) Controller returns a <code class="interface">Callable</code>, (2) Spring MVC starts async processing and submits the <code class="interface">Callable</code> to a <code class="interface">TaskExecutor</code> for processing in a separate thread, (3) the <code class="class">DispatcherServlet</code> and all Filter&#8217;s exit the request processing thread but the response remains open, (4) the <code class="interface">Callable</code> produces a result and Spring MVC dispatches the request back to the Servlet container, (5) the <code class="class">DispatcherServlet</code> is invoked again and processing resumes with the asynchronously produced result from the <code class="interface">Callable</code>.
The exact sequencing of (2), (3), and (4) may vary depending on the speed of execution of the concurrent threads.</p>
</div>
<div class="paragraph">
<p>The sequence of events for async request processing with a <code class="class">DeferredResult</code> is the same in principal except it&#8217;s up to the application to produce the asynchronous result from some thread: (1) Controller returns a <code class="class">DeferredResult</code> and saves it in some in-memory queue or list where it can be accessed, (2) Spring MVC starts async processing, (3) the <code class="class">DispatcherServlet</code> and all configured Filter&#8217;s exit the request processing thread but the response remains open, (4) the application sets the <code class="class">DeferredResult</code> from some thread and Spring MVC dispatches the request back to the Servlet container, (5) the <code class="class">DispatcherServlet</code> is invoked again and processing resumes with the asynchronously produced result.</p>
</div>
<div class="paragraph">
<p>Explaining the motivation for async request processing and when or why to use it are beyond the scope of this document.
For further information you may wish to read &lt;&lt;,this blog post series&gt;&gt;.</p>
</div>
<div class="sect3">
<h4 id="exception-handling-for-async-requests"><a class="anchor" href="#exception-handling-for-async-requests"></a>Exception Handling for Async Requests</h4>
<div class="paragraph">
<p>What happens if a <code class="interface">Callable</code> returned from a controller method raises an Exception while being executed? The effect is similar to what happens when any controller method raises an exception.
It is handled by a matching <code class="interface">@ExceptionHandler</code> method in the same controller or by one of the configured <code class="interface">HandlerExceptionResolver</code> instances.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Under the covers, when a <code class="interface">Callable</code> raises an Exception, Spring MVC still dispatches to the Servlet container to resume processing.
The only difference is that the result of executing the <code class="interface">Callable</code> is an <code class="class">Exception</code> that must be processed with the configured <code class="interface">HandlerExceptionResolver</code> instances.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using a <code class="class">DeferredResult</code>, you have a choice of calling its <code>setErrorResult(Object)</code> method and provide an <code class="class">Exception</code> or any other Object you&#8217;d like to use as the result.
If the result is an <code class="class">Exception</code>, it will be processed with a matching <code class="interface">@ExceptionHandler</code> method in the same controller or with any configured <code class="interface">HandlerExceptionResolver</code> instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="intercepting-async-requests"><a class="anchor" href="#intercepting-async-requests"></a>Intercepting Async Requests</h4>
<div class="paragraph">
<p>An existing <code class="interface">HandlerInterceptor</code> can implement <code class="interface">AsyncHandlerInterceptor</code>, which provides one additional method <code>afterConcurrentHandlingStarted</code>.
It is invoked after async processing starts and when the initial request processing thread is being exited.
See the Javadoc of <code class="interface">AsyncHandlerInterceptor</code> for more details on that.</p>
</div>
<div class="paragraph">
<p>Further options for async request lifecycle callbacks are provided directly on <code class="class">DeferredResult</code>, which has the methods <code>onTimeout(Runnable)</code> and <code>onCompletion(Runnable)</code>.
Those are called when the async request is about to time out or has completed respectively.
The timeout event can be handled by setting the <code class="class">DeferredResult</code> to some value.
The completion callback however is final and the result can no longer be set.</p>
</div>
<div class="paragraph">
<p>Similar callbacks are also available with a <code class="interface">Callable</code>.
However, you will need to wrap the <code class="interface">Callable</code> in an instance of <code class="class">WebAsyncTask</code> and then use that to register the timeout and completion callbacks.
Just like with <code class="class">DeferredResult</code>, the timeout event can be handled and a value can be returned while the completion event is final.</p>
</div>
<div class="paragraph">
<p>You can also register a <code class="interface">CallableProcessingInterceptor</code> or a <code class="interface">DeferredResultProcessingInterceptor</code> globally through the MVC Java config or the MVC namespace.
Those interceptors provide a full set of callbacks and apply every time a <code class="interface">Callable</code> or a <code class="class">DeferredResult</code> is used.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-for-async-request-processing"><a class="anchor" href="#configuration-for-async-request-processing"></a>Configuration for Async Request Processing</h4>
<div class="sect4">
<h5 id="servlet-3-async-config"><a class="anchor" href="#servlet-3-async-config"></a>Servlet 3 Async Config</h5>
<div class="paragraph">
<p>To use Servlet 3 async request processing, you need to update <code class="file">web.xml</code> to version 3.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
    version="3.0"&gt;

    ...

  &lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">DispatcherServlet</code> and any <code class="interface">Filter</code> configuration need to have the <code>&lt;async-supported&gt;true&lt;/async-supported&gt;</code> sub-element.
Additionally, any <code class="interface">Filter</code> that also needs to get involved in async dispatches should also be configured to support the ASYNC dispatcher type.
Note that it is safe to enable the ASYNC dispatcher type for all filters provided with the Spring Framework since they will not get involved in async dispatches unless needed.</p>
</div>
<div class="paragraph">
<p>If using Servlet 3, Java based configuration, e.g.
via <code class="interface">WebApplicationInitializer</code>, you&#8217;ll also need to set the "asyncSupported" flag as well as the ASYNC dispatcher type just like with <code class="file">web.xml</code>.
To simplify all this configuration, consider extending <code class="class">AbstractDispatcherServletInitializer</code> or <code class="class">AbstractAnnotationConfigDispatcherServletInitializer</code>, which automatically set those options and make it very easy to register <code class="interface">Filter</code> instances.</p>
</div>
</div>
<div class="sect4">
<h5 id="spring-mvc-async-config"><a class="anchor" href="#spring-mvc-async-config"></a>Spring MVC Async Config</h5>
<div class="paragraph">
<p>The MVC Java config and the MVC namespace both provide options for configuring async request processing.
<code class="interface">WebMvcConfigurer</code> has the method <code>configureAsyncSupport</code> while &lt;mvc:annotation-driven&gt; has an &lt;async-support&gt; sub-element.</p>
</div>
<div class="paragraph">
<p>Those allow you to configure the default timeout value to use for async requests, which if not set depends on the underlying Servlet container (e.g.
10 seconds on Tomcat).
You can also configure an <code class="interface">AsyncTaskExecutor</code> to use for executing <code class="interface">Callable</code> instances returned from controller methods.
It is highly recommended to configure this property since by default Spring MVC uses <code class="class">SimpleAsyncTaskExecutor</code>.
The MVC Java config and the MVC namespace also allow you to register <code class="interface">CallableProcessingInterceptor</code> and <code class="interface">DeferredResultProcessingInterceptor</code> instances.</p>
</div>
<div class="paragraph">
<p>If you need to override the default timeout value for a specific <code class="class">DeferredResult</code>, you can do so by using the appropriate class constructor.
Similarly, for a <code class="interface">Callable</code>, you can wrap it in a <code class="class">WebAsyncTask</code> and use the appropriate class constructor to customize the timeout value.
The class constructor of <code class="class">WebAsyncTask</code> also allows providing an <code class="interface">AsyncTaskExecutor</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-controllers"><a class="anchor" href="#testing-controllers"></a>Testing Controllers</h3>
<div class="paragraph">
<p>The <code class="file">spring-test</code> module offers first class support for testing annotated controllers.
See <a href="#spring-mvc-test-framework">[spring-mvc-test-framework]</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handler-mappings"><a class="anchor" href="#handler-mappings"></a>Handler mappings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In previous versions of Spring, users were required to define one or more <code class="interface">HandlerMapping</code> beans in the web application context to map incoming web requests to appropriate handlers.
With the introduction of annotated controllers, you generally don&#8217;t need to do that because the <code class="class">RequestMappingHandlerMapping</code> automatically looks for <code class="interface">@RequestMapping</code> annotations on all <code class="interface">@Controller</code> beans.
However, do keep in mind that all <code class="class">HandlerMapping</code> classes extending from <code class="class">AbstractHandlerMapping</code> have the following properties that you can use to customize their behavior:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>interceptors</code></dt>
<dd>
<p>List of interceptors to use.
[interface]`HandlerInterceptor`s are discussed in <a href="#mvc-handlermapping-interceptor">[mvc-handlermapping-interceptor]</a>.</p>
</dd>
<dt class="hdlist1"><code>defaultHandler</code></dt>
<dd>
<p>Default handler to use, when this handler mapping does not result in a matching handler.</p>
</dd>
<dt class="hdlist1"><code>order</code></dt>
<dd>
<p>Based on the value of the order property (see the <code>org.springframework.core.Ordered</code> interface), Spring sorts all handler mappings available in the context and applies the first matching handler.</p>
</dd>
<dt class="hdlist1"><code>alwaysUseFullPath</code></dt>
<dd>
<p>If <code>true</code> , Spring uses the full path within the current Servlet context to find an appropriate handler.
If <code>false</code> (the default), the path within the current Servlet mapping is used.
For example, if a Servlet is mapped using <code>/testing/*</code> and the <code>alwaysUseFullPath</code> property is set to true, <code>/testing/viewPage.html</code> is used, whereas if the property is set to false, <code>/viewPage.html</code> is used.</p>
</dd>
<dt class="hdlist1"><code>urlDecode</code></dt>
<dd>
<p>Defaults to <code>true</code>, as of Spring 2.5.
If you prefer to compare encoded paths, set this flag to <code>false</code>.
However, the <code class="interface">HttpServletRequest</code> always exposes the Servlet path in decoded form.
Be aware that the Servlet path will not match when compared with encoded paths.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following example shows how to configure an interceptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;
  &lt;bean id="handlerMapping" class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"&gt;
    &lt;property name="interceptors"&gt;
      &lt;bean class="example.MyInterceptor"/&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;beans&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="intercepting-requests-with-a-code-class-interface-handlerinterceptor-code"><a class="anchor" href="#intercepting-requests-with-a-code-class-interface-handlerinterceptor-code"></a>Intercepting requests with a <code class="interface">HandlerInterceptor</code></h3>
<div class="paragraph">
<p>Spring&#8217;s handler mapping mechanism includes handler interceptors, which are useful when you want to apply specific functionality to certain requests, for example, checking for a principal.</p>
</div>
<div class="paragraph">
<p>Interceptors located in the handler mapping must implement <code class="interface">HandlerInterceptor</code> from the <code>org.springframework.web.servlet</code> package.
This interface defines three methods: <code>preHandle(..)</code> is called <em>before</em> the actual handler is executed; <code>postHandle(..)</code> is called <em>after</em> the handler is executed; and <code>afterCompletion(..)</code> is called <em>after the complete request has finished</em>.
These three methods should provide enough flexibility to do all kinds of preprocessing and postprocessing.</p>
</div>
<div class="paragraph">
<p>The <code>preHandle(..)</code> method returns a boolean value.
You can use this method to break or continue the processing of the execution chain.
When this method returns <code>true</code>, the handler execution chain will continue; when it returns false, the <code class="class">DispatcherServlet</code> assumes the interceptor itself has taken care of requests (and, for example, rendered an appropriate view) and does not continue executing the other interceptors and the actual handler in the execution chain.</p>
</div>
<div class="paragraph">
<p>Interceptors can be configured using the <code>interceptors</code> property, which is present on all <code class="class">HandlerMapping</code> classes extending from <code class="class">AbstractHandlerMapping</code>.
This is shown in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;
    &lt;bean id="handlerMapping"
          class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"&gt;
        &lt;property name="interceptors"&gt;
            &lt;list&gt;
                &lt;ref bean="officeHoursInterceptor"/&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="officeHoursInterceptor"
          class="samples.TimeBasedAccessInterceptor"&gt;
        &lt;property name="openingTime" value="9"/&gt;
        &lt;property name="closingTime" value="18"/&gt;
    &lt;/bean&gt;
&lt;beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package samples;

public class TimeBasedAccessInterceptor extends HandlerInterceptorAdapter {

    private int openingTime;
    private int closingTime;

    public void setOpeningTime(int openingTime) {
        this.openingTime = openingTime;
    }

    public void setClosingTime(int closingTime) {
        this.closingTime = closingTime;
    }

    public boolean preHandle(
            HttpServletRequest request,
            HttpServletResponse response,
            Object handler) throws Exception {

        Calendar cal = Calendar.getInstance();
        int hour = cal.get(HOUR_OF_DAY);
        if (openingTime &lt;= hour &amp;&amp; hour &lt; closingTime) {
            return true;
        } else {
            response.sendRedirect("http://host.com/outsideOfficeHours.html");
            return false;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any request handled by this mapping is intercepted by the <code class="class">TimeBasedAccessInterceptor</code>.
If the current time is outside office hours, the user is redirected to a static HTML file that says, for example, you can only access the website during office hours.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
When using the <code class="class">RequestMappingHandlerMapping</code> the actual handler is an instance of <code class="class">HandlerMethod</code> which identifies the specific controller method that will be invoked.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, the Spring adapter class <code class="class">HandlerInterceptorAdapter</code> makes it easier to extend the <code class="interface">HandlerInterceptor</code> interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
In the example above, the configured interceptor will apply to all requests handled with annotated controller methods.
If you want to narrow down the URL paths to which an interceptor applies, you can use the MVC namespace or the MVC Java config, or declare bean instances of type <code class="class">MappedInterceptor</code> to do that.
See <a href="#mvc-config-enable">Enabling the MVC Java Config or the MVC
        XML Namespace</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resolving-views"><a class="anchor" href="#resolving-views"></a>Resolving views</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All MVC frameworks for web applications provide a way to address views.
Spring provides view resolvers, which enable you to render models in a browser without tying you to a specific view technology.
Out of the box, Spring enables you to use JSPs, Velocity templates and XSLT views, for example.
See <a href="#view">[view]</a> for a discussion of how to integrate and use a number of disparate view technologies.</p>
</div>
<div class="paragraph">
<p>The two interfaces that are important to the way Spring handles views are <code class="interface">ViewResolver</code> and <code class="interface">View</code>.
The <code class="interface">ViewResolver</code> provides a mapping between view names and actual views.
The <code class="interface">View</code> interface addresses the preparation of the request and hands the request over to one of the view technologies.</p>
</div>
<div class="sect2">
<h3 id="resolving-views-with-the-code-class-interface-viewresolver-code-interface"><a class="anchor" href="#resolving-views-with-the-code-class-interface-viewresolver-code-interface"></a>Resolving views with the <code class="interface">ViewResolver</code> interface</h3>
<div class="paragraph">
<p>As discussed in <a href="#mvc-controller">[mvc-controller]</a>, all handler methods in the Spring Web MVC controllers must resolve to a logical view name, either explicitly (e.g., by returning a <code>String</code>, <code>View</code>, or <code>ModelAndView</code>) or implicitly (i.e., based on conventions).
Views in Spring are addressed by a logical view name and are resolved by a view resolver.
Spring comes with quite a few view resolvers.
This table lists most of them; a couple of examples follow.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 4. View resolvers</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ViewResolver</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractCachingViewResolver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XmlViewResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of
              ViewResolver that accepts a
              configuration file written in XML with the same DTD as Spring&#8217;s
              XML bean factories. The default configuration file is
              /WEB-INF/views.xml.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ResourceBundleViewResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of
              ViewResolver that uses bean
              definitions in a ResourceBundle,
              specified by the bundle base name. Typically you define the
              bundle in a properties file, located in the classpath. The
              default file name is
              views.properties.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UrlBasedViewResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple implementation of the
              ViewResolver interface that
              effects the direct resolution of logical view names to URLs,
              without an explicit mapping definition. This is appropriate if
              your logical names match the names of your view resources in a
              straightforward manner, without the need for arbitrary
              mappings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InternalResourceViewResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convenient subclass of
              UrlBasedViewResolver that supports
              InternalResourceView (in effect, Servlets
              and JSPs) and subclasses such as JstlView
              and TilesView. You can specify the view
              class for all views generated by this resolver by using
              setViewClass(..). See the Javadocs for the
              UrlBasedViewResolver class for
              details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VelocityViewResolver /
              FreeMarkerViewResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convenient subclass of
              UrlBasedViewResolver that supports
              VelocityView (in effect, Velocity
              templates) or FreeMarkerView
              ,respectively, and custom subclasses of them.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ContentNegotiatingViewResolver</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>As an example, with JSP as a view technology, you can use the <code class="class">UrlBasedViewResolver</code>.
This view resolver translates a view name to a URL and hands the request over to the RequestDispatcher to render the view.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="viewResolver"
      class="org.springframework.web.servlet.view.UrlBasedViewResolver"&gt;
    &lt;property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/&gt;
    &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt;
    &lt;property name="suffix" value=".jsp"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When returning <code>test</code> as a logical view name, this view resolver forwards the request to the <code class="class">RequestDispatcher</code> that will send the request to <code>/WEB-INF/jsp/test.jsp</code>.</p>
</div>
<div class="paragraph">
<p>When you combine different view technologies in a web application, you can use the <code class="class">ResourceBundleViewResolver</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="viewResolver"
      class="org.springframework.web.servlet.view.ResourceBundleViewResolver"&gt;
    &lt;property name="basename" value="views"/&gt;
    &lt;property name="defaultParentView" value="parentView"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">ResourceBundleViewResolver</code> inspects the <code class="class">ResourceBundle</code> identified by the basename, and for each view it is supposed to resolve, it uses the value of the property <code>[viewname].(class)</code> as the view class and the value of the property <code>[viewname].url</code> as the view url.
Examples can be found in the next chapter which covers view technologies.
As you can see, you can identify a parent view, from which all views in the properties file .
This way you can specify a default view class, for example.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Subclasses of <code class="class">AbstractCachingViewResolver</code> cache view instances that they resolve.
Caching improves performance of certain view technologies.
It&#8217;s possible to turn off the cache by setting the <code>cache</code> property to <code>false</code>.
Furthermore, if you must refresh a certain view at runtime (for example when a Velocity template is modified), you can use the <code>removeFromCache(String viewName, Locale
        loc)</code> method.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="chaining-viewresolvers"><a class="anchor" href="#chaining-viewresolvers"></a>Chaining ViewResolvers</h3>
<div class="paragraph">
<p>Spring supports multiple view resolvers.
Thus you can chain resolvers and, for example, override specific views in certain circumstances.
You chain view resolvers by adding more than one resolver to your application context and, if necessary, by setting the <code>order</code> property to specify ordering.
Remember, the higher the order property, the later the view resolver is positioned in the chain.</p>
</div>
<div class="paragraph">
<p>In the following example, the chain of view resolvers consists of two resolvers, an <code class="class">InternalResourceViewResolver</code>, which is always automatically positioned as the last resolver in the chain, and an <code class="class">XmlViewResolver</code> for specifying Excel views.
Excel views are not supported by the <code class="class">InternalResourceViewResolver</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="jspViewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
  &lt;property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/&gt;
  &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt;
  &lt;property name="suffix" value=".jsp"/&gt;
&lt;/bean&gt;

&lt;bean id="excelViewResolver" class="org.springframework.web.servlet.view.XmlViewResolver"&gt;
  &lt;property name="order" value="1"/&gt;
  &lt;property name="location" value="/WEB-INF/views.xml"/&gt;
&lt;/bean&gt;

&lt;!-- in views.xml --&gt;

&lt;beans&gt;
  &lt;bean name="report" class="org.springframework.example.ReportExcelView"/&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a specific view resolver does not result in a view, Spring examines the context for other view resolvers.
If additional view resolvers exist, Spring continues to inspect them until a view is resolved.
If no view resolver returns a view, Spring throws a <code class="class">ServletException</code>.</p>
</div>
<div class="paragraph">
<p>The contract of a view resolver specifies that a view resolver <em>can</em> return null to indicate the view could not be found.
Not all view resolvers do this, however, because in some cases, the resolver simply cannot detect whether or not the view exists.
For example, the <code class="class">InternalResourceViewResolver</code> uses the <code class="class">RequestDispatcher</code> internally, and dispatching is the only way to figure out if a JSP exists, but this action can only execute once.
The same holds for the <code class="class">VelocityViewResolver</code> and some others.
Check the Javadoc for the view resolver to see whether it reports non-existing views.
Thus, putting an <code class="class">InternalResourceViewResolver</code> in the chain in a place other than the last, results in the chain not being fully inspected, because the <code class="class">InternalResourceViewResolver</code> will <em>always</em> return a view!</p>
</div>
</div>
<div class="sect2">
<h3 id="redirecting-to-views"><a class="anchor" href="#redirecting-to-views"></a>Redirecting to views</h3>
<div class="paragraph">
<p>As mentioned previously, a controller typically returns a logical view name, which a view resolver resolves to a particular view technology.
For view technologies such as JSPs that are processed through the Servlet or JSP engine, this resolution is usually handled through the combination of <code class="class">InternalResourceViewResolver</code> and <code class="class">InternalResourceView</code>, which issues an internal forward or include via the Servlet API&#8217;s <code>RequestDispatcher.forward(..)</code> method or <code>RequestDispatcher.include()</code> method.
For other view technologies, such as Velocity, XSLT, and so on, the view itself writes the content directly to the response stream.</p>
</div>
<div class="paragraph">
<p>It is sometimes desirable to issue an HTTP redirect back to the client, before the view is rendered.
This is desirable, for example, when one controller has been called with <code>POST`ed data, and the response is actually a delegation to another controller (for example on a successful form submission).
In this case, a normal internal forward will mean that the other controller will also see the same `POST</code> data, which is potentially problematic if it can confuse it with other expected data.
Another reason to perform a redirect before displaying the result is to eliminate the possibility of the user submitting the form data multiple times.
In this scenario, the browser will first send an initial <code>POST</code>; it will then receive a response to redirect to a different URL; and finally the browser will perform a subsequent <code>GET</code> for the URL named in the redirect response.
Thus, from the perspective of the browser, the current page does not reflect the result of a <code>POST</code> but rather of a <code>GET</code>.
The end effect is that there is no way the user can accidentally re-<code>POST</code> the same data by performing a refresh.
The refresh forces a <code>GET</code> of the result page, not a resend of the initial <code>POST</code> data.</p>
</div>
<div class="sect3">
<h4 id="code-class-class-redirectview-code"><a class="anchor" href="#code-class-class-redirectview-code"></a><code class="class">RedirectView</code></h4>
<div class="paragraph">
<p>One way to force a redirect as the result of a controller response is for the controller to create and return an instance of Spring&#8217;s <code class="class">RedirectView</code>.
In this case, <code class="class">DispatcherServlet</code> does not use the normal view resolution mechanism.
Rather because it has been given the (redirect) view already, the <code class="class">DispatcherServlet</code> simply instructs the view to do its work.</p>
</div>
<div class="paragraph">
<p>The <code class="class">RedirectView</code> issues an <code>HttpServletResponse.sendRedirect()</code> call that returns to the client browser as an HTTP redirect.
By default all model attributes are considered to be exposed as URI template variables in the redirect URL. Of the remaining attributes those that are primitive types or collections/arrays of primitive types are automatically appended as query parameters.</p>
</div>
<div class="paragraph">
<p>Appending primitive type attributes as query parameters may be the desired result if a model instance was prepared specifically for the redirect.
However, in annotated controllers the model may contain additional attributes added for rendering purposes (e.g.
drop-down field values).
To avoid the possibility of having such attributes appear in the URL an annotated controller can declare an argument of type <code class="interface">RedirectAttributes</code> and use it to specify the exact attributes to make available to <code class="class">RedirectView</code>.
If the controller method decides to redirect, the content of <code class="interface">RedirectAttributes</code> is used.
Otherwise the content of the model is used.</p>
</div>
<div class="paragraph">
<p>Note that URI template variables from the present request are automatically made available when expanding a redirect URL and do not need to be added explicitly neither through <code class="interface">Model</code> nor <code class="interface">RedirectAttributes</code>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(value = "/files/{path}", method = RequestMethod.POST)
public String upload(...) {
    // ...
    return "redirect:files/{path}";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code class="class">RedirectView</code> and the view is created by the controller itself, it is recommended that you configure the redirect URL to be injected into the controller so that it is not baked into the controller but configured in the context along with the view names.
The next section discusses this process.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-code-redirect-code-prefix"><a class="anchor" href="#the-code-redirect-code-prefix"></a>The <code>redirect:</code> prefix</h4>
<div class="paragraph">
<p>While the use of <code class="class">RedirectView</code> works fine, if the controller itself creates the <code class="class">RedirectView</code>, there is no avoiding the fact that the controller is aware that a redirection is happening.
This is really suboptimal and couples things too tightly.
The controller should not really care about how the response gets handled.
In general it should operate only in terms of view names that have been injected into it.</p>
</div>
<div class="paragraph">
<p>The special <code>redirect:</code> prefix allows you to accomplish this.
If a view name is returned that has the prefix <code>redirect:</code>, the <code class="class">UrlBasedViewResolver</code> (and all subclasses) will recognize this as a special indication that a redirect is needed.
The rest of the view name will be treated as the redirect URL.</p>
</div>
<div class="paragraph">
<p>The net effect is the same as if the controller had returned a <code class="class">RedirectView</code>, but now the controller itself can simply operate in terms of logical view names.
A logical view name such as <code>redirect:/myapp/some/resource</code> will redirect relative to the current Servlet context, while a name such as <code>redirect:http://myhost.com/some/arbitrary/path</code> will redirect to an absolute URL.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-code-forward-code-prefix"><a class="anchor" href="#the-code-forward-code-prefix"></a>The <code>forward:</code> prefix</h4>
<div class="paragraph">
<p>It is also possible to use a special <code>forward:</code> prefix for view names that are ultimately resolved by <code class="class">UrlBasedViewResolver</code> and subclasses.
This creates an <code class="class">InternalResourceView</code> (which ultimately does a <code>RequestDispatcher.forward()</code>) around the rest of the view name, which is considered a URL. Therefore, this prefix is not useful with <code class="class">InternalResourceViewResolver</code> and <code class="class">InternalResourceView</code> (for JSPs for example).
But the prefix can be helpful when you are primarily using another view technology, but still want to force a forward of a resource to be handled by the Servlet/JSP engine.
(Note that you may also chain multiple view resolvers, instead.)</p>
</div>
<div class="paragraph">
<p>As with the <code>redirect:</code> prefix, if the view name with the <code>forward:</code> prefix is injected into the controller, the controller does not detect that anything special is happening in terms of handling the response.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-contentnegotiatingviewresolver-code"><a class="anchor" href="#code-class-class-contentnegotiatingviewresolver-code"></a><code class="class">ContentNegotiatingViewResolver</code></h3>
<div class="paragraph">
<p>The <code class="class">ContentNegotiatingViewResolver</code> does not resolve views itself but rather delegates to other view resolvers, selecting the view that resembles the representation requested by the client.
Two strategies exist for a client to request a representation from the server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use a distinct URI for each resource, typically by using a different file extension in the URI. For example, the URI`
<a href="http://www.example.com/users/fred.pdf`">http://www.example.com/users/fred.pdf`</a> requests a PDF representation of the user fred, and <code>http://www.example.com/users/fred.xml</code> requests an XML representation.</p>
</li>
<li>
<p>Use the same URI for the client to locate the resource, but set the <code>Accept</code> HTTP request header to list the &lt;&lt;,media
          types&gt;&gt; that it understands.
For example, an HTTP request for <code>http://www.example.com/users/fred</code> with an <code>Accept</code> header set to <code>application/pdf
          `requests a PDF representation of the user fred, while `http://www.example.com/users/fred</code> with an <code>Accept</code> header set to <code>text/xml</code> requests an XML representation.
This strategy is known as &lt;&lt;,content
          negotiation&gt;&gt;.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One issue with the <code>Accept</code> header is that it is impossible to set it in a web browser within HTML. For example, in Firefox, it is fixed to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this reason it is common to see the use of a distinct URI for each representation when developing browser based web applications.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To support multiple representations of a resource, Spring provides the <code class="class">ContentNegotiatingViewResolver</code> to resolve a view based on the file extension or <code>Accept</code> header of the HTTP request.
<code class="class">ContentNegotiatingViewResolver</code> does not perform the view resolution itself but instead delegates to a list of view resolvers that you specify through the bean property <code>ViewResolvers</code>.</p>
</div>
<div class="paragraph">
<p>The <code class="class">ContentNegotiatingViewResolver</code> selects an appropriate <code class="class">View</code> to handle the request by comparing the request media type(s) with the media type (also known as <code>Content-Type</code>) supported by the <code class="class">View</code> associated with each of its <code class="class">ViewResolvers</code>.
The first <code class="class">View</code> in the list that has a compatible <code>Content-Type</code> returns the representation to the client.
If a compatible view cannot be supplied by the <code class="class">ViewResolver</code> chain, then the list of views specified through the <code>DefaultViews</code> property will be consulted.
This latter option is appropriate for singleton <code class="class">Views</code> that can render an appropriate representation of the current resource regardless of the logical view name.
The <code>Accept</code> header may include wild cards, for example <code>text/*</code>, in which case a <code class="class">View</code> whose Content-Type was <code>text/xml</code> is a compatible match.</p>
</div>
<div class="paragraph">
<p>To support the resolution of a view based on a file extension, use the <code class="class">ContentNegotiatingViewResolver `bean property `mediaTypes</code> to specify a mapping of file extensions to media types.
For more information on the algorithm used to determine the request media type, refer to the API documentation for <code class="class">ContentNegotiatingViewResolver</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example configuration of a <code class="class">ContentNegotiatingViewResolver:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver"&gt;
  &lt;property name="mediaTypes"&gt;
    &lt;map&gt;
      &lt;entry key="atom" value="application/atom+xml"/&gt;
      &lt;entry key="html" value="text/html"/&gt;
      &lt;entry key="json" value="application/json"/&gt;
    &lt;/map&gt;
  &lt;/property&gt;
  &lt;property name="viewResolvers"&gt;
    &lt;list&gt;
      &lt;bean class="org.springframework.web.servlet.view.BeanNameViewResolver"/&gt;
      &lt;bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
        &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt;
        &lt;property name="suffix" value=".jsp"/&gt;
      &lt;/bean&gt;
    &lt;/list&gt;
  &lt;/property&gt;
  &lt;property name="defaultViews"&gt;
    &lt;list&gt;
      &lt;bean class="org.springframework.web.servlet.view.json.MappingJackson2JsonView" /&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;


&lt;bean id="content" class="com.springsource.samples.rest.SampleContentAtomView"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">InternalResourceViewResolver</code> handles the translation of view names and JSP pages, while the <code class="class">BeanNameViewResolver</code> returns a view based on the name of a bean.
(See "<a href="#mvc-viewresolver-resolver">Resolving views with the
      ViewResolver interface</a>" for more details on how Spring looks up and instantiates a view.) In this example, the <code>content</code> bean is a class that inherits from <code class="class">AbstractAtomFeedView</code>, which returns an Atom RSS feed.
For more information on creating an Atom Feed representation, see the section Atom Views.</p>
</div>
<div class="paragraph">
<p>In the above configuration, if a request is made with an <code>.html</code> extension, the view resolver looks for a view that matches the <code>text/html</code> media type.
The <code class="class">InternalResourceViewResolver</code> provides the matching view for <code>text/html</code>.
If the request is made with the file extension <code>.atom</code>, the view resolver looks for a view that matches the <code>application/atom+xml</code> media type.
This view is provided by the <code class="class">BeanNameViewResolver</code> that maps to the <code class="class">SampleContentAtomView</code> if the view name returned is <code class="class">content</code>.
If the request is made with the file extension <code>.json</code>, the <code class="class">MappingJackson2JsonView`instance from the `DefaultViews</code> list will be selected regardless of the view name.
Alternatively, client requests can be made without a file extension but with the <code>Accept</code> header set to the preferred media-type, and the same resolution of request to views would occur.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If <code class="class">ContentNegotiatingViewResolver</code>'s list of ViewResolvers is not configured explicitly, it automatically uses any ViewResolvers defined in the application context.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The corresponding controller code that returns an Atom RSS feed for a URI of the form <code>http://localhost/content.atom</code> or <code>http://localhost/content</code> with an <code>Accept</code> header of application/atom+xml is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
public class ContentController {

    private List&lt;SampleContent&gt; contentList = new ArrayList&lt;SampleContent&gt;();

    @RequestMapping(value="/content", method=RequestMethod.GET)
    public ModelAndView getContent() {
        ModelAndView mav = new ModelAndView();
        mav.setViewName("content");
        mav.addObject("sampleContentList", contentList);
        return mav;
    }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-flash-attributes"><a class="anchor" href="#using-flash-attributes"></a>Using flash attributes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flash attributes provide a way for one request to store attributes intended for use in another.
This is most commonly needed when redirecting&#8201;&#8212;&#8201;for example, the <em>Post/Redirect/Get</em> pattern.
Flash attributes are saved temporarily before the redirect (typically in the session) to be made available to the request after the redirect and removed immediately.</p>
</div>
<div class="paragraph">
<p>Spring MVC has two main abstractions in support of flash attributes.
<code class="class">FlashMap</code> is used to hold flash attributes while <code class="interface">FlashMapManager</code> is used to store, retrieve, and manage <code class="class">FlashMap</code> instances.</p>
</div>
<div class="paragraph">
<p>Flash attribute support is always "on" and does not need to enabled explicitly although if not used, it never causes HTTP session creation.
On each request there is an "input" <code class="class">FlashMap</code> with attributes passed from a previous request (if any) and an "output" <code class="class">FlashMap</code> with attributes to save for a subsequent request.
Both <code class="class">FlashMap</code> instances are accessible from anywhere in Spring MVC through static methods in <code class="class">RequestContextUtils</code>.</p>
</div>
<div class="paragraph">
<p>Annotated controllers typically do not need to work with <code class="class">FlashMap</code> directly.
Instead an <code class="interface">@RequestMapping</code> method can accept an argument of type <code class="interface">RedirectAttributes</code> and use it to add flash attributes for a redirect scenario.
Flash attributes added via <code class="interface">RedirectAttributes</code> are automatically propagated to the "output" FlashMap.
Similarly after the redirect attributes from the "input" <code class="class">FlashMap</code> are automatically added to the <code class="interface">Model</code> of the controller serving the target URL.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching requests to flash attributes</div>
<div class="paragraph">
<p>The concept of flash attributes exists in many other Web frameworks and has proven to be exposed sometimes to concurrency issues.
This is because by definition flash attributes are to be stored until the next request.
However the very "next" request may not be the intended recipient but another asynchronous request (e.g.
polling or resource requests) in which case the flash attributes are removed too early.</p>
</div>
<div class="paragraph">
<p>To reduce the possibility of such issues, <code class="class">RedirectView</code> automatically "stamps" <code class="class">FlashMap</code> instances with the path and query parameters of the target redirect URL. In turn the default <code class="class">FlashMapManager</code> matches that information to incoming requests when looking up the "input" <code class="class">FlashMap</code>.</p>
</div>
<div class="paragraph">
<p>This does not eliminate the possibility of a concurrency issue entirely but nevertheless reduces it greatly with information that is already available in the redirect URL. Therefore the use of flash attributes is recommended mainly for redirect scenarios .</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-uri-s"><a class="anchor" href="#building-uri-s"></a>Building `URI`s</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring MVC provides a mechanism for building and encoding a URI using <code class="class">UriComponentsBuilder</code> and <code class="class">UriComponents</code>.</p>
</div>
<div class="paragraph">
<p>For example you can expand and encode a URI template string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>UriComponents uriComponents =
        UriComponentsBuilder.fromUriString("http://example.com/hotels/{hotel}/bookings/{booking}").build();

URI uri = uriComponents.expand("42", "21").encode().toUri();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code class="class">UriComponents</code> is immutable and the <code>expand()</code> and <code>encode()</code> operations return new instances if necessary.</p>
</div>
<div class="paragraph">
<p>You can also expand and encode using individual URI components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>UriComponents uriComponents =
        UriComponentsBuilder.newInstance()
            .scheme("http").host("example.com").path("/hotels/{hotel}/bookings/{booking}").build()
            .expand("42", "21")
            .encode();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a Servlet environment the <code class="class">ServletUriComponentsBuilder</code> sub-class provides static factory methods to copy available URL information from a Servlet requests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>HttpServletRequest request = ...

// Re-use host, scheme, port, path and query string
// Replace the "accountId" query param

ServletUriComponentsBuilder ucb =
        ServletUriComponentsBuilder.fromRequest(request).replaceQueryParam("accountId", "{id}").build()
            .expand("123")
            .encode();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you may choose to copy a subset of the available information up to and including the context path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// Re-use host, port and context path
// Append "/accounts" to the path

ServletUriComponentsBuilder ucb =
        ServletUriComponentsBuilder.fromContextPath(request).path("/accounts").build()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in cases where the <code class="class">DispatcherServlet</code> is mapped by name (e.g.
<code>/main/*</code>), you can also have the literal part of the servlet mapping included:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// Re-use host, port, context path
// Append the literal part of the servlet mapping to the path
// Append "/accounts" to the path

ServletUriComponentsBuilder ucb =
        ServletUriComponentsBuilder.fromServletMapping(request).path("/accounts").build()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-locales"><a class="anchor" href="#using-locales"></a>Using locales</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most parts of Spring&#8217;s architecture support internationalization, just as the Spring web MVC framework does.
<code class="class">DispatcherServlet</code> enables you to automatically resolve messages using the client&#8217;s locale.
This is done with <code class="interface">LocaleResolver</code> objects.</p>
</div>
<div class="paragraph">
<p>When a request comes in, the <code class="class">DispatcherServlet</code> looks for a locale resolver, and if it finds one it tries to use it to set the locale.
Using the <code>RequestContext.getLocale()</code> method, you can always retrieve the locale that was resolved by the locale resolver.</p>
</div>
<div class="paragraph">
<p>In addition to automatic locale resolution, you can also attach an interceptor to the handler mapping (see <a href="#mvc-handlermapping-interceptor">[mvc-handlermapping-interceptor]</a> for more information on handler mapping interceptors) to change the locale under specific circumstances, for example, based on a parameter in the request.</p>
</div>
<div class="paragraph">
<p>Locale resolvers and interceptors are defined in the <code>org.springframework.web.servlet.i18n</code> package and are configured in your application context in the normal way.
Here is a selection of the locale resolvers included in Spring.</p>
</div>
<div class="sect2">
<h3 id="code-class-class-acceptheaderlocaleresolver-code"><a class="anchor" href="#code-class-class-acceptheaderlocaleresolver-code"></a><code class="class">AcceptHeaderLocaleResolver</code></h3>
<div class="paragraph">
<p>This locale resolver inspects the <code>accept-language</code> header in the request that was sent by the client (e.g., a web browser).
Usually this header field contains the locale of the client&#8217;s operating system.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-cookielocaleresolver-code"><a class="anchor" href="#code-class-class-cookielocaleresolver-code"></a><code class="class">CookieLocaleResolver</code></h3>
<div class="paragraph">
<p>This locale resolver inspects a <code class="class">Cookie</code> that might exist on the client to see if a locale is specified.
If so, it uses the specified locale.
Using the properties of this locale resolver, you can specify the name of the cookie as well as the maximum age.
Find below an example of defining a <code class="class">CookieLocaleResolver</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="localeResolver" class="org.springframework.web.servlet.i18n.CookieLocaleResolver"&gt;

    &lt;property name="cookieName" value="clientlanguage"/&gt;

    &lt;!-- in seconds. If set to -1, the cookie is not persisted (deleted when browser shuts down) --&gt;
    &lt;property name="cookieMaxAge" value="100000"&gt;

&lt;/bean&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 5. <code class="class">CookieLocaleResolver</code> properties</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
</table>

</div>
<div class="sect2">
<h3 id="code-class-class-sessionlocaleresolver-code"><a class="anchor" href="#code-class-class-sessionlocaleresolver-code"></a><code class="class">SessionLocaleResolver</code></h3>
<div class="paragraph">
<p>The <code class="class">SessionLocaleResolver</code> allows you to retrieve locales from the session that might be associated with the user&#8217;s request.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-localechangeinterceptor-code"><a class="anchor" href="#code-class-class-localechangeinterceptor-code"></a><code class="class">LocaleChangeInterceptor</code></h3>
<div class="paragraph">
<p>You can enable changing of locales by adding the <code class="class">LocaleChangeInterceptor</code> to one of the handler mappings (see <a href="#mvc-handlermapping">[mvc-handlermapping]</a>).
It will detect a parameter in the request and change the locale.
It calls <code>setLocale()</code> on the <code class="interface">LocaleResolver</code> that also exists in the context.
The following example shows that calls to all <code>*.view</code> resources containing a parameter named <code>siteLanguage</code> will now change the locale.
So, for example, a request for the following URL, <code>http://www.sf.net/home.view?siteLanguage=nl</code> will change the site language to Dutch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="localeChangeInterceptor"
      class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor"&gt;
    &lt;property name="paramName" value="siteLanguage"/&gt;
&lt;/bean&gt;

&lt;bean id="localeResolver"
      class="org.springframework.web.servlet.i18n.CookieLocaleResolver"/&gt;

&lt;bean id="urlMapping"
      class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;
    &lt;property name="interceptors"&gt;
        &lt;list&gt;
            &lt;ref bean="localeChangeInterceptor"/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="mappings"&gt;
        &lt;value&gt;/**/*.view=someController&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-themes"><a class="anchor" href="#using-themes"></a>Using themes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview-of-themes"><a class="anchor" href="#overview-of-themes"></a>Overview of themes</h3>
<div class="paragraph">
<p>You can apply Spring Web MVC framework themes to set the overall look-and-feel of your application, thereby enhancing user experience.
A theme is a collection of static resources, typically style sheets and images, that affect the visual style of the application.</p>
</div>
</div>
<div class="sect2">
<h3 id="defining-themes"><a class="anchor" href="#defining-themes"></a>Defining themes</h3>
<div class="paragraph">
<p>To use themes in your web application, you must set up an implementation of the <code class="interface">org.springframework.ui.context.ThemeSource</code> interface.
The <code class="interface">WebApplicationContext</code> interface extends <code class="interface">ThemeSource</code> but delegates its responsibilities to a dedicated implementation.
By default the delegate will be an <code class="class">org.springframework.ui.context.support.ResourceBundleThemeSource</code> implementation that loads properties files from the root of the classpath.
To use a custom <code class="interface">ThemeSource</code> implementation or to configure the base name prefix of the <code class="class">ResourceBundleThemeSource</code>, you can register a bean in the application context with the reserved name <code class="class">themeSource</code>.
The web application context automatically detects a bean with that name and uses it.</p>
</div>
<div class="paragraph">
<p>When using the <code class="class">ResourceBundleThemeSource</code>, a theme is defined in a simple properties file.
The properties file lists the resources that make up the theme.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>styleSheet=/themes/cool/style.css
background=/themes/cool/img/coolBg.jpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>The keys of the properties are the names that refer to the themed elements from view code.
For a JSP, you typically do this using the <code>spring:theme</code> custom tag, which is very similar to the <code>spring:message</code> tag.
The following JSP fragment uses the theme defined in the previous example to customize the look and feel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%&gt;
&lt;html&gt;
   &lt;head&gt;
      &lt;link rel="stylesheet" href="&lt;spring:theme code='styleSheet'/&gt;" type="text/css"/&gt;
   &lt;/head&gt;
   &lt;body style="background=&lt;spring:theme code='background'/&gt;"&gt;
      ...
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the <code class="class">ResourceBundleThemeSource</code> uses an empty base name prefix.
As a result, the properties files are loaded from the root of the classpath.
Thus you would put the <code>cool.properties</code> theme definition in a directory at the root of the classpath, for example, in <code>/WEB-INF/classes</code>.
The <code class="class">ResourceBundleThemeSource</code> uses the standard Java resource bundle loading mechanism, allowing for full internationalization of themes.
For example, we could have a <code>/WEB-INF/classes/cool_nl.properties</code> that references a special background image with Dutch text on it.</p>
</div>
</div>
<div class="sect2">
<h3 id="theme-resolvers"><a class="anchor" href="#theme-resolvers"></a>Theme resolvers</h3>
<div class="paragraph">
<p>After you define themes, as in the preceding section, you decide which theme to use.
The <code class="class">DispatcherServlet</code> will look for a bean named <code class="class">themeResolver</code> to find out which <code class="interface">ThemeResolver</code> implementation to use.
A theme resolver works in much the same way as a <code class="interface">LocaleResolver</code>.
It detects the theme to use for a particular request and can also alter the request&#8217;s theme.
The following theme resolvers are provided by Spring:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 6. <code class="interface">ThemeResolver</code> implementations</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FixedThemeResolver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selects a fixed theme, set using the
              defaultThemeName property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SessionThemeResolver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CookieThemeResolver</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Spring also provides a <code class="class">ThemeChangeInterceptor</code> that allows theme changes on every request with a simple request parameter.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-s-multipart-file-upload-support"><a class="anchor" href="#spring-s-multipart-file-upload-support"></a>Spring&#8217;s multipart (file upload) support</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-2"><a class="anchor" href="#introduction-2"></a>Introduction</h3>
<div class="paragraph">
<p>Spring&#8217;s built-in multipart support handles file uploads in web applications.
You enable this multipart support with pluggable <code class="interface">MultipartResolver</code> objects, defined in the <code>org.springframework.web.multipart</code> package.
Spring provides one <code class="interface">MultipartResolver</code> implementation for use with &lt;&lt;,<em>Commons
      FileUpload</em>&gt;&gt; and another for use with Servlet 3.0 multipart request parsing.</p>
</div>
<div class="paragraph">
<p>By default, Spring does no multipart handling, because some developers want to handle multiparts themselves.
You enable Spring multipart handling by adding a multipart resolver to the web application&#8217;s context.
Each request is inspected to see if it contains a multipart.
If no multipart is found, the request continues as expected.
If a multipart is found in the request, the <code class="class">MultipartResolver</code> that has been declared in your context is used.
After that, the multipart attribute in your request is treated like any other attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-a-code-class-interface-multipartresolver-code-with-em-commons-fileupload-em"><a class="anchor" href="#using-a-code-class-interface-multipartresolver-code-with-em-commons-fileupload-em"></a>Using a <code class="interface">MultipartResolver</code> with <em>Commons FileUpload</em></h3>
<div class="paragraph">
<p>The following example shows how to use the <code class="class">CommonsMultipartResolver</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="multipartResolver"
    class="org.springframework.web.multipart.commons.CommonsMultipartResolver"&gt;

    &lt;!-- one of the properties available; the maximum file size in bytes --&gt;
    &lt;property name="maxUploadSize" value="100000"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you also need to put the appropriate jars in your classpath for the multipart resolver to work.
In the case of the <code class="class">CommonsMultipartResolver</code>, you need to use <code>commons-fileupload.jar</code>.</p>
</div>
<div class="paragraph">
<p>When the Spring <code class="class">DispatcherServlet</code> detects a multi-part request, it activates the resolver that has been declared in your context and hands over the request.
The resolver then wraps the current <code class="class">HttpServletRequest</code> into a <code class="class">MultipartHttpServletRequest</code> that supports multipart file uploads.
Using the <code class="class">MultipartHttpServletRequest</code>, you can get information about the multiparts contained by this request and actually get access to the multipart files themselves in your controllers.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-a-code-class-interface-multipartresolver-code-with-em-servlet-3-0-em"><a class="anchor" href="#using-a-code-class-interface-multipartresolver-code-with-em-servlet-3-0-em"></a>Using a <code class="interface">MultipartResolver</code> with <em>Servlet 3.0</em></h3>
<div class="paragraph">
<p>In order to use Servlet 3.0 based multipart parsing, you need to mark the <code class="class">DispatcherServlet</code> with a <code>"multipart-config"</code> section in <code class="file">web.xml</code>, or with a <code class="class">javax.servlet.MultipartConfigElement</code> in programmatic Servlet registration, or in case of a custom Servlet class possibly with a <code class="class">javax.servlet.annotation.MultipartConfig</code> annotation on your Servlet class.
Configuration settings such as maximum sizes or storage locations need to be applied at that Servlet registration level as Servlet 3.0 does not allow for those settings to be done from the MultipartResolver.</p>
</div>
<div class="paragraph">
<p>Once Servlet 3.0 multipart parsing has been enabled in one of the above mentioned ways you can add the <code class="class">StandardServletMultipartResolver</code> to your Spring configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="multipartResolver"
    class="org.springframework.web.multipart.support.StandardServletMultipartResolver"&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handling-a-file-upload-in-a-form"><a class="anchor" href="#handling-a-file-upload-in-a-form"></a>Handling a file upload in a form</h3>
<div class="paragraph">
<p>After the <code class="class">MultipartResolver</code> completes its job, the request is processed like any other.
First, create a form with a file input that will allow the user to upload a form.
The encoding attribute (<code>enctype="multipart/form-data"</code>) lets the browser know how to encode the form as multipart request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Upload a file please&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Please upload a file&lt;/h1&gt;
        &lt;form method="post" action="/form" enctype="multipart/form-data"&gt;
            &lt;input type="text" name="name"/&gt;
            &lt;input type="file" name="file"/&gt;
            &lt;input type="submit"/&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next step is to create a controller that handles the file upload.
This controller is very similar to a <a href="#mvc-ann-controller">normal annotated
      <code class="interface">@Controller</code></a>, except that we use <code class="class">MultipartHttpServletRequest</code> or <code class="file">MultipartFile</code> in the method parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
public class FileUploadController {

    @RequestMapping(value = "/form", method = RequestMethod.POST)
    public String handleFormUpload(@RequestParam("name") String name,
        @RequestParam("file") MultipartFile file) {

        if (!file.isEmpty()) {
            byte[] bytes = file.getBytes();
            // store the bytes somewhere
           return "redirect:uploadSuccess";
       } else {
           return "redirect:uploadFailure";
       }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the <code class="interface">@RequestParam</code> method parameters map to the input elements declared in the form.
In this example, nothing is done with the <code>byte[]</code>, but in practice you can save it in a database, store it on the file system, and so on.</p>
</div>
<div class="paragraph">
<p>When using Servlet 3.0 multipart parsing you can also use <code class="class">javax.servlet.http.Part</code> for the method parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
public class FileUploadController {

    @RequestMapping(value = "/form", method = RequestMethod.POST)
    public String handleFormUpload(@RequestParam("name") String name,
        @RequestParam("file") Part file) {

        InputStream inputStream = file.getInputStream();
        // store bytes from uploaded file somewhere

        return "redirect:uploadSuccess";
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handling-a-file-upload-request-from-programmatic-clients"><a class="anchor" href="#handling-a-file-upload-request-from-programmatic-clients"></a>Handling a file upload request from programmatic clients</h3>
<div class="paragraph">
<p>Multipart requests can also be submitted from non-browser clients in a RESTful service scenario.
All of the above examples and configuration apply here as well.
However, unlike browsers that typically submit files and simple form fields, a programmatic client can also send more complex data of a specific content type&#8201;&#8212;&#8201;for example a multipart request with a file and second part with JSON formatted data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>POST /someUrl
Content-Type: multipart/mixed

--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name="meta-data"
Content-Type: application/json; charset=UTF-8
Content-Transfer-Encoding: 8bit

{
  "name": "value"
}
--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name="file-data"; filename="file.properties"
Content-Type: text/xml
Content-Transfer-Encoding: 8bit
... File Data ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could access the part named "meta-data" with a <code class="interface">@RequestParam("meta-data") String
      metadata</code> controller method argument.
However, you would probably prefer to accept a strongly typed object initialized from the JSON formatted data in the body of the request part, very similar to the way <code class="interface">@RequestBody</code> converts the body of a non-multipart request to a target object with the help of an <code class="class">HttpMessageConverter</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code class="interface">@RequestPart</code> annotation instead of the <code class="interface">@RequestParam</code> annotation for this purpose.
It allows you to have the content of a specific multipart passed through an <code class="class">HttpMessageConverter</code> taking into consideration the <code>'Content-Type'</code> header of the multipart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(value="/someUrl", method = RequestMethod.POST)
public String onSubmit(@RequestPart("meta-data") MetaData metadata,
                       @RequestPart("file-data") MultipartFile file) {
    // ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how <code class="class">MultipartFile</code> method arguments can be accessed with <code class="interface">@RequestParam</code> or with <code class="interface">@RequestPart</code> interchangeably.
However, the <code>@RequestPart("meta-data") MetaData</code> method argument in this case is read as JSON content based on its <code>'Content-Type'</code> header and converted with the help of the <code class="class">MappingJackson2HttpMessageConverter</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handling-exceptions"><a class="anchor" href="#handling-exceptions"></a>Handling exceptions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="code-class-interface-handlerexceptionresolver-code"><a class="anchor" href="#code-class-interface-handlerexceptionresolver-code"></a><code class="interface">HandlerExceptionResolver</code></h3>
<div class="paragraph">
<p>Spring <code>HandlerExceptionResolver</code> implementations deal with unexpected exceptions that occur during controller execution.
A <code>HandlerExceptionResolver</code> somewhat resembles the exception mappings you can define in the web application descriptor <code>web.xml</code>.
However, they provide a more flexible way to do so.
For example they provide information about which handler was executing when the exception was thrown.
Furthermore, a programmatic way of handling exceptions gives you more options for responding appropriately before the request is forwarded to another URL (the same end result as when you use the Servlet specific exception mappings).</p>
</div>
<div class="paragraph">
<p>Besides implementing the <code class="interface">HandlerExceptionResolver</code> interface, which is only a matter of implementing the <code>resolveException(Exception, Handler)</code> method and returning a <code class="class">ModelAndView</code>, you may also use the provided <code class="class">SimpleMappingExceptionResolver</code> or create <code class="interface">@ExceptionHandler</code> methods.
The <code class="class">SimpleMappingExceptionResolver</code> enables you to take the class name of any exception that might be thrown and map it to a view name.
This is functionally equivalent to the exception mapping feature from the Servlet API, but it is also possible to implement more finely grained mappings of exceptions from different handlers.
The <code class="interface">@ExceptionHandler</code> annotation on the other hand can be used on methods that should be invoked to handle an exception.
Such methods may be defined locally within an <code class="interface">@Controller</code> or may apply globally to all <code class="interface">@RequestMapping</code> methods when defined within an <code class="interface">@ControllerAdvice</code> class.
The following sections explain this in more detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-interface-exceptionhandler-code"><a class="anchor" href="#code-class-interface-exceptionhandler-code"></a><code class="interface">@ExceptionHandler</code></h3>
<div class="paragraph">
<p>The <code class="interface">HandlerExceptionResolver</code> interface and the <code class="class">SimpleMappingExceptionResolver</code> implementations allow you to map Exceptions to specific views declaratively along with some optional Java logic before forwarding to those views.
However, in some cases, especially when relying on <code class="interface">@ResponseBody</code> methods rather than on view resolution, it may be more convenient to directly set the status of the response and optionally write error content to the body of the response.</p>
</div>
<div class="paragraph">
<p>You can do that with <code class="interface">@ExceptionHandler</code> methods.
When declared within a controller such methods apply to exceptions raised by <code class="interface">@RequestMapping</code> methods of that contoroller (or any of its sub-classes).
You can also declare an <code class="interface">@ExceptionHandler</code> method within an <code class="interface">@ControllerAdvice</code> class in which case it handles exceptions from <code class="interface">@RequestMapping</code> methods from any controller.
The <code class="interface">@ControllerAdvice</code> annotation is a component annotation, which can be used with classpath scanning.
It is automatically enabled when using the MVC namespace and the MVC Java config, or otherwise depending on whether the <code class="class">ExceptionHandlerExceptionResolver</code> is configured or not.
Below is an example of a controller-local <code class="interface">@ExceptionHandler</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
public class SimpleController {


  // @RequestMapping methods omitted ...


  @ExceptionHandler(IOException.class)
  public ResponseEntity&lt;String&gt; handleIOException(IOException ex) {

    // prepare responseEntity

    return responseEntity;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">@ExceptionHandler</code> value can be set to an array of Exception types.
If an exception is thrown that matches one of the types in the list, then the method annotated with the matching <code class="class">@ExceptionHandler</code> will be invoked.
If the annotation value is not set then the exception types listed as method arguments are used.</p>
</div>
<div class="paragraph">
<p>Much like standard controller methods annotated with a <code class="interface">@RequestMapping</code> annotation, the method arguments and return values of <code class="interface">@ExceptionHandler</code> methods can be flexible.
For example, the <code class="class">HttpServletRequest</code> can be accessed in Servlet environments and the <code class="class">PortletRequest</code> in Portlet environments.
The return type can be a <code class="class">String</code>, which is interpreted as a view name, a <code class="class">ModelAndView</code> object, a <code class="class">ResponseEntity</code>, or you can also add the <code class="interface">@ResponseBody</code> to have the method return value converted with message converters and written to the response stream.</p>
</div>
</div>
<div class="sect2">
<h3 id="handling-standard-spring-mvc-exceptions"><a class="anchor" href="#handling-standard-spring-mvc-exceptions"></a>Handling Standard Spring MVC Exceptions</h3>
<div class="paragraph">
<p>Spring MVC may raise a number of exceptions while processing a request.
The <code class="class">SimpleMappingExceptionResolver</code> can easily map any exception to a default error view as needed.
However, when working with clients that interpret responses in an automated way you will want to set specific status code on the response.
Depending on the exception raised the status code may indicate a client error (4xx) or a server error (5xx).</p>
</div>
<div class="paragraph">
<p>The <code class="class">DefaultHandlerExceptionResolver</code> translates Spring MVC exceptions to specific error status codes.
It is registered by default with the MVC namespace, the MVC Java config, and also by the the <code class="class">DispatcherServlet</code> (i.e.
when not using the MVC namespace or Java config).
Listed below are some of the exceptions handled by this resolver and the corresponding status codes:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Exception</th>
<th class="tableblock halign-left valign-top">HTTP Status Code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BindException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConversionNotSupportedException</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpMediaTypeNotAcceptableException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpMediaTypeNotSupportedException</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpMessageNotReadableException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpMessageNotWritableException</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpRequestMethodNotSupportedException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MethodArgumentNotValidException</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MissingServletRequestParameterException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MissingServletRequestPartException</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NoHandlerFoundException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NoSuchRequestHandlingMethodException</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The <code class="class">DefaultHandlerExceptionResolver</code> works transparently by setting the status of the response.
However, it stops short of writing any error content to the body of the response while your application may need to add developer-friendly content to every error response for example when providing a REST API. You can prepare a <code class="class">ModelAndView</code> and render error content through view resolution&#8201;&#8212;&#8201;i.e.
by configuring a <code class="class">ContentNegotiatingViewResolver</code>, <code class="class">MappingJacksonJsonView</code>, and so on.
However, you may prefer to use <code class="interface">@ExceptionHandler</code> methods instead.</p>
</div>
<div class="paragraph">
<p>If you prefer to write error content via <code class="interface">@ExceptionHandler</code> methods you can extend <code class="class">ResponseEntityExceptionHandler</code> instead.
This is a convenient base for <code class="interface">@ControllerAdvice</code> classes providing an <code class="interface">@ExceptionHandler</code> method to handle standard Spring MVC exceptions and return <code class="class">ResponseEntity</code>.
That allows you to customize the response and write error content with message converters.
See the Javadoc of <code class="class">ResponseEntityExceptionHandler</code> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="annotating-business-exceptions-with-code-class-interface-responsestatus-code"><a class="anchor" href="#annotating-business-exceptions-with-code-class-interface-responsestatus-code"></a>Annotating Business Exceptions With <code class="interface">@ResponseStatus</code></h3>
<div class="paragraph">
<p>A business exception can be annotated with <code class="interface">@ResponseStatus</code>.
When the exception is raised, the <code class="class">ResponseStatusExceptionResolver</code> handles it by setting the status of the response accordingly.
By default the <code class="class">DispatcherServlet</code> registers the <code class="class">ResponseStatusExceptionResolver</code> and it is available for use.</p>
</div>
</div>
<div class="sect2">
<h3 id="customizing-the-default-servlet-container-error-page"><a class="anchor" href="#customizing-the-default-servlet-container-error-page"></a>Customizing the Default Servlet Container Error Page</h3>
<div class="paragraph">
<p>When the status of the response is set to an error status code and the body of the response is empty, Servlet containers commonly render an HTML formatted error page.
To customize the default error page of the container, you can declare an <code>&lt;error-page&gt;</code> element in <code class="file">web.xml</code>.
Up until Servlet 3, that element had to be mapped to a specific status code or exception type.
Starting with Servlet 3 an error page does not need to be mapped, which effectively means the specified location customizes the default Servlet container error page.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;error-page&gt;
    &lt;location&gt;/error&lt;/location&gt;
&lt;/error-page&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the actual location for the error page can be a JSP page or some other URL within the container including one handled through an <code class="interface">@Controller</code> method:</p>
</div>
<div class="paragraph">
<p>When writing error information, the status code and the error message set on the <code class="interface">HttpServletResponse</code> can be accessed through request attributes in a controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
public class ErrorController {

    @RequestMapping(value="/error", produces="application/json")
    @ResponseBody
    public Map&lt;String, Object&gt; handle(HttpServletRequest request) {

        Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
        map.put("status", request.getAttribute("javax.servlet.error.status_code"));
        map.put("reason", request.getAttribute("javax.servlet.error.message"));

        return map;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or in a JSP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;%@ page contentType="application/json" pageEncoding="UTF-8"%&gt;
{
   status:&lt;%=request.getAttribute("javax.servlet.error.status_code") %&gt;,
   reason:&lt;%=request.getAttribute("javax.servlet.error.message") %&gt;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="convention-over-configuration-support"><a class="anchor" href="#convention-over-configuration-support"></a>Convention over configuration support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a lot of projects, sticking to established conventions and having reasonable defaults is just what they (the projects) need, and Spring Web MVC now has explicit support for <em>convention over
    configuration</em>.
What this means is that if you establish a set of naming conventions and suchlike, you can <em>substantially</em> cut down on the amount of configuration that is required to set up handler mappings, view resolvers, <code class="class">ModelAndView</code> instances, etc.
This is a great boon with regards to rapid prototyping, and can also lend a degree of (always good-to-have) consistency across a codebase should you choose to move forward with it into production.</p>
</div>
<div class="paragraph">
<p>Convention-over-configuration support addresses the three core areas of MVC: models, views, and controllers.</p>
</div>
<div class="sect2">
<h3 id="the-controller-code-class-class-controllerclassnamehandlermapping-code"><a class="anchor" href="#the-controller-code-class-class-controllerclassnamehandlermapping-code"></a>The Controller <code class="class">ControllerClassNameHandlerMapping</code></h3>
<div class="paragraph">
<p>The <code class="class">ControllerClassNameHandlerMapping</code> class is a <code class="interface">HandlerMapping</code> implementation that uses a convention to determine the mapping between request URLs and the <code class="interface">Controller</code> instances that are to handle those requests.</p>
</div>
<div class="paragraph">
<p>Consider the following simple <code class="interface">Controller</code> implementation.
Take special notice of the <em>name</em> of the class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ViewShoppingCartController implements Controller {

    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        // the implementation is not hugely important for this example...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a snippet from the corresponding Spring Web MVC configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping"/&gt;

&lt;bean id="viewShoppingCart" class="x.y.z.ViewShoppingCartController"&gt;
    &lt;!-- inject dependencies as required... --&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">ControllerClassNameHandlerMapping</code> finds all of the various handler (or <code class="interface">Controller</code>) beans defined in its application context and strips <code>Controller</code> off the name to define its handler mappings.
Thus, <code class="class">ViewShoppingCartController</code> maps to the <code>/viewshoppingcart*</code> request URL.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at some more examples so that the central idea becomes immediately familiar.
(Notice all lowercase in the URLs, in contrast to camel-cased <code class="interface">Controller</code> class names.)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="class">WelcomeController</code> maps to the <code>/welcome*</code> request URL</p>
</li>
<li>
<p><code class="class">HomeController</code> maps to the <code>/home*</code> request URL</p>
</li>
<li>
<p><code class="class">IndexController</code> maps to the <code>/index*</code> request URL</p>
</li>
<li>
<p><code class="class">RegisterController</code> maps to the <code>/register*</code> request URL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the case of <code class="class">MultiActionController</code> handler classes, the mappings generated are slightly more complex.
The <code class="interface">Controller</code> names in the following examples are assumed to be <code class="class">MultiActionController</code> implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="class">AdminController</code> maps to the <code>/admin/*</code> request URL</p>
</li>
<li>
<p><code class="class">CatalogController</code> maps to the <code>/catalog/*</code> request URL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you follow the convention of naming your <code class="interface">Controller</code> implementations as <code>xxx`_Controller_, the [class]`ControllerClassNameHandlerMapping</code> saves you the tedium of defining and maintaining a potentially <em>looooong</em> <code class="class">SimpleUrlHandlerMapping</code> (or suchlike).</p>
</div>
<div class="paragraph">
<p>The <code class="class">ControllerClassNameHandlerMapping</code> class extends the <code class="class">AbstractHandlerMapping</code> base class so you can define <code class="interface">HandlerInterceptor</code> instances and everything else just as you would with many other <code class="interface">HandlerMapping</code> implementations.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-model-code-class-class-modelmap-code-code-class-class-modelandview-code"><a class="anchor" href="#the-model-code-class-class-modelmap-code-code-class-class-modelandview-code"></a>The Model <code class="class">ModelMap</code> (<code class="class">ModelAndView</code>)</h3>
<div class="paragraph">
<p>The <code class="class">ModelMap</code> class is essentially a glorified <code class="interface">Map</code> that can make adding objects that are to be displayed in (or on) a <code class="interface">View</code> adhere to a common naming convention.
Consider the following <code class="interface">Controller</code> implementation; notice that objects are added to the <code class="class">ModelAndView</code> without any associated name specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class DisplayShoppingCartController implements Controller {

    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {

        List cartItems = // get a List of CartItem objects
        User user = // get the User doing the shopping

        ModelAndView mav = new ModelAndView("displayShoppingCart"); &lt;-- the logical view name

        mav.addObject(cartItems); &lt;-- look ma, no name, just the object
        mav.addObject(user); &lt;-- and again ma!

        return mav;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">ModelAndView</code> class uses a <code class="class">ModelMap</code> class that is a custom <code class="interface">Map</code> implementation that automatically generates a key for an object when an object is added to it.
The strategy for determining the name for an added object is, in the case of a scalar object such as <code class="class">User</code>, to use the short class name of the object&#8217;s class.
The following examples are names that are generated for scalar objects put into a <code class="class">ModelMap</code> instance.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <code class="class">x.y.User</code> instance added will have the name <code>user</code> generated.</p>
</li>
<li>
<p>An <code class="class">x.y.Registration</code> instance added will have the name <code>registration</code> generated.</p>
</li>
<li>
<p>An <code class="class">x.y.Foo</code> instance added will have the name <code>foo</code> generated.</p>
</li>
<li>
<p>A <code class="class">java.util.HashMap</code> instance added will have the name <code>hashMap</code> generated.
You probably want to be explicit about the name in this case because <code>hashMap</code> is less than intuitive.</p>
</li>
<li>
<p>Adding <code>null</code> will result in an <code class="class">IllegalArgumentException</code> being thrown.
If the object (or objects) that you are adding could be <code>null</code>, then you will also want to be explicit about the name.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">What, no automatic pluralization?</div>
<div class="paragraph">
<p>Spring Web MVC&#8217;s convention-over-configuration support does not support automatic pluralization.
That is, you cannot add a <code class="interface">List</code> of <code class="class">Person</code> objects to a <code class="class">ModelAndView</code> and have the generated name be <code class="class">people</code>.</p>
</div>
<div class="paragraph">
<p>This decision was made after some debate, with the  winning out in the end.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The strategy for generating a name after adding a <code class="interface">Set</code> or a <code class="interface">List</code> is to peek into the collection, take the short class name of the first object in the collection, and use that with <code>List</code> appended to the name.
The same applies to arrays although with arrays it is not necessary to peek into the array contents.
A few examples will make the semantics of name generation for collections clearer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <code class="class">x.y.User[]</code> array with zero or more <code class="class">x.y.User</code> elements added will have the name <code>userList</code> generated.</p>
</li>
<li>
<p>An <code class="class">x.y.Foo[]</code> array with zero or more <code class="class">x.y.User</code> elements added will have the name <code>fooList</code> generated.</p>
</li>
<li>
<p>A <code class="class">java.util.ArrayList</code> with one or more <code class="class">x.y.User</code> elements added will have the name <code>userList</code> generated.</p>
</li>
<li>
<p>A <code class="class">java.util.HashSet</code> with one or more <code class="class">x.y.Foo</code> elements added will have the name <code>fooList</code> generated.</p>
</li>
<li>
<p>An <em>empty</em> <code class="class">java.util.ArrayList</code> will not be added at all (in effect, the <code class="method">addObject(..)</code> call will essentially be a no-op).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-view-code-class-interface-requesttoviewnametranslator-code"><a class="anchor" href="#the-view-code-class-interface-requesttoviewnametranslator-code"></a>The View - <code class="interface">RequestToViewNameTranslator</code></h3>
<div class="paragraph">
<p>The <code class="interface">RequestToViewNameTranslator</code> interface determines a logical <code class="interface">View</code> name when no such logical view name is explicitly supplied.
It has just one implementation, the <code class="class">DefaultRequestToViewNameTranslator</code> class.</p>
</div>
<div class="paragraph">
<p>The <code class="class">DefaultRequestToViewNameTranslator</code> maps request URLs to logical view names, as with this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class RegistrationController implements Controller {

    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        // process the request...
        ModelAndView mav = new ModelAndView();
        // add data as necessary to the model...
        return mav;
        // notice that no View or logical view name has been set
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;!-- this bean with the well known name generates view names for us --&gt;
    &lt;bean id="viewNameTranslator"
        class="org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator"/&gt;

    &lt;bean class="x.y.RegistrationController"&gt;
        &lt;!-- inject dependencies as necessary --&gt;
    &lt;/bean&gt;

    &lt;!-- maps request URLs to Controller names --&gt;
    &lt;bean class="org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping"/&gt;

    &lt;bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
        &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt;
        &lt;property name="suffix" value=".jsp"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how in the implementation of the <code>handleRequest(..)</code> method no <code class="interface">View</code> or logical view name is ever set on the <code class="class">ModelAndView</code> that is returned.
The <code class="class">DefaultRequestToViewNameTranslator</code> is tasked with generating a <em>logical view name</em> from the URL of the request.
In the case of the above <code class="class">RegistrationController</code>, which is used in conjunction with the <code class="class">ControllerClassNameHandlerMapping</code>, a request URL of <code>http://localhost/registration.html</code> results in a logical view name of <code>registration</code> being generated by the <code class="class">DefaultRequestToViewNameTranslator</code>.
This logical view name is then resolved into the <code>/WEB-INF/jsp/registration.jsp</code> view by the <code class="class">InternalResourceViewResolver</code> bean.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
You do not need to define a <code class="class">DefaultRequestToViewNameTranslator</code> bean explicitly.
If you like the default settings of the <code class="class">DefaultRequestToViewNameTranslator</code>, you can rely on the Spring Web MVC <code class="class">DispatcherServlet</code> to instantiate an instance of this class if one is not explicitly configured.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course, if you need to change the default settings, then you do need to configure your own <code class="class">DefaultRequestToViewNameTranslator</code> bean explicitly.
Consult the comprehensive Javadoc for the <code class="class">DefaultRequestToViewNameTranslator</code> class for details of the various properties that can be configured.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="etag-support"><a class="anchor" href="#etag-support"></a>ETag support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An &lt;&lt;,ETag&gt;&gt; (entity tag) is an HTTP response header returned by an HTTP/1.1 compliant web server used to determine change in content at a given URL. It can be considered to be the more sophisticated successor to the <code>Last-Modified</code> header.
When a server returns a representation with an ETag header, the client can use this header in subsequent GETs, in an <code>If-None-Match</code> header.
If the content has not changed, the server returns <code>304: Not
    Modified</code>.</p>
</div>
<div class="paragraph">
<p>Support for ETags is provided by the Servlet filter <code class="class">ShallowEtagHeaderFilter</code>.
It is a plain Servlet Filter, and thus can be used in combination with any web framework.
The <code class="class">ShallowEtagHeaderFilter</code> filter creates so-called shallow ETags (as opposed to deep ETags, more about that later).The filter caches the content of the rendered JSP (or other content), generates an MD5 hash over that, and returns that as an ETag header in the response.
The next time a client sends a request for the same resource, it uses that hash as the <code>If-None-Match</code> value.
The filter detects this, renders the view again, and compares the two hashes.
If they are equal, a <code>304</code> is returned.
This filter will not save processing power, as the view is still rendered.
The only thing it saves is bandwidth, as the rendered response is not sent back over the wire.</p>
</div>
<div class="paragraph">
<p>You configure the <code class="class">ShallowEtagHeaderFilter</code> in <code class="file">web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;filter&gt;
  &lt;filter-name&gt;etagFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.ShallowEtagHeaderFilter&lt;/filter-class&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
  &lt;filter-name&gt;etagFilter&lt;/filter-name&gt;
  &lt;servlet-name&gt;petclinic&lt;/servlet-name&gt;
&lt;/filter-mapping&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="code-based-servlet-container-initialization"><a class="anchor" href="#code-based-servlet-container-initialization"></a>Code-based Servlet container initialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a Servlet 3.0+ environment, you  have the option of configuring the Servlet container programmatically as an alternative or in combination with a <code class="file">web.xml</code> file.
Below is an example of registering a <code class="class">DispatcherServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import org.springframework.web.WebApplicationInitializer;

public class MyWebApplicationInitializer implements WebApplicationInitializer {

    @Override
    public void onStartup(ServletContext container) {
        XmlWebApplicationContext appContext = new XmlWebApplicationContext();
        appContext.setConfigLocation("/WEB-INF/spring/dispatcher-config.xml");

        ServletRegistration.Dynamic registration = container.addServlet("dispatcher", new DispatcherServlet(appContext));
        registration.setLoadOnStartup(1);
        registration.addMapping("/");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="interface">WebApplicationInitializer</code> is an interface provided by Spring MVC that ensures your implementation is detected and automatically used to initialize any Servlet 3 container.
An abstract base class implementation of <code class="interface">WebApplicationInitializer</code> named <code class="class">AbstractDispatcherServletInitializer</code> makes it even easier to register the <code class="class">DispatcherServlet</code> by simply overriding methods to specify the servlet mapping and the location of the <code class="class">DispatcherServlet</code> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses() {
        return null;
    }

    @Override
    protected Class&lt;?&gt;[] getServletConfigClasses() {
        return new Class[] { MyWebConfig.class };
    }

    @Override
    protected String[] getServletMappings() {
        return new String[] { "/" };
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example is for an application that uses Java-based Spring configuration.
If using XML-based Spring configuration, extend directly from <code class="class">AbstractDispatcherServletInitializer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyWebAppInitializer extends AbstractDispatcherServletInitializer {

    @Override
    protected WebApplicationContext createRootApplicationContext() {
        return null;
    }

    @Override
    protected WebApplicationContext createServletApplicationContext() {
        XmlWebApplicationContext cxt = new XmlWebApplicationContext();
        cxt.setConfigLocation("/WEB-INF/spring/dispatcher-config.xml");
        return cxt;
    }

    @Override
    protected String[] getServletMappings() {
        return new String[] { "/" };
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="class">AbstractDispatcherServletInitializer</code> also provides a convenient way to add <code class="interface">Filter</code> instances and have them automatically mapped to the <code class="class">DispatcherServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyWebAppInitializer extends AbstractDispatcherServletInitializer {

    // ...

    @Override
    protected Filter[] getServletFilters() {
        return new Filter[] { new HiddenHttpMethodFilter(), new CharacterEncodingFilter() };
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each filter is added with a default name based on its concrete type and automatically mapped to the <code class="class">DispatcherServlet</code>.</p>
</div>
<div class="paragraph">
<p>The <code>isAsyncSupported</code> protected method of <code class="class">AbstractDispatcherServletInitializer</code> provides a single place to enable async support on the <code class="class">DispatcherServlet</code> and all filters mapped to it.
By default this flag is set to <code>true</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-spring-mvc"><a class="anchor" href="#configuring-spring-mvc"></a>Configuring Spring MVC</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#mvc-servlet-special-bean-types">[mvc-servlet-special-bean-types]</a> and <a href="#mvc-servlet-config">[mvc-servlet-config]</a> explained about Spring MVC&#8217;s special beans and the default implementations used by the <code class="class">DispatcherServlet</code>.
In this section you&#8217;ll learn about two additional ways of configuring Spring MVC. Namely the MVC Java config and the MVC XML namespace.</p>
</div>
<div class="paragraph">
<p>The MVC Java config and the MVC namespace provide similar default configuration that overrides the <code class="class">DispatcherServlet</code> defaults.
The goal is to spare most applications from having to having to create the same configuration and also to provide higher-level constructs for configuring Spring MVC that serve as a simple starting point and require little or no prior knowledge of the underlying configuration.</p>
</div>
<div class="paragraph">
<p>You can choose either the MVC Java config or the MVC namespace depending on your preference.
Also as you will see further below, with the MVC Java config it is easier to see the underlying configuration as well as to make fine-grained customizations directly to the created Spring MVC beans.
But let&#8217;s start from the beginning.</p>
</div>
<div class="sect2">
<h3 id="enabling-the-mvc-java-config-or-the-mvc-xml-namespace"><a class="anchor" href="#enabling-the-mvc-java-config-or-the-mvc-xml-namespace"></a>Enabling the MVC Java Config or the MVC XML Namespace</h3>
<div class="paragraph">
<p>To enable MVC Java config add the annotation <code class="interface">@EnableWebMvc</code> to one of your <code class="interface">@Configuration</code> classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
public class WebConfig {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To achieve the same in XML use the <code>mvc:annotation-driven</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;

    &lt;mvc:annotation-driven /&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above registers a <code class="class">RequestMappingHandlerMapping</code>, a <code class="class">RequestMappingHandlerAdapter</code>, and an <code class="class">ExceptionHandlerExceptionResolver</code> (among others) in support of processing requests with annotated controller methods using annotations such as <code class="interface">@RequestMapping `, [interface]</code>@ExceptionHandler`, and others.</p>
</div>
<div class="paragraph">
<p>It also enables the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Spring 3 style type conversion through a <a href="#core-convert">ConversionService</a> instance in addition to the JavaBeans PropertyEditors used for Data Binding.</p>
</li>
<li>
<p>Support for <a href="#format">formatting</a> Number fields using the <code class="interface">@NumberFormat</code> annotation through the <code class="interface">ConversionService</code>.</p>
</li>
<li>
<p>Support for <a href="#format">formatting</a> Date, Calendar, Long, and Joda Time fields using the <code class="interface">@DateTimeFormat</code> annotation.</p>
</li>
<li>
<p>Support for <a href="#validation-mvc-jsr303">validating</a> @Controller inputs with <code class="interface">@Valid</code>, if a JSR-303 Provider is present on the classpath.</p>
</li>
<li>
<p>HttpMessageConverter support for <code class="interface">@RequestBody</code> method parameters and <code class="interface">@ResponseBody</code> method return values from <code class="interface">@RequestMapping</code> or <code class="interface">@ExceptionHandler</code> methods.</p>
<div class="paragraph">
<p>This is the complete list of HttpMessageConverters set up by mvc:annotation-driven:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="class">ByteArrayHttpMessageConverter</code> converts byte arrays.</p>
</li>
<li>
<p><code class="class">StringHttpMessageConverter</code> converts strings.</p>
</li>
<li>
<p><code class="class">ResourceHttpMessageConverter</code> converts to/from <code class="class">org.springframework.core.io.Resource</code> for all media types.</p>
</li>
<li>
<p><code class="class">SourceHttpMessageConverter</code> converts to/from a <code class="class">javax.xml.transform.Source</code>.</p>
</li>
<li>
<p><code class="class">FormHttpMessageConverter</code> converts form data to/from a <code class="class">MultiValueMap&lt;String,
String&gt;</code>.</p>
</li>
<li>
<p><code class="class">Jaxb2RootElementHttpMessageConverter</code> converts Java objects to/from XML&#8201;&#8212;&#8201;added if JAXB2 is present on the classpath.</p>
</li>
<li>
<p><code class="class">MappingJackson2HttpMessageConverter</code> (or <code class="class">MappingJacksonHttpMessageConverter</code>) converts to/from JSON&#8201;&#8212;&#8201;added if Jackson 2 (or Jackson) is present on the classpath.</p>
</li>
<li>
<p><code class="class">AtomFeedHttpMessageConverter</code> converts Atom feeds&#8201;&#8212;&#8201;added if Rome is present on the classpath.</p>
</li>
<li>
<p><code class="class">RssChannelHttpMessageConverter</code> converts RSS feeds&#8201;&#8212;&#8201;added if Rome is present on the classpath.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="customizing-the-provided-configuration"><a class="anchor" href="#customizing-the-provided-configuration"></a>Customizing the Provided Configuration</h3>
<div class="paragraph">
<p>To customize the default configuration in Java you simply implement the <code class="interface">WebMvcConfigurer</code> interface or more likely extend the class <code class="class">WebMvcConfigurerAdapter</code> and override the methods you need.
Below is an example of some of the available methods to override.
See <code class="interface">WebMvcConifgurer</code> for a list of all methods and the Javadoc for further details:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  protected void addFormatters(FormatterRegistry registry) {
    // Add formatters and/or converters
  }

  @Override
  public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
    // Configure the list of HttpMessageConverters to use
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To customize the default configuration of <code>&lt;mvc:annotation-driven /&gt;</code> check what attributes and sub-elements it supports.
You can view the &lt;&lt;,Spring MVC XML schema&gt;&gt; or use the code completion feature of your IDE to discover what attributes and sub-elements are available.
The sample below shows a subset of what is available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:annotation-driven conversion-service="conversionService"&gt;
    &lt;mvc:message-converters&gt;
        &lt;bean class="org.example.MyHttpMessageConverter"/&gt;
        &lt;bean class="org.example.MyOtherHttpMessageConverter"/&gt;
    &lt;/mvc:message-converters&gt;
&lt;/mvc:annotation-driven&gt;

&lt;bean id="conversionService" class="org.springframework.format.support.FormattingConversionServiceFactoryBean"&gt;
    &lt;property name="formatters"&gt;
        &lt;list&gt;
            &lt;bean class="org.example.MyFormatter"/&gt;
            &lt;bean class="org.example.MyOtherFormatter"/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-interceptors"><a class="anchor" href="#configuring-interceptors"></a>Configuring Interceptors</h3>
<div class="paragraph">
<p>You can configure <code class="interface">HandlerInterceptors</code> or <code class="interface">WebRequestInterceptors</code> to be applied to all incoming requests or restricted to specific URL path patterns.</p>
</div>
<div class="paragraph">
<p>An example of registering interceptors in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  public void addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(new LocaleInterceptor());
    registry.addInterceptor(new ThemeInterceptor()).addPathPatterns("/**").excludePathPatterns("/admin/**");
    registry.addInterceptor(new SecurityInterceptor()).addPathPatterns("/secure/*");
 }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in XML use the <code>&lt;mvc:interceptors&gt;</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:interceptors&gt;
    &lt;bean class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor" /&gt;
    &lt;mvc:interceptor&gt;
        &lt;mvc:mapping path="/**"/&gt;
        &lt;mvc:exclude-mapping path="/admin/**"/&gt;
        &lt;bean class="org.springframework.web.servlet.theme.ThemeChangeInterceptor" /&gt;
    &lt;/mvc:interceptor&gt;
    &lt;mvc:interceptor&gt;
        &lt;mvc:mapping path="/secure/*"/&gt;
        &lt;bean class="org.example.SecurityInterceptor" /&gt;
    &lt;/mvc:interceptor&gt;
&lt;/mvc:interceptors&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-content-negotiation"><a class="anchor" href="#configuring-content-negotiation"></a>Configuring Content Negotiation</h3>
<div class="paragraph">
<p>Staring with Spring Framework 3.2, you can configure how Spring MVC determines the requested media types from the client for request mapping as well as for content negotiation purposes.
The available options are to check the file extension in the request URI, the "Accept" header, a request parameter, as well as to fall back on a default content type.
By default, file extension in the request URI is checked first and the "Accept" header is checked next.</p>
</div>
<div class="paragraph">
<p>For file extensions in the request URI, the MVC Java config and the MVC namespace, automatically register extensions such as <code class="file">.json</code>, <code class="file">.xml</code>, <code class="file">.rss</code>, and <code class="file">.atom</code> if the corresponding dependencies such as Jackson, JAXB2, or Rome are present on the classpath.
Additional extensions may be not need to be registered explicitly if they can be discovered via <code class="class">ServletContext.getMimeType(String)</code> or the <em>Java Activation Framework</em> (see <code class="class">javax.activation.MimetypesFileTypeMap</code>).</p>
</div>
<div class="paragraph">
<p>Below is an example of customizing content negotiation options through the MVC Java config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
    configurer.favorPathExtension(false).favorParameter(true);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the MVC namespace, the <code>&lt;mvc:annotation-driven&gt;</code> element has a <code>content-negotiation-manager</code> attribute, which expects a <code class="class">ContentNegotiationManager</code> that in turn can be created with a <code class="class">ContentNegotiationManagerFactoryBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:annotation-driven content-negotiation-manager="contentNegotiationManager" /&gt;

&lt;bean id="contentNegotiationManager" class="org.springframework.web.accept.ContentNegotiationManagerFactoryBean"&gt;
    &lt;property name="favorPathExtension" value="false" /&gt;
    &lt;property name="favorParameter" value="true" /&gt;
    &lt;property name="mediaTypes" &gt;
        &lt;value&gt;
            json=application/json
            xml=application/xml
        &lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If not using the MVC Java config or the MVC namespace, you&#8217;ll need to create an instance of <code class="class">ContentNegotiationManager</code> and use it to configure <code class="class">RequestMappingHandlerMapping</code> for request mapping purposes, and <code class="class">RequestMappingHandlerAdapter</code> and <code class="class">ExceptionHandlerExceptionResolver</code> for content negotiation purposes.</p>
</div>
<div class="paragraph">
<p>Note that <code class="class">ContentNegotiatingViewResolver</code> now can also be configured with a <code>ContentNegotiatingViewResolver</code>, so you can use one instance throughout Spring MVC.</p>
</div>
<div class="paragraph">
<p>In more advanced cases, it may be useful to configure multiple <code class="class">ContentNegotiationManager</code> instances that in turn may contain custom <code class="class">ContentNegotiationStrategy</code> implementations.
For example you could configure <code class="class">ExceptionHandlerExceptionResolver</code> with a <code class="class">ContentNegotiationManager</code> that always resolves the requested media type to <code class="file">"application/json"</code>.
Or you may want to plug a custom strategy that has some logic to select a default content type (e.g.
either XML or JSON) if no content types were requested.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-view-controllers"><a class="anchor" href="#configuring-view-controllers"></a>Configuring View Controllers</h3>
<div class="paragraph">
<p>This is a shortcut for defining a <code class="class">ParameterizableViewController</code> that immediately forwards to a view when invoked.
Use it in static cases when there is no Java controller logic to execute before the view generates the response.</p>
</div>
<div class="paragraph">
<p>An example of forwarding a request for <code>"/"</code> to a view called <code>"home"</code> in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  public void addViewControllers(ViewControllerRegistry registry) {
    registry.addViewController("/").setViewName("home");
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the same in XML use the <code>&lt;mvc:view-controller&gt;</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:view-controller path="/" view-name="home"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-serving-of-resources"><a class="anchor" href="#configuring-serving-of-resources"></a>Configuring Serving of Resources</h3>
<div class="paragraph">
<p>This option allows static resource requests following a particular URL pattern to be served by a <code class="class">ResourceHttpRequestHandler</code> from any of a list of <code class="class">Resource</code> locations.
This provides a convenient way to serve static resources from locations other than the web application root, including locations on the classpath.
The <code>cache-period</code> property may be used to set far future expiration headers (1 year is the recommendation of optimization tools such as Page Speed and YSlow) so that they will be more efficiently utilized by the client.
The handler also properly evaluates the <code>Last-Modified</code> header (if present) so that a <code>304</code> status code will be returned as appropriate, avoiding unnecessary overhead for resources that are already cached by the client.
For example, to serve resource requests with a URL pattern of <code>/resources/**</code> from a <code>public-resources</code> directory within the web application root you would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  public void addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler("/resources/**").addResourceLocations("/public-resources/");
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the same in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:resources mapping="/resources/**" location="/public-resources/"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To serve these resources with a 1-year future expiration to ensure maximum use of the browser cache and a reduction in HTTP requests made by the browser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  public void addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler("/resources/**").addResourceLocations("/public-resources/").setCachePeriod(31556926);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:resources mapping="/resources/**" location="/public-resources/" cache-period="31556926"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mapping</code> attribute must be an Ant pattern that can be used by <code class="class">SimpleUrlHandlerMapping</code>, and the <code>location</code> attribute must specify one or more valid resource directory locations.
Multiple resource locations may be specified using a comma-separated list of values.
The locations specified will be checked in the specified order for the presence of the resource for any given request.
For example, to enable the serving of resources from both the web application root and from a known path of <code>/META-INF/public-web-resources/</code> in any jar on the classpath use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@EnableWebMvc
@Configuration
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  public void addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler("/resources/**")
      .addResourceLocations("/", "classpath:/META-INF/public-web-resources/");
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:resources mapping="/resources/**" location="/, classpath:/META-INF/public-web-resources/"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When serving resources that may change when a new version of the application is deployed, it is recommended that you incorporate a version string into the mapping pattern used to request the resources, so that you may force clients to request the newly deployed version of your application&#8217;s resources.
Such a version string can be parameterized and accessed using SpEL so that it may be easily managed in a single place when deploying new versions.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s consider an application that uses a performance-optimized custom build (as recommended) of the Dojo JavaScript library in production, and that the build is generally deployed within the web application at a path of <code>/public-resources/dojo/dojo.js</code>.
Since different parts of Dojo may be incorporated into the custom build for each new version of the application, the client web browsers need to be forced to re-download that custom-built <code>dojo.js</code> resource any time a new version of the application is deployed.
A simple way to achieve this would be to manage the version of the application in a properties file, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>application.version=1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then to make the properties file&#8217;s values accessible to SpEL as a bean using the <code>util:properties</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;util:properties id="applicationProps" location="/WEB-INF/spring/application.properties"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the application version now accessible via SpEL, we can incorporate this into the use of the <code>resources</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:resources mapping="/resources-#{applicationProps['application.version']}/**" location="/public-resources/"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, you can use the <code class="interface">@PropertySouce</code> annotation and then inject the <code class="class">Environment</code> abstraction for access to all defined properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
@PropertySource("/WEB-INF/spring/application.properties")
public class WebConfig extends WebMvcConfigurerAdapter {

  @Inject Environment env;

  @Override
  public void addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler("/resources-" + env.getProperty("application.version") + "/**")
      .addResourceLocations("/public-resources/");
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and finally, to request the resource with the proper URL, we can take advantage of the Spring JSP tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;spring:eval expression="@applicationProps['application.version']" var="applicationVersion"/&gt;

&lt;spring:url value="/resources-{applicationVersion}" var="resourceUrl"&gt;
    &lt;spring:param name="applicationVersion" value="${applicationVersion}"/&gt;
&lt;/spring:url&gt;

&lt;script src="${resourceUrl}/dojo/dojo.js" type="text/javascript"&gt; &lt;/script&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mvc-default-servlet-handler"><a class="anchor" href="#mvc-default-servlet-handler"></a>mvc:default-servlet-handler</h3>
<div class="paragraph">
<p>This tag allows for mapping the <code>DispatcherServlet</code> to "/" (thus overriding the mapping of the container&#8217;s default Servlet), while still allowing static resource requests to be handled by the container&#8217;s default Servlet.
It configures a <code>DefaultServletHttpRequestHandler</code> with a URL mapping of "/**" and the lowest priority relative to other URL mappings.</p>
</div>
<div class="paragraph">
<p>This handler will forward all requests to the default Servlet.
Therefore it is important that it remains last in the order of all other URL <code>HandlerMappings</code>.
That will be the case if you use <code>&lt;mvc:annotation-driven&gt;</code> or alternatively if you are setting up your own customized <code>HandlerMapping</code> instance be sure to set its <code>order</code> property to a value lower than that of the <code>DefaultServletHttpRequestHandler</code>, which is <code>Integer.MAX_VALUE</code>.</p>
</div>
<div class="paragraph">
<p>To enable the feature using the default setup use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
    configurer.enable();
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:default-servlet-handler/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The caveat to overriding the "/" Servlet mapping is that the <code>RequestDispatcher</code> for the default Servlet must be retrieved by name rather than by path.
The <code>DefaultServletHttpRequestHandler</code> will attempt to auto-detect the default Servlet for the container at startup time, using a list of known names for most of the major Servlet containers (including Tomcat, Jetty, GlassFish, JBoss, Resin, WebLogic, and WebSphere).
If the default Servlet has been custom configured with a different name, or if a different Servlet container is being used where the default Servlet name is unknown, then the default Servlet&#8217;s name must be explicitly provided as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
    configurer.enable("myCustomDefaultServlet");
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;mvc:default-servlet-handler default-servlet-name="myCustomDefaultServlet"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="more-spring-web-mvc-resources"><a class="anchor" href="#more-spring-web-mvc-resources"></a>More Spring Web MVC Resources</h3>
<div class="paragraph">
<p>See the following links and pointers for more resources about Spring Web MVC:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are many excellent articles and tutorials that show how to build web applications with Spring MVC. Read them at the &lt;&lt;,Spring
Documentation&gt;&gt; page.</p>
</li>
<li>
<p>by Seth Ladd and others (published by Apress) is an excellent hard copy source of Spring Web MVC goodness.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="advanced-customizations-with-mvc-java-config"><a class="anchor" href="#advanced-customizations-with-mvc-java-config"></a>Advanced Customizations with MVC Java Config</h3>
<div class="paragraph">
<p>As you can see from the above examples, MVC Java config and the MVC namespace provide higher level constructs that do not require deep knowledge of the underlying beans created for you.
Instead it helps you to focus on your application needs.
However, at some point you may need more fine-grained control or you may simply wish to understand the underlying configuration.</p>
</div>
<div class="paragraph">
<p>The first step towards more fine-grained control is to see the underlying beans created for you.
In MVC Java config you can see the Javadoc and the <code class="interface">@Bean</code> methods in <code class="class">WebMvcConfigurationSupport</code>.
The configuration in this class is automatically imported through the <code class="interface">@EnableWebMvc</code> annotation.
In fact if you open <code class="interface">@EnableWebMvc</code> you can see the <code class="interface">@Import</code> statement.</p>
</div>
<div class="paragraph">
<p>The next step towards more fine-grained control is to customize a property on one of the beans created in <code class="class">WebMvcConfigurationSupport</code> or perhaps to provide your own instance.
This requires two things&#8201;&#8212;&#8201;remove the <code class="interface">@EnableWebMvc</code> annotation in order to prevent the import and then extend directly from <code class="class">WebMvcConfigurationSupport</code>.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
public class WebConfig extends WebMvcConfigurationSupport {

  @Override
  public void addInterceptors(InterceptorRegistry registry){
    // ...
  }

  @Override
  @Bean
  public RequestMappingHandlerAdapter requestMappingHandlerAdapter() {

      // Create or let "super" create the adapter
      // Then customize one of its properties
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that modifying beans in this way does not prevent you from using any of the higher-level constructs shown earlier in this section.</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced-customizations-with-the-mvc-namespace"><a class="anchor" href="#advanced-customizations-with-the-mvc-namespace"></a>Advanced Customizations with the MVC Namespace</h3>
<div class="paragraph">
<p>Fine-grained control over the configuration created for you is a bit harder with the MVC namespace.</p>
</div>
<div class="paragraph">
<p>If you do need to do that, rather than replicating the configuration it provides, consider configuring a <code class="interface">BeanPostProcessor</code> that detects the bean you want to customize by type and then modifying its properties as necessary.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Component
public class MyPostProcessor implements BeanPostProcessor {

  public Object postProcessBeforeInitialization(Object bean, String name) throws BeansException {
    if (bean instanceof RequestMappingHandlerAdapter) {
      // Modify properties of the adapter
    }
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code class="class">MyPostProcessor</code> needs to be included in an <code class="interface">&lt;component scan /&gt;</code> in order for it to be detected or if you prefer you can declare it explicitly with an XML bean declaration.</p>
</div>
</div>
</div>
</div>
<h1 id="view-technologies" class="sect0"><a class="anchor" href="#view-technologies"></a>View technologies</h1>
<div class="sect1">
<h2 id="introduction-3"><a class="anchor" href="#introduction-3"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the areas in which Spring excels is in the separation of view technologies from the rest of the MVC framework.
For example, deciding to use Velocity or XSLT in place of an existing JSP is primarily a matter of configuration.
This chapter covers the major view technologies that work with Spring and touches briefly on how to add new ones.
This chapter assumes you are already familiar with <a href="#mvc-viewresolver">[mvc-viewresolver]</a> which covers the basics of how views in general are coupled to the MVC framework.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jsp-jstl"><a class="anchor" href="#jsp-jstl"></a>JSP &amp; JSTL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring provides a couple of out-of-the-box solutions for JSP and JSTL views.
Using JSP or JSTL is done using a normal view resolver defined in the <code class="interface">WebApplicationContext</code>.
Furthermore, of course you need to write some JSPs that will actually render the view.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Setting up your application to use JSTL is a common source of error, mainly caused by confusion over the different servlet spec., JSP and JSTL version numbers, what they mean and how to declare the taglibs correctly.
The article &lt;&lt;,
        How to Reference and Use JSTL in your Web Application&gt;&gt; provides a useful guide to the common pitfalls and how to avoid them.
Note that as of Spring 3.0, the minimum supported servlet version is 2.4 (JSP 2.0 and JSTL 1.1), which reduces the scope for confusion somewhat.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="view-resolvers"><a class="anchor" href="#view-resolvers"></a>View resolvers</h3>
<div class="paragraph">
<p>Just as with any other view technology you&#8217;re integrating with Spring, for JSPs you&#8217;ll need a view resolver that will resolve your views.
The most commonly used view resolvers when developing with JSPs are the <code class="class">InternalResourceViewResolver</code> and the <code class="class">ResourceBundleViewResolver</code>.
Both are declared in the <code class="interface">WebApplicationContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- the ResourceBundleViewResolver --&gt;
&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.ResourceBundleViewResolver"&gt;
  &lt;property name="basename" value="views"/&gt;
&lt;/bean&gt;

# And a sample properties file is uses (views.properties in WEB-INF/classes):
welcome.(class)=org.springframework.web.servlet.view.JstlView
welcome.url=/WEB-INF/jsp/welcome.jsp

productList.(class)=org.springframework.web.servlet.view.JstlView
productList.url=/WEB-INF/jsp/productlist.jsp</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code class="class">ResourceBundleViewResolver</code> needs a properties file defining the view names mapped to 1) a class and 2) a URL. With a <code class="class">ResourceBundleViewResolver</code> you can mix different types of views using only one resolver.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
  &lt;property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/&gt;
  &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt;
  &lt;property name="suffix" value=".jsp"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">InternalResourceBundleViewResolver</code> can be configured for using JSPs as described above.
As a best practice, we strongly encourage placing your JSP files in a directory under the <code class="file">'WEB-INF'</code> directory, so there can be no direct access by clients.</p>
</div>
</div>
<div class="sect2">
<h3 id="em-plain-old-em-jsps-versus-jstl"><a class="anchor" href="#em-plain-old-em-jsps-versus-jstl"></a><em>Plain-old</em> JSPs versus JSTL</h3>
<div class="paragraph">
<p>When using the Java Standard Tag Library you must use a special view class, the <code class="class">JstlView</code>, as JSTL needs some preparation before things such as the I18N features will work.</p>
</div>
</div>
<div class="sect2">
<h3 id="additional-tags-facilitating-development"><a class="anchor" href="#additional-tags-facilitating-development"></a>Additional tags facilitating development</h3>
<div class="paragraph">
<p>Spring provides data binding of request parameters to command objects as described in earlier chapters.
To facilitate the development of JSP pages in combination with those data binding features, Spring provides a few tags that make things even easier.
All Spring tags have <em>HTML escaping</em> features to enable or disable escaping of characters.</p>
</div>
<div class="paragraph">
<p>The tag library descriptor (TLD) is included in the <code class="file">spring-webmvc.jar</code>.
Further information about the individual tags can be found in the appendix entitled <a href="#spring.tld">[spring.tld]</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-spring-s-form-tag-library"><a class="anchor" href="#using-spring-s-form-tag-library"></a>Using Spring&#8217;s form tag library</h3>
<div class="paragraph">
<p>As of version 2.0, Spring provides a comprehensive set of data binding-aware tags for handling form elements when using JSP and Spring Web MVC. Each tag provides support for the set of attributes of its corresponding HTML tag counterpart, making the tags familiar and intuitive to use.
The tag-generated HTML is HTML 4.01/XHTML 1.0 compliant.</p>
</div>
<div class="paragraph">
<p>Unlike other form/input tag libraries, Spring&#8217;s form tag library is integrated with Spring Web MVC, giving the tags access to the command object and reference data your controller deals with.
As you will see in the following examples, the form tags make JSPs easier to develop, read and maintain.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s go through the form tags and look at an example of how each tag is used.
We have included generated HTML snippets where certain tags require further commentary.</p>
</div>
<div class="sect3">
<h4 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h4>
<div class="paragraph">
<p>The form tag library comes bundled in <code>spring-webmvc.jar</code>.
The library descriptor is called <code>spring-form.tld</code>.</p>
</div>
<div class="paragraph">
<p>To use the tags from this library, add the following directive to the top of your JSP page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;
where <code>form</code> is the tag name prefix you want to use for the tags from this library.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-code-form-code-tag"><a class="anchor" href="#the-code-form-code-tag"></a>The <code>form</code> tag</h4>
<div class="paragraph">
<p>This tag renders an HTML <em>form</em> tag and exposes a binding path to inner tags for binding.
It puts the command object in the <code>PageContext</code> so that the command object can be accessed by inner tags.
<em>All the other tags in this library
        are nested tags of the <code>form</code> tag</em>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we have a domain object called <code class="class">User</code>.
It is a JavaBean with properties such as <code>firstName</code> and <code>lastName</code>.
We will use it as the form backing object of our form controller which returns <code>form.jsp</code>.
Below is an example of what <code>form.jsp</code> would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form:form&gt;
      &lt;table&gt;
          &lt;tr&gt;
              &lt;td&gt;First Name:&lt;/td&gt;
              &lt;td&gt;&lt;form:input path="firstName" /&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td&gt;Last Name:&lt;/td&gt;
              &lt;td&gt;&lt;form:input path="lastName" /&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td colspan="2"&gt;
                  &lt;input type="submit" value="Save Changes" /&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
      &lt;/table&gt;
  &lt;/form:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>firstName</code> and <code>lastName</code> values are retrieved from the command object placed in the <code class="interface">PageContext</code> by the page controller.
Keep reading to see more complex examples of how inner tags are used with the <code>form</code> tag.</p>
</div>
<div class="paragraph">
<p>The generated HTML looks like a standard form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form method="POST"&gt;
      &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;First Name:&lt;/td&gt;
            &lt;td&gt;&lt;input name="firstName" type="text" value="Harry"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Last Name:&lt;/td&gt;
            &lt;td&gt;&lt;input name="lastName" type="text" value="Potter"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="2"&gt;
              &lt;input type="submit" value="Save Changes" /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
  &lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding JSP assumes that the variable name of the form backing object is <code>'command'</code>.
If you have put the form backing object into the model under another name (definitely a best practice), then you can bind the form to the named variable like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form:form commandName="user"&gt;
      &lt;table&gt;
          &lt;tr&gt;
              &lt;td&gt;First Name:&lt;/td&gt;
              &lt;td&gt;&lt;form:input path="firstName" /&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td&gt;Last Name:&lt;/td&gt;
              &lt;td&gt;&lt;form:input path="lastName" /&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td colspan="2"&gt;
                  &lt;input type="submit" value="Save Changes" /&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
      &lt;/table&gt;
  &lt;/form:form&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-code-input-code-tag"><a class="anchor" href="#the-code-input-code-tag"></a>The <code>input</code> tag</h4>
<div class="paragraph">
<p>This tag renders an HTML <em>input</em> tag using the bound value and type=<em>text</em> by default.
For an example of this tag, see <a href="#view-jsp-formtaglib-formtag">[view-jsp-formtaglib-formtag]</a>.
Starting with Spring 3.1 you can use other types such HTML5-specific types like <em>email</em>, <em>tel</em>, <em>date</em>, and others.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-code-checkbox-code-tag"><a class="anchor" href="#the-code-checkbox-code-tag"></a>The <code>checkbox</code> tag</h4>
<div class="paragraph">
<p>This tag renders an HTML <em>input</em> tag with type <em>checkbox</em>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume our <code class="class">User</code> has preferences such as newsletter subscription and a list of hobbies.
Below is an example of the <code class="class">Preferences</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class Preferences {

      private boolean receiveNewsletter;

      private String[] interests;

      private String favouriteWord;

      public boolean isReceiveNewsletter() {
          return receiveNewsletter;
      }

      public void setReceiveNewsletter(boolean receiveNewsletter) {
          this.receiveNewsletter = receiveNewsletter;
      }

      public String[] getInterests() {
          return interests;
      }

      public void setInterests(String[] interests) {
          this.interests = interests;
      }

      public String getFavouriteWord() {
          return favouriteWord;
      }

      public void setFavouriteWord(String favouriteWord) {
          this.favouriteWord = favouriteWord;
      }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>form.jsp</code> would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form:form&gt;
      &lt;table&gt;
          &lt;tr&gt;
              &lt;td&gt;Subscribe to newsletter?:&lt;/td&gt;
              &lt;%-- Approach 1: Property is of type java.lang.Boolean --%&gt;
              &lt;td&gt;&lt;form:checkbox path="preferences.receiveNewsletter"/&gt;&lt;/td&gt;
          &lt;/tr&gt;

          &lt;tr&gt;
              &lt;td&gt;Interests:&lt;/td&gt;
              &lt;td&gt;
                  &lt;%-- Approach 2: Property is of an array or of type java.util.Collection --%&gt;
                  Quidditch: &lt;form:checkbox path="preferences.interests" value="Quidditch"/&gt;
                  Herbology: &lt;form:checkbox path="preferences.interests" value="Herbology"/&gt;
                  Defence Against the Dark Arts: &lt;form:checkbox path="preferences.interests"
                      value="Defence Against the Dark Arts"/&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td&gt;Favourite Word:&lt;/td&gt;
              &lt;td&gt;
                  &lt;%-- Approach 3: Property is of type java.lang.Object --%&gt;
                  Magic: &lt;form:checkbox path="preferences.favouriteWord" value="Magic"/&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
      &lt;/table&gt;
  &lt;/form:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are 3 approaches to the <code>checkbox</code> tag which should meet all your checkbox needs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Approach One - When the bound value is of type <code>java.lang.Boolean</code>, the <code>input(checkbox)</code> is marked as <em>checked</em> if the bound value is <code>true</code>.
The <code>value</code> attribute corresponds to the resolved value of the <code>setValue(Object)</code> value property.</p>
</li>
<li>
<p>Approach Two - When the bound value is of type <code>array</code> or <code class="interface">java.util.Collection</code>, the <code>input(checkbox)</code> is marked as <em>checked</em> if the configured <code>setValue(Object)</code> value is present in the bound <code class="interface">Collection</code>.</p>
</li>
<li>
<p>Approach Three - For any other bound value type, the <code>input(checkbox)</code> is marked as <em>checked</em> if the configured <code>setValue(Object)</code> is equal to the bound value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that regardless of the approach, the same HTML structure is generated.
Below is an HTML snippet of some checkboxes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Interests:&lt;/td&gt;
      &lt;td&gt;
          Quidditch: &lt;input name="preferences.interests" type="checkbox" value="Quidditch"/&gt;
          &lt;input type="hidden" value="1" name="_preferences.interests"/&gt;
          Herbology: &lt;input name="preferences.interests" type="checkbox" value="Herbology"/&gt;
          &lt;input type="hidden" value="1" name="_preferences.interests"/&gt;
          Defence Against the Dark Arts: &lt;input name="preferences.interests" type="checkbox"
              value="Defence Against the Dark Arts"/&gt;
          &lt;input type="hidden" value="1" name="_preferences.interests"/&gt;
      &lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>What you might not expect to see is the additional hidden field after each checkbox.
When a checkbox in an HTML page is <em>not</em> checked, its value will not be sent to the server as part of the HTTP request parameters once the form is submitted, so we need a workaround for this quirk in HTML in order for Spring form data binding to work.
The <code>checkbox</code> tag follows the existing Spring convention of including a hidden parameter prefixed by an underscore ("_") for each checkbox.
By doing this, you are effectively telling Spring that .</p>
</div>
</div>
<div class="sect3">
<h4 id="the-code-checkboxes-code-tag"><a class="anchor" href="#the-code-checkboxes-code-tag"></a>The <code>checkboxes</code> tag</h4>
<div class="paragraph">
<p>This tag renders multiple HTML <em>input</em> tags with type <em>checkbox</em>.</p>
</div>
<div class="paragraph">
<p>Building on the example from the previous <code class="class">checkbox</code> tag section.
Sometimes you prefer not to have to list all the possible hobbies in your JSP page.
You would rather provide a list at runtime of the available options and pass that in to the tag.
That is the purpose of the <code class="class">checkboxes</code> tag.
You pass in an <code class="class">Array</code>, a <code class="class">List</code> or a <code class="class">Map</code> containing the available options in the "items" property.
Typically the bound property is a collection so it can hold multiple values selected by the user.
Below is an example of the JSP using this tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form:form&gt;
      &lt;table&gt;
          &lt;tr&gt;
              &lt;td&gt;Interests:&lt;/td&gt;
              &lt;td&gt;
                  &lt;%-- Property is of an array or of type java.util.Collection --%&gt;
                  &lt;form:checkboxes path="preferences.interests" items="${interestList}"/&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
      &lt;/table&gt;
  &lt;/form:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example assumes that the "interestList" is a <code class="class">List</code> available as a model attribute containing strings of the values to be selected from.
In the case where you use a Map, the map entry key will be used as the value and the map entry&#8217;s value will be used as the label to be displayed.
You can also use a custom object where you can provide the property names for the value using "itemValue" and the label using "itemLabel".</p>
</div>
</div>
<div class="sect3">
<h4 id="the-code-radiobutton-code-tag"><a class="anchor" href="#the-code-radiobutton-code-tag"></a>The <code>radiobutton</code> tag</h4>
<div class="paragraph">
<p>This tag renders an HTML <em>input</em> tag with type <em>radio</em>.</p>
</div>
<div class="paragraph">
<p>A typical usage pattern will involve multiple tag instances bound to the same property but with different values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Sex:&lt;/td&gt;
      &lt;td&gt;Male: &lt;form:radiobutton path="sex" value="M"/&gt; &lt;br/&gt;
          Female: &lt;form:radiobutton path="sex" value="F"/&gt; &lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-code-radiobuttons-code-tag"><a class="anchor" href="#the-code-radiobuttons-code-tag"></a>The <code>radiobuttons</code> tag</h4>
<div class="paragraph">
<p>This tag renders multiple HTML <em>input</em> tags with type <em>radio</em>.</p>
</div>
<div class="paragraph">
<p>Just like the <code class="class">checkboxes</code> tag above, you might want to pass in the available options as a runtime variable.
For this usage you would use the <code class="class">radiobuttons</code> tag.
You pass in an <code class="class">Array</code>, a <code class="class">List</code> or a <code class="class">Map</code> containing the available options in the "items" property.
In the case where you use a Map, the map entry key will be used as the value and the map entry&#8217;s value will be used as the label to be displayed.
You can also use a custom object where you can provide the property names for the value using "itemValue" and the label using "itemLabel".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Sex:&lt;/td&gt;
      &lt;td&gt;&lt;form:radiobuttons path="sex" items="${sexOptions}"/&gt;&lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-code-password-code-tag"><a class="anchor" href="#the-code-password-code-tag"></a>The <code>password</code> tag</h4>
<div class="paragraph">
<p>This tag renders an HTML <em>input</em> tag with type <em>password</em> using the bound value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Password:&lt;/td&gt;
      &lt;td&gt;
          &lt;form:password path="password" /&gt;
      &lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that by default, the password value is <em>not</em> shown.
If you do want the password value to be shown, then set the value of the <code>'showPassword'</code> attribute to true, like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Password:&lt;/td&gt;
      &lt;td&gt;
          &lt;form:password path="password" value="^76525bvHGq" showPassword="true" /&gt;
      &lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-code-select-code-tag"><a class="anchor" href="#the-code-select-code-tag"></a>The <code>select</code> tag</h4>
<div class="paragraph">
<p>This tag renders an HTML <em>select</em> element.
It supports data binding to the selected option as well as the use of nested <code>option</code> and <code>options</code> tags.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume a <code class="class">User</code> has a list of skills.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Skills:&lt;/td&gt;
      &lt;td&gt;&lt;form:select path="skills" items="${skills}"/&gt;&lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>User's</code> skill were in Herbology, the HTML source of the <em>Skills</em> row would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Skills:&lt;/td&gt;
      &lt;td&gt;&lt;select name="skills" multiple="true"&gt;
          &lt;option value="Potions"&gt;Potions&lt;/option&gt;
          &lt;option value="Herbology" selected="selected"&gt;Herbology&lt;/option&gt;
          &lt;option value="Quidditch"&gt;Quidditch&lt;/option&gt;&lt;/select&gt;
      &lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-code-option-code-tag"><a class="anchor" href="#the-code-option-code-tag"></a>The <code>option</code> tag</h4>
<div class="paragraph">
<p>This tag renders an HTML <em>option</em>.
It sets <em>selected</em> as appropriate based on the bound value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;House:&lt;/td&gt;
      &lt;td&gt;
          &lt;form:select path="house"&gt;
              &lt;form:option value="Gryffindor"/&gt;
              &lt;form:option value="Hufflepuff"/&gt;
              &lt;form:option value="Ravenclaw"/&gt;
              &lt;form:option value="Slytherin"/&gt;
          &lt;/form:select&gt;
      &lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>User's</code> house was in Gryffindor, the HTML source of the <em>House</em> row would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;House:&lt;/td&gt;
      &lt;td&gt;
          &lt;select name="house"&gt;
              &lt;option value="Gryffindor" selected="selected"&gt;Gryffindor&lt;/option&gt;
              &lt;option value="Hufflepuff"&gt;Hufflepuff&lt;/option&gt;
              &lt;option value="Ravenclaw"&gt;Ravenclaw&lt;/option&gt;
              &lt;option value="Slytherin"&gt;Slytherin&lt;/option&gt;
          &lt;/select&gt;
      &lt;/td&gt;
   &lt;/tr&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-code-options-code-tag"><a class="anchor" href="#the-code-options-code-tag"></a>The <code>options</code> tag</h4>
<div class="paragraph">
<p>This tag renders a list of HTML <em>option</em> tags.
It sets the <em>selected</em> attribute as appropriate based on the bound value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Country:&lt;/td&gt;
      &lt;td&gt;
          &lt;form:select path="country"&gt;
              &lt;form:option value="-" label="--Please Select"/&gt;
              &lt;form:options items="${countryList}" itemValue="code" itemLabel="name"/&gt;
          &lt;/form:select&gt;
      &lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code class="class">User</code> lived in the UK, the HTML source of the <em>Country</em> row would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Country:&lt;/td&gt;
      &lt;td&gt;
          &lt;select name="country"&gt;
              &lt;option value="-"&gt;--Please Select&lt;/option&gt;
              &lt;option value="AT"&gt;Austria&lt;/option&gt;
              &lt;option value="UK" selected="selected"&gt;United Kingdom&lt;/option&gt;
              &lt;option value="US"&gt;United States&lt;/option&gt;
          &lt;/select&gt;
      &lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the example shows, the combined usage of an <code>option</code> tag with the <code>options</code> tag generates the same standard HTML, but allows you to explicitly specify a value in the JSP that is for display only (where it belongs) such as the default string in the example: "-- Please Select".</p>
</div>
<div class="paragraph">
<p>The <code>items</code> attribute is typically populated with a collection or array of item objects.
<code>itemValue</code> and <code>itemLabel</code> simply refer to bean properties of those item objects, if specified; otherwise, the item objects themselves will be stringified.
Alternatively, you may specify a <code>Map</code> of items, in which case the map keys are interpreted as option values and the map values correspond to option labels.
If <code>itemValue</code> and/or <code>itemLabel</code> happen to be specified as well, the item value property will apply to the map key and the item label property will apply to the map value.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-code-textarea-code-tag"><a class="anchor" href="#the-code-textarea-code-tag"></a>The <code>textarea</code> tag</h4>
<div class="paragraph">
<p>This tag renders an HTML <em>textarea</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;tr&gt;
      &lt;td&gt;Notes:&lt;/td&gt;
      &lt;td&gt;&lt;form:textarea path="notes" rows="3" cols="20" /&gt;&lt;/td&gt;
      &lt;td&gt;&lt;form:errors path="notes" /&gt;&lt;/td&gt;
  &lt;/tr&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-code-hidden-code-tag"><a class="anchor" href="#the-code-hidden-code-tag"></a>The <code>hidden</code> tag</h4>
<div class="paragraph">
<p>This tag renders an HTML <em>input</em> tag with type <em>hidden</em> using the bound value.
To submit an unbound hidden value, use the HTML <code>input</code> tag with type <em>hidden</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form:hidden path="house" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we choose to submit the <em>house</em> value as a hidden one, the HTML would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;input name="house" type="hidden" value="Gryffindor"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-code-errors-code-tag"><a class="anchor" href="#the-code-errors-code-tag"></a>The <code>errors</code> tag</h4>
<div class="paragraph">
<p>This tag renders field errors in an HTML <em>span</em> tag.
It provides access to the errors created in your controller or those that were created by any validators associated with your controller.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we want to display all error messages for the <code>firstName</code> and <code>lastName</code> fields once we submit the form.
We have a validator for instances of the <code class="class">User</code> class called <code class="class">UserValidator</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class UserValidator implements Validator {

      public boolean supports(Class candidate) {
          return User.class.isAssignableFrom(candidate);
      }

      public void validate(Object obj, Errors errors) {
          ValidationUtils.rejectIfEmptyOrWhitespace(errors, "firstName", "required", "Field is required.");
          ValidationUtils.rejectIfEmptyOrWhitespace(errors, "lastName", "required", "Field is required.");
      }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>form.jsp</code> would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form:form&gt;
      &lt;table&gt;
          &lt;tr&gt;
              &lt;td&gt;First Name:&lt;/td&gt;
              &lt;td&gt;&lt;form:input path="firstName" /&gt;&lt;/td&gt;
              &lt;%-- Show errors for firstName field --%&gt;
              &lt;td&gt;&lt;form:errors path="firstName" /&gt;&lt;/td&gt;
          &lt;/tr&gt;

          &lt;tr&gt;
              &lt;td&gt;Last Name:&lt;/td&gt;
              &lt;td&gt;&lt;form:input path="lastName" /&gt;&lt;/td&gt;
              &lt;%-- Show errors for lastName field --%&gt;
              &lt;td&gt;&lt;form:errors path="lastName"  /&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td colspan="3"&gt;
                  &lt;input type="submit" value="Save Changes" /&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
      &lt;/table&gt;
  &lt;/form:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we submit a form with empty values in the <code>firstName</code> and <code>lastName</code> fields, this is what the HTML would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form method="POST"&gt;
      &lt;table&gt;
          &lt;tr&gt;
              &lt;td&gt;First Name:&lt;/td&gt;
              &lt;td&gt;&lt;input name="firstName" type="text" value=""/&gt;&lt;/td&gt;
              &lt;%-- Associated errors to firstName field displayed --%&gt;
              &lt;td&gt;&lt;span name="firstName.errors"&gt;Field is required.&lt;/span&gt;&lt;/td&gt;
          &lt;/tr&gt;

          &lt;tr&gt;
              &lt;td&gt;Last Name:&lt;/td&gt;
              &lt;td&gt;&lt;input name="lastName" type="text" value=""/&gt;&lt;/td&gt;
              &lt;%-- Associated errors to lastName field displayed --%&gt;
              &lt;td&gt;&lt;span name="lastName.errors"&gt;Field is required.&lt;/span&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td colspan="3"&gt;
                  &lt;input type="submit" value="Save Changes" /&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
      &lt;/table&gt;
  &lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>What if we want to display the entire list of errors for a given page? The example below shows that the <code>errors</code> tag also supports some basic wildcarding functionality.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>path="*"</code> - displays all errors</p>
</li>
<li>
<p><code>path="lastName"</code> - displays all errors associated with the <code>lastName</code> field</p>
</li>
<li>
<p>if <code>path</code> is omitted - object errors only are displayed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example below will display a list of errors at the top of the page, followed by field-specific errors next to the fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form:form&gt;
      &lt;form:errors path="*" cssClass="errorBox" /&gt;
      &lt;table&gt;
          &lt;tr&gt;
              &lt;td&gt;First Name:&lt;/td&gt;
              &lt;td&gt;&lt;form:input path="firstName" /&gt;&lt;/td&gt;
              &lt;td&gt;&lt;form:errors path="firstName" /&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td&gt;Last Name:&lt;/td&gt;
              &lt;td&gt;&lt;form:input path="lastName" /&gt;&lt;/td&gt;
              &lt;td&gt;&lt;form:errors path="lastName"  /&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td colspan="3"&gt;
                  &lt;input type="submit" value="Save Changes" /&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
      &lt;/table&gt;
  &lt;/form:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The HTML would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form method="POST"&gt;
      &lt;span name="*.errors" class="errorBox"&gt;Field is required.&lt;br/&gt;Field is required.&lt;/span&gt;
      &lt;table&gt;
          &lt;tr&gt;
              &lt;td&gt;First Name:&lt;/td&gt;
              &lt;td&gt;&lt;input name="firstName" type="text" value=""/&gt;&lt;/td&gt;
              &lt;td&gt;&lt;span name="firstName.errors"&gt;Field is required.&lt;/span&gt;&lt;/td&gt;
          &lt;/tr&gt;

          &lt;tr&gt;
              &lt;td&gt;Last Name:&lt;/td&gt;
              &lt;td&gt;&lt;input name="lastName" type="text" value=""/&gt;&lt;/td&gt;
              &lt;td&gt;&lt;span name="lastName.errors"&gt;Field is required.&lt;/span&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
              &lt;td colspan="3"&gt;
                  &lt;input type="submit" value="Save Changes" /&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
  &lt;/form&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-method-conversion"><a class="anchor" href="#http-method-conversion"></a>HTTP Method Conversion</h4>
<div class="paragraph">
<p>A key principle of REST is the use of the Uniform Interface.
This means that all resources (URLs) can be manipulated using the same four HTTP methods: GET, PUT, POST, and DELETE. For each method, the HTTP specification defines the exact semantics.
For instance, a GET should always be a safe operation, meaning that is has no side effects, and a PUT or DELETE should be idempotent, meaning that you can repeat these operations over and over again, but the end result should be the same.
While HTTP defines these four methods, HTML only supports two: GET and POST. Fortunately, there are two possible workarounds: you can either use JavaScript to do your PUT or DELETE, or simply do a POST with the <em>real</em> method as an additional parameter (modeled as a hidden input field in an HTML form).
This latter trick is what Spring&#8217;s <code class="class">HiddenHttpMethodFilter</code> does.
This filter is a plain Servlet Filter and therefore it can be used in combination with any web framework (not just Spring MVC).
Simply add this filter to your web.xml, and a POST with a hidden _method parameter will be converted into the corresponding HTTP method request.</p>
</div>
<div class="paragraph">
<p>To support HTTP method conversion the Spring MVC form tag was updated to support setting the HTTP method.
For example, the following snippet taken from the updated Petclinic sample</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;form:form method="delete"&gt;
      &lt;p class="submit"&gt;&lt;input type="submit" value="Delete Pet"/&gt;&lt;/p&gt;
&lt;/form:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will actually perform an HTTP POST, with the <em>real</em> DELETE method hidden behind a request parameter, to be picked up by the <code class="class">HiddenHttpMethodFilter</code>, as defined in web.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>&lt;filter&gt;
    &lt;filter-name&gt;httpMethodFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;httpMethodFilter&lt;/filter-name&gt;
    &lt;servlet-name&gt;petclinic&lt;/servlet-name&gt;
&lt;/filter-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding @Controller method is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@RequestMapping(method = RequestMethod.DELETE)
public String deletePet(@PathVariable int ownerId, @PathVariable int petId) {
  this.clinic.deletePet(petId);
  return "redirect:/owners/" + ownerId;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="html5-tags"><a class="anchor" href="#html5-tags"></a>HTML5 Tags</h4>
<div class="paragraph">
<p>Starting with Spring 3, the Spring form tag library allows entering dynamic attributes, which means you can enter any HTML5 specific attributes.</p>
</div>
<div class="paragraph">
<p>In Spring 3.1, the form input tag supports entering a type attribute other than <em>text</em>.
This is intended to allow rendering new HTML5 specific input types such as <em>email</em>, <em>date</em>, <em>range</em>, and others.
Note that entering type=<em>text</em> is not required since <em>text</em> is the default type.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tiles"><a class="anchor" href="#tiles"></a>Tiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to integrate Tiles - just as any other view technology - in web applications using Spring.
The following describes in a broad way how to do this.</p>
</div>
<div class="paragraph">
<p><em>NOTE:</em> This section focuses on Spring&#8217;s support for Tiles 2 (the standalone version of Tiles, requiring Java 5+) in the <code>org.springframework.web.servlet.view.tiles2</code> package as as well as Tiles 3 in the <code>org.springframework.web.servlet.view.tiles3</code> package.
Spring also continues to support Tiles 1.x (a.k.a.
"Struts Tiles", as shipped with Struts 1.1+; compatible with Java 1.4) in the original <code>org.springframework.web.servlet.view.tiles</code> package.</p>
</div>
<div class="sect2">
<h3 id="dependencies"><a class="anchor" href="#dependencies"></a>Dependencies</h3>
<div class="paragraph">
<p>To be able to use Tiles you have to have a couple of additional dependencies included in your project.
The following is the list of dependencies you need.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Tiles version 2.1.2 or higher</code></p>
</li>
<li>
<p><code>Commons BeanUtils</code></p>
</li>
<li>
<p><code>Commons Digester</code></p>
</li>
<li>
<p><code>Commons Logging</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="how-to-integrate-tiles"><a class="anchor" href="#how-to-integrate-tiles"></a>How to integrate Tiles</h3>
<div class="paragraph">
<p>To be able to use Tiles, you have to configure it using files containing definitions (for basic information on definitions and other Tiles concepts, please have a look at &lt;&lt;,&gt;&gt;).
In Spring this is done using the <code class="class">TilesConfigurer</code>.
Have a look at the following piece of example ApplicationContext configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="tilesConfigurer" class="org.springframework.web.servlet.view.tiles2.TilesConfigurer"&gt;
  &lt;property name="definitions"&gt;
    &lt;list&gt;
      &lt;value&gt;/WEB-INF/defs/general.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/widgets.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/administrator.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/customer.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/templates.xml&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, there are five files containing definitions, which are all located in the <code class="file">'WEB-INF/defs'</code> directory.
At initialization of the <code class="interface">WebApplicationContext</code>, the files will be loaded and the definitions factory will be initialized.
After that has been done, the Tiles includes in the definition files can be used as views within your Spring web application.
To be able to use the views you have to have a <code class="interface">ViewResolver</code> just as with any other view technology used with Spring.
Below you can find two possibilities, the <code class="class">UrlBasedViewResolver</code> and the <code class="class">ResourceBundleViewResolver</code>.</p>
</div>
<div class="sect3">
<h4 id="code-class-class-urlbasedviewresolver-code"><a class="anchor" href="#code-class-class-urlbasedviewresolver-code"></a><code class="class">UrlBasedViewResolver</code></h4>
<div class="paragraph">
<p>The <code class="class">UrlBasedViewResolver</code> instantiates the given <code>viewClass</code> for each view it has to resolve.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.UrlBasedViewResolver"&gt;
  &lt;property name="viewClass" value="org.springframework.web.servlet.view.tiles2.TilesView"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="code-class-class-resourcebundleviewresolver-code"><a class="anchor" href="#code-class-class-resourcebundleviewresolver-code"></a><code class="class">ResourceBundleViewResolver</code></h4>
<div class="paragraph">
<p>The <code class="class">ResourceBundleViewResolver</code> has to be provided with a property file containing viewnames and viewclasses the resolver can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.ResourceBundleViewResolver"&gt;
  &lt;property name="basename" value="views"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>...
welcomeView.(class)=org.springframework.web.servlet.view.tiles2.TilesView
welcomeView.url=welcome (this is the name of a Tiles definition)

vetsView.(class)=org.springframework.web.servlet.view.tiles2.TilesView
vetsView.url=vetsView (again, this is the name of a Tiles definition)

findOwnersForm.(class)=org.springframework.web.servlet.view.JstlView
findOwnersForm.url=/WEB-INF/jsp/findOwners.jsp
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, when using the <code class="class">ResourceBundleViewResolver</code>, you can easily mix different view technologies.</p>
</div>
<div class="paragraph">
<p>Note that the <code class="class">TilesView</code> class for Tiles 2 supports JSTL (the JSP Standard Tag Library) out of the box, whereas there is a separate <code class="class">TilesJstlView</code> subclass in the Tiles 1.x support.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-class-class-simplespringpreparerfactory-code-and-code-class-class-springbeanpreparerfactory-code"><a class="anchor" href="#code-class-class-simplespringpreparerfactory-code-and-code-class-class-springbeanpreparerfactory-code"></a><code class="class">SimpleSpringPreparerFactory</code> and <code class="class">SpringBeanPreparerFactory</code></h4>
<div class="paragraph">
<p>As an advanced feature, Spring also supports two special Tiles 2 <code class="interface">PreparerFactory</code> implementations.
Check out the Tiles documentation for details on how to use <code class="interface">ViewPreparer</code> references in your Tiles definition files.</p>
</div>
<div class="paragraph">
<p>Specify <code class="class">SimpleSpringPreparerFactory</code> to autowire ViewPreparer instances based on specified preparer classes, applying Spring&#8217;s container callbacks as well as applying configured Spring BeanPostProcessors.
If Spring&#8217;s context-wide annotation-config has been activated, annotations in ViewPreparer classes will be automatically detected and applied.
Note that this expects preparer <em>classes</em> in the Tiles definition files, just like the default <code class="class">PreparerFactory</code> does.</p>
</div>
<div class="paragraph">
<p>Specify <code class="class">SpringBeanPreparerFactory</code> to operate on specified preparer <em>names</em> instead of classes, obtaining the corresponding Spring bean from the DispatcherServlet&#8217;s application context.
The full bean creation process will be in the control of the Spring application context in this case, allowing for the use of explicit dependency injection configuration, scoped beans etc.
Note that you need to define one Spring bean definition per preparer name (as used in your Tiles definitions).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="tilesConfigurer" class="org.springframework.web.servlet.view.tiles2.TilesConfigurer"&gt;
  &lt;property name="definitions"&gt;
    &lt;list&gt;
      &lt;value&gt;/WEB-INF/defs/general.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/widgets.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/administrator.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/customer.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/templates.xml&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;

  &lt;!-- resolving preparer names as Spring bean definition names --&gt;
  &lt;property name="preparerFactoryClass"
       value="org.springframework.web.servlet.view.tiles2.SpringBeanPreparerFactory"/&gt;

&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="velocity-freemarker"><a class="anchor" href="#velocity-freemarker"></a>Velocity &amp; FreeMarker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&lt;&lt;,Velocity&gt;&gt; and &lt;&lt;,FreeMarker&gt;&gt; are two templating languages that can be used as view technologies within Spring MVC applications.
The languages are quite similar and serve similar needs and so are considered together in this section.
For semantic and syntactic differences between the two languages, see the &lt;&lt;,FreeMarker&gt;&gt; web site.</p>
</div>
<div class="sect2">
<h3 id="dependencies-2"><a class="anchor" href="#dependencies-2"></a>Dependencies</h3>
<div class="paragraph">
<p>Your web application will need to include <code class="file">velocity-1.x.x.jar</code> or <code class="file">freemarker-2.x.jar</code> in order to work with Velocity or FreeMarker respectively and <code class="file">commons-collections.jar</code> is required for Velocity.
Typically they are included in the <code>WEB-INF/lib</code> folder where they are guaranteed to be found by a Java EE server and added to the classpath for your application.
It is of course assumed that you already have the <code class="file">spring-webmvc.jar</code> in your <code class="file">'WEB-INF/lib'</code> directory too! If you make use of Spring&#8217;s <em>dateToolAttribute</em> or <em>numberToolAttribute</em> in your Velocity views, you will also need to include the <code class="file">velocity-tools-generic-1.x.jar</code></p>
</div>
</div>
<div class="sect2">
<h3 id="context-configuration"><a class="anchor" href="#context-configuration"></a>Context configuration</h3>
<div class="paragraph">
<p>A suitable configuration is initialized by adding the relevant configurer bean definition to your <code class="file">'*-servlet.xml'</code> as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!--
  This bean sets up the Velocity environment for us based on a root path for templates.
  Optionally, a properties file can be specified for more control over the Velocity
  environment, but the defaults are pretty sane for file based template loading.
--&gt;
&lt;bean id="velocityConfig" class="org.springframework.web.servlet.view.velocity.VelocityConfigurer"&gt;
  &lt;property name="resourceLoaderPath" value="/WEB-INF/velocity/"/&gt;
&lt;/bean&gt;

&lt;!--

  View resolvers can also be configured with ResourceBundles or XML files. If you need
  different view resolving based on Locale, you have to use the resource bundle resolver.

--&gt;
&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.velocity.VelocityViewResolver"&gt;
  &lt;property name="cache" value="true"/&gt;
  &lt;property name="prefix" value=""/&gt;
  &lt;property name="suffix" value=".vm"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>&lt;!-- freemarker config --&gt;
&lt;bean id="freemarkerConfig" class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"&gt;
  &lt;property name="templateLoaderPath" value="/WEB-INF/freemarker/"/&gt;
&lt;/bean&gt;

&lt;!--

  View resolvers can also be configured with ResourceBundles or XML files. If you need
  different view resolving based on Locale, you have to use the resource bundle resolver.

--&gt;
&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver"&gt;
  &lt;property name="cache" value="true"/&gt;
  &lt;property name="prefix" value=""/&gt;
  &lt;property name="suffix" value=".ftl"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
For non web-apps add a <code class="class">VelocityConfigurationFactoryBean</code> or a <code class="class">FreeMarkerConfigurationFactoryBean</code> to your application context definition file.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="creating-templates"><a class="anchor" href="#creating-templates"></a>Creating templates</h3>
<div class="paragraph">
<p>Your templates need to be stored in the directory specified by the <code>*Configurer</code> bean shown above.
This document does not cover details of creating templates for the two languages - please see their relevant websites for information.
If you use the view resolvers highlighted, then the logical view names relate to the template file names in similar fashion to <code class="class">InternalResourceViewResolver</code> for JSP&#8217;s.
So if your controller returns a ModelAndView object containing a view name of "welcome" then the resolvers will look for the <code>/WEB-INF/freemarker/welcome.ftl</code> or <code>/WEB-INF/velocity/welcome.vm</code> template as appropriate.</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced-configuration"><a class="anchor" href="#advanced-configuration"></a>Advanced configuration</h3>
<div class="paragraph">
<p>The basic configurations highlighted above will be suitable for most application requirements, however additional configuration options are available for when unusual or advanced requirements dictate.</p>
</div>
<div class="sect3">
<h4 id="velocity-properties"><a class="anchor" href="#velocity-properties"></a>velocity.properties</h4>
<div class="paragraph">
<p>This file is completely optional, but if specified, contains the values that are passed to the Velocity runtime in order to configure velocity itself.
Only required for advanced configurations, if you need this file, specify its location on the <code>VelocityConfigurer</code> bean definition above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="velocityConfig" class="org.springframework.web.servlet.view.velocity.VelocityConfigurer"&gt;
  &lt;property name="configLocation" value="/WEB-INF/velocity.properties"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can specify velocity properties directly in the bean definition for the Velocity config bean by replacing the "configLocation" property with the following inline properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="velocityConfig" class="org.springframework.web.servlet.view.velocity.VelocityConfigurer"&gt;
  &lt;property name="velocityProperties"&gt;
    &lt;props&gt;
      &lt;prop key="resource.loader"&gt;file&lt;/prop&gt;
      &lt;prop key="file.resource.loader.class"&gt;
        org.apache.velocity.runtime.resource.loader.FileResourceLoader
      &lt;/prop&gt;
      &lt;prop key="file.resource.loader.path"&gt;${webapp.root}/WEB-INF/velocity&lt;/prop&gt;
      &lt;prop key="file.resource.loader.cache"&gt;false&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to the &lt;&lt;,API
        documentation&gt;&gt; for Spring configuration of Velocity, or the Velocity documentation for examples and definitions of the <code class="file">'velocity.properties'</code> file itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="freemarker"><a class="anchor" href="#freemarker"></a>FreeMarker</h4>
<div class="paragraph">
<p>FreeMarker <em>Settings</em> and <em>SharedVariables</em> can be passed directly to the FreeMarker <code>Configuration</code> object managed by Spring by setting the appropriate bean properties on the <code>FreeMarkerConfigurer</code> bean.
The <code>freemarkerSettings</code> property requires a <code>java.util.Properties</code> object and the <code>freemarkerVariables</code> property requires a <code>java.util.Map</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="freemarkerConfig" class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"&gt;
  &lt;property name="templateLoaderPath" value="/WEB-INF/freemarker/"/&gt;
  &lt;property name="freemarkerVariables"&gt;
    &lt;map&gt;
      &lt;entry key="xml_escape" value-ref="fmXmlEscape"/&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="fmXmlEscape" class="freemarker.template.utility.XmlEscape"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the FreeMarker documentation for details of settings and variables as they apply to the <code class="class">Configuration</code> object.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bind-support-and-form-handling"><a class="anchor" href="#bind-support-and-form-handling"></a>Bind support and form handling</h3>
<div class="paragraph">
<p>Spring provides a tag library for use in JSP&#8217;s that contains (amongst other things) a <code>&lt;spring:bind/&gt;</code> tag.
This tag primarily enables forms to display values from form backing objects and to show the results of failed validations from a <code>Validator</code> in the web or business tier.
From version 1.1, Spring now has support for the same functionality in both Velocity and FreeMarker, with additional convenience macros for generating form input elements themselves.</p>
</div>
<div class="sect3">
<h4 id="the-bind-macros"><a class="anchor" href="#the-bind-macros"></a>The bind macros</h4>
<div class="paragraph">
<p>A standard set of macros are maintained within the <code>spring-webmvc.jar</code> file for both languages, so they are always available to a suitably configured application.</p>
</div>
<div class="paragraph">
<p>Some of the macros defined in the Spring libraries are considered internal (private) but no such scoping exists in the macro definitions making all macros visible to calling code and user templates.
The following sections concentrate only on the macros you need to be directly calling from within your templates.
If you wish to view the macro code directly, the files are called spring.vm / spring.ftl and are in the packages <code>org.springframework.web.servlet.view.velocity</code> or <code>org.springframework.web.servlet.view.freemarker</code> respectively.</p>
</div>
</div>
<div class="sect3">
<h4 id="simple-binding"><a class="anchor" href="#simple-binding"></a>Simple binding</h4>
<div class="paragraph">
<p>In your html forms (vm / ftl templates) that act as the <em>formView</em> for a Spring form controller, you can use code similar to the following to bind to field values and display error messages for each input field in similar fashion to the JSP equivalent.
Note that the name of the command object is "command" by default, but can be overridden in your MVC configuration by setting the <em>commandName</em> bean property on your form controller.
Example code is shown below for the <code>personFormV</code> and <code>personFormF</code> views configured earlier;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- velocity macros are automatically available --&gt;
&lt;html&gt;
...
&lt;form action="" method="POST"&gt;
  Name:
  #springBind( "command.name" )
  &lt;input type="text"
    name="${status.expression}"
    value="$!status.value" /&gt;&lt;br&gt;
  #foreach($error in $status.errorMessages) &lt;b&gt;$error&lt;/b&gt; &lt;br&gt; #end
  &lt;br&gt;
  ...
  &lt;input type="submit" value="submit"/&gt;
&lt;/form&gt;
...
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- freemarker macros have to be imported into a namespace.  We strongly
recommend sticking to 'spring' --&gt;
&lt;#import "/spring.ftl" as spring /&gt;
&lt;html&gt;
...
&lt;form action="" method="POST"&gt;
  Name:
  &lt;@spring.bind "command.name" /&gt;
  &lt;input type="text"
    name="${spring.status.expression}"
    value="${spring.status.value?default("")}" /&gt;&lt;br&gt;
  &lt;#list spring.status.errorMessages as error&gt; &lt;b&gt;${error}&lt;/b&gt; &lt;br&gt; &lt;/#list&gt;
  &lt;br&gt;
  ...
  &lt;input type="submit" value="submit"/&gt;
&lt;/form&gt;
...
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>#springBind</code> / <code>&lt;@spring.bind&gt;</code> requires a <em>path</em> argument which consists of the name of your command object (it will be <em>command</em> unless you changed it in your FormController properties) followed by a period and the name of the field on the command object you wish to bind to.
Nested fields can be used too such as "command.address.street".
The <code>bind</code> macro assumes the default HTML escaping behavior specified by the ServletContext parameter <code>defaultHtmlEscape</code> in web.xml</p>
</div>
<div class="paragraph">
<p>The optional form of the macro called <code>#springBindEscaped</code> / <code>&lt;@spring.bindEscaped&gt;</code> takes a second argument and explicitly specifies whether HTML escaping should be used in the status error messages or values.
Set to true or false as required.
Additional form handling macros simplify the use of HTML escaping and these macros should be used wherever possible.
They are explained in the next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="form-input-generation-macros"><a class="anchor" href="#form-input-generation-macros"></a>Form input generation macros</h4>
<div class="paragraph">
<p>Additional convenience macros for both languages simplify both binding and form generation (including validation error display).
It is never necessary to use these macros to generate form input fields, and they can be mixed and matched with simple HTML or calls direct to the spring bind macros highlighted previously.</p>
</div>
<div class="paragraph">
<p>The following table of available macros show the VTL and FTL definitions and the parameter list that each takes.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 7. Table of macro definitions</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">macro</th>
<th class="tableblock halign-left valign-top">VTL definition</th>
<th class="tableblock halign-left valign-top">FTL definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message (output a
                string from a resource bundle based on the code
                parameter)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springMessage($code)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.message
                code/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messageText (output a
                string from a resource bundle based on the code parameter,
                falling back to the value of the default parameter)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springMessageText($code
                $text)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.messageText code,
                text/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url (prefix a relative
                URL with the application&#8217;s context root)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springUrl($relativeUrl)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.url
                relativeUrl/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formInput (standard
                input field for gathering user input)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springFormInput($path
                $attributes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.formInput path, attributes,
                fieldType/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formHiddenInput *
                (hidden input field for submitting non-user input)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springFormHiddenInput($path
                $attributes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.formHiddenInput path,
                attributes/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formPasswordInput *
                (standard input field for gathering passwords. Note that no
                value will ever be populated in fields of this type)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springFormPasswordInput($path
                $attributes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.formPasswordInput path,
                attributes/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formTextarea (large
                text field for gathering long, freeform text input)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springFormTextarea($path
                $attributes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.formTextarea path,
                attributes/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formSingleSelect (drop
                down box of options allowing a single required value to be
                selected)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springFormSingleSelect( $path $options
                $attributes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.formSingleSelect path, options,
                attributes/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formMultiSelect (a
                list box of options allowing the user to select 0 or more
                values)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springFormMultiSelect($path $options
                $attributes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.formMultiSelect path, options,
                attributes/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formRadioButtons (a
                set of radio buttons allowing a single selection to be made
                from the available choices)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springFormRadioButtons($path $options
                $separator $attributes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.formRadioButtons path, options
                separator, attributes/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formCheckboxes (a set
                of checkboxes allowing 0 or more values to be
                selected)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springFormCheckboxes($path $options
                $separator $attributes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.formCheckboxes path, options,
                separator, attributes/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formCheckbox (a single
                checkbox)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springFormCheckbox($path
                $attributes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.formCheckbox path,
                attributes/&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">showErrors (simplify
                display of validation errors for the bound field)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#springShowErrors($separator
                $classOrStyle)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;@spring.showErrors separator,
                classOrStyle/&gt;</p></td>
</tr>
</tbody>
</table>

<div class="ulist">
<ul>
<li>
<p>In FTL (FreeMarker), these two macros are not actually required as you can use the normal <code>formInput</code> macro, specifying <em><code>hidden</code></em> or <em><code>password</code></em> as the value for the <code>fieldType</code> parameter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The parameters to any of the above macros have consistent meanings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>path: the name of the field to bind to (ie "command.name")</p>
</li>
<li>
<p>options: a Map of all the available values that can be selected from in the input field.
The keys to the map represent the values that will be POSTed back from the form and bound to the command object.
Map objects stored against the keys are the labels displayed on the form to the user and may be different from the corresponding values posted back by the form.
Usually such a map is supplied as reference data by the controller.
Any Map implementation can be used depending on required behavior.
For strictly sorted maps, a <code>SortedMap</code> such as a <code>TreeMap</code> with a suitable Comparator may be used and for arbitrary Maps that should return values in insertion order, use a <code>LinkedHashMap</code> or a <code>LinkedMap</code> from commons-collections.</p>
</li>
<li>
<p>separator: where multiple options are available as discreet elements (radio buttons or checkboxes), the sequence of characters used to separate each one in the list (ie "&lt;br&gt;").</p>
</li>
<li>
<p>attributes: an additional string of arbitrary tags or text to be included within the HTML tag itself.
This string is echoed literally by the macro.
For example, in a textarea field you may supply attributes as <em>rows="5" cols="60"</em> or you could pass style information such as <em>style="border:1px solid silver"</em>.</p>
</li>
<li>
<p>classOrStyle: for the showErrors macro, the name of the CSS class that the span tag wrapping each error will use.
If no information is supplied (or the value is empty) then the errors will be wrapped in &lt;b&gt;&lt;/b&gt; tags.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples of the macros are outlined below some in FTL and some in VTL. Where usage differences exist between the two languages, they are explained in the notes.</p>
</div>
<div class="sect4">
<h5 id="input-fields"><a class="anchor" href="#input-fields"></a>Input Fields</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- the Name field example from above using form macros in VTL --&gt;
...
    Name:
    #springFormInput("command.name" "")&lt;br&gt;
    #springShowErrors("&lt;br&gt;" "")&lt;br&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The formInput macro takes the path parameter (command.name) and an additional attributes parameter which is empty in the example above.
The macro, along with all other form generation macros, performs an implicit spring bind on the path parameter.
The binding remains valid until a new bind occurs so the showErrors macro doesn&#8217;t need to pass the path parameter again - it simply operates on whichever field a bind was last created for.</p>
</div>
<div class="paragraph">
<p>The showErrors macro takes a separator parameter (the characters that will be used to separate multiple errors on a given field) and also accepts a second parameter, this time a class name or style attribute.
Note that FreeMarker is able to specify default values for the attributes parameter, unlike Velocity, and the two macro calls above could be expressed as follows in FTL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;@spring.formInput "command.name"/&gt;
&lt;@spring.showErrors "&lt;br&gt;"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output is shown below of the form fragment generating the name field, and displaying a validation error after the form was submitted with no value in the field.
Validation occurs through Spring&#8217;s Validation framework.</p>
</div>
<div class="paragraph">
<p>The generated HTML looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>Name:
  &lt;input type="text" name="name" value=""
&gt;
&lt;br&gt;
  &lt;b&gt;required&lt;/b&gt;
&lt;br&gt;
&lt;br&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The formTextarea macro works the same way as the formInput macro and accepts the same parameter list.
Commonly, the second parameter (attributes) will be used to pass style information or rows and cols attributes for the textarea.</p>
</div>
</div>
<div class="sect4">
<h5 id="selection-fields"><a class="anchor" href="#selection-fields"></a>Selection Fields</h5>
<div class="paragraph">
<p>Four selection field macros can be used to generate common UI value selection inputs in your HTML forms.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>formSingleSelect</p>
</li>
<li>
<p>formMultiSelect</p>
</li>
<li>
<p>formRadioButtons</p>
</li>
<li>
<p>formCheckboxes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of the four macros accepts a Map of options containing the value for the form field, and the label corresponding to that value.
The value and the label can be the same.</p>
</div>
<div class="paragraph">
<p>An example of radio buttons in FTL is below.
The form backing object specifies a default value of <em>London</em> for this field and so no validation is necessary.
When the form is rendered, the entire list of cities to choose from is supplied as reference data in the model under the name <em>cityMap</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>...
  Town:
  &lt;@spring.formRadioButtons "command.address.town", cityMap, "" /&gt;&lt;br&gt;&lt;br&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This renders a line of radio buttons, one for each value in <code>cityMap</code> using the separator "".
No additional attributes are supplied (the last parameter to the macro is missing).
The cityMap uses the same String for each key-value pair in the map.
The map&#8217;s keys are what the form actually submits as POSTed request parameters, map values are the labels that the user sees.
In the example above, given a list of three well known cities and a default value in the form backing object, the HTML would be</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>Town:
&lt;input type="radio" name="address.town" value="London"

&gt;
London
&lt;input type="radio" name="address.town" value="Paris"
  checked="checked"
&gt;
Paris
&lt;input type="radio" name="address.town" value="New York"

&gt;
New York</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your application expects to handle cities by internal codes for example, the map of codes would be created with suitable keys like the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>protected Map referenceData(HttpServletRequest request) throws Exception {
  Map cityMap = new LinkedHashMap();
  cityMap.put("LDN", "London");
  cityMap.put("PRS", "Paris");
  cityMap.put("NYC", "New York");

  Map m = new HashMap();
  m.put("cityMap", cityMap);
  return m;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code would now produce output where the radio values are the relevant codes but the user still sees the more user friendly city names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>Town:
&lt;input type="radio" name="address.town" value="LDN"

&gt;
London
&lt;input type="radio" name="address.town" value="PRS"
  checked="checked"
&gt;
Paris
&lt;input type="radio" name="address.town" value="NYC"

&gt;
New York</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="html-escaping-and-xhtml-compliance"><a class="anchor" href="#html-escaping-and-xhtml-compliance"></a>HTML escaping and XHTML compliance</h4>
<div class="paragraph">
<p>Default usage of the form macros above will result in HTML tags that are HTML 4.01 compliant and that use the default value for HTML escaping defined in your web.xml as used by Spring&#8217;s bind support.
In order to make the tags XHTML compliant or to override the default HTML escaping value, you can specify two variables in your template (or in your model where they will be visible to your templates).
The advantage of specifying them in the templates is that they can be changed to different values later in the template processing to provide different behavior for different fields in your form.</p>
</div>
<div class="paragraph">
<p>To switch to XHTML compliance for your tags, specify a value of <em>true</em> for a model/context variable named xhtmlCompliant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>## for Velocity..
#set($springXhtmlCompliant = true)

&lt;#-- for FreeMarker --&gt;
&lt;#assign xhtmlCompliant = true in spring&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any tags generated by the Spring macros will now be XHTML compliant after processing this directive.</p>
</div>
<div class="paragraph">
<p>In similar fashion, HTML escaping can be specified per field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;#-- until this point, default HTML escaping is used --&gt;

&lt;#assign htmlEscape = true in spring&gt;
&lt;#-- next field will use HTML escaping --&gt;
&lt;@spring.formInput "command.name" /&gt;

&lt;#assign htmlEscape = false in spring&gt;
&lt;#-- all future fields will be bound with HTML escaping off --&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xslt"><a class="anchor" href="#xslt"></a>XSLT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>XSLT is a transformation language for XML and is popular as a view technology within web applications.
XSLT can be a good choice as a view technology if your application naturally deals with XML, or if your model can easily be converted to XML. The following section shows how to produce an XML document as model data and have it transformed with XSLT in a Spring Web MVC application.</p>
</div>
<div class="sect2">
<h3 id="my-first-words"><a class="anchor" href="#my-first-words"></a>My First Words</h3>
<div class="paragraph">
<p>This example is a trivial Spring application that creates a list of words in the <code class="interface">Controller</code> and adds them to the model map.
The map is returned along with the view name of our XSLT view.
See <a href="#mvc-controller">[mvc-controller]</a> for details of Spring Web MVC&#8217;s <code class="interface">Controller</code> interface.
The XSLT view will turn the list of words into a simple XML document ready for transformation.</p>
</div>
<div class="sect3">
<h4 id="bean-definitions"><a class="anchor" href="#bean-definitions"></a>Bean definitions</h4>
<div class="paragraph">
<p>Configuration is standard for a simple Spring application.
The dispatcher servlet config file contains a reference to a <code class="interface">ViewResolver</code>, URL mappings and a single controller bean&#8230;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="homeController"class="xslt.HomeController"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;
that encapsulates our word generation logic.</p>
</div>
</div>
<div class="sect3">
<h4 id="standard-mvc-controller-code"><a class="anchor" href="#standard-mvc-controller-code"></a>Standard MVC controller code</h4>
<div class="paragraph">
<p>The controller logic is encapsulated in a subclass of <code class="class">AbstractController</code>, with the handler method being defined like so&#8230;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>protected ModelAndView handleRequestInternal(
    HttpServletRequest request,
    HttpServletResponse response) throws Exception {

    Map map = new HashMap();
    List wordList = new ArrayList();

    wordList.add("hello");
    wordList.add("world");

    map.put("wordList", wordList);

    return new ModelAndView("home", map);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So far we&#8217;ve done nothing that&#8217;s XSLT specific.
The model data has been created in the same way as you would for any other Spring MVC application.
Depending on the configuration of the application now, that list of words could be rendered by JSP/JSTL by having them added as request attributes, or they could be handled by Velocity by adding the object to the <code class="class">VelocityContext</code>.
In order to have XSLT render them, they of course have to be converted into an XML document somehow.
There are software packages available that will automatically <em>domify</em> an object graph, but within Spring, you have complete flexibility to create the DOM from your model in any way you choose.
This prevents the transformation of XML playing too great a part in the structure of your model data which is a danger when using tools to manage the domification process.</p>
</div>
</div>
<div class="sect3">
<h4 id="convert-the-model-data-to-xml"><a class="anchor" href="#convert-the-model-data-to-xml"></a>Convert the model data to XML</h4>
<div class="paragraph">
<p>In order to create a DOM document from our list of words or any other model data, we must subclass the (provided) <code class="class">org.springframework.web.servlet.view.xslt.AbstractXsltView</code> class.
In doing so, we must also typically implement the abstract method <code class="method">createXsltSource(..)</code> method.
The first parameter passed to this method is our model map.
Here&#8217;s the complete listing of the <code class="class">HomePage</code> class in our trivial word application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
package xslt;

// imports omitted for brevity

public class HomePage extends AbstractXsltView {

    protected Source createXsltSource(Map model, String rootName, HttpServletRequest
        request, HttpServletResponse response) throws Exception {

        Document document = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();
        Element root = document.createElement(rootName);

        List words = (List) model.get("wordList");
        for (Iterator it = words.iterator(); it.hasNext();) {
            String nextWord = (String) it.next();
            Element wordNode = document.createElement("word");
            Text textNode = document.createTextNode(nextWord);
            wordNode.appendChild(textNode);
            root.appendChild(wordNode);
        }
        return new DOMSource(root);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A series of parameter name/value pairs can optionally be defined by your subclass which will be added to the transformation object.
The parameter names must match those defined in your XSLT template declared with <code>&lt;xsl:param
        name="myParam"&gt;defaultValue&lt;/xsl:param&gt;</code>.
To specify the parameters, override the <code class="method">getParameters()</code> method of the <code class="class">AbstractXsltView</code> class and return a <code class="interface">Map</code> of the name/value pairs.
If your parameters need to derive information from the current request, you can override the <code class="method">getParameters(HttpServletRequest
        request)</code> method instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="defining-the-view-properties"><a class="anchor" href="#defining-the-view-properties"></a>Defining the view properties</h4>
<div class="paragraph">
<p>The views.properties file (or equivalent xml definition if you&#8217;re using an XML based view resolver as we did in the Velocity examples above) looks like this for the one-view application that is <em>My First Words</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>home.(class)=xslt.HomePage
home.stylesheetLocation=/WEB-INF/xsl/home.xslt
home.root=words</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, you can see how the view is tied in with the <code class="class">HomePage</code> class just written which handles the model domification in the first property <code>'.(class)'</code>.
The <code>'stylesheetLocation'</code> property points to the XSLT file which will handle the XML transformation into HTML for us and the final property <code>'.root'</code> is the name that will be used as the root of the XML document.
This gets passed to the <code class="class">HomePage</code> class above in the second parameter to the <code class="method">createXsltSource(..)</code> method(s).</p>
</div>
</div>
<div class="sect3">
<h4 id="document-transformation"><a class="anchor" href="#document-transformation"></a>Document transformation</h4>
<div class="paragraph">
<p>Finally, we have the XSLT code used for transforming the above document.
As shown in the above <code class="file">'views.properties'</code> file, the stylesheet is called <code class="file">'home.xslt'</code> and it lives in the war file in the <code class="file">'WEB-INF/xsl'</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

    &lt;xsl:output method="html" omit-xml-declaration="yes"/&gt;

    &lt;xsl:template match="/"&gt;
        &lt;html&gt;
            &lt;head&gt;&lt;title&gt;Hello!&lt;/title&gt;&lt;/head&gt;
            &lt;body&gt;
                &lt;h1&gt;My First Words&lt;/h1&gt;
                &lt;xsl:apply-templates/&gt;
            &lt;/body&gt;
        &lt;/html&gt;
    &lt;/xsl:template&gt;

    &lt;xsl:template match="word"&gt;
        &lt;xsl:value-of select="."/&gt;&lt;br/&gt;
    &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="summary"><a class="anchor" href="#summary"></a>Summary</h3>
<div class="paragraph">
<p>A summary of the files discussed and their location in the WAR file is shown in the simplified WAR structure below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>ProjectRoot
  |
  +- WebContent
      |
      +- WEB-INF
          |
          +- classes
          |    |
          |    +- xslt
          |    |   |
          |    |   +- HomePageController.class
          |    |   +- HomePage.class
          |    |
          |    +- views.properties
          |
          +- lib
          |   |
          |   +- spring-*.jar
          |
          +- xsl
          |   |
          |   +- home.xslt
          |
          +- frontcontroller-servlet.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will also need to ensure that an XML parser and an XSLT engine are available on the classpath.
JDK 1.4 provides them by default, and most Java EE containers will also make them available by default, but it&#8217;s a possible source of errors to be aware of.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-views-pdf-excel"><a class="anchor" href="#document-views-pdf-excel"></a>Document views (PDF/Excel)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-4"><a class="anchor" href="#introduction-4"></a>Introduction</h3>
<div class="paragraph">
<p>Returning an HTML page isn&#8217;t always the best way for the user to view the model output, and Spring makes it simple to generate a PDF document or an Excel spreadsheet dynamically from the model data.
The document is the view and will be streamed from the server with the correct content type to (hopefully) enable the client PC to run their spreadsheet or PDF viewer application in response.</p>
</div>
<div class="paragraph">
<p>In order to use Excel views, you need to add the <em>poi</em> library to your classpath, and for PDF generation, the iText library.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-and-setup"><a class="anchor" href="#configuration-and-setup"></a>Configuration and setup</h3>
<div class="paragraph">
<p>Document based views are handled in an almost identical fashion to XSLT views, and the following sections build upon the previous one by demonstrating how the same controller used in the XSLT example is invoked to render the same model as both a PDF document and an Excel spreadsheet (which can also be viewed or manipulated in Open Office).</p>
</div>
<div class="sect3">
<h4 id="document-view-definitions"><a class="anchor" href="#document-view-definitions"></a>Document view definitions</h4>
<div class="paragraph">
<p>First, let&#8217;s amend the views.properties file (or xml equivalent) and add a simple view definition for both document types.
The entire file now looks like this with the XSLT view shown from earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>home.(class)=xslt.HomePage
home.stylesheetLocation=/WEB-INF/xsl/home.xslt
home.root=words

xl.(class)=excel.HomePage

pdf.(class)=pdf.HomePage</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>If you want to start with a
        template spreadsheet or a fillable PDF form to add your model data to, specify the location
        as the <em>url</em> property in the view definition</em></p>
</div>
</div>
<div class="sect3">
<h4 id="controller-code"><a class="anchor" href="#controller-code"></a>Controller code</h4>
<div class="paragraph">
<p>The controller code we&#8217;ll use remains exactly the same from the XSLT example earlier other than to change the name of the view to use.
Of course, you could be clever and have this selected based on a URL parameter or some other logic - proof that Spring really is very good at decoupling the views from the controllers!</p>
</div>
</div>
<div class="sect3">
<h4 id="subclassing-for-excel-views"><a class="anchor" href="#subclassing-for-excel-views"></a>Subclassing for Excel views</h4>
<div class="paragraph">
<p>Exactly as we did for the XSLT example, we&#8217;ll subclass suitable abstract classes in order to implement custom behavior in generating our output documents.
For Excel, this involves writing a subclass of <code>org.springframework.web.servlet.view.document.AbstractExcelView</code> (for Excel files generated by POI) or <code>org.springframework.web.servlet.view.document.AbstractJExcelView</code> (for JExcelApi-generated Excel files) and implementing the <code>buildExcelDocument()</code> method.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the complete listing for our POI Excel view which displays the word list from the model map in consecutive rows of the first column of a new spreadsheet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package excel;

// imports omitted for brevity

public class HomePage extends AbstractExcelView {

    protected void buildExcelDocument(
        Map model,
        HSSFWorkbook wb,
        HttpServletRequest req,
        HttpServletResponse resp)
        throws Exception {

        HSSFSheet sheet;
        HSSFRow sheetRow;
        HSSFCell cell;

        // Go to the first sheet
        // getSheetAt: only if wb is created from an existing document
        // sheet = wb.getSheetAt(0);
        sheet = wb.createSheet("Spring");
        sheet.setDefaultColumnWidth((short) 12);

        // write a text at A1
        cell = getCell(sheet, 0, 0);
        setText(cell, "Spring-Excel test");

        List words = (List) model.get("wordList");
        for (int i=0; i &lt; words.size(); i++) {
            cell = getCell(sheet, 2+i, 0);
            setText(cell, (String) words.get(i));

        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following is a view generating the same Excel file, now using JExcelApi:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package excel;

// imports omitted for brevity

public class HomePage extends AbstractJExcelView {

    protected void buildExcelDocument(Map model,
        WritableWorkbook wb,
        HttpServletRequest request,
        HttpServletResponse response)
    throws Exception {

        WritableSheet sheet = wb.createSheet("Spring", 0);

        sheet.addCell(new Label(0, 0, "Spring-Excel test"));

        List words = (List) model.get("wordList");
        for (int i = 0; i &lt; words.size(); i++) {
            sheet.addCell(new Label(2+i, 0, (String) words.get(i)));
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the differences between the APIs.
We&#8217;ve found that the JExcelApi is somewhat more intuitive, and furthermore, JExcelApi has slightly better image-handling capabilities.
There have been memory problems with large Excel files when using JExcelApi however.</p>
</div>
<div class="paragraph">
<p>If you now amend the controller such that it returns <code>xl</code> as the name of the view (<code>return new
        ModelAndView("xl", map);</code>) and run your application again, you should find that the Excel spreadsheet is created and downloaded automatically when you request the same page as before.</p>
</div>
</div>
<div class="sect3">
<h4 id="subclassing-for-pdf-views"><a class="anchor" href="#subclassing-for-pdf-views"></a>Subclassing for PDF views</h4>
<div class="paragraph">
<p>The PDF version of the word list is even simpler.
This time, the class extends <code>org.springframework.web.servlet.view.document.AbstractPdfView</code> and implements the <code>buildPdfDocument()</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package pdf;

// imports omitted for brevity

public class PDFPage extends AbstractPdfView {

    protected void buildPdfDocument(
        Map model,
        Document doc,
        PdfWriter writer,
        HttpServletRequest req,
        HttpServletResponse resp)
        throws Exception {

        List words = (List) model.get("wordList");

        for (int i=0; i&lt;words.size(); i++)
            doc.add( new Paragraph((String) words.get(i)));

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again, amend the controller to return the <code>pdf</code> view with <code>return new
        ModelAndView("pdf", map);</code>, and reload the URL in your application.
This time a PDF document should appear listing each of the words in the model map.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jasperreports"><a class="anchor" href="#jasperreports"></a>JasperReports</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JasperReports (&lt;&lt;,&gt;&gt;) is a powerful open-source reporting engine that supports the creation of report designs using an easily understood XML file format.
JasperReports is capable of rendering reports in four different formats: CSV, Excel, HTML and PDF.</p>
</div>
<div class="sect2">
<h3 id="dependencies-3"><a class="anchor" href="#dependencies-3"></a>Dependencies</h3>
<div class="paragraph">
<p>Your application will need to include the latest release of JasperReports, which at the time of writing was 0.6.1.
JasperReports itself depends on the following projects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BeanShell</p>
</li>
<li>
<p>Commons BeanUtils</p>
</li>
<li>
<p>Commons Collections</p>
</li>
<li>
<p>Commons Digester</p>
</li>
<li>
<p>Commons Logging</p>
</li>
<li>
<p>iText</p>
</li>
<li>
<p>POI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JasperReports also requires a JAXP compliant XML parser.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-2"><a class="anchor" href="#configuration-2"></a>Configuration</h3>
<div class="paragraph">
<p>To configure JasperReports views in your Spring container configuration you need to define a <code class="interface">ViewResolver</code> to map view names to the appropriate view class depending on which format you want your report rendered in.</p>
</div>
<div class="sect3">
<h4 id="configuring-the-code-class-interface-viewresolver-code"><a class="anchor" href="#configuring-the-code-class-interface-viewresolver-code"></a>Configuring the <code class="interface">ViewResolver</code></h4>
<div class="paragraph">
<p>Typically, you will use the <code class="class">ResourceBundleViewResolver</code> to map view names to view classes and files in a properties file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.ResourceBundleViewResolver"&gt;
    &lt;property name="basename" value="views"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we&#8217;ve configured an instance of the <code class="class">ResourceBundleViewResolver</code> class that will look for view mappings in the resource bundle with base name <code>views</code>.
(The content of this file is described in the next section.)</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-view-s"><a class="anchor" href="#configuring-the-view-s"></a>Configuring the `View`s</h4>
<div class="paragraph">
<p>The Spring Framework contains five different <code class="interface">View</code> implementations for JasperReports, four of which correspond to one of the four output formats supported by JasperReports, and one that allows for the format to be determined at runtime:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 8. JasperReports <code class="interface">View</code> classes</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class Name</th>
<th class="tableblock halign-left valign-top">Render Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JasperReportsCsvView</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JasperReportsHtmlView</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JasperReportsPdfView</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JasperReportsXlsView</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JasperReportsMultiFormatView</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The view is decided
                upon at runtime</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Mapping one of these classes to a view name and a report file is a matter of adding the appropriate entries in the resource bundle configured in the previous section as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>simpleReport.(class)=org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView
simpleReport.url=/WEB-INF/reports/DataSourceReport.jasper</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the view with name <code>simpleReport</code> is mapped to the <code class="class">JasperReportsPdfView</code> class, causing the output of this report to be rendered in PDF format.
The <code>url</code> property of the view is set to the location of the underlying report file.</p>
</div>
</div>
<div class="sect3">
<h4 id="about-report-files"><a class="anchor" href="#about-report-files"></a>About Report Files</h4>
<div class="paragraph">
<p>JasperReports has two distinct types of report file: the design file, which has a <code>.jrxml</code> extension, and the compiled report file, which has a <code>.jasper</code> extension.
Typically, you use the JasperReports Ant task to compile your <code>.jrxml</code> design file into a <code>.jasper</code> file before deploying it into your application.
With the Spring Framework you can map either of these files to your report file and the framework will take care of compiling the <code>.jrxml</code> file on the fly for you.
You should note that after a <code>.jrxml</code> file is compiled by the Spring Framework, the compiled report is cached for the lifetime of the application.
Thus, to make changes to the file you will need to restart your application.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-code-class-class-jasperreportsmultiformatview-code"><a class="anchor" href="#using-code-class-class-jasperreportsmultiformatview-code"></a>Using <code class="class">JasperReportsMultiFormatView</code></h4>
<div class="paragraph">
<p>The <code class="class">JasperReportsMultiFormatView</code> allows for the report format to be specified at runtime.
The actual rendering of the report is delegated to one of the other JasperReports view classes - the <code class="class">JasperReportsMultiFormatView</code> class simply adds a wrapper layer that allows for the exact implementation to be specified at runtime.</p>
</div>
<div class="paragraph">
<p>The <code class="class">JasperReportsMultiFormatView</code> class introduces two concepts: the format key and the discriminator key.
The <code class="class">JasperReportsMultiFormatView</code> class uses the mapping key to look up the actual view implementation class, and it uses the format key to lookup up the mapping key.
From a coding perspective you add an entry to your model with the format key as the key and the mapping key as the value, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public ModelAndView handleSimpleReportMulti(HttpServletRequest request,
HttpServletResponse response) throws Exception {

  String uri = request.getRequestURI();
  String format = uri.substring(uri.lastIndexOf(".") + 1);

  Map model = getModel();
  model.put("format", format);

  return new ModelAndView("simpleReportMulti", model);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the mapping key is determined from the extension of the request URI and is added to the model under the default format key: <code>format</code>.
If you wish to use a different format key then you can configure this using the <code>formatKey</code> property of the <code class="class">JasperReportsMultiFormatView</code> class.</p>
</div>
<div class="paragraph">
<p>By default the following mapping key mappings are configured in <code class="class">JasperReportsMultiFormatView</code>:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 9. <code class="class">JasperReportsMultiFormatView</code> Default Mapping Key Mappings</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mapping Key</th>
<th class="tableblock halign-left valign-top">View Class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JasperReportsCsvView</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JasperReportsHtmlView</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JasperReportsPdfView</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JasperReportsXlsView</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>So in the example above a request to URI /foo/myReport.pdf would be mapped to the <code>JasperReportsPdfView</code> class.
You can override the mapping key to view class mappings using the <code>formatMappings</code> property of <code class="class">JasperReportsMultiFormatView</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="populating-the-code-class-class-modelandview-code"><a class="anchor" href="#populating-the-code-class-class-modelandview-code"></a>Populating the <code class="class">ModelAndView</code></h3>
<div class="paragraph">
<p>In order to render your report correctly in the format you have chosen, you must supply Spring with all of the data needed to populate your report.
For JasperReports this means you must pass in all report parameters along with the report datasource.
Report parameters are simple name/value pairs and can be added to the <code class="interface">Map</code> for your model as you would add any name/value pair.</p>
</div>
<div class="paragraph">
<p>When adding the datasource to the model you have two approaches to choose from.
The first approach is to add an instance of <code class="class">JRDataSource</code> or a <code class="interface">Collection</code> type to the model <code class="interface">Map</code> under any arbitrary key.
Spring will then locate this object in the model and treat it as the report datasource.
For example, you may populate your model like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>private Map getModel() {
  Map model = new HashMap();
  Collection beanData = getBeanData();
  model.put("myBeanData", beanData);
  return model;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second approach is to add the instance of <code>JRDataSource</code> or <code>Collection</code> under a specific key and then configure this key using the <code>reportDataKey</code> property of the view class.
In both cases Spring will wrap instances of <code>Collection</code> in a <code>JRBeanCollectionDataSource</code> instance.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>private Map getModel() {
  Map model = new HashMap();
  Collection beanData = getBeanData();
  Collection someData = getSomeData();
  model.put("myBeanData", beanData);
  model.put("someData", someData);
  return model;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that two <code>Collection</code> instances are being added to the model.
To ensure that the correct one is used, we simply modify our view configuration as appropriate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>simpleReport.(class)=org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView
simpleReport.url=/WEB-INF/reports/DataSourceReport.jasper
simpleReport.reportDataKey=myBeanData</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be aware that when using the first approach, Spring will use the first instance of <code>JRDataSource</code> or <code>Collection</code> that it encounters.
If you need to place multiple instances of <code>JRDataSource</code> or <code>Collection</code> into the model you need to use the second approach.</p>
</div>
</div>
<div class="sect2">
<h3 id="working-with-sub-reports"><a class="anchor" href="#working-with-sub-reports"></a>Working with Sub-Reports</h3>
<div class="paragraph">
<p>JasperReports provides support for embedded sub-reports within your master report files.
There are a wide variety of mechanisms for including sub-reports in your report files.
The easiest way is to hard code the report path and the SQL query for the sub report into your design files.
The drawback of this approach is obvious: the values are hard-coded into your report files reducing reusability and making it harder to modify and update report designs.
To overcome this you can configure sub-reports declaratively, and you can include additional data for these sub-reports directly from your controllers.</p>
</div>
<div class="sect3">
<h4 id="configuring-sub-report-files"><a class="anchor" href="#configuring-sub-report-files"></a>Configuring Sub-Report Files</h4>
<div class="paragraph">
<p>To control which sub-report files are included in a master report using Spring, your report file must be configured to accept sub-reports from an external source.
To do this you declare a parameter in your report file like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;parameter name="ProductsSubReport" class="net.sf.jasperreports.engine.JasperReport"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you define your sub-report to use this sub-report parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;subreport&gt;
    &lt;reportElement isPrintRepeatedValues="false" x="5" y="25" width="325"
        height="20" isRemoveLineWhenBlank="true" backcolor="#ffcc99"/&gt;
    &lt;subreportParameter name="City"&gt;
        &lt;subreportParameterExpression&gt;&lt;![CDATA[$F{city}]]&gt;&lt;/subreportParameterExpression&gt;
    &lt;/subreportParameter&gt;
    &lt;dataSourceExpression&gt;&lt;![CDATA[$P{SubReportData}]]&gt;&lt;/dataSourceExpression&gt;
    &lt;subreportExpression class="net.sf.jasperreports.engine.JasperReport"&gt;
                  &lt;![CDATA[$P{ProductsSubReport}]]&gt;&lt;/subreportExpression&gt;
&lt;/subreport&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines a master report file that expects the sub-report to be passed in as an instance of <code>net.sf.jasperreports.engine.JasperReports</code> under the parameter <code>ProductsSubReport</code>.
When configuring your Jasper view class, you can instruct Spring to load a report file and pass it into the JasperReports engine as a sub-report using the <code>subReportUrls</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;property name="subReportUrls"&gt;
    &lt;map&gt;
        &lt;entry key="ProductsSubReport" value="/WEB-INF/reports/subReportChild.jrxml"/&gt;
    &lt;/map&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the key of the <code class="interface">Map</code> corresponds to the name of the sub-report parameter in the report design file, and the entry is the URL of the report file.
Spring will load this report file, compiling it if necessary, and pass it into the JasperReports engine under the given key.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-sub-report-data-sources"><a class="anchor" href="#configuring-sub-report-data-sources"></a>Configuring Sub-Report Data Sources</h4>
<div class="paragraph">
<p>This step is entirely optional when using Spring to configure your sub-reports.
If you wish, you can still configure the data source for your sub-reports using static queries.
However, if you want Spring to convert data returned in your <code>ModelAndView</code> into instances of <code>JRDataSource</code> then you need to specify which of the parameters in your <code>ModelAndView</code> Spring should convert.
To do this, configure the list of parameter names using the <code>subReportDataKeys</code> property of your chosen view class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;property name="subReportDataKeys" value="SubReportData"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the key you supply <em>must</em> correspond to both the key used in your <code>ModelAndView</code> and the key used in your report design file.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-exporter-parameters"><a class="anchor" href="#configuring-exporter-parameters"></a>Configuring Exporter Parameters</h3>
<div class="paragraph">
<p>If you have special requirements for exporter configuration&#8201;&#8212;&#8201;perhaps you want a specific page size for your PDF report&#8201;&#8212;&#8201;you can configure these exporter parameters declaratively in your Spring configuration file using the <code>exporterParameters</code> property of the view class.
The <code>exporterParameters</code> property is typed as a <code class="interface">Map</code>.
In your configuration the key of an entry should be the fully-qualified name of a static field that contains the exporter parameter definition, and the value of an entry should be the value you want to assign to the parameter.
An example of this is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="htmlReport" class="org.springframework.web.servlet.view.jasperreports.JasperReportsHtmlView"&gt;
  &lt;property name="url" value="/WEB-INF/reports/simpleReport.jrxml"/&gt;
  &lt;property name="exporterParameters"&gt;
    &lt;map&gt;
      &lt;entry key="net.sf.jasperreports.engine.export.JRHtmlExporterParameter.HTML_FOOTER"&gt;
        &lt;value&gt;Footer by Spring!
          &amp;lt;/td&amp;gt;&amp;lt;td width="50%"&amp;gt;&amp;amp;nbsp; &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
          &amp;lt;/table&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
        &lt;/value&gt;
      &lt;/entry&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the <code class="class">JasperReportsHtmlView</code> is configured with an exporter parameter for <code>net.sf.jasperreports.engine.export.JRHtmlExporterParameter.HTML_FOOTER</code> which will output a footer in the resulting HTML.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="feed-views"><a class="anchor" href="#feed-views"></a>Feed Views</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both <code class="class">AbstractAtomFeedView</code> and <code class="class">AbstractRssFeedView</code> inherit from the base class <code class="class">AbstractFeedView</code> and are used to provide Atom and RSS Feed views respectfully.
They are based on java.net&#8217;s &lt;&lt;,ROME&gt;&gt; project and are located in the package <code>org.springframework.web.servlet.view.feed</code>.</p>
</div>
<div class="paragraph">
<p><code class="class">AbstractAtomFeedView</code> requires you to implement the <code class="method">buildFeedEntries()</code> method and optionally override the <code class="method">buildFeedMetadata()</code> method (the default implementation is empty), as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class SampleContentAtomView extends AbstractAtomFeedView {

  @Override
  protected void buildFeedMetadata(Map&lt;String, Object&gt; model, Feed feed,
      HttpServletRequest request) {
    // implementation omitted
  }

  @Override
  protected List&lt;Entry&gt; buildFeedEntries(Map&lt;String, Object&gt; model,
      HttpServletRequest request, HttpServletResponse response)
      throws Exception {

    // implementation omitted
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar requirements apply for implementing <code class="class">AbstractRssFeedView</code>, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class SampleContentAtomView extends AbstractRssFeedView {

  @Override
  protected void buildFeedMetadata(Map&lt;String, Object&gt; model, Channel feed,
                                   HttpServletRequest request) {
    // implementation omitted
  }

  @Override
  protected List&lt;Item&gt; buildFeedItems(Map&lt;String, Object&gt; model,
      HttpServletRequest request, HttpServletResponse response)
      throws Exception {
    // implementation omitted
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="method">buildFeedItems()</code> and <code class="method">buildFeedEntires()</code> methods pass in the HTTP request in case you need to access the Locale.
The HTTP response is passed in only for the setting of cookies or other HTTP headers.
The feed will automatically be written to the response object after the method returns.</p>
</div>
<div class="paragraph">
<p>For an example of creating an Atom view please refer to Alef Arendsen&#8217;s SpringSource Team Blog &lt;&lt;,entry&gt;&gt;.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xml-marshalling-view"><a class="anchor" href="#xml-marshalling-view"></a>XML Marshalling View</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code class="class">MarhsallingView</code> uses an XML <code class="interface">Marshaller</code> defined in the <code class="class">org.springframework.oxm</code> package to render the response content as XML. The object to be marshalled can be set explicitly using <code class="class">MarhsallingView</code>'s  bean property.
Alternatively, the view will iterate over all model properties and marshal only those types that are supported by the <code class="interface">Marshaller</code>.
For more information on the functionality in the <code class="class">org.springframework.oxm</code> package refer to the chapter <a href="#oxm">Marshalling XML using O/X
    Mappers</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-mapping-view"><a class="anchor" href="#json-mapping-view"></a>JSON Mapping View</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code class="class">MappingJackson2JsonView</code> (or <code class="class">MappingJacksonJsonView</code> depending on the the Jackson version you have) uses the Jackson library&#8217;s <code class="class">ObjectMapper</code> to render the response content as JSON. By default, the entire contents of the model map (with the exception of framework-specific classes) will be encoded as JSON. For cases where the contents of the map need to be filtered, users may specify a specific set of model attributes to encode via the <code>RenderedAttributes</code> property.
The <code>extractValueFromSingleKeyModel</code> property may also be  used to have the value in single-key models extracted and serialized directly rather than as a map of model attributes.</p>
</div>
<div class="paragraph">
<p>JSON mapping can be customized as needed through the use of Jackson&#8217;s provided annotations.
When further control is needed, a custom <code class="interface">ObjectMapper</code> can be injected through the <code>ObjectMapper</code> property for cases where custom JSON serializers/deserializers need to be provided for specific types.</p>
</div>
</div>
</div>
<h1 id="integrating-with-other-web-frameworks" class="sect0"><a class="anchor" href="#integrating-with-other-web-frameworks"></a>Integrating with other web frameworks</h1>
<div class="sect1">
<h2 id="introduction-5"><a class="anchor" href="#introduction-5"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter details Spring&#8217;s integration with third party web frameworks such as &lt;&lt;,JSF&gt;&gt;, &lt;&lt;,Struts&gt;&gt;, &lt;&lt;,WebWork&gt;&gt;, and &lt;&lt;,Tapestry&gt;&gt;.</p>
</div>
<div class="paragraph">
<p>One of the core value propositions of the Spring Framework is that of enabling <em>choice</em>.
In a general sense, Spring does not force one to use or buy into any particular architecture, technology, or methodology (although it certainly recommends some over others).
This freedom to pick and choose the architecture, technology, or methodology that is most relevant to a developer and his or her development team is arguably most evident in the web area, where Spring provides its own web framework (<a href="#mvc">Spring MVC</a>), while at the same time providing integration with a number of popular third party web frameworks.
This allows one to continue to leverage any and all of the skills one may have acquired in a particular web framework such as Struts, while at the same time being able to enjoy the benefits afforded by Spring in other areas such as data access, declarative transaction management, and flexible configuration and application assembly.</p>
</div>
<div class="paragraph">
<p>Having dispensed with the woolly sales patter (c.f.
the previous paragraph), the remainder of this chapter will concentrate upon the meaty details of integrating your favorite web framework with Spring.
One thing that is often commented upon by developers coming to Java from other languages is the seeming super-abundance of web frameworks available in Java.
There are indeed a great number of web frameworks in the Java space; in fact there are far too many to cover with any semblance of detail in a single chapter.
This chapter thus picks four of the more popular web frameworks in Java, starting with the Spring configuration that is common to all of the supported web frameworks, and then detailing the specific integration options for each supported web framework.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Please note that this chapter does not attempt to explain how to use any of the supported web frameworks.
For example, if you want to use Struts for the presentation layer of your web application, the assumption is that you are already familiar with Struts.
If you need further details about any of the supported web frameworks themselves, please do consult <a href="#web-integration-resources">[web-integration-resources]</a> at the end of this chapter.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common-configuration"><a class="anchor" href="#common-configuration"></a>Common configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before diving into the integration specifics of each supported web framework, let us first take a look at the Spring configuration that is <em>not</em> specific to any one web framework.
(This section is equally applicable to Spring&#8217;s own web framework, Spring MVC.)</p>
</div>
<div class="paragraph">
<p>One of the concepts (for want of a better word) espoused by (Spring&#8217;s) lightweight application model is that of a layered architecture.
Remember that in a <em>classic</em> layered architecture, the web layer is but one of many layers; it serves as one of the entry points into a server side application and it delegates to service objects (facades) defined in a service layer to satisfy business specific (and presentation-technology agnostic) use cases.
In Spring, these service objects, any other business-specific objects, data access objects, etc.
exist in a distinct <em>business context</em>, which contains <em>no</em> web or presentation layer objects (presentation objects such as Spring MVC controllers are typically configured in a distinct <em>presentation context</em>).
This section details how one configures a Spring container (a <code class="class">WebApplicationContext</code>) that contains all of the <em>business beans</em> in one&#8217;s application.</p>
</div>
<div class="paragraph">
<p>On to specifics: all that one need do is to declare a &lt;&lt;,<code class="class">ContextLoaderListener</code>&gt;&gt; in the standard Java EE servlet <code>web.xml</code> file of one&#8217;s web application, and add a <code>contextConfigLocation</code> &lt;context-param/&gt; section (in the same file) that defines which set of Spring XML configuration files to load.</p>
</div>
<div class="paragraph">
<p>Find below the &lt;listener/&gt; configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;listener&gt;
  &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
&lt;/listener&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Find below the &lt;context-param/&gt; configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;context-param&gt;
  &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
  &lt;param-value&gt;/WEB-INF/applicationContext*.xml&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify the <code>contextConfigLocation</code> context parameter, the <code class="class">ContextLoaderListener</code> will look for a file called <code>/WEB-INF/applicationContext.xml</code> to load.
Once the context files are loaded, Spring creates a &lt;&lt;,<code class="class">WebApplicationContext</code>&gt;&gt; object based on the bean definitions and stores it in the <code class="interface">ServletContext</code> of the web application.</p>
</div>
<div class="paragraph">
<p>All Java web frameworks are built on top of the Servlet API, and so one can use the following code snippet to get access to this <em>business context</em> <code class="interface">ApplicationContext</code> created by the <code class="class">ContextLoaderListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>WebApplicationContext ctx = WebApplicationContextUtils.getWebApplicationContext(servletContext);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The &lt;&lt;,<code class="class">WebApplicationContextUtils</code>&gt;&gt; class is for convenience, so you don&#8217;t have to remember the name of the <code class="interface">ServletContext</code> attribute.
Its <em>getWebApplicationContext()</em> method will return <code>null</code> if an object doesn&#8217;t exist under the <code>WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> key.
Rather than risk getting <code class="class">NullPointerExceptions</code> in your application, it&#8217;s better to use the <code>getRequiredWebApplicationContext()</code> method.
This method throws an exception when the <code class="interface">ApplicationContext</code> is missing.</p>
</div>
<div class="paragraph">
<p>Once you have a reference to the <code class="class">WebApplicationContext</code>, you can retrieve beans by their name or type.
Most developers retrieve beans by name and then cast them to one of their implemented interfaces.</p>
</div>
<div class="paragraph">
<p>Fortunately, most of the frameworks in this section have simpler ways of looking up beans.
Not only do they make it easy to get beans from a Spring container, but they also allow you to use dependency injection on their controllers.
Each web framework section has more detail on its specific integration strategies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="javaserver-faces-1-1-and-1-2"><a class="anchor" href="#javaserver-faces-1-1-and-1-2"></a>JavaServer Faces 1.1 and 1.2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JavaServer Faces (JSF) is the JCP&#8217;s standard component-based, event-driven web user interface framework.
As of Java EE 5, it is an official part of the Java EE umbrella.</p>
</div>
<div class="paragraph">
<p>For a popular JSF runtime as well as for popular JSF component libraries, check out the &lt;&lt;,Apache
    MyFaces project&gt;&gt;.
The MyFaces project also provides common JSF extensions such as &lt;&lt;,MyFaces Orchestra&gt;&gt;: a Spring-based JSF extension that provides rich conversation scope support.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Spring Web Flow 2.0 provides rich JSF support through its newly established Spring Faces module, both for JSF-centric usage (as described in this section) and for Spring-centric usage (using JSF views within a Spring MVC dispatcher).
Check out the &lt;&lt;,Spring Web Flow
      website&gt;&gt; for details!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The key element in Spring&#8217;s JSF integration is the JSF 1.1 <code class="class">VariableResolver</code> mechanism.
On JSF 1.2, Spring supports the <code class="class">ELResolver</code> mechanism as a next-generation version of JSF EL integration.</p>
</div>
<div class="sect2">
<h3 id="delegatingvariableresolver-jsf-1-1-1-2"><a class="anchor" href="#delegatingvariableresolver-jsf-1-1-1-2"></a>DelegatingVariableResolver (JSF 1.1/1.2)</h3>
<div class="paragraph">
<p>The easiest way to integrate one&#8217;s Spring middle-tier with one&#8217;s JSF web layer is to use the &lt;&lt;,<code class="class">DelegatingVariableResolver</code>&gt;&gt; class.
To configure this variable resolver in one&#8217;s application, one will need to edit one&#8217;s <em>faces-context.xml</em> file.
After the opening <code>&lt;faces-config/&gt;</code> element, add an <code>&lt;application/&gt;</code> element and a <code>&lt;variable-resolver/&gt;</code> element within it.
The value of the variable resolver should reference Spring&#8217;s <code class="class">DelegatingVariableResolver</code>; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;faces-config&gt;
  &lt;application&gt;
    &lt;variable-resolver&gt;org.springframework.web.jsf.DelegatingVariableResolver&lt;/variable-resolver&gt;
    &lt;locale-config&gt;
      &lt;default-locale&gt;en&lt;/default-locale&gt;
      &lt;supported-locale&gt;en&lt;/supported-locale&gt;
      &lt;supported-locale&gt;es&lt;/supported-locale&gt;
    &lt;/locale-config&gt;
    &lt;message-bundle&gt;messages&lt;/message-bundle&gt;
  &lt;/application&gt;
&lt;/faces-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">DelegatingVariableResolver</code> will first delegate value lookups to the default resolver of the underlying JSF implementation and then to Spring&#8217;s <em>business context</em> <code class="class">WebApplicationContext</code>.
This allows one to easily inject dependencies into one&#8217;s JSF-managed beans.</p>
</div>
<div class="paragraph">
<p>Managed beans are defined in one&#8217;s <code>faces-config.xml</code> file.
Find below an example where <code>#{userManager}</code> is a bean that is retrieved from the Spring <em>business context</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;managed-bean&gt;
  &lt;managed-bean-name&gt;userList&lt;/managed-bean-name&gt;
  &lt;managed-bean-class&gt;com.whatever.jsf.UserList&lt;/managed-bean-class&gt;
  &lt;managed-bean-scope&gt;request&lt;/managed-bean-scope&gt;
  &lt;managed-property&gt;
    &lt;property-name&gt;userManager&lt;/property-name&gt;
    &lt;value&gt;#{userManager}&lt;/value&gt;
  &lt;/managed-property&gt;
&lt;/managed-bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springbeanvariableresolver-jsf-1-1-1-2"><a class="anchor" href="#springbeanvariableresolver-jsf-1-1-1-2"></a>SpringBeanVariableResolver (JSF 1.1/1.2)</h3>
<div class="paragraph">
<p><code class="class">SpringBeanVariableResolver</code> is a variant of <code class="class">DelegatingVariableResolver</code>.
It delegates to the Spring&#8217;s <em>business context</em> <code class="class">WebApplicationContext</code> <em>first</em> and then to the default resolver of the underlying JSF implementation.
This is useful in particular when using request/session-scoped beans with special Spring resolution rules, e.g.
Spring <code class="interface">FactoryBean</code> implementations.</p>
</div>
<div class="paragraph">
<p>Configuration-wise, simply define <code class="class">SpringBeanVariableResolver</code> in your <em>faces-context.xml</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;faces-config&gt;
  &lt;application&gt;
    &lt;variable-resolver&gt;org.springframework.web.jsf.SpringBeanVariableResolver&lt;/variable-resolver&gt;
    ...
  &lt;/application&gt;
&lt;/faces-config&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springbeanfaceselresolver-jsf-1-2"><a class="anchor" href="#springbeanfaceselresolver-jsf-1-2"></a>SpringBeanFacesELResolver (JSF 1.2+)</h3>
<div class="paragraph">
<p><code class="class">SpringBeanFacesELResolver</code> is a JSF 1.2 compliant <code class="class">ELResolver</code> implementation, integrating with the standard Unified EL as used by JSF 1.2 and JSP 2.1.
Like <code class="class">SpringBeanVariableResolver</code>, it delegates to the Spring&#8217;s <em>business context</em> <code class="class">WebApplicationContext</code> <em>first</em>, then to the default resolver of the underlying JSF implementation.</p>
</div>
<div class="paragraph">
<p>Configuration-wise, simply define <code class="class">SpringBeanFacesELResolver</code> in your JSF 1.2 <em>faces-context.xml</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;faces-config&gt;
  &lt;application&gt;
    &lt;el-resolver&gt;org.springframework.web.jsf.el.SpringBeanFacesELResolver&lt;/el-resolver&gt;
    ...
  &lt;/application&gt;
&lt;/faces-config&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="facescontextutils"><a class="anchor" href="#facescontextutils"></a>FacesContextUtils</h3>
<div class="paragraph">
<p>A custom <code class="interface">VariableResolver</code> works well when mapping one&#8217;s properties to beans in <em>faces-config.xml</em>, but at times one may need to grab a bean explicitly.
The &lt;&lt;,<code class="class">FacesContextUtils</code>&gt;&gt; class makes this easy.
It is similar to <code class="class">WebApplicationContextUtils</code>, except that it takes a <code class="class">FacesContext</code> parameter rather than a <code class="interface">ServletContext</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>ApplicationContext ctx = FacesContextUtils.getWebApplicationContext(FacesContext.getCurrentInstance());</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="apache-struts-1-x-and-2-x"><a class="anchor" href="#apache-struts-1-x-and-2-x"></a>Apache Struts 1.x and 2.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&lt;&lt;,Struts&gt;&gt; used to be the <em>de facto</em> web framework for Java applications, mainly because it was one of the first to be released (June 2001).
It has now been renamed to <em>Struts 1</em> (as opposed to Struts 2).
Many applications still use it.
Invented by Craig McClanahan, Struts is an open source project hosted by the Apache Software Foundation.
At the time, it greatly simplified the JSP/Servlet programming paradigm and won over many developers who were using proprietary frameworks.
It simplified the programming model, it was open source (and thus free as in beer), and it had a large community, which allowed the project to grow and become popular among Java web developers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>The following section discusses Struts 1 a.k.a. "Struts
      Classic".</em></p>
</div>
<div class="paragraph">
<p>Struts 2 is effectively a different product - a successor of WebWork 2.2 (as discussed in <a href="#webwork">[webwork]</a>), carrying the Struts brand now.
Check out the Struts 2 &lt;&lt;,Spring
      Plugin&gt;&gt; for the built-in Spring integration shipped with Struts 2.
In general, Struts 2 is closer to WebWork 2.2 than to Struts 1 in terms of its Spring integration implications.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To integrate your Struts 1.x application with Spring, you have two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure Spring to manage your Actions as beans, using the <code class="class">ContextLoaderPlugin</code>, and set their dependencies in a Spring context file.</p>
</li>
<li>
<p>Subclass Spring&#8217;s <code class="class">ActionSupport</code> classes and grab your Spring-managed beans explicitly using a <em>getWebApplicationContext()</em> method.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="contextloaderplugin"><a class="anchor" href="#contextloaderplugin"></a>ContextLoaderPlugin</h3>
<div class="paragraph">
<p>The &lt;&lt;,<code class="class">ContextLoaderPlugin</code>&gt;&gt; is a Struts 1.1+ plug-in that loads a Spring context file for the Struts <code class="class">ActionServlet</code>.
This context refers to the root <code class="class">WebApplicationContext</code> (loaded by the <code class="class">ContextLoaderListener</code>) as its parent.
The default name of the context file is the name of the mapped servlet, plus <em>-servlet.xml</em>.
If <code class="class">ActionServlet</code> is defined in web.xml as <code>&lt;servlet-name&gt;action&lt;/servlet-name&gt;</code>, the default is <em>/WEB-INF/action-servlet.xml</em>.</p>
</div>
<div class="paragraph">
<p>To configure this plug-in, add the following XML to the plug-ins section near the bottom of your <em>struts-config.xml</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;plug-in className="org.springframework.web.struts.ContextLoaderPlugIn"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The location of the context configuration files can be customized using the <em><code>contextConfigLocation</code></em> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;plug-in className="org.springframework.web.struts.ContextLoaderPlugIn"&gt;
  &lt;set-property property="contextConfigLocation"
      value="/WEB-INF/action-servlet.xml,/WEB-INF/applicationContext.xml"/&gt;
&lt;/plug-in&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to use this plugin to load all your context files, which can be useful when using testing tools like StrutsTestCase.
StrutsTestCase&#8217;s <code class="class">MockStrutsTestCase</code> won&#8217;t initialize Listeners on startup so putting all your context files in the plugin is a workaround.
(A &lt;&lt;,
      bug has been filed&gt;&gt; for this issue, but has been closed as <em>Wont Fix</em>).</p>
</div>
<div class="paragraph">
<p>After configuring this plug-in in <em>struts-config.xml</em>, you can configure your <code class="class">Action</code> to be managed by Spring.
Spring (1.1.3+) provides two ways to do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Override Struts' default <code class="class">RequestProcessor</code> with Spring&#8217;s <code class="class">DelegatingRequestProcessor</code>.</p>
</li>
<li>
<p>Use the <code class="class">DelegatingActionProxy</code> class in the <code>type</code> attribute of your <code>&lt;action-mapping&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both of these methods allow you to manage your Actions and their dependencies in the <em>action-servlet.xml</em> file.
The bridge between the Action in <em>struts-config.xml</em> and <em>action-servlet.xml</em> is built with the action-mapping&#8217;s "path" and the bean&#8217;s "name".
If you have the following in your <em>struts-config.xml</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;action path="/users" .../&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must define that Action&#8217;s bean with the "/users" name in <em>action-servlet.xml</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean name="/users" .../&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="delegatingrequestprocessor"><a class="anchor" href="#delegatingrequestprocessor"></a>DelegatingRequestProcessor</h4>
<div class="paragraph">
<p>To configure the &lt;&lt;,<code>DelegatingRequestProcessor</code>&gt;&gt; in your <em>struts-config.xml</em> file, override the "processorClass" property in the &lt;controller&gt; element.
These lines follow the &lt;action-mapping&gt; element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;controller&gt;
  &lt;set-property property="processorClass"
      value="org.springframework.web.struts.DelegatingRequestProcessor"/&gt;
&lt;/controller&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After adding this setting, your Action will automatically be looked up in Spring&#8217;s context file, no matter what the type.
In fact, you don&#8217;t even need to specify a type.
Both of the following snippets will work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;action path="/user" type="com.whatever.struts.UserAction"/&gt;
&lt;action path="/user"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;re using Struts' <em>modules</em> feature, your bean names must contain the module prefix.
For example, an action defined as <code>&lt;action path="/user"/&gt;</code> with module prefix "admin" requires a bean name with <code>&lt;bean
        name="/admin/user"/&gt;</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If you are using Tiles in your Struts application, you must configure your &lt;controller&gt; with the &lt;&lt;,<code class="class">DelegatingTilesRequestProcessor</code>&gt;&gt; instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="delegatingactionproxy"><a class="anchor" href="#delegatingactionproxy"></a>DelegatingActionProxy</h4>
<div class="paragraph">
<p>If you have a custom <code class="class">RequestProcessor</code> and can&#8217;t use the <code class="class">DelegatingRequestProcessor</code> or <code class="class">DelegatingTilesRequestProcessor</code> approaches, you can use the &lt;&lt;,<code class="class">DelegatingActionProxy</code>&gt;&gt; as the type in your action-mapping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;action path="/user" type="org.springframework.web.struts.DelegatingActionProxy"
    name="userForm" scope="request" validate="false" parameter="method"&gt;
  &lt;forward name="list" path="/userList.jsp"/&gt;
  &lt;forward name="edit" path="/userForm.jsp"/&gt;
&lt;/action&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean definition in <em>action-servlet.xml</em> remains the same, whether you use a custom <code>RequestProcessor</code> or the <code class="class">DelegatingActionProxy</code>.</p>
</div>
<div class="paragraph">
<p>If you define your <code class="class">Action</code> in a context file, the full feature set of Spring&#8217;s bean container will be available for it: dependency injection as well as the option to instantiate a new <code class="class">Action</code> instance for each request.
To activate the latter, add <em>scope="prototype"</em> to your Action&#8217;s bean definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean name="/user" scope="prototype" autowire="byName"
    class="org.example.web.UserAction"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="actionsupport-classes"><a class="anchor" href="#actionsupport-classes"></a>ActionSupport Classes</h3>
<div class="paragraph">
<p>As previously mentioned, you can retrieve the <code class="class">WebApplicationContext</code> from the <code class="interface">ServletContext</code> using the <code class="class">WebApplicationContextUtils</code> class.
An easier way is to extend Spring&#8217;s <code class="class">Action</code> classes for Struts.
For example, instead of subclassing Struts' <code class="class">Action</code> class, you can subclass Spring&#8217;s &lt;&lt;,<code class="class">ActionSupport</code>&gt;&gt; class.</p>
</div>
<div class="paragraph">
<p>The <code class="class">ActionSupport</code> class provides additional convenience methods, like <em>getWebApplicationContext()</em>.
Below is an example of how you might use this in an Action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class UserAction extends DispatchActionSupport {

    public ActionForward execute(ActionMapping mapping,
                                 ActionForm form,
                                 HttpServletRequest request,
                                 HttpServletResponse response) throws Exception {
        if (log.isDebugEnabled()) {
            log.debug("entering 'delete' method...");
        }
        WebApplicationContext ctx = getWebApplicationContext();
        UserManager mgr = (UserManager) ctx.getBean("userManager");
        // talk to manager for business logic
        return mapping.findForward("success");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring includes subclasses for all of the standard Struts Actions - the Spring versions merely have <em>Support</em> appended to the name:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt;,<code class="class">ActionSupport</code>&gt;&gt;,</p>
</li>
<li>
<p>&lt;&lt;,<code>DispatchActionSupport</code>&gt;&gt;,</p>
</li>
<li>
<p>&lt;&lt;,<code>LookupDispatchActionSupport</code>&gt;&gt; and</p>
</li>
<li>
<p>&lt;&lt;,<code>MappingDispatchActionSupport</code>&gt;&gt;.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The recommended strategy is to use the approach that best suits your project.
Subclassing makes your code more readable, and you know exactly how your dependencies are resolved.
In contrast, using the <code class="class">ContextLoaderPlugin</code> allows you to easily add new dependencies in your context XML file.
Either way, Spring provides some nice options for integrating with Struts.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="webwork-2-x"><a class="anchor" href="#webwork-2-x"></a>WebWork 2.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From the &lt;&lt;,WebWork
    homepage&gt;&gt;:</p>
</div>
<div class="paragraph">
<p>Web work&#8217;s architecture and concepts are easy to understand, and the framework also has an extensive tag library as well as nicely decoupled validation.</p>
</div>
<div class="paragraph">
<p>One of the key enablers in WebWork&#8217;s technology stack is &lt;&lt;,an
    IoC container&gt;&gt; to manage Webwork Actions, handle the "wiring" of business objects, etc.
Prior to WebWork version 2.2, WebWork used its own proprietary IoC container (and provided integration points so that one could integrate an IoC container such as Spring&#8217;s into the mix).
However, as of WebWork version 2.2, the default IoC container that is used within WebWork <em>is</em> Spring.
This is obviously great news if one is a Spring developer, because it means that one is immediately familiar with the basics of IoC configuration, idioms, and suchlike within WebWork.</p>
</div>
<div class="paragraph">
<p>Now in the interests of adhering to the DRY (Don&#8217;t Repeat Yourself) principle, it would be foolish to document the Spring-WebWork integration in light of the fact that the WebWork team have already written such a writeup.
Please consult the &lt;&lt;,Spring-WebWork
    integration page&gt;&gt; on the &lt;&lt;,WebWork wiki&gt;&gt; for the full lowdown.</p>
</div>
<div class="paragraph">
<p>Note that the Spring-WebWork integration code was developed (and continues to be maintained and improved) by the WebWork developers themselves.
So please refer first to the WebWork site and forums if you are having issues with the integration.
But feel free to post comments and queries regarding the Spring-WebWork integration on the &lt;&lt;,Spring
    support forums&gt;&gt;, too.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tapestry-3-x-and-4-x"><a class="anchor" href="#tapestry-3-x-and-4-x"></a>Tapestry 3.x and 4.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From the &lt;&lt;,Tapestry
    homepage&gt;&gt;:</p>
</div>
<div class="paragraph">
<p>While Spring has its own <a href="#mvc">powerful web
    layer</a>, there are a number of unique advantages to building an enterprise Java application using a combination of Tapestry for the web user interface and the Spring container for the lower layers.
This section of the web integration chapter attempts to detail a few best practices for combining these two frameworks.</p>
</div>
<div class="paragraph">
<p>A <em>typical</em> layered enterprise Java application built with Tapestry and Spring will consist of a top user interface (UI) layer built with Tapestry, and a number of lower layers, all wired together by one or more Spring containers.
Tapestry&#8217;s own reference documentation contains the following snippet of best practice advice.
(Text that the author of this Spring section has added is contained within <code>[]</code> brackets.)</p>
</div>
<div class="paragraph">
<p>The key question then is: how does one supply Tapestry pages with collaborating services? The answer, ideally, is that one would want to dependency inject those services directly into one&#8217;s Tapestry pages.
In Tapestry, one can effect this dependency injection by a variety of means.
This section is only going to enumerate the dependency injection means afforded by Spring.
The real beauty of the rest of this Spring-Tapestry integration is that the elegant and flexible design of Tapestry itself makes doing this dependency injection of Spring-managed beans a cinch.
(Another nice thing is that this Spring-Tapestry integration code was written - and continues to be maintained - by the Tapestry creator &lt;&lt;,Howard M.
    Lewis Ship&gt;&gt;, so hats off to him for what is really some silky smooth integration).</p>
</div>
<div class="sect2">
<h3 id="injecting-spring-managed-beans"><a class="anchor" href="#injecting-spring-managed-beans"></a>Injecting Spring-managed beans</h3>
<div class="paragraph">
<p>Assume we have the following simple Spring container definition (in the ubiquitous XML format):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd"&gt;

&lt;beans&gt;
    &lt;!-- the DataSource --&gt;
    &lt;jee:jndi-lookup id="dataSource" jndi-name="java:DefaultDS"/&gt;

    &lt;bean id="hibSessionFactory"
          class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
        &lt;property name="dataSource" ref="dataSource"/&gt;
    &lt;/bean&gt;

    &lt;bean id="transactionManager"
          class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;

    &lt;bean id="mapper"
          class="com.whatever.dataaccess.mapper.hibernate.MapperImpl"&gt;
        &lt;property name="sessionFactory" ref="hibSessionFactory"/&gt;
    &lt;/bean&gt;

    &lt;!-- (transactional) AuthenticationService --&gt;
    &lt;bean id="authenticationService"
          class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
        &lt;property name="transactionManager" ref="transactionManager"/&gt;
        &lt;property name="target"&gt;
            &lt;bean class="com.whatever.services.service.user.AuthenticationServiceImpl"&gt;
                &lt;property name="mapper" ref="mapper"/&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name="proxyInterfacesOnly" value="true"/&gt;
        &lt;property name="transactionAttributes"&gt;
            &lt;value&gt;
                *=PROPAGATION_REQUIRED
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- (transactional) UserService --&gt;
    &lt;bean id="userService"
          class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
        &lt;property name="transactionManager" ref="transactionManager"/&gt;
        &lt;property name="target"&gt;
             &lt;bean class="com.whatever.services.service.user.UserServiceImpl"&gt;
                 &lt;property name="mapper" ref="mapper"/&gt;
             &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name="proxyInterfacesOnly" value="true"/&gt;
        &lt;property name="transactionAttributes"&gt;
            &lt;value&gt;
                *=PROPAGATION_REQUIRED
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

 &lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the Tapestry application, the above bean definitions need to be <a href="#web-integration-common">loaded into a Spring
      container</a>, and any relevant Tapestry pages need to be supplied (injected) with the <code>authenticationService</code> and <code>userService</code> beans, which implement the <code class="interface">AuthenticationService</code> and <code class="interface">UserService</code> interfaces, respectively.</p>
</div>
<div class="paragraph">
<p>At this point, the application context is available to a web application by calling Spring&#8217;s static utility function <code>WebApplicationContextUtils.getApplicationContext(servletContext)</code>, where servletContext is the standard <code class="interface">ServletContext</code> from the Java EE Servlet specification.
As such, one simple mechanism for a page to get an instance of the <code class="interface">UserService</code>, for example, would be with code such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>WebApplicationContext appContext = WebApplicationContextUtils.getApplicationContext(
    getRequestCycle().getRequestContext().getServlet().getServletContext());
UserService userService = (UserService) appContext.getBean("userService");
// ... some code which uses UserService</code></pre>
</div>
</div>
<div class="paragraph">
<p>This mechanism does work.
Having said that, it can be made a lot less verbose by encapsulating most of the functionality in a method in the base class for the page or component.
However, in some respects it goes against the IoC principle; ideally you would like the page to not have to ask the context for a specific bean by name, and in fact, the page would ideally not know about the context at all.</p>
</div>
<div class="paragraph">
<p>Luckily, there is a mechanism to allow this.
We rely upon the fact that Tapestry already has a mechanism to declaratively add properties to a page, and it is in fact the preferred approach to manage all properties on a page in this declarative fashion, so that Tapestry can properly manage their lifecycle as part of the page and component lifecycle.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
This next section is applicable to Tapestry 3.x.
If you are using Tapestry version 4.x, please consult the section entitled <a href="#tapestry-4-style-di">[tapestry-4-style-di]</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="dependency-injecting-spring-beans-into-tapestry-pages"><a class="anchor" href="#dependency-injecting-spring-beans-into-tapestry-pages"></a>Dependency Injecting Spring Beans into Tapestry pages</h4>
<div class="paragraph">
<p>First we need to make the <code class="interface">ApplicationContext</code> available to the Tapestry page or Component without having to have the <code class="interface">ServletContext</code>; this is because at the stage in the page&#8217;s/component&#8217;s lifecycle when we need to access the <code class="interface">ApplicationContext</code>, the <code class="interface">ServletContext</code> won&#8217;t be easily available to the page, so we can&#8217;t use <code>WebApplicationContextUtils.getApplicationContext(servletContext)</code> directly.
One way is by defining a custom version of the Tapestry <code class="interface">IEngine</code> which exposes this for us:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.whatever.web.xportal;

// import ...

public class MyEngine extends org.apache.tapestry.engine.BaseEngine {

    public static final String APPLICATION_CONTEXT_KEY = "appContext";

    /**
     * @see org.apache.tapestry.engine.AbstractEngine#setupForRequest(org.apache.tapestry.request.RequestContext)
     */
    protected void setupForRequest(RequestContext context) {
        super.setupForRequest(context);

        // insert ApplicationContext in global, if not there
        Map global = (Map) getGlobal();
        ApplicationContext ac = (ApplicationContext) global.get(APPLICATION_CONTEXT_KEY);
        if (ac == null) {
            ac = WebApplicationContextUtils.getWebApplicationContext(
                context.getServlet().getServletContext()
            );
            global.put(APPLICATION_CONTEXT_KEY, ac);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This engine class places the Spring Application Context as an attribute called "appContext" in this Tapestry app&#8217;s <em>Global</em> object.
Make sure to register the fact that this special IEngine instance should be used for this Tapestry application, with an entry in the Tapestry application definition file.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>file: xportal.application:
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE application PUBLIC
    "-//Apache Software Foundation//Tapestry Specification 3.0//EN"
    "http://jakarta.apache.org/tapestry/dtd/Tapestry_3_0.dtd"&gt;
&lt;application
    name="Whatever xPortal"
    engine-class="com.whatever.web.xportal.MyEngine"&gt;
&lt;/application&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="component-definition-files"><a class="anchor" href="#component-definition-files"></a>Component definition files</h4>
<div class="paragraph">
<p>Now in our page or component definition file (*.page or *.jwc), we simply add property-specification elements to grab the beans we need out of the <code class="interface">ApplicationContext</code>, and create page or component properties for them.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>    &lt;property-specification name="userService"
                            type="com.whatever.services.service.user.UserService"&gt;
        global.appContext.getBean("userService")
    &lt;/property-specification&gt;
    &lt;property-specification name="authenticationService"
                            type="com.whatever.services.service.user.AuthenticationService"&gt;
        global.appContext.getBean("authenticationService")
    &lt;/property-specification&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The OGNL expression inside the property-specification specifies the initial value for the property, as a bean obtained from the context.
The entire page definition might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE page-specification PUBLIC
    "-//Apache Software Foundation//Tapestry Specification 3.0//EN"
    "http://jakarta.apache.org/tapestry/dtd/Tapestry_3_0.dtd"&gt;

&lt;page-specification class="com.whatever.web.xportal.pages.Login"&gt;

    &lt;property-specification name="username" type="java.lang.String"/&gt;
    &lt;property-specification name="password" type="java.lang.String"/&gt;
    &lt;property-specification name="error" type="java.lang.String"/&gt;
    &lt;property-specification name="callback" type="org.apache.tapestry.callback.ICallback" persistent="yes"/&gt;
    &lt;property-specification name="userService"
                            type="com.whatever.services.service.user.UserService"&gt;
        global.appContext.getBean("userService")
    &lt;/property-specification&gt;
    &lt;property-specification name="authenticationService"
                            type="com.whatever.services.service.user.AuthenticationService"&gt;
        global.appContext.getBean("authenticationService")
    &lt;/property-specification&gt;

    &lt;bean name="delegate" class="com.whatever.web.xportal.PortalValidationDelegate"/&gt;

    &lt;bean name="validator" class="org.apache.tapestry.valid.StringValidator" lifecycle="page"&gt;
        &lt;set-property name="required" expression="true"/&gt;
        &lt;set-property name="clientScriptingEnabled" expression="true"/&gt;
    &lt;/bean&gt;

    &lt;component id="inputUsername" type="ValidField"&gt;
        &lt;static-binding name="displayName" value="Username"/&gt;
        &lt;binding name="value" expression="username"/&gt;
        &lt;binding name="validator" expression="beans.validator"/&gt;
    &lt;/component&gt;

    &lt;component id="inputPassword" type="ValidField"&gt;
        &lt;binding name="value" expression="password"/&gt;
       &lt;binding name="validator" expression="beans.validator"/&gt;
       &lt;static-binding name="displayName" value="Password"/&gt;
       &lt;binding name="hidden" expression="true"/&gt;
    &lt;/component&gt;

&lt;/page-specification&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-abstract-accessors"><a class="anchor" href="#adding-abstract-accessors"></a>Adding abstract accessors</h4>
<div class="paragraph">
<p>Now in the Java class definition for the page or component itself, all we need to do is add an abstract getter method for the properties we have defined (in order to be able to access the properties).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// our UserService implementation; will come from page definition
public abstract UserService getUserService();
// our AuthenticationService implementation; will come from page definition
public abstract AuthenticationService getAuthenticationService();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the sake of completeness, the entire Java class, for a login page in this example, might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.whatever.web.xportal.pages;

/**
 *  Allows the user to login, by providing username and password.
 *  After successfully logging in, a cookie is placed on the client browser
 *  that provides the default username for future logins (the cookie
 *  persists for a week).
 */
public abstract class Login extends BasePage implements ErrorProperty, PageRenderListener {

    /** the key under which the authenticated user object is stored in the visit as */
    public static final String USER_KEY = "user";

    /** The name of the cookie that identifies a user **/
    private static final String COOKIE_NAME = Login.class.getName() + ".username";
    private final static int ONE_WEEK = 7 * 24 * 60 * 60;

    public abstract String getUsername();
    public abstract void setUsername(String username);

    public abstract String getPassword();
    public abstract void setPassword(String password);

    public abstract ICallback getCallback();
    public abstract void setCallback(ICallback value);

    public abstract UserService getUserService();
    public abstract AuthenticationService getAuthenticationService();

    protected IValidationDelegate getValidationDelegate() {
        return (IValidationDelegate) getBeans().getBean("delegate");
    }

    protected void setErrorField(String componentId, String message) {
        IFormComponent field = (IFormComponent) getComponent(componentId);
        IValidationDelegate delegate = getValidationDelegate();
        delegate.setFormComponent(field);
        delegate.record(new ValidatorException(message));
    }

    /**
     *  Attempts to login.
     * &lt;p&gt;
     *  If the user name is not known, or the password is invalid, then an error
     *  message is displayed.
     **/
    public void attemptLogin(IRequestCycle cycle) {

        String password = getPassword();

        // Do a little extra work to clear out the password.
        setPassword(null);
        IValidationDelegate delegate = getValidationDelegate();

        delegate.setFormComponent((IFormComponent) getComponent("inputPassword"));
        delegate.recordFieldInputValue(null);

        // An error, from a validation field, may already have occurred.
        if (delegate.getHasErrors()) {
            return;
        }

        try {
            User user = getAuthenticationService().login(getUsername(), getPassword());
           loginUser(user, cycle);
        }
        catch (FailedLoginException ex) {
            this.setError("Login failed: " + ex.getMessage());
            return;
        }
    }

    /**
     *  Sets up the {@link User} as the logged in user, creates
     *  a cookie for their username (for subsequent logins),
     *  and redirects to the appropriate page, or
     *  a specified page).
     **/
    public void loginUser(User user, IRequestCycle cycle) {

        String username = user.getUsername();

        // Get the visit object; this will likely force the
        // creation of the visit object and an HttpSession
        Map visit = (Map) getVisit();
        visit.put(USER_KEY, user);

        // After logging in, go to the MyLibrary page, unless otherwise specified
        ICallback callback = getCallback();

        if (callback == null) {
            cycle.activate("Home");
        }
        else {
            callback.performCallback(cycle);
        }

        IEngine engine = getEngine();
        Cookie cookie = new Cookie(COOKIE_NAME, username);
        cookie.setPath(engine.getServletPath());
        cookie.setMaxAge(ONE_WEEK);

        // Record the user's username in a cookie
        cycle.getRequestContext().addCookie(cookie);
        engine.forgetPage(getPageName());
    }

    public void pageBeginRender(PageEvent event) {
        if (getUsername() == null) {
            setUsername(getRequestCycle().getRequestContext().getCookieValue(COOKIE_NAME));
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dependency-injecting-spring-beans-into-tapestry-pages-tapestry-4-x-style"><a class="anchor" href="#dependency-injecting-spring-beans-into-tapestry-pages-tapestry-4-x-style"></a>Dependency Injecting Spring Beans into Tapestry pages - Tapestry 4.x style</h4>
<div class="paragraph">
<p>Effecting the dependency injection of Spring-managed beans into Tapestry pages in Tapestry version 4.x is <em>so</em> much simpler.
All that is needed is a single &lt;&lt;,add-on
        library&gt;&gt;, and some (small) amount of (essentially boilerplate) configuration.
Simply package and deploy this library with the (any of the) other libraries required by your web application (typically in <code>WEB-INF/lib</code>).</p>
</div>
<div class="paragraph">
<p>You will then need to create and expose the Spring container using the <a href="#web-integration-common">method detailed
        previously</a>.
You can then inject Spring-managed beans into Tapestry very easily; if we are using Java 5, consider the <code class="class">Login</code> page from above: we simply need to annotate the appropriate getter methods in order to dependency inject the Spring-managed <code>userService</code> and <code>authenticationService</code> objects (lots of the class definition has been elided for clarity).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.whatever.web.xportal.pages;

public abstract class Login extends BasePage implements ErrorProperty, PageRenderListener {

    @InjectObject("spring:userService")
    public abstract UserService getUserService();

    @InjectObject("spring:authenticationService")
    public abstract AuthenticationService getAuthenticationService();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are almost done.
All that remains is the HiveMind configuration that exposes the Spring container stored in the <code class="interface">ServletContext</code> as a HiveMind service; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0"?&gt;
&lt;module id="com.javaforge.tapestry.spring" version="0.1.1"&gt;

    &lt;service-point id="SpringApplicationInitializer"
        interface="org.apache.tapestry.services.ApplicationInitializer"
        visibility="private"&gt;
        &lt;invoke-factory&gt;
            &lt;construct class="com.javaforge.tapestry.spring.SpringApplicationInitializer"&gt;
                &lt;set-object property="beanFactoryHolder"
                    value="service:hivemind.lib.DefaultSpringBeanFactoryHolder" /&gt;
            &lt;/construct&gt;
        &lt;/invoke-factory&gt;
    &lt;/service-point&gt;

    &lt;!-- Hook the Spring setup into the overall application initialization. --&gt;
    &lt;contribution
        configuration-id="tapestry.init.ApplicationInitializers"&gt;
        &lt;command id="spring-context"
            object="service:SpringApplicationInitializer" /&gt;
    &lt;/contribution&gt;

&lt;/module&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using Java 5 (and thus have access to annotations), then that really is it.</p>
</div>
<div class="paragraph">
<p>If you are not using Java 5, then one obviously doesn&#8217;t annotate one&#8217;s Tapestry page classes with annotations; instead, one simply uses good old fashioned XML to declare the dependency injection; for example, inside the <code>.page</code> or <code>.jwc</code> file for the <code class="class">Login</code> page (or component):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;inject property="userService" object="spring:userService"/&gt;
&lt;inject property="authenticationService" object="spring:authenticationService"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we&#8217;ve managed to allow service beans defined in a Spring container to be provided to the Tapestry page in a declarative fashion.
The page class does not know where the service implementations are coming from, and in fact it is easy to slip in another implementation, for example, during testing.
This inversion of control is one of the prime goals and benefits of the Spring Framework, and we have managed to extend it throughout the stack in this Tapestry application.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="further-resources-2"><a class="anchor" href="#further-resources-2"></a>Further Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Find below links to further resources about the various web frameworks described in this chapter.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The &lt;&lt;,JSF&gt;&gt; homepage</p>
</li>
<li>
<p>The &lt;&lt;,Struts&gt;&gt; homepage</p>
</li>
<li>
<p>The &lt;&lt;,WebWork&gt;&gt; homepage</p>
</li>
<li>
<p>The &lt;&lt;,Tapestry&gt;&gt; homepage</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="portlet-mvc-framework" class="sect0"><a class="anchor" href="#portlet-mvc-framework"></a>Portlet MVC Framework</h1>
<div class="sect1">
<h2 id="introduction-6"><a class="anchor" href="#introduction-6"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">JSR-168 The Java Portlet Specification</div>
<p>[sidebar]For more general information about portlet development, please review a whitepaper from Sun entitled &lt;&lt;,"Introduction to JSR 168"&gt;&gt;, and of course the &lt;&lt;,JSR-168 Specification&gt;&gt; itself.</p>
</div>
<div class="paragraph">
<p>In addition to supporting conventional (servlet-based) Web development, Spring also supports JSR-168 Portlet development.
As much as possible, the Portlet MVC framework is a mirror image of the Web MVC framework, and also uses the same underlying view abstractions and integration technology.
So, be sure to review the chapters entitled <a href="#mvc">[mvc]</a> and <a href="#view">[view]</a> before continuing with this chapter.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Bear in mind that while the concepts of Spring MVC are the same in Spring Portlet MVC, there are some notable differences created by the unique workflow of JSR-168 portlets.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The main way in which portlet workflow differs from servlet workflow is that the request to the portlet can have two distinct phases: the action phase and the render phase.
The action phase is executed only once and is where any <em>backend</em> changes or actions occur, such as making changes in a database.
The render phase then produces what is displayed to the user each time the display is refreshed.
The critical point here is that for a single overall request, the action phase is executed only once, but the render phase may be executed multiple times.
This provides (and requires) a clean separation between the activities that modify the persistent state of your system and the activities that generate what is displayed to the user.</p>
</div>
<div class="paragraph">
<p>The dual phases of portlet requests are one of the real strengths of the JSR-168 specification.
For example, dynamic search results can be updated routinely on the display without the user explicitly rerunning the search.
Most other portlet MVC frameworks attempt to completely hide the two phases from the developer and make it look as much like traditional servlet development as possible - we think this approach removes one of the main benefits of using portlets.
So, the separation of the two phases is preserved throughout the Spring Portlet MVC framework.
The primary manifestation of this approach is that where the servlet version of the MVC classes will have one method that deals with the request, the portlet version of the MVC classes will have two methods that deal with the request: one for the action phase and one for the render phase.
For example, where the servlet version of <code class="class">AbstractController</code> has the <code class="method">handleRequestInternal(..)</code> method, the portlet version of <code class="class">AbstractController</code> has <code class="method">handleActionRequestInternal(..)</code> and <code class="method">handleRenderRequestInternal(..)</code> methods.</p>
</div>
<div class="paragraph">
<p>The framework is designed around a <code class="class">DispatcherPortlet</code> that dispatches requests to handlers, with configurable handler mappings and view resolution, just as the <code class="class">DispatcherServlet</code> in the web framework does.
File upload is also supported in the same way.</p>
</div>
<div class="paragraph">
<p>Locale resolution and theme resolution are not supported in Portlet MVC - these areas are in the purview of the portal/portlet container and are not appropriate at the Spring level.
However, all mechanisms in Spring that depend on the locale (such as internationalization of messages) will still function properly because <code class="class">DispatcherPortlet</code> exposes the current locale in the same way as <code class="class">DispatcherServlet</code>.</p>
</div>
<div class="sect2">
<h3 id="controllers-the-c-in-mvc"><a class="anchor" href="#controllers-the-c-in-mvc"></a>Controllers - The C in MVC</h3>
<div class="paragraph">
<p>The default handler is still a very simple <code class="interface">Controller</code> interface, offering just two methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="method">void handleActionRequest(request,response)</code></p>
</li>
<li>
<p><code class="method">ModelAndView handleRenderRequest(request,response)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The framework also includes most of the same controller implementation hierarchy, such as <code class="class">AbstractController</code>, <code class="class">SimpleFormController</code>, and so on.
Data binding, command object usage, model handling, and view resolution are all the same as in the servlet framework.</p>
</div>
</div>
<div class="sect2">
<h3 id="views-the-v-in-mvc"><a class="anchor" href="#views-the-v-in-mvc"></a>Views - The V in MVC</h3>
<div class="paragraph">
<p>All the view rendering capabilities of the servlet framework are used directly via a special bridge servlet named <code class="class">ViewRendererServlet</code>.
By using this servlet, the portlet request is converted into a servlet request and the view can be rendered using the entire normal servlet infrastructure.
This means all the existing renderers, such as JSP, Velocity, etc., can still be used within the portlet.</p>
</div>
</div>
<div class="sect2">
<h3 id="web-scoped-beans"><a class="anchor" href="#web-scoped-beans"></a>Web-scoped beans</h3>
<div class="paragraph">
<p>Spring Portlet MVC supports beans whose lifecycle is scoped to the current HTTP request or HTTP <code class="interface">Session</code> (both normal and global).
This is not a specific feature of Spring Portlet MVC itself, but rather of the <code class="interface">WebApplicationContext</code> container(s) that Spring Portlet MVC uses.
These bean scopes are described in detail in <a href="#beans-factory-scopes-other">[beans-factory-scopes-other]</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-code-class-class-dispatcherportlet-code"><a class="anchor" href="#the-code-class-class-dispatcherportlet-code"></a>The <code class="class">DispatcherPortlet</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Portlet MVC is a request-driven web MVC framework, designed around a portlet that dispatches requests to controllers and offers other functionality facilitating the development of portlet applications.
Spring&#8217;s <code class="class">DispatcherPortlet</code> however, does more than just that.
It is completely integrated with the Spring <code class="interface">ApplicationContext</code> and allows you to use every other feature Spring has.</p>
</div>
<div class="paragraph">
<p>Like ordinary portlets, the <code class="class">DispatcherPortlet</code> is declared in the <code>portlet.xml</code> file of your web application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;portlet&gt;
    &lt;portlet-name&gt;sample&lt;/portlet-name&gt;
    &lt;portlet-class&gt;org.springframework.web.portlet.DispatcherPortlet&lt;/portlet-class&gt;
    &lt;supports&gt;
        &lt;mime-type&gt;text/html&lt;/mime-type&gt;
        &lt;portlet-mode&gt;view&lt;/portlet-mode&gt;
    &lt;/supports&gt;
    &lt;portlet-info&gt;
        &lt;title&gt;Sample Portlet&lt;/title&gt;
    &lt;/portlet-info&gt;
&lt;/portlet&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">DispatcherPortlet</code> now needs to be configured.</p>
</div>
<div class="paragraph">
<p>In the Portlet MVC framework, each <code class="class">DispatcherPortlet</code> has its own <code class="interface">WebApplicationContext</code>, which inherits all the beans already defined in the Root <code class="interface">WebApplicationContext</code>.
These inherited beans can be overridden in the portlet-specific scope, and new scope-specific beans can be defined local to a given portlet instance.</p>
</div>
<div class="paragraph">
<p>The framework will, on initialization of a <code class="class">DispatcherPortlet</code>, look for a file named <code>[portlet-name]-portlet.xml</code> in the <code>WEB-INF</code> directory of your web application and create the beans defined there (overriding the definitions of any beans defined with the same name in the global scope).</p>
</div>
<div class="paragraph">
<p>The config location used by the <code class="class">DispatcherPortlet</code> can be modified through a portlet initialization parameter (see below for details).</p>
</div>
<div class="paragraph">
<p>The Spring <code class="class">DispatcherPortlet</code> has a few special beans it uses, in order to be able to process requests and render the appropriate views.
These beans are included in the Spring framework and can be configured in the <code class="interface">WebApplicationContext</code>, just as any other bean would be configured.
Each of those beans is described in more detail below.
Right now, we&#8217;ll just mention them, just to let you know they exist and to enable us to go on talking about the <code class="class">DispatcherPortlet</code>.
For most of the beans, defaults are provided so you don&#8217;t have to worry about configuring them.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 10. Special beans in the <code class="interface">WebApplicationContext</code></caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>When a <code class="class">DispatcherPortlet</code> is setup for use and a request comes in for that specific <code class="class">DispatcherPortlet</code>, it starts processing the request.
The list below describes the complete process a request goes through if handled by a <code class="class">DispatcherPortlet</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The locale returned by <code>PortletRequest.getLocale()</code> is bound to the request to let elements in the process resolve the locale to use when processing the request (rendering the view, preparing data, etc.).</p>
</li>
<li>
<p>If a multipart resolver is specified and this is an <code class="interface">ActionRequest</code>, the request is inspected for multiparts and if they are found, it is wrapped in a <code class="interface">MultipartActionRequest</code> for further processing by other elements in the process.
(See <a href="#portlet-multipart">[portlet-multipart]</a> for further information about multipart handling).</p>
</li>
<li>
<p>An appropriate handler is searched for.
If a handler is found, the execution chain associated with the handler (pre-processors, post-processors, controllers) will be executed in order to prepare a model.</p>
</li>
<li>
<p>If a model is returned, the view is rendered, using the view resolver that has been configured with the <code class="interface">WebApplicationContext</code>.
If no model is returned (which could be due to a pre- or post-processor intercepting the request, for example, for security reasons), no view is rendered, since the request could already have been fulfilled.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Exceptions that are thrown during processing of the request get picked up by any of the handler exception resolvers that are declared in the <code class="interface">WebApplicationContext</code>.
Using these exception resolvers you can define custom behavior in case such exceptions get thrown.</p>
</div>
<div class="paragraph">
<p>You can customize Spring&#8217;s <code class="class">DispatcherPortlet</code> by adding context parameters in the <code>portlet.xml</code> file or portlet init-parameters.
The possibilities are listed below.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 11. <code class="class">DispatcherPortlet</code> initialization parameters</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contextClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that implements
            WebApplicationContext,
            which will be used to instantiate the context used by
            this portlet. If this parameter isn&#8217;t specified, the
            XmlPortletApplicationContext will
            be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contextConfigLocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String which is passed to the context instance
            (specified by contextClass) to
            indicate where context(s) can be found. The String is
            potentially split up into multiple Strings (using a
            comma as a delimiter) to support multiple contexts (in
            case of multiple context locations, for beans that are
            defined twice, the latest takes precedence).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The namespace of the
            WebApplicationContext.
            Defaults to [portlet-name]-portlet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">viewRendererUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL at which
            DispatcherPortlet can access an
            instance of ViewRendererServlet
            (see ).</p></td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sect1">
<h2 id="the-code-class-class-viewrendererservlet-code"><a class="anchor" href="#the-code-class-class-viewrendererservlet-code"></a>The <code class="class">ViewRendererServlet</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The rendering process in Portlet MVC is a bit more complex than in Web MVC. In order to reuse all the <a href="#view">view technologies</a> from Spring Web MVC, we must convert the <code class="interface">PortletRequest</code> / <code class="interface">PortletResponse</code> to <code class="interface">HttpServletRequest</code> / <code class="interface">HttpServletResponse</code> and then call the <code>render</code> method of the <code class="interface">View</code>.
To do this, <code class="class">DispatcherPortlet</code> uses a special servlet that exists for just this purpose: the <code class="class">ViewRendererServlet</code>.</p>
</div>
<div class="paragraph">
<p>In order for <code class="class">DispatcherPortlet</code> rendering to work, you must declare an instance of the <code class="class">ViewRendererServlet</code> in the <code>web.xml</code> file for your web application as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;servlet&gt;
    &lt;servlet-name&gt;ViewRendererServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.ViewRendererServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ViewRendererServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/WEB-INF/servlet/view&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To perform the actual rendering, <code class="class">DispatcherPortlet</code> does the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Binds the <code class="interface">WebApplicationContext</code> to the request as an attribute under the same <code>WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> key that <code class="class">DispatcherServlet</code> uses.</p>
</li>
<li>
<p>Binds the <code class="interface">Model</code> and <code class="interface">View</code> objects to the request to make them available to the <code class="class">ViewRendererServlet</code>.</p>
</li>
<li>
<p>Constructs a <code class="interface">PortletRequestDispatcher</code> and performs an <code>include</code> using the <code>/WEB-
INF/servlet/view</code> URL that is mapped to the <code class="class">ViewRendererServlet</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code class="class">ViewRendererServlet</code> is then able to call the <code>render</code> method on the <code class="interface">View</code> with the appropriate arguments.</p>
</div>
<div class="paragraph">
<p>The actual URL for the <code class="class">ViewRendererServlet</code> can be changed using <code class="class">DispatcherPortlet</code>'s <code>viewRendererUrl</code> configuration parameter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controllers"><a class="anchor" href="#controllers"></a>Controllers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The controllers in Portlet MVC are very similar to the Web MVC Controllers, and porting code from one to the other should be simple.</p>
</div>
<div class="paragraph">
<p>The basis for the Portlet MVC controller architecture is the <code class="interface">org.springframework.web.portlet.mvc.Controller</code> interface, which is listed below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface Controller {

    /**
     * Process the render request and return a ModelAndView object which the
     * DispatcherPortlet will render.
     */
    ModelAndView handleRenderRequest(RenderRequest request, RenderResponse response)
        throws Exception;

    /**
     * Process the action request. There is nothing to return.
     */
    void handleActionRequest(ActionRequest request, ActionResponse response)
        throws Exception;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the Portlet <code class="interface">Controller</code> interface requires two methods that handle the two phases of a portlet request: the action request and the render request.
The action phase should be capable of handling an action request, and the render phase should be capable of handling a render request and returning an appropriate model and view.
While the <code class="interface">Controller</code> interface is quite abstract, Spring Portlet MVC offers several controllers that already contain a lot of the functionality you might need; most of these are very similar to controllers from Spring Web MVC. The <code class="interface">Controller</code> interface just defines the most common functionality required of every controller: handling an action request, handling a render request, and returning a model and a view.</p>
</div>
<div class="sect2">
<h3 id="code-class-class-abstractcontroller-code-and-code-class-class-portletcontentgenerator-code"><a class="anchor" href="#code-class-class-abstractcontroller-code-and-code-class-class-portletcontentgenerator-code"></a><code class="class">AbstractController</code> and <code class="class">PortletContentGenerator</code></h3>
<div class="paragraph">
<p>Of course, just a <code class="interface">Controller</code> interface isn&#8217;t enough.
To provide a basic infrastructure, all of Spring Portlet MVC&#8217;s <code class="interface">Controller`s inherit from [class]`AbstractController</code>, a class offering access to Spring&#8217;s <code class="interface">ApplicationContext</code> and control over caching.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 12. Features offered by the <code class="class">AbstractController</code></caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requireSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether or not this
              Controller requires a
              session to do its work. This feature is offered to
              all controllers. If a session is not present when
              such a controller receives a request, the user is
              informed using a
              SessionRequiredException.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">synchronizeSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this if you want handling by this
              controller to be synchronized on the user&#8217;s session.
              To be more specific, the extending controller will
              override the handleRenderRequestInternal(..) and
              handleActionRequestInternal(..) methods, which will be
              synchronized on the user&#8217;s session if you specify
              this variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">renderWhenMinimized</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cacheSeconds</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The <code>requireSession</code> and <code>cacheSeconds</code> properties are declared on the <code class="class">PortletContentGenerator</code> class, which is the superclass of <code class="class">AbstractController</code>) but are included here for completeness.</p>
</div>
<div class="paragraph">
<p>When using the <code class="class">AbstractController</code> as a base class for your controllers (which is not recommended since there are a lot of other controllers that might already do the job for you) you only have to override either the <code class="method">handleActionRequestInternal(ActionRequest,
      ActionResponse)</code> method or the <code class="method">handleRenderRequestInternal(RenderRequest,
      RenderResponse)</code> method (or both), implement your logic, and return a <code class="class">ModelAndView</code> object (in the case of <code>handleRenderRequestInternal</code>).</p>
</div>
<div class="paragraph">
<p>The default implementations of both <code class="method">handleActionRequestInternal(..)</code> and <code class="method">handleRenderRequestInternal(..)</code> throw a <code class="class">PortletException</code>.
This is consistent with the behavior of <code class="class">GenericPortlet</code> from the JSR- 168 Specification API. So you only need to override the method that your controller is intended to handle.</p>
</div>
<div class="paragraph">
<p>Here is short example consisting of a class and a declaration in the web application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package samples;

import javax.portlet.RenderRequest;
import javax.portlet.RenderResponse;

import org.springframework.web.portlet.mvc.AbstractController;
import org.springframework.web.portlet.ModelAndView;

public class SampleController extends AbstractController {

    public ModelAndView handleRenderRequestInternal(RenderRequest request, RenderResponse response) {
        ModelAndView mav = new ModelAndView("foo");
        mav.addObject("message", "Hello World!");
        return mav;
    }
}

&lt;bean id="sampleController" class="samples.SampleController"&gt;
    &lt;property name="cacheSeconds" value="120"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class above and the declaration in the web application context is all you need besides setting up a handler mapping (see <a href="#portlet-handlermapping">[portlet-handlermapping]</a>) to get this very simple controller working.</p>
</div>
</div>
<div class="sect2">
<h3 id="other-simple-controllers"><a class="anchor" href="#other-simple-controllers"></a>Other simple controllers</h3>
<div class="paragraph">
<p>Although you can extend <code class="class">AbstractController</code>, Spring Portlet MVC provides a number of concrete implementations which offer functionality that is commonly used in simple MVC applications.</p>
</div>
<div class="paragraph">
<p>The <code class="class">ParameterizableViewController</code> is basically the same as the example above, except for the fact that you can specify the view name that it will return in the web application context (no need to hard-code the view name).</p>
</div>
<div class="paragraph">
<p>The <code class="class">PortletModeNameViewController</code> uses the current mode of the portlet as the view name.
So, if your portlet is in View mode (i.e.
<code>PortletMode.VIEW</code>) then it uses "view" as the view name.</p>
</div>
</div>
<div class="sect2">
<h3 id="command-controllers"><a class="anchor" href="#command-controllers"></a>Command Controllers</h3>
<div class="paragraph">
<p>Spring Portlet MVC has the exact same hierarchy of <em>command controllers</em> as Spring Web MVC. They provide a way to interact with data objects and dynamically bind parameters from the <code class="interface">PortletRequest</code> to the data object specified.
Your data objects don&#8217;t have to implement a framework-specific interface, so you can directly manipulate your persistent objects if you desire.
Let&#8217;s examine what command controllers are available, to get an overview of what you can do with them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="class">AbstractCommandController</code> - a command controller you can use to create your own command controller, capable of binding request parameters to a data object you specify.
This class does not offer form functionality, it does however offer validation features and lets you specify in the controller itself what to do with the command object that has been filled with the parameters from the request.</p>
</li>
<li>
<p><code class="class">AbstractFormController</code> - an abstract controller offering form submission support.
Using this controller you can model forms and populate them using a command object you retrieve in the controller.
After a user has filled the form, <code class="class">AbstractFormController</code> binds the fields, validates, and hands the object back to the controller to take appropriate action.
Supported features are: invalid form submission (resubmission), validation, and normal form workflow.
You implement methods to determine which views are used for form presentation and success.
Use this controller if you need forms, but don&#8217;t want to specify what views you&#8217;re going to show the user in the application context.</p>
</li>
<li>
<p><code class="class">SimpleFormController</code> - a concrete <code class="class">AbstractFormController</code> that provides even more support when creating a form with a corresponding command object.
The <code class="class">SimpleFormController</code> lets you specify a command object, a viewname for the form, a viewname for the page you want to show the user when form submission has succeeded, and more.</p>
</li>
<li>
<p><code class="class">AbstractWizardFormController</code>  a concrete <code class="class">AbstractFormController</code> that provides a wizard-style interface for editing the contents of a command object across multiple display pages.
Supports multiple user actions: finish, cancel, or page change, all of which are easily specified in request parameters from the view.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These command controllers are quite powerful, but they do require a detailed understanding of how they operate in order to use them efficiently.
Carefully review the Javadocs for this entire hierarchy and then look at some sample implementations before you start using them.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-portletwrappingcontroller-code"><a class="anchor" href="#code-class-class-portletwrappingcontroller-code"></a><code class="class">PortletWrappingController</code></h3>
<div class="paragraph">
<p>Instead of developing new controllers, it is possible to use existing portlets and map requests to them from a <code class="class">DispatcherPortlet</code>.
Using the <code class="class">PortletWrappingController</code>, you can instantiate an existing <code class="interface">Portlet</code> as a <code class="interface">Controller</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="myPortlet" class="org.springframework.web.portlet.mvc.PortletWrappingController"&gt;
    &lt;property name="portletClass" value="sample.MyPortlet"/&gt;
    &lt;property name="portletName" value="my-portlet"/&gt;
    &lt;property name="initParameters"&gt;
        &lt;value&gt;config=/WEB-INF/my-portlet-config.xml&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be very valuable since you can then use interceptors to pre-process and post-process requests going to these portlets.
Since JSR-168 does not support any kind of filter mechanism, this is quite handy.
For example, this can be used to wrap the Hibernate <code class="class">OpenSessionInViewInterceptor</code> around a MyFaces JSF Portlet.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handler-mappings-2"><a class="anchor" href="#handler-mappings-2"></a>Handler mappings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using a handler mapping you can map incoming portlet requests to appropriate handlers.
There are some handler mappings you can use out of the box, for example, the <code class="class">PortletModeHandlerMapping</code>, but let&#8217;s first examine the general concept of a <code class="interface">HandlerMapping</code>.</p>
</div>
<div class="paragraph">
<p>Note: We are intentionally using the term &#8220;Handler&#8221; here instead of &#8220;Controller&#8221;.
<code class="class">DispatcherPortlet</code> is designed to be used with other ways to process requests than just Spring Portlet MVC&#8217;s own Controllers.
A Handler is any Object that can handle portlet requests.
Controllers are an example of Handlers, and they are of course the default.
To use some other framework with <code class="class">DispatcherPortlet</code>, a corresponding implementation of <code class="interface">HandlerAdapter</code> is all that is needed.</p>
</div>
<div class="paragraph">
<p>The functionality a basic <code class="interface">HandlerMapping</code> provides is the delivering of a <code class="class">HandlerExecutionChain</code>, which must contain the handler that matches the incoming request, and may also contain a list of handler interceptors that are applied to the request.
When a request comes in, the <code class="class">DispatcherPortlet</code> will hand it over to the handler mapping to let it inspect the request and come up with an appropriate <code class="class">HandlerExecutionChain</code>.
Then the <code class="class">DispatcherPortlet</code> will execute the handler and interceptors in the chain (if any).
These concepts are all exactly the same as in Spring Web MVC.</p>
</div>
<div class="paragraph">
<p>The concept of configurable handler mappings that can optionally contain interceptors (executed before or after the actual handler was executed, or both) is extremely powerful.
A lot of supporting functionality can be built into a custom <code class="interface">HandlerMapping</code>.
Think of a custom handler mapping that chooses a handler not only based on the portlet mode of the request coming in, but also on a specific state of the session associated with the request.</p>
</div>
<div class="paragraph">
<p>In Spring Web MVC, handler mappings are commonly based on URLs.
Since there is really no such thing as a URL within a Portlet, we must use other mechanisms to control mappings.
The two most common are the portlet mode and a request parameter, but anything available to the portlet request can be used in a custom handler mapping.</p>
</div>
<div class="paragraph">
<p>The rest of this section describes three of Spring Portlet MVC&#8217;s most commonly used handler mappings.
They all extend <code class="class">AbstractHandlerMapping</code> and share the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>interceptors</code>: The list of interceptors to use.
[interface]`HandlerInterceptor`s are discussed in <a href="#portlet-handlermapping-interceptor">[portlet-handlermapping-interceptor]</a>.</p>
</li>
<li>
<p><code>defaultHandler</code>: The default handler to use, when this handler mapping does not result in a matching handler.</p>
</li>
<li>
<p><code>order</code>: Based on the value of the order property (see the <code class="interface">org.springframework.core.Ordered</code> interface), Spring will sort all handler mappings available in the context and apply the first matching handler.</p>
</li>
<li>
<p><code>lazyInitHandlers</code>: Allows for lazy initialization of singleton handlers (prototype handlers are always lazily initialized).
Default value is false.
This property is directly implemented in the three concrete Handlers.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="code-class-class-portletmodehandlermapping-code"><a class="anchor" href="#code-class-class-portletmodehandlermapping-code"></a><code class="class">PortletModeHandlerMapping</code></h3>
<div class="paragraph">
<p>This is a simple handler mapping that maps incoming requests based on the current mode of the portlet (e.g.
&#8216;view&#8217;, &#8216;edit&#8217;, &#8216;help&#8217;).
An example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.web.portlet.handler.PortletModeHandlerMapping"&gt;
    &lt;property name="portletModeMap"&gt;
        &lt;map&gt;
            &lt;entry key="view" value-ref="viewHandler"/&gt;
            &lt;entry key="edit" value-ref="editHandler"/&gt;
            &lt;entry key="help" value-ref="helpHandler"/&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-parameterhandlermapping-code"><a class="anchor" href="#code-class-class-parameterhandlermapping-code"></a><code class="class">ParameterHandlerMapping</code></h3>
<div class="paragraph">
<p>If we need to navigate around to multiple controllers without changing portlet mode, the simplest way to do this is with a request parameter that is used as the key to control the mapping.</p>
</div>
<div class="paragraph">
<p><code class="class">ParameterHandlerMapping</code> uses the value of a specific request parameter to control the mapping.
The default name of the parameter is <code>'action'</code>, but can be changed using the <code>'parameterName'</code> property.</p>
</div>
<div class="paragraph">
<p>The bean configuration for this mapping will look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.web.portlet.handler.ParameterHandlerMapping&gt;
    &lt;property name="parameterMap"&gt;
        &lt;map&gt;
            &lt;entry key="add" value-ref="addItemHandler"/&gt;
            &lt;entry key="edit" value-ref="editItemHandler"/&gt;
            &lt;entry key="delete" value-ref="deleteItemHandler"/&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-portletmodeparameterhandlermapping-code"><a class="anchor" href="#code-class-class-portletmodeparameterhandlermapping-code"></a><code class="class">PortletModeParameterHandlerMapping</code></h3>
<div class="paragraph">
<p>The most powerful built-in handler mapping, <code class="class">PortletModeParameterHandlerMapping</code> combines the capabilities of the two previous ones to allow different navigation within each portlet mode.</p>
</div>
<div class="paragraph">
<p>Again the default name of the parameter is "action", but can be changed using the <code>parameterName</code> property.</p>
</div>
<div class="paragraph">
<p>By default, the same parameter value may not be used in two different portlet modes.
This is so that if the portal itself changes the portlet mode, the request will no longer be valid in the mapping.
This behavior can be changed by setting the <code>allowDupParameters</code> property to true.
However, this is not recommended.</p>
</div>
<div class="paragraph">
<p>The bean configuration for this mapping will look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.web.portlet.handler.PortletModeParameterHandlerMapping"&gt;
    &lt;property name="portletModeParameterMap"&gt;
        &lt;map&gt;
            &lt;entry key="view"&gt; &lt;!-- 'view' portlet mode --&gt;
                &lt;map&gt;
                    &lt;entry key="add" value-ref="addItemHandler"/&gt;
                    &lt;entry key="edit" value-ref="editItemHandler"/&gt;
                    &lt;entry key="delete" value-ref="deleteItemHandler"/&gt;
                &lt;/map&gt;
            &lt;/entry&gt;
            &lt;entry key="edit"&gt; &lt;!-- 'edit' portlet mode --&gt;
                &lt;map&gt;
                    &lt;entry key="prefs" value-ref="prefsHandler"/&gt;
                    &lt;entry key="resetPrefs" value-ref="resetPrefsHandler"/&gt;
                &lt;/map&gt;
            &lt;/entry&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping can be chained ahead of a <code class="class">PortletModeHandlerMapping</code>, which can then provide defaults for each mode and an overall default as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-interface-handlerinterceptor-s"><a class="anchor" href="#adding-interface-handlerinterceptor-s"></a>Adding [interface]`HandlerInterceptor`s</h3>
<div class="paragraph">
<p>Spring&#8217;s handler mapping mechanism has a notion of handler interceptors, which can be extremely useful when you want to apply specific functionality to certain requests, for example, checking for a principal.
Again Spring Portlet MVC implements these concepts in the same way as Web MVC.</p>
</div>
<div class="paragraph">
<p>Interceptors located in the handler mapping must implement <code class="interface">HandlerInterceptor</code> from the <code>org.springframework.web.portlet</code> package.
Just like the servlet version, this interface defines three methods: one that will be called before the actual handler will be executed (<code>preHandle</code>), one that will be called after the handler is executed (<code>postHandle</code>), and one that is called after the complete request has finished (<code>afterCompletion</code>).
These three methods should provide enough flexibility to do all kinds of pre- and post- processing.</p>
</div>
<div class="paragraph">
<p>The <code>preHandle</code> method returns a boolean value.
You can use this method to break or continue the processing of the execution chain.
When this method returns <code>true</code>, the handler execution chain will continue.
When it returns <code>false</code>, the <code class="class">DispatcherPortlet</code> assumes the interceptor itself has taken care of requests (and, for example, rendered an appropriate view) and does not continue executing the other interceptors and the actual handler in the execution chain.</p>
</div>
<div class="paragraph">
<p>The <code>postHandle</code> method is only called on a <code class="interface">RenderRequest</code>.
The <code>preHandle</code> and <code>afterCompletion</code> methods are called on both an <code class="interface">ActionRequest</code> and a <code class="interface">RenderRequest</code>.
If you need to execute logic in these methods for just one type of request, be sure to check what kind of request it is before processing it.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-handlerinterceptoradapter-code"><a class="anchor" href="#code-class-class-handlerinterceptoradapter-code"></a><code class="class">HandlerInterceptorAdapter</code></h3>
<div class="paragraph">
<p>As with the servlet package, the portlet package has a concrete implementation of <code class="interface">HandlerInterceptor</code> called <code class="class">HandlerInterceptorAdapter</code>.
This class has empty versions of all the methods so that you can inherit from this class and implement just one or two methods when that is all you need.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-parametermappinginterceptor-code"><a class="anchor" href="#code-class-class-parametermappinginterceptor-code"></a><code class="class">ParameterMappingInterceptor</code></h3>
<div class="paragraph">
<p>The portlet package also has a concrete interceptor named <code class="class">ParameterMappingInterceptor</code> that is meant to be used directly with <code class="class">ParameterHandlerMapping</code> and <code class="class">PortletModeParameterHandlerMapping</code>.
This interceptor will cause the parameter that is being used to control the mapping to be forwarded from an <code class="interface">ActionRequest</code> to the subsequent <code class="interface">RenderRequest</code>.
This will help ensure that the <code class="interface">RenderRequest</code> is mapped to the same Handler as the <code class="interface">ActionRequest</code>.
This is done in the <code>preHandle</code> method of the interceptor, so you can still modify the parameter value in your handler to change where the <code class="interface">RenderRequest</code> will be mapped.</p>
</div>
<div class="paragraph">
<p>Be aware that this interceptor is calling <code>setRenderParameter</code> on the <code class="interface">ActionResponse</code>, which means that you cannot call <code>sendRedirect</code> in your handler when using this interceptor.
If you need to do external redirects then you will either need to forward the mapping parameter manually or write a different interceptor to handle this for you.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="views-and-resolving-them"><a class="anchor" href="#views-and-resolving-them"></a>Views and resolving them</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned previously, Spring Portlet MVC directly reuses all the view technologies from Spring Web MVC. This includes not only the various <code class="interface">View</code> implementations themselves, but also the <code class="interface">ViewResolver</code> implementations.
For more information, refer to <a href="#view">[view]</a> and <a href="#mvc-viewresolver">[mvc-viewresolver]</a> respectively.</p>
</div>
<div class="paragraph">
<p>A few items on using the existing <code class="interface">View</code> and <code class="interface">ViewResolver</code> implementations  are worth mentioning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Most portals expect the result of rendering a portlet to be an HTML fragment.
So, things like JSP/JSTL, Velocity, FreeMarker, and XSLT all make sense.
But it is unlikely that views that return other document types will make any sense in a portlet context.</p>
</li>
<li>
<p>There is no such thing as an HTTP redirect from within a portlet (the <code>sendRedirect(..)</code> method of <code class="interface">ActionResponse</code> cannot be used to stay within the portal).
So, <code class="class">RedirectView</code> and use of the <code>'redirect:'</code> prefix will <em>not</em> work correctly from within Portlet MVC.</p>
</li>
<li>
<p>It may be possible to use the <code>'forward:'</code> prefix from within Portlet MVC. However, remember that since you are in a portlet, you have no idea what the current URL looks like.
This means you cannot use a relative URL to access other resources in your web application and that you will have to use an absolute URL.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, for JSP development, the new Spring Taglib and the new Spring Form Taglib both work in portlet views in exactly the same way that they work in servlet views.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multipart-file-upload-support"><a class="anchor" href="#multipart-file-upload-support"></a>Multipart (file upload) support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Portlet MVC has built-in multipart support to handle file uploads in portlet applications, just like Web MVC does.
The design for the multipart support is done with pluggable <code class="interface">PortletMultipartResolver</code> objects, defined in the <code>org.springframework.web.portlet.multipart</code> package.
Spring provides a <code class="interface">PortletMultipartResolver</code> for use with &lt;&lt;,Commons FileUpload&gt;&gt;.
How uploading files is supported will be described in the rest of this section.</p>
</div>
<div class="paragraph">
<p>By default, no multipart handling will be done by Spring Portlet MVC, as some developers will want to handle multiparts themselves.
You will have to enable it yourself by adding a multipart resolver to the web application&#8217;s context.
After you have done that, <code class="class">DispatcherPortlet</code> will inspect each request to see if it contains a multipart.
If no multipart is found, the request will continue as expected.
However, if a multipart is found in the request, the <code class="interface">PortletMultipartResolver</code> that has been declared in your context will be used.
After that, the multipart attribute in your request will be treated like any other attribute.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Any configured <code class="interface">PortletMultipartResolver</code> bean <em>must</em> have the following id (or name): "<code>portletMultipartResolver</code>".
If you have defined your <code class="interface">PortletMultipartResolver</code> with any other name, then the <code class="class">DispatcherPortlet</code> will <em>not</em> find your <code class="interface">PortletMultipartResolver</code>, and consequently no multipart support will be in effect.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="using-the-code-class-interface-portletmultipartresolver-code"><a class="anchor" href="#using-the-code-class-interface-portletmultipartresolver-code"></a>Using the <code class="interface">PortletMultipartResolver</code></h3>
<div class="paragraph">
<p>The following example shows how to use the <code class="class">CommonsPortletMultipartResolver</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="portletMultipartResolver"
        class="org.springframework.web.portlet.multipart.CommonsPortletMultipartResolver"&gt;

    &lt;!-- one of the properties available; the maximum file size in bytes --&gt;
    &lt;property name="maxUploadSize" value="100000"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you also need to put the appropriate jars in your classpath for the multipart resolver to work.
In the case of the <code class="class">CommonsMultipartResolver</code>, you need to use <code>commons-fileupload.jar</code>.
Be sure to use at least version 1.1 of Commons FileUpload as previous versions do not support JSR-168 Portlet applications.</p>
</div>
<div class="paragraph">
<p>Now that you have seen how to set Portlet MVC up to handle multipart requests, let&#8217;s talk about how to actually use it.
When <code class="class">DispatcherPortlet</code> detects a multipart request, it activates the resolver that has been declared in your context and hands over the request.
What the resolver then does is wrap the current <code class="interface">ActionRequest</code> in a <code class="interface">MultipartActionRequest</code> that has support for multipart file uploads.
Using the <code class="interface">MultipartActionRequest</code> you can get information about the multiparts contained by this request and actually get access to the multipart files themselves in your controllers.</p>
</div>
<div class="paragraph">
<p>Note that you can only receive multipart file uploads as part of an <code class="interface">ActionRequest</code>, not as part of a <code class="interface">RenderRequest</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="handling-a-file-upload-in-a-form-2"><a class="anchor" href="#handling-a-file-upload-in-a-form-2"></a>Handling a file upload in a form</h3>
<div class="paragraph">
<p>After the <code class="interface">PortletMultipartResolver</code> has finished doing its job, the request will be processed like any other.
To use the <code class="interface">PortletMultipartResolver</code>, create a form with an upload field (see example below), then let Spring bind the file onto your form (backing object).
To actually let the user upload a file, we have to create a (JSP/HTML) form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;h1&gt;Please upload a file&lt;/h1&gt;
&lt;form method="post" action="&lt;portlet:actionURL/&gt;" enctype="multipart/form-data"&gt;
    &lt;input type="file" name="file"/&gt;
    &lt;input type="submit"/&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we&#8217;ve created a field named &#8220;file&#8221; that matches the property of the bean that holds the <code>byte[]</code> array.
Furthermore we&#8217;ve added the encoding attribute (<code>enctype="multipart/form-data"</code>), which is necessary to let the browser know how to encode the multipart fields (do not forget this!).</p>
</div>
<div class="paragraph">
<p>Just as with any other property that&#8217;s not automagically convertible to a string or primitive type, to be able to put binary data in your objects you have to register a custom editor with the <code class="class">PortletRequestDataBinder</code>.
There are a couple of editors available for handling files and setting the results on an object.
There&#8217;s a <code class="class">StringMultipartFileEditor</code> capable of converting files to Strings (using a user-defined character set), and there is a <code class="class">ByteArrayMultipartFileEditor</code> which converts files to byte arrays.
They function analogous to the <code class="class">CustomDateEditor</code>.</p>
</div>
<div class="paragraph">
<p>So, to be able to upload files using a form, declare the resolver, a mapping to a controller that will process the bean, and the controller itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="portletMultipartResolver"
        class="org.springframework.web.portlet.multipart.CommonsPortletMultipartResolver"/&gt;

&lt;bean class="org.springframework.web.portlet.handler.PortletModeHandlerMapping"&gt;
    &lt;property name="portletModeMap"&gt;
        &lt;map&gt;
            &lt;entry key="view" value-ref="fileUploadController"/&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="fileUploadController" class="examples.FileUploadController"&gt;
    &lt;property name="commandClass" value="examples.FileUploadBean"/&gt;
    &lt;property name="formView" value="fileuploadform"/&gt;
    &lt;property name="successView" value="confirmation"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, create the controller and the actual class to hold the file property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class FileUploadController extends SimpleFormController {

    public void onSubmitAction(ActionRequest request, ActionResponse response,
            Object command, BindException errors) throws Exception {

        // cast the bean
        FileUploadBean bean = (FileUploadBean) command;

        // let's see if there's content there
        byte[] file = bean.getFile();
        if (file == null) {
            // hmm, that's strange, the user did not upload anything
        }

        // do something with the file here
    }

    protected void initBinder(
            PortletRequest request, PortletRequestDataBinder binder) throws Exception {
        // to actually be able to convert Multipart instance to byte[]
        // we have to register a custom editor
        binder.registerCustomEditor(byte[].class, new ByteArrayMultipartFileEditor());
        // now Spring knows how to handle multipart object and convert
    }
}

public class FileUploadBean {

    private byte[] file;

    public void setFile(byte[] file) {
        this.file = file;
    }

    public byte[] getFile() {
        return file;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code class="class">FileUploadBean</code> has a property of type <code>byte[]</code> that holds the file.
The controller registers a custom editor to let Spring know how to actually convert the multipart objects the resolver has found to properties specified by the bean.
In this example, nothing is done with the <code>byte[]</code> property of the bean itself, but in practice you can do whatever you want (save it in a database, mail it to somebody, etc).</p>
</div>
<div class="paragraph">
<p>An equivalent example in which a file is bound straight to a String-typed property on a form backing object might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class FileUploadController extends SimpleFormController {

    public void onSubmitAction(ActionRequest request, ActionResponse response,
            Object command, BindException errors) throws Exception {

        // cast the bean
        FileUploadBean bean = (FileUploadBean) command;

        // let's see if there's content there
        String file = bean.getFile();
        if (file == null) {
            // hmm, that's strange, the user did not upload anything
        }

        // do something with the file here
    }

    protected void initBinder(
        PortletRequest request, PortletRequestDataBinder binder) throws Exception {

        // to actually be able to convert Multipart instance to a String
        // we have to register a custom editor
        binder.registerCustomEditor(String.class,
            new StringMultipartFileEditor());
        // now Spring knows how to handle multipart objects and convert
    }
}

public class FileUploadBean {

    private String file;

    public void setFile(String file) {
        this.file = file;
    }

    public String getFile() {
        return file;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, this last example only makes (logical) sense in the context of uploading a plain text file (it wouldn&#8217;t work so well in the case of uploading an image file).</p>
</div>
<div class="paragraph">
<p>The third (and final) option is where one binds directly to a <code class="interface">MultipartFile</code> property declared on the (form backing) object&#8217;s class.
In this case one does not need to register any custom property editor because there is no type conversion to be performed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class FileUploadController extends SimpleFormController {

    public void onSubmitAction(ActionRequest request, ActionResponse response,
            Object command, BindException errors) throws Exception {

        // cast the bean
        FileUploadBean bean = (FileUploadBean) command;

        // let's see if there's content there
        MultipartFile file = bean.getFile();
        if (file == null) {
            // hmm, that's strange, the user did not upload anything
        }

        // do something with the file here
    }
}

public class FileUploadBean {

    private MultipartFile file;

    public void setFile(MultipartFile file) {
        this.file = file;
    }

    public MultipartFile getFile() {
        return file;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handling-exceptions-2"><a class="anchor" href="#handling-exceptions-2"></a>Handling exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just like Servlet MVC, Portlet MVC provides <code class="interface">HandlerExceptionResolver`s to ease the pain of unexpected exceptions that occur while your request is being processed by a handler that matched the request.
Portlet MVC also provides a portlet-specific, concrete [class]`SimpleMappingExceptionResolver</code> that enables you to take the class name of any exception that might be thrown and map it to a view name.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="annotation-based-controller-configuration"><a class="anchor" href="#annotation-based-controller-configuration"></a>Annotation-based controller configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring 2.5 introduced an annotation-based programming model for MVC controllers, using annotations such as <code class="interface">@RequestMapping</code>, <code class="interface">@RequestParam</code>, <code class="interface">@ModelAttribute</code>, etc.
This annotation support is available for both Servlet MVC and Portlet MVC. Controllers implemented in this style do not have to extend specific base classes or implement specific interfaces.
Furthermore, they do not usually have direct dependencies on Servlet or Portlet API&#8217;s, although they can easily get access to Servlet or Portlet facilities if desired.</p>
</div>
<div class="paragraph">
<p>The following sections document these annotations and how they are most commonly used in a Portlet environment.</p>
</div>
<div class="sect2">
<h3 id="setting-up-the-dispatcher-for-annotation-support"><a class="anchor" href="#setting-up-the-dispatcher-for-annotation-support"></a>Setting up the dispatcher for annotation support</h3>
<div class="paragraph">
<p><em>[interface]<code>@RequestMapping</code> will only be processed
      if a corresponding <code class="interface">HandlerMapping</code> (for type level annotations)
      and/or <code class="interface">HandlerAdapter</code> (for method level annotations) is
      present in the dispatcher.</em> This is the case by default in both <code class="class">DispatcherServlet</code> and <code class="class">DispatcherPortlet</code>.</p>
</div>
<div class="paragraph">
<p>However, if you are defining custom <code class="interface">HandlerMappings</code> or <code class="interface">HandlerAdapters</code>, then you need to make sure that a corresponding custom <code class="class">DefaultAnnotationHandlerMapping</code> and/or <code class="class">AnnotationMethodHandlerAdapter</code> is defined as well - provided that you intend to use <code class="interface">@RequestMapping</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;bean class="org.springframework.web.portlet.mvc.annotation.DefaultAnnotationHandlerMapping"/&gt;

    &lt;bean class="org.springframework.web.portlet.mvc.annotation.AnnotationMethodHandlerAdapter"/&gt;

    // ... (controller bean definitions) ...

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Defining a <code class="class">DefaultAnnotationHandlerMapping</code> and/or <code class="class">AnnotationMethodHandlerAdapter</code> explicitly also makes sense if you would like to customize the mapping strategy, e.g.
specifying a custom <code class="interface">WebBindingInitializer</code> (see below).</p>
</div>
</div>
<div class="sect2">
<h3 id="defining-a-controller-with-code-class-interface-controller-code-2"><a class="anchor" href="#defining-a-controller-with-code-class-interface-controller-code-2"></a>Defining a controller with <code class="interface">@Controller</code></h3>
<div class="paragraph">
<p>The <code class="interface">@Controller</code> annotation indicates that a particular class serves the role of a <em>controller</em>.
There is no need to extend any controller base class or reference the Portlet API. You are of course still able to reference Portlet-specific features if you need to.</p>
</div>
<div class="paragraph">
<p>The basic purpose of the <code class="interface">@Controller</code> annotation is to act as a stereotype for the annotated class, indicating its role.
The dispatcher will scan such annotated classes for mapped methods, detecting <code class="interface">@RequestMapping</code> annotations (see the next section).</p>
</div>
<div class="paragraph">
<p>Annotated controller beans may be defined explicitly, using a standard Spring bean definition in the dispatcher&#8217;s context.
However, the <code class="interface">@Controller</code> stereotype also allows for autodetection, aligned with Spring 2.5&#8217;s general support for detecting component classes in the classpath and auto-registering bean definitions for them.</p>
</div>
<div class="paragraph">
<p>To enable autodetection of such annotated controllers, you have to add component scanning to your configuration.
This is easily achieved by using the <em>spring-context</em> schema as shown in the following XML snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"&gt;

    &lt;context:component-scan base-package="org.springframework.samples.petportal.portlet"/&gt;

    // ...

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapping-requests-with-code-class-interface-requestmapping-code-2"><a class="anchor" href="#mapping-requests-with-code-class-interface-requestmapping-code-2"></a>Mapping requests with <code class="interface">@RequestMapping</code></h3>
<div class="paragraph">
<p>The <code class="interface">@RequestMapping</code> annotation is used to map portlet modes like <em>VIEW</em>/<em>EDIT</em> onto an entire class or a particular handler method.
Typically the type-level annotation maps a specific mode (or mode plus parameter condition) onto a form controller, with additional method-level annotations <em>narrowing</em> the primary mapping for specific portlet request parameters.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code class="interface">@RequestMapping</code> at the type level may be used for plain implementations of the <code class="interface">Controller</code> interface as well.
In this case, the request processing code would follow the traditional <code>handle(Action|Render)Request</code> signature, while the controller&#8217;s mapping would be expressed through an <code class="interface">@RequestMapping</code> annotation.
This works for pre-built <code class="interface">Controller</code> base classes, such as <code class="class">SimpleFormController</code>, too.</p>
</div>
<div class="paragraph">
<p>In the following discussion, we&#8217;ll focus on controllers that are based on annotated handler methods.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example of a form controller from the PetPortal sample application using this annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("EDIT")
@SessionAttributes("site")
public class PetSitesEditController {

    private Properties petSites;

    public void setPetSites(Properties petSites) {
        this.petSites = petSites;
    }

    @ModelAttribute("petSites")
    public Properties getPetSites() {
        return this.petSites;
    }

    @RequestMapping  // default (action=list)
    public String showPetSites() {
        return "petSitesEdit";
    }

    @RequestMapping(params = "action=add")  // render phase
    public String showSiteForm(Model model) {
        // Used for the initial form as well as for redisplaying with errors.
        if (!model.containsAttribute("site")) {
            model.addAttribute("site", new PetSite());
        }
        return "petSitesAdd";
    }

    @RequestMapping(params = "action=add")  // action phase
    public void populateSite(
            @ModelAttribute("site") PetSite petSite, BindingResult result,
            SessionStatus status, ActionResponse response) {

        new PetSiteValidator().validate(petSite, result);
        if (!result.hasErrors()) {
            this.petSites.put(petSite.getName(), petSite.getUrl());
            status.setComplete();
            response.setRenderParameter("action", "list");
        }
    }

    @RequestMapping(params = "action=delete")
    public void removeSite(@RequestParam("site") String site, ActionResponse response) {
        this.petSites.remove(site);
        response.setRenderParameter("action", "list");
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="supported-handler-method-arguments"><a class="anchor" href="#supported-handler-method-arguments"></a>Supported handler method arguments</h3>
<div class="paragraph">
<p>Handler methods which are annotated with <code class="class">@RequestMapping</code> are allowed to have very flexible signatures.
They may have arguments of the following types, in arbitrary order (except for validation results, which need to follow right after the corresponding command object, if desired):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Request and/or response objects (Portlet API).
You may choose any specific request/response type, e.g.
PortletRequest / ActionRequest / RenderRequest.
An explicitly declared action/render argument is also used for mapping specific request types onto a handler method (in case of no other information given that differentiates between action and render requests).</p>
</li>
<li>
<p>Session object (Portlet API): of type PortletSession.
An argument of this type will enforce the presence of a corresponding session.
As a consequence, such an argument will never be <code>null</code>.</p>
</li>
<li>
<p><code class="class">org.springframework.web.context.request.WebRequest</code> or <code class="class">org.springframework.web.context.request.NativeWebRequest</code>.
Allows for generic request parameter access as well as request/session attribute access, without ties to the native Servlet/Portlet API.</p>
</li>
<li>
<p><code class="class">java.util.Locale</code> for the current request locale (the portal locale in a Portlet environment).</p>
</li>
<li>
<p><code class="class">java.io.InputStream</code> / <code class="class">java.io.Reader</code> for access to the request&#8217;s content.
This will be the raw InputStream/Reader as exposed by the Portlet API.</p>
</li>
<li>
<p><code class="class">java.io.OutputStream</code> / <code class="class">java.io.Writer</code> for generating the response&#8217;s content.
This will be the raw OutputStream/Writer as exposed by the Portlet API.</p>
</li>
<li>
<p><code class="class">@RequestParam</code> annotated parameters for access to specific Portlet request parameters.
Parameter values will be converted to the declared method argument type.</p>
</li>
<li>
<p><code class="interface">java.util.Map</code> / <code class="interface">org.springframework.ui.Model</code> / <code class="class">org.springframework.ui.ModelMap</code> for enriching the implicit model that will be exposed to the web view.</p>
</li>
<li>
<p>Command/form objects to bind parameters to: as bean properties or fields, with customizable type conversion, depending on <code class="class">@InitBinder</code> methods and/or the HandlerAdapter configuration - see the "<code>webBindingInitializer</code>" property on <code class="class">AnnotationMethodHandlerAdapter</code>.
Such command objects along with their validation results will be exposed as model attributes, by default using the non-qualified command class name in property notation (e.g.
"orderAddress" for type "mypackage.OrderAddress").
Specify a parameter-level <code class="class">ModelAttribute</code> annotation for declaring a specific model attribute name.</p>
</li>
<li>
<p><code class="class">org.springframework.validation.Errors</code> / <code class="class">org.springframework.validation.BindingResult</code> validation results for a preceding command/form object (the immediate preceding argument).</p>
</li>
<li>
<p><code class="class">org.springframework.web.bind.support.SessionStatus</code> status handle for marking form processing as complete (triggering the cleanup of session attributes that have been indicated by the <code class="class">@SessionAttributes</code> annotation at the handler type level).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following return types are supported for handler methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code class="class">ModelAndView</code> object, with the model implicitly enriched with command objects and the results of <code>@ModelAttribute</code> annotated reference data accessor methods.</p>
</li>
<li>
<p>A <code class="interface">Model</code> object, with the view name implicitly determined through a <code class="interface">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects and the results of <code>@ModelAttribute</code> annotated reference data accessor methods.</p>
</li>
<li>
<p>A <code class="interface">Map</code> object for exposing a model, with the view name implicitly determined through a <code class="interface">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects and the results of <code>@ModelAttribute</code> annotated reference data accessor methods.</p>
</li>
<li>
<p>A <code class="interface">View</code> object, with the model implicitly determined through command objects and <code>@ModelAttribute</code> annotated reference data accessor methods.
The handler method may also programmatically enrich the model by declaring a <code class="interface">Model</code> argument (see above).</p>
</li>
<li>
<p>A <code class="class">String</code> value which is interpreted as view name, with the model implicitly determined through command objects and <code>@ModelAttribute</code> annotated reference data accessor methods.
The handler method may also programmatically enrich the model by declaring a <code class="interface">Model</code> argument (see above).</p>
</li>
<li>
<p><code>void</code> if the method handles the response itself (e.g.
by writing the response content directly).</p>
</li>
<li>
<p>Any other return type will be considered a single model attribute to be exposed to the view, using the attribute name specified through <code>@ModelAttribute</code> at the method level (or the default attribute name based on the return type&#8217;s class name otherwise).
The model will be implicitly enriched with command objects and the results of <code>@ModelAttribute</code> annotated reference data accessor methods.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="binding-request-parameters-to-method-parameters-with-code-class-class-requestparam-code"><a class="anchor" href="#binding-request-parameters-to-method-parameters-with-code-class-class-requestparam-code"></a>Binding request parameters to method parameters with <code class="class">@RequestParam</code></h3>
<div class="paragraph">
<p>The <code class="class">@RequestParam</code> annotation is used to bind request parameters to a method parameter in your controller.</p>
</div>
<div class="paragraph">
<p>The following code snippet from the PetPortal sample application shows the usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("EDIT")
@SessionAttributes("site")
public class PetSitesEditController {

    // ...

    public void removeSite(@RequestParam("site") String site, ActionResponse response) {
        this.petSites.remove(site);
        response.setRenderParameter("action", "list");
    }

    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameters using this annotation are required by default, but you can specify that a parameter is optional by setting <code class="interface">@RequestParam</code>'s <code>required</code> attribute to <code>false</code> (e.g., <code>@RequestParam(value="id", required=false)</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="providing-a-link-to-data-from-the-model-with-code-class-class-modelattribute-code"><a class="anchor" href="#providing-a-link-to-data-from-the-model-with-code-class-class-modelattribute-code"></a>Providing a link to data from the model with <code class="class">@ModelAttribute</code></h3>
<div class="paragraph">
<p><code class="class">@ModelAttribute</code> has two usage scenarios in controllers.
When placed on a method parameter, <code class="class">@ModelAttribute</code> is used to map a model attribute to the specific, annotated method parameter (see the <code>populateSite()</code> method below).
This is how the controller gets a reference to the object holding the data entered in the form.
In addition, the parameter can be declared as the specific type of the form backing object rather than as a generic <code class="class">java.lang.Object</code>, thus increasing type safety.</p>
</div>
<div class="paragraph">
<p><code class="class">@ModelAttribute</code> is also used at the method level to provide <em>reference data</em> for the model (see the <code>getPetSites()</code> method below).
For this usage the method signature can contain the same types as documented above for the <code class="class">@RequestMapping</code> annotation.</p>
</div>
<div class="paragraph">
<p><em>Note:</em> <code class="class">@ModelAttribute</code> annotated methods will be executed <em>before</em> the chosen <code class="class">@RequestMapping</code> annotated handler method.
They effectively pre-populate the implicit model with specific attributes, often loaded from a database.
Such an attribute can then already be accessed through <code class="class">@ModelAttribute</code> annotated handler method parameters in the chosen handler method, potentially with binding and validation applied to it.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows these two usages of this annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("EDIT")
@SessionAttributes("site")
public class PetSitesEditController {

    // ...

    @ModelAttribute("petSites")
    public Properties getPetSites() {
        return this.petSites;
    }

    @RequestMapping(params = "action=add")  // action phase
    public void populateSite(
            @ModelAttribute("site") PetSite petSite, BindingResult result,
            SessionStatus status, ActionResponse response) {

        new PetSiteValidator().validate(petSite, result);
        if (!result.hasErrors()) {
            this.petSites.put(petSite.getName(), petSite.getUrl());
            status.setComplete();
            response.setRenderParameter("action", "list");
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="specifying-attributes-to-store-in-a-session-with-code-class-class-sessionattributes-code"><a class="anchor" href="#specifying-attributes-to-store-in-a-session-with-code-class-class-sessionattributes-code"></a>Specifying attributes to store in a Session with <code class="class">@SessionAttributes</code></h3>
<div class="paragraph">
<p>The type-level <code class="class">@SessionAttributes</code> annotation declares session attributes used by a specific handler.
This will typically list the names of model attributes or types of model attributes which should be transparently stored in the session or some conversational storage, serving as form-backing beans between subsequent requests.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows the usage of this annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
@RequestMapping("EDIT")
@SessionAttributes("site")
public class PetSitesEditController {
  // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customizing-code-class-class-webdatabinder-code-initialization-2"><a class="anchor" href="#customizing-code-class-class-webdatabinder-code-initialization-2"></a>Customizing <code class="class">WebDataBinder</code> initialization</h3>
<div class="paragraph">
<p>To customize request parameter binding with PropertyEditors, etc.
via Spring&#8217;s <code class="class">WebDataBinder</code>, you can either use <code class="interface">@InitBinder</code>-annotated methods within your controller or externalize your configuration by providing a custom <code class="interface">WebBindingInitializer</code>.</p>
</div>
<div class="sect3">
<h4 id="customizing-data-binding-with-code-class-interface-initbinder-code-2"><a class="anchor" href="#customizing-data-binding-with-code-class-interface-initbinder-code-2"></a>Customizing data binding with <code class="interface">@InitBinder</code></h4>
<div class="paragraph">
<p>Annotating controller methods with <code class="interface">@InitBinder</code> allows you to configure web data binding directly within your controller class.
<code class="interface">@InitBinder</code> identifies methods which initialize the <code class="class">WebDataBinder</code> which will be used for populating command and form object arguments of annotated handler methods.</p>
</div>
<div class="paragraph">
<p>Such init-binder methods support all arguments that <code class="interface">@RequestMapping</code> supports, except for command/form objects and corresponding validation result objects.
Init-binder methods must not have a return value.
Thus, they are usually declared as <code>void</code>.
Typical arguments include <code class="class">WebDataBinder</code> in combination with <code class="interface">WebRequest</code> or <code class="class">java.util.Locale</code>, allowing code to register context-specific editors.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates the use of <code class="interface">@InitBinder</code> for configuring a <code class="class">CustomDateEditor</code> for all <code class="class">java.util.Date</code> form properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Controller
public class MyFormController {

    @InitBinder
    public void initBinder(WebDataBinder binder) {
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
        dateFormat.setLenient(false);
        binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, false));
    }

    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-a-custom-code-class-interface-webbindinginitializer-code-2"><a class="anchor" href="#configuring-a-custom-code-class-interface-webbindinginitializer-code-2"></a>Configuring a custom <code class="interface">WebBindingInitializer</code></h4>
<div class="paragraph">
<p>To externalize data binding initialization, you can provide a custom implementation of the <code class="interface">WebBindingInitializer</code> interface, which you then enable by supplying a custom bean configuration for an <code class="class">AnnotationMethodHandlerAdapter</code>, thus overriding the default configuration.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="portlet-application-deployment"><a class="anchor" href="#portlet-application-deployment"></a>Portlet application deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process of deploying a Spring Portlet MVC application is no different than deploying any JSR-168 Portlet application.
However, this area is confusing enough in general that it is worth talking about here briefly.</p>
</div>
<div class="paragraph">
<p>Generally, the portal/portlet container runs in one webapp in your servlet container and your portlets run in another webapp in your servlet container.
In order for the portlet container webapp to make calls into your portlet webapp it must make cross-context calls to a well-known servlet that provides access to the portlet services defined in your <code>portlet.xml</code> file.</p>
</div>
<div class="paragraph">
<p>The JSR-168 specification does not specify exactly how this should happen, so each portlet container has its own mechanism for this, which usually involves some kind of &#8220;deployment process&#8221; that makes changes to the portlet webapp itself and then registers the portlets within the portlet container.</p>
</div>
<div class="paragraph">
<p>At a minimum, the <code>web.xml</code> file in your portlet webapp is modified to inject the well-known servlet that the portlet container will call.
In some cases a single servlet will service all portlets in the webapp, in other cases there will be an instance of the servlet for each portlet.</p>
</div>
<div class="paragraph">
<p>Some portlet containers will also inject libraries and/or configuration files into the webapp as well.
The portlet container must also make its implementation of the Portlet JSP Tag Library available to your webapp.</p>
</div>
<div class="paragraph">
<p>The bottom line is that it is important to understand the deployment needs of your target portal and make sure they are met (usually by following the automated deployment process it provides).
Be sure to carefully review the documentation from your portal for this process.</p>
</div>
<div class="paragraph">
<p>Once you have deployed your portlet, review the resulting <code>web.xml</code> file for sanity.
Some older portals have been known to corrupt the definition of the <code class="class">ViewRendererServlet</code>, thus breaking the rendering of your portlets.</p>
</div>
</div>
</div>
<h1 id="spring-integration" class="sect0"><a class="anchor" href="#spring-integration"></a>Integration</h1>
<div class="paragraph">
<p>This part of the reference documentation covers the Spring Framework&#8217;s integration with a number of Java EE (and related) technologies.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#remoting">[remoting]</a></p>
</li>
<li>
<p><a href="#ejb">[ejb]</a></p>
</li>
<li>
<p><a href="#jms">JMS</a></p>
</li>
<li>
<p><a href="#jmx">JMX</a></p>
</li>
<li>
<p><a href="#cci">[cci]</a></p>
</li>
<li>
<p><a href="#mail">[mail]</a></p>
</li>
<li>
<p><a href="#scheduling">[scheduling]</a></p>
</li>
<li>
<p><a href="#dynamic-language">[dynamic-language]</a></p>
</li>
<li>
<p><a href="#cache">[cache]</a></p>
</li>
</ul>
</div>
<h1 id="remoting-and-web-services-using-spring" class="sect0"><a class="anchor" href="#remoting-and-web-services-using-spring"></a>Remoting and web services using Spring</h1>
<div class="sect1">
<h2 id="introduction-7"><a class="anchor" href="#introduction-7"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring features integration classes for remoting support using various technologies.
The remoting support eases the development of remote-enabled services, implemented by your usual (Spring) POJOs.
Currently, Spring supports the following remoting technologies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Remote Method Invocation (RMI)</em>.
Through the use of the <code class="class">RmiProxyFactoryBean</code> and the <code class="class">RmiServiceExporter</code> Spring supports both traditional RMI (with <code class="interface">java.rmi.Remote</code> interfaces and ) and transparent remoting via RMI invokers (with any Java interface).</p>
</li>
<li>
<p><em>Spring&#8217;s HTTP invoker</em>.
Spring provides a special remoting strategy which allows for Java serialization via HTTP, supporting any Java interface (just like the RMI invoker).
The corresponding support classes are <code class="class">HttpInvokerProxyFactoryBean</code> and <code class="class">HttpInvokerServiceExporter</code>.</p>
</li>
<li>
<p><em>Hessian</em>.
By using Spring&#8217;s <code class="class">HessianProxyFactoryBean</code> and the <code class="class">HessianServiceExporter</code> you can transparently expose your services using the lightweight binary HTTP-based protocol provided by Caucho.</p>
</li>
<li>
<p><em>Burlap</em>.
Burlap is Caucho&#8217;s XML-based alternative to Hessian.
Spring provides support classes such as <code class="class">BurlapProxyFactoryBean</code> and <code class="class">BurlapServiceExporter</code>.</p>
</li>
<li>
<p><em>JAX-WS</em>.
Spring provides remoting support for web services via JAX-WS (the successor of JAX-RPC, as introduced in Java EE 5 and Java 6).</p>
</li>
<li>
<p><em>JMS</em>.
Remoting using JMS as the underlying protocol is supported via the <code class="class">JmsInvokerServiceExporter</code> and <code class="class">JmsInvokerProxyFactoryBean</code> classes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While discussing the remoting capabilities of Spring, we&#8217;ll use the following domain model and corresponding services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class Account implements Serializable{

    private String name;

    public String getName(){
        return name;
    }

    public void setName(String name) {
      this.name = name;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface AccountService {

    public void insertAccount(Account account);

    public List&lt;Account&gt; getAccounts(String name);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface RemoteAccountService extends Remote {

    public void insertAccount(Account account) throws RemoteException;

    public List&lt;Account&gt; getAccounts(String name) throws RemoteException;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// the implementation doing nothing at the moment
public class AccountServiceImpl implements AccountService {

    public void insertAccount(Account acc) {
        // do something...
    }

    public List&lt;Account&gt; getAccounts(String name) {
        // do something...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will start exposing the service to a remote client by using RMI and talk a bit about the drawbacks of using RMI. We&#8217;ll then continue to show an example using Hessian as the protocol.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exposing-services-using-rmi"><a class="anchor" href="#exposing-services-using-rmi"></a>Exposing services using RMI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using Spring&#8217;s support for RMI, you can transparently expose your services through the RMI infrastructure.
After having this set up, you basically have a configuration similar to remote EJBs, except for the fact that there is no standard support for security context propagation or remote transaction propagation.
Spring does provide hooks for such additional invocation context when using the RMI invoker, so you can for example plug in security frameworks or custom security credentials here.</p>
</div>
<div class="sect2">
<h3 id="exporting-the-service-using-the-code-class-class-rmiserviceexporter-code"><a class="anchor" href="#exporting-the-service-using-the-code-class-class-rmiserviceexporter-code"></a>Exporting the service using the <code class="class">RmiServiceExporter</code></h3>
<div class="paragraph">
<p>Using the <code class="class">RmiServiceExporter</code>, we can expose the interface of our AccountService object as RMI object.
The interface can be accessed by using <code class="class">RmiProxyFactoryBean</code>, or via plain RMI in case of a traditional RMI service.
The <code class="class">RmiServiceExporter</code> explicitly supports the exposing of any non-RMI services via RMI invokers.</p>
</div>
<div class="paragraph">
<p>Of course, we first have to set up our service in the Spring container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="accountService" class="example.AccountServiceImpl"&gt;
    &lt;!-- any additional properties, maybe a DAO? --&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;ll have to expose our service using the <code class="class">RmiServiceExporter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.remoting.rmi.RmiServiceExporter"&gt;
    &lt;!-- does not necessarily have to be the same name as the bean to be exported --&gt;
    &lt;property name="serviceName" value="AccountService"/&gt;
    &lt;property name="service" ref="accountService"/&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
    &lt;!-- defaults to 1099 --&gt;
    &lt;property name="registryPort" value="1199"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we&#8217;re overriding the port for the RMI registry.
Often, your application server also maintains an RMI registry and it is wise to not interfere with that one.
Furthermore, the service name is used to bind the service under.
So right now, the service will be bound at <code>'rmi://HOST:1199/AccountService'</code>.
We&#8217;ll use the URL later on to link in the service at the client side.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The <code>servicePort</code> property has been omitted (it defaults to 0).
This means that an anonymous port will be used to communicate with the service.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="linking-in-the-service-at-the-client"><a class="anchor" href="#linking-in-the-service-at-the-client"></a>Linking in the service at the client</h3>
<div class="paragraph">
<p>Our client is a simple object using the <code class="interface">AccountService</code> to manage accounts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class SimpleObject {

    private AccountService accountService;

    public void setAccountService(AccountService accountService) {
        this.accountService = accountService;
    }

    // additional methods using the accountService

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To link in the service on the client, we&#8217;ll create a separate Spring container, containing the simple object and the service linking configuration bits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="example.SimpleObject"&gt;
    &lt;property name="accountService" ref="accountService"/&gt;
&lt;/bean&gt;

&lt;bean id="accountService" class="org.springframework.remoting.rmi.RmiProxyFactoryBean"&gt;
    &lt;property name="serviceUrl" value="rmi://HOST:1199/AccountService"/&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all we need to do to support the remote account service on the client.
Spring will transparently create an invoker and remotely enable the account service through the <code class="class">RmiServiceExporter</code>.
At the client we&#8217;re linking it in using the <code class="class">RmiProxyFactoryBean</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-hessian-or-burlap-to-remotely-call-services-via-http"><a class="anchor" href="#using-hessian-or-burlap-to-remotely-call-services-via-http"></a>Using Hessian or Burlap to remotely call services via HTTP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hessian offers a binary HTTP-based remoting protocol.
It is developed by Caucho and more information about Hessian itself can be found at &lt;&lt;,&gt;&gt;.</p>
</div>
<div class="sect2">
<h3 id="wiring-up-the-code-class-class-dispatcherservlet-code-for-hessian-and-co"><a class="anchor" href="#wiring-up-the-code-class-class-dispatcherservlet-code-for-hessian-and-co"></a>Wiring up the <code class="class">DispatcherServlet</code> for Hessian and co.</h3>
<div class="paragraph">
<p>Hessian communicates via HTTP and does so using a custom servlet.
Using Spring&#8217;s <code class="class">DispatcherServlet</code> principles, as known from Spring Web MVC usage, you can easily wire up such a servlet exposing your services.
First we&#8217;ll have to create a new servlet in your application (this is an excerpt from <code class="file">'web.xml'</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;servlet&gt;
    &lt;servlet-name&gt;remoting&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;remoting&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/remoting/*&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;re probably familiar with Spring&#8217;s <code class="class">DispatcherServlet</code> principles and if so, you know that now you&#8217;ll have to create a Spring container configuration resource named <code class="file">'remoting-servlet.xml'</code> (after the name of your servlet) in the <code class="file">'WEB-INF'</code> directory.
The application context will be used in the next section.</p>
</div>
<div class="paragraph">
<p>Alternatively, consider the use of Spring&#8217;s simpler <code class="class">HttpRequestHandlerServlet</code>.
This allows you to embed the remote exporter definitions in your root application context (by default in <code class="file">'WEB-INF/applicationContext.xml'</code>), with individual servlet definitions pointing to specific exporter beans.
Each servlet name needs to match the bean name of its target exporter in this case.</p>
</div>
</div>
<div class="sect2">
<h3 id="exposing-your-beans-by-using-the-code-class-class-hessianserviceexporter-code"><a class="anchor" href="#exposing-your-beans-by-using-the-code-class-class-hessianserviceexporter-code"></a>Exposing your beans by using the <code class="class">HessianServiceExporter</code></h3>
<div class="paragraph">
<p>In the newly created application context called <code>remoting-servlet.xml</code>, we&#8217;ll create a <code class="class">HessianServiceExporter</code> exporting your services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="accountService" class="example.AccountServiceImpl"&gt;
    &lt;!-- any additional properties, maybe a DAO? --&gt;
&lt;/bean&gt;

&lt;bean name="/AccountService" class="org.springframework.remoting.caucho.HessianServiceExporter"&gt;
    &lt;property name="service" ref="accountService"/&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we&#8217;re ready to link in the service at the client.
No explicit handler mapping is specified, mapping request URLs onto services, so <code class="class">BeanNameUrlHandlerMapping</code> will be used: Hence, the service will be exported at the URL indicated through its bean name within the containing <code class="class">DispatcherServlet</code>'s mapping (as defined above): <code>'http://HOST:8080/remoting/AccountService'</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, create a <code class="class">HessianServiceExporter</code> in your root application context (e.g.
in <code class="file">'WEB-INF/applicationContext.xml'</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean name="accountExporter" class="org.springframework.remoting.caucho.HessianServiceExporter"&gt;
    &lt;property name="service" ref="accountService"/&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the latter case, define a corresponding servlet for this exporter in <code class="file">'web.xml'</code>, with the same end result: The exporter getting mapped to the request path <code>/remoting/AccountService</code>.
Note that the servlet name needs to match the bean name of the target exporter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;servlet&gt;
    &lt;servlet-name&gt;accountExporter&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.context.support.HttpRequestHandlerServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;accountExporter&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/remoting/AccountService&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linking-in-the-service-on-the-client"><a class="anchor" href="#linking-in-the-service-on-the-client"></a>Linking in the service on the client</h3>
<div class="paragraph">
<p>Using the <code class="class">HessianProxyFactoryBean</code> we can link in the service at the client.
The same principles apply as with the RMI example.
We&#8217;ll create a separate bean factory or application context and mention the following beans where the <code class="class">SimpleObject</code> is using the <code class="interface">AccountService</code> to manage accounts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="example.SimpleObject"&gt;
    &lt;property name="accountService" ref="accountService"/&gt;
&lt;/bean&gt;

&lt;bean id="accountService" class="org.springframework.remoting.caucho.HessianProxyFactoryBean"&gt;
    &lt;property name="serviceUrl" value="http://remotehost:8080/remoting/AccountService"/&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-burlap"><a class="anchor" href="#using-burlap"></a>Using Burlap</h3>
<div class="paragraph">
<p>We won&#8217;t discuss Burlap, the XML-based equivalent of Hessian, in detail here, since it is configured and set up in exactly the same way as the Hessian variant explained above.
Just replace the word <code>Hessian</code> with <code>Burlap</code> and you&#8217;re all set to go.</p>
</div>
</div>
<div class="sect2">
<h3 id="applying-http-basic-authentication-to-a-service-exposed-through-hessian-or-burlap"><a class="anchor" href="#applying-http-basic-authentication-to-a-service-exposed-through-hessian-or-burlap"></a>Applying HTTP basic authentication to a service exposed through Hessian or Burlap</h3>
<div class="paragraph">
<p>One of the advantages of Hessian and Burlap is that we can easily apply HTTP basic authentication, because both protocols are HTTP-based.
Your normal HTTP server security mechanism can easily be applied through using the <code>web.xml</code> security features, for example.
Usually, you don&#8217;t use per-user security credentials here, but rather shared credentials defined at the <code>Hessian/BurlapProxyFactoryBean</code> level (similar to a JDBC <code class="interface">DataSource</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping"&gt;
    &lt;property name="interceptors" ref="authorizationInterceptor"/&gt;
&lt;/bean&gt;

&lt;bean id="authorizationInterceptor"
      class="org.springframework.web.servlet.handler.UserRoleAuthorizationInterceptor"&gt;
    &lt;property name="authorizedRoles" value="administrator,operator"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an example where we explicitly mention the <code class="class">BeanNameUrlHandlerMapping</code> and set an interceptor allowing only administrators and operators to call the beans mentioned in this application context.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Of course, this example doesn&#8217;t show a flexible kind of security infrastructure.
For more options as far as security is concerned, have a look at the Spring Security project at &lt;&lt;,&gt;&gt;.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exposing-services-using-http-invokers"><a class="anchor" href="#exposing-services-using-http-invokers"></a>Exposing services using HTTP invokers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As opposed to Burlap and Hessian, which are both lightweight protocols using their own slim serialization mechanisms, Spring HTTP invokers use the standard Java serialization mechanism to expose services through HTTP. This has a huge advantage if your arguments and return types are complex types that cannot be serialized using the serialization mechanisms Hessian and Burlap use (refer to the next section for more considerations when choosing a remoting technology).</p>
</div>
<div class="paragraph">
<p>Under the hood, Spring uses either the standard facilities provided by J2SE to perform HTTP calls or Commons <code class="class">HttpClient</code>.
Use the latter if you need more advanced and easy-to-use functionality.
Refer to &lt;&lt;,jakarta.apache.org/commons/httpclient&gt;&gt; for more info.</p>
</div>
<div class="sect2">
<h3 id="exposing-the-service-object"><a class="anchor" href="#exposing-the-service-object"></a>Exposing the service object</h3>
<div class="paragraph">
<p>Setting up the HTTP invoker infrastructure for a service object resembles closely the way you would do the same using Hessian or Burlap.
Just as Hessian support provides the <code class="class">HessianServiceExporter</code>, Spring&#8217;s HttpInvoker support provides the <code class="class">org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter</code>.</p>
</div>
<div class="paragraph">
<p>To expose the <code>AccountService</code> (mentioned above) within a Spring Web MVC <code class="class">DispatcherServlet</code>, the following configuration needs to be in place in the dispatcher&#8217;s application context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean name="/AccountService" class="org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter"&gt;
    &lt;property name="service" ref="accountService"/&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such an exporter definition will be exposed through the <code class="class">DispatcherServlet</code>'s standard mapping facilities, as explained in the section on Hessian.</p>
</div>
<div class="paragraph">
<p>Alternatively, create an <code class="class">HttpInvokerServiceExporter</code> in your root application context (e.g.
in <code class="file">'WEB-INF/applicationContext.xml'</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean name="accountExporter" class="org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter"&gt;
    &lt;property name="service" ref="accountService"/&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, define a corresponding servlet for this exporter in <code class="file">'web.xml'</code>, with the servlet name matching the bean name of the target exporter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;servlet&gt;
    &lt;servlet-name&gt;accountExporter&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.context.support.HttpRequestHandlerServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;accountExporter&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/remoting/AccountService&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are running outside of a servlet container and are using Sun&#8217;s Java 6, then you can use the built-in HTTP server implementation.
You can configure the <code class="class">SimpleHttpServerFactoryBean</code> together with a <code class="class">SimpleHttpInvokerServiceExporter</code> as is shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean name="accountExporter"
    class="org.springframework.remoting.httpinvoker.SimpleHttpInvokerServiceExporter"&gt;
    &lt;property name="service" ref="accountService"/&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;

&lt;bean id="httpServer"
        class="org.springframework.remoting.support.SimpleHttpServerFactoryBean"&gt;
    &lt;property name="contexts"&gt;
        &lt;util:map&gt;
            &lt;entry key="/remoting/AccountService" value-ref="accountExporter"/&gt;
        &lt;/util:map&gt;
    &lt;/property&gt;
    &lt;property name="port" value="8080" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linking-in-the-service-at-the-client-2"><a class="anchor" href="#linking-in-the-service-at-the-client-2"></a>Linking in the service at the client</h3>
<div class="paragraph">
<p>Again, linking in the service from the client much resembles the way you would do it when using Hessian or Burlap.
Using a proxy, Spring will be able to translate your calls to HTTP POST requests to the URL pointing to the exported service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="httpInvokerProxy" class="org.springframework.remoting.httpinvoker.HttpInvokerProxyFactoryBean"&gt;
    &lt;property name="serviceUrl" value="http://remotehost:8080/remoting/AccountService"/&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned before, you can choose what HTTP client you want to use.
By default, the <code class="class">HttpInvokerProxy</code> uses the J2SE HTTP functionality, but you can also use the Commons <code class="class">HttpClient</code> by setting the <code>httpInvokerRequestExecutor</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;property name="httpInvokerRequestExecutor"&gt;
    &lt;bean class="org.springframework.remoting.httpinvoker.CommonsHttpInvokerRequestExecutor"/&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="web-services"><a class="anchor" href="#web-services"></a>Web services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring provides full support for standard Java web services APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exposing web services using JAX-WS</p>
</li>
<li>
<p>Accessing web services using JAX-WS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to stock support for JAX-WS in Spring Core, the Spring portfolio also features &lt;&lt;,Spring Web
    Services&gt;&gt;, a solution for contract-first, document-driven web services - highly recommended for building modern, future-proof web services.</p>
</div>
<div class="sect2">
<h3 id="exposing-servlet-based-web-services-using-jax-ws"><a class="anchor" href="#exposing-servlet-based-web-services-using-jax-ws"></a>Exposing servlet-based web services using JAX-WS</h3>
<div class="paragraph">
<p>Spring provides a convenient base class for JAX-WS servlet endpoint implementations - <code class="class">SpringBeanAutowiringSupport</code>.
To expose our <code class="interface">AccountService</code> we extend Spring&#8217;s <code class="class">SpringBeanAutowiringSupport</code> class and implement our business logic here, usually delegating the call to the business layer.
We&#8217;ll simply use Spring 2.5&#8217;s <code>@Autowired</code> annotation for expressing such dependencies on Spring-managed beans.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>/**
 * JAX-WS compliant AccountService implementation that simply delegates
 * to the AccountService implementation in the root web application context.
 *
 * This wrapper class is necessary because JAX-WS requires working with dedicated
 * endpoint classes. If an existing service needs to be exported, a wrapper that
 * extends SpringBeanAutowiringSupport for simple Spring bean autowiring (through
 * the @Autowired annotation) is the simplest JAX-WS compliant way.
 *
 * This is the class registered with the server-side JAX-WS implementation.
 * In the case of a Java EE 5 server, this would simply be defined as a servlet
 * in web.xml, with the server detecting that this is a JAX-WS endpoint and reacting
 * accordingly. The servlet name usually needs to match the specified WS service name.
 *
 * The web service engine manages the lifecycle of instances of this class.
 * Spring bean references will just be wired in here.
 */
import org.springframework.web.context.support.SpringBeanAutowiringSupport;

@WebService(serviceName="AccountService")
public class AccountServiceEndpoint extends SpringBeanAutowiringSupport {

    @Autowired
    private AccountService biz;

    @WebMethod
    public void insertAccount(Account acc) {
       biz.insertAccount(acc);
    }

    @WebMethod
    public Account[] getAccounts(String name) {
       return biz.getAccounts(name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our <code class="class">AccountServletEndpoint</code> needs to run in the same web application as the Spring context to allow for access to Spring&#8217;s facilities.
This is the case by default in Java EE 5 environments, using the standard contract for JAX-WS servlet endpoint deployment.
See Java EE 5 web service tutorials for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="exporting-standalone-web-services-using-jax-ws"><a class="anchor" href="#exporting-standalone-web-services-using-jax-ws"></a>Exporting standalone web services using JAX-WS</h3>
<div class="paragraph">
<p>The built-in JAX-WS provider that comes with Sun&#8217;s JDK 1.6 supports exposure of web services using the built-in HTTP server that&#8217;s included in JDK 1.6 as well.
Spring&#8217;s <code class="class">SimpleJaxWsServiceExporter</code> detects all <code>@WebService</code> annotated beans in the Spring application context, exporting them through the default JAX-WS server (the JDK 1.6 HTTP server).</p>
</div>
<div class="paragraph">
<p>In this scenario, the endpoint instances are defined and managed as Spring beans themselves; they will be registered with the JAX-WS engine but their lifecycle will be up to the Spring application context.
This means that Spring functionality like explicit dependency injection may be applied to the endpoint instances.
Of course, annotation-driven injection through <code>@Autowired</code> will work as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.remoting.jaxws.SimpleJaxWsServiceExporter"&gt;
    &lt;property name="baseAddress" value="http://localhost:8080/"/&gt;
&lt;/bean&gt;

&lt;bean id="accountServiceEndpoint" class="example.AccountServiceEndpoint"&gt;
    ...
&lt;/bean&gt;

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">AccountServiceEndpoint</code> may derive from Spring&#8217;s <code class="class">SpringBeanAutowiringSupport</code> but doesn&#8217;t have to since the endpoint is a fully Spring-managed bean here.
This means that the endpoint implementation may look like as follows, without any superclass declared - and Spring&#8217;s <code>@Autowired</code> configuration annotation still being honored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@WebService(serviceName="AccountService")
public class AccountServiceEndpoint {

    @Autowired
    private AccountService biz;

    @WebMethod
    public void insertAccount(Account acc) {
       biz.insertAccount(acc);
    }

    @WebMethod
    public List&lt;Account&gt; getAccounts(String name) {
       return biz.getAccounts(name);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exporting-web-services-using-the-jax-ws-ri-s-spring-support"><a class="anchor" href="#exporting-web-services-using-the-jax-ws-ri-s-spring-support"></a>Exporting web services using the JAX-WS RI&#8217;s Spring support</h3>
<div class="paragraph">
<p>Sun&#8217;s JAX-WS RI, developed as part of the GlassFish project, ships Spring support as part of its JAX-WS Commons project.
This allows for defining JAX-WS endpoints as Spring-managed beans, similar to the standalone mode discussed in the previous section - but this time in a Servlet environment.
<em>Note that this is not portable in a Java
      EE 5 environment; it is mainly intended for non-EE environments such as
      Tomcat, embedding the JAX-WS RI as part of the web
      application.</em></p>
</div>
<div class="paragraph">
<p>The difference to the standard style of exporting servlet-based endpoints is that the lifecycle of the endpoint instances themselves will be managed by Spring here, and that there will be only one JAX-WS servlet defined in <code>web.xml</code>.
With the standard Java EE 5 style (as illustrated above), you&#8217;ll have one servlet definition per service endpoint, with each endpoint typically delegating to Spring beans (through the use of <code>@Autowired</code>, as shown above).</p>
</div>
<div class="paragraph">
<p>Check out &lt;&lt;,https://jax-ws-commons.dev.java.net/spring/&gt;&gt; for the details on setup and usage style.</p>
</div>
</div>
<div class="sect2">
<h3 id="accessing-web-services-using-jax-ws"><a class="anchor" href="#accessing-web-services-using-jax-ws"></a>Accessing web services using JAX-WS</h3>
<div class="paragraph">
<p>Spring provides two factory beans to create JAX-WS web service proxies, namely <code class="class">LocalJaxWsServiceFactoryBean</code> and <code class="class">JaxWsPortProxyFactoryBean</code>.
The former can only return a JAX-WS service class for us to work with.
The latter is the full-fledged version that can return a proxy that implements our business service interface.
In this example we use the latter to create a proxy for the <code class="interface">AccountService</code> endpoint (again):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="accountWebService" class="org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean"&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
    &lt;property name="wsdlDocumentUrl" value="http://localhost:8888/AccountServiceEndpoint?WSDL"/&gt;
    &lt;property name="namespaceUri" value="http://example/"/&gt;
    &lt;property name="serviceName" value="AccountService"/&gt;
    &lt;property name="portName" value="AccountServiceEndpointPort"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>serviceInterface</code> is our business interface the clients will use.
<code>wsdlDocumentUrl</code> is the URL for the WSDL file.
Spring needs this a startup time to create the JAX-WS Service.
<code>namespaceUri</code> corresponds to the targetNamespace in the .wsdl file.
<code>serviceName</code> corresponds to the service name in the .wsdl file.
<code>portName</code> corresponds to the port name in the .wsdl file.</p>
</div>
<div class="paragraph">
<p>Accessing the web service is now very easy as we have a bean factory for it that will expose it as <code>AccountService</code> interface.
We can wire this up in Spring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="client" class="example.AccountClientImpl"&gt;
    ...
    &lt;property name="service" ref="accountWebService"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the client code we can access the web service just as if it was a normal class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class AccountClientImpl {

    private AccountService service;

    public void setService(AccountService service) {
        this.service = service;
    }

    public void foo() {
        service.insertAccount(...);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>NOTE:</em> The above is slightly simplified in that JAX-WS requires endpoint interfaces and implementation classes to be annotated with <code>@WebService</code>, <code>@SOAPBinding</code> etc annotations.
This means that you cannot (easily) use plain Java interfaces and implementation classes as JAX-WS endpoint artifacts; you need to annotate them accordingly first.
Check the JAX-WS documentation for details on those requirements.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms"><a class="anchor" href="#jms"></a>JMS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is also possible to expose services transparently using JMS as the underlying communication protocol.
The JMS remoting support in the Spring Framework is pretty basic - it sends and receives on the <code class="interface">same thread</code> and in the <em>same
    non-transactional</em> <code class="interface">Session</code>, and as such throughput will be very implementation dependent.
Note that these single-threaded and non-transactional constraints apply only to Spring&#8217;s JMS <em>remoting</em> support.
See <a href="#jms">JMS</a> for information on Spring&#8217;s rich support for JMS-based <em>messaging</em>.</p>
</div>
<div class="paragraph">
<p>The following interface is used on both the server and the client side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.foo;

public interface CheckingAccountService {

    public void cancelAccount(Long accountId);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following simple implementation of the above interface is used on the server-side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.foo;

public class SimpleCheckingAccountService implements CheckingAccountService {

    public void cancelAccount(Long accountId) {
        System.out.println("Cancelling account [" + accountId + "]");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration file contains the JMS-infrastructure beans that are shared on both the client and server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;bean id="connectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory"&gt;
        &lt;property name="brokerURL" value="tcp://ep-t43:61616"/&gt;
    &lt;/bean&gt;

    &lt;bean id="queue" class="org.apache.activemq.command.ActiveMQQueue"&gt;
        &lt;constructor-arg value="mmm"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="server-side-configuration"><a class="anchor" href="#server-side-configuration"></a>Server-side configuration</h3>
<div class="paragraph">
<p>On the server, you just need to expose the service object using the <code class="class">JmsInvokerServiceExporter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;bean id="checkingAccountService"
          class="org.springframework.jms.remoting.JmsInvokerServiceExporter"&gt;
        &lt;property name="serviceInterface" value="com.foo.CheckingAccountService"/&gt;
        &lt;property name="service"&gt;
            &lt;bean class="com.foo.SimpleCheckingAccountService"/&gt;
        &lt;/property&gt;
   &lt;/bean&gt;

   &lt;bean class="org.springframework.jms.listener.SimpleMessageListenerContainer"&gt;
       &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
       &lt;property name="destination" ref="queue"/&gt;
       &lt;property name="concurrentConsumers" value="3"/&gt;
       &lt;property name="messageListener" ref="checkingAccountService"/&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.foo;

import org.springframework.context.support.ClassPathXmlApplicationContext;

public class Server {

    public static void main(String[] args) throws Exception {
        new ClassPathXmlApplicationContext(new String[]{"com/foo/server.xml", "com/foo/jms.xml"});
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="client-side-configuration"><a class="anchor" href="#client-side-configuration"></a>Client-side configuration</h3>
<div class="paragraph">
<p>The client merely needs to create a client-side proxy that will implement the agreed upon interface (<code class="interface">CheckingAccountService</code>).
The resulting object created off the back of the following bean definition can be injected into other client side objects, and the proxy will take care of forwarding the call to the server-side object via JMS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;bean id="checkingAccountService"
          class="org.springframework.jms.remoting.JmsInvokerProxyFactoryBean"&gt;
        &lt;property name="serviceInterface" value="com.foo.CheckingAccountService"/&gt;
        &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
        &lt;property name="queue" ref="queue"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.foo;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class Client {

    public static void main(String[] args) throws Exception {
        ApplicationContext ctx = new ClassPathXmlApplicationContext(
                new String[] {"com/foo/client.xml", "com/foo/jms.xml"});
        CheckingAccountService service = (CheckingAccountService) ctx.getBean("checkingAccountService");
        service.cancelAccount(new Long(10));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also wish to investigate the support provided by the &lt;&lt;,Lingo&gt;&gt; project, which (to quote the homepage blurb)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="auto-detection-is-not-implemented-for-remote-interfaces"><a class="anchor" href="#auto-detection-is-not-implemented-for-remote-interfaces"></a>Auto-detection is not implemented for remote interfaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The main reason why auto-detection of implemented interfaces does not occur for remote interfaces is to avoid opening too many doors to remote callers.
The target object might implement internal callback interfaces like <code class="interface">InitializingBean</code> or <code class="interface">DisposableBean</code> which one would not want to expose to callers.</p>
</div>
<div class="paragraph">
<p>Offering a proxy with all interfaces implemented by the target usually does not matter in the local case.
But when exporting a remote service, you should expose a specific service interface, with specific operations intended for remote usage.
Besides internal callback interfaces, the target might implement multiple business interfaces, with just one of them intended for remote exposure.
For these reasons, we <em>require</em> such a service interface to be specified.</p>
</div>
<div class="paragraph">
<p>This is a trade-off between configuration convenience and the risk of accidental exposure of internal methods.
Always specifying a service interface is not too much effort, and puts you on the safe side regarding controlled exposure of specific methods.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="considerations-when-choosing-a-technology"><a class="anchor" href="#considerations-when-choosing-a-technology"></a>Considerations when choosing a technology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each and every technology presented here has its drawbacks.
You should carefully consider your needs, the services you are exposing and the objects you&#8217;ll be sending over the wire when choosing a technology.</p>
</div>
<div class="paragraph">
<p>When using RMI, it&#8217;s not possible to access the objects through the HTTP protocol, unless you&#8217;re tunneling the RMI traffic.
RMI is a fairly heavy-weight protocol in that it supports full-object serialization which is important when using a complex data model that needs serialization over the wire.
However, RMI-JRMP is tied to Java clients: It is a Java-to-Java remoting solution.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s HTTP invoker is a good choice if you need HTTP-based remoting but also rely on Java serialization.
It shares the basic infrastructure with RMI invokers, just using HTTP as transport.
Note that HTTP invokers are not only limited to Java-to-Java remoting but also to Spring on both the client and server side.
(The latter also applies to Spring&#8217;s RMI invoker for non-RMI interfaces.)</p>
</div>
<div class="paragraph">
<p>Hessian and/or Burlap might provide significant value when operating in a heterogeneous environment, because they explicitly allow for non-Java clients.
However, non-Java support is still limited.
Known issues include the serialization of Hibernate objects in combination with lazily-initialized collections.
If you have such a data model, consider using RMI or HTTP invokers instead of Hessian.</p>
</div>
<div class="paragraph">
<p>JMS can be useful for providing clusters of services and allowing the JMS broker to take care of load balancing, discovery and auto-failover.
By default: Java serialization is used when using JMS remoting but the JMS provider could use a different mechanism for the wire formatting, such as XStream to allow servers to be implemented in other technologies.</p>
</div>
<div class="paragraph">
<p>Last but not least, EJB has an advantage over RMI in that it supports standard role-based authentication and authorization and remote transaction propagation.
It is possible to get RMI invokers or HTTP invokers to support security context propagation as well, although this is not provided by core Spring: There are just appropriate hooks for plugging in third-party or custom solutions here.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accessing-restful-services-on-the-client"><a class="anchor" href="#accessing-restful-services-on-the-client"></a>Accessing RESTful services on the Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code class="class">RestTemplate</code> is the core class for client-side access to RESTful services.
It is conceptually similar to other template classes in Spring, such as <code class="class">JdbcTemplate</code> and <code class="class">JmsTemplate</code> and other template classes found in other Spring portfolio projects.
<code class="class">RestTemplate</code>'s behavior is customized by providing callback methods and configuring the <code class="interface">HttpMessageConverter</code> used to marshal objects into the HTTP request body and to unmarshal any response back into an object.
As it is common to use XML as a message format, Spring provides a <code class="class">MarshallingHttpMessageConverter</code> that uses the Object-to-XML framework that is part of the <code class="class">org.springframework.oxm</code> package.
This gives you a wide range of choices of XML to Object mapping technologies to choose from.</p>
</div>
<div class="paragraph">
<p>This section describes how to use the <code class="class">RestTemplate</code> and its associated <code class="interface">HttpMessageConverters</code>.</p>
</div>
<div class="sect2">
<h3 id="resttemplate"><a class="anchor" href="#resttemplate"></a>RestTemplate</h3>
<div class="paragraph">
<p>Invoking RESTful services in Java is typically done using a helper class such as Jakarta Commons <code class="class">HttpClient</code>.
For common REST operations this approach is too low level as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>String uri = "http://example.com/hotels/1/bookings";

PostMethod post = new PostMethod(uri);
String request = // create booking request content
post.setRequestEntity(new StringRequestEntity(request));

httpClient.executeMethod(post);

if (HttpStatus.SC_CREATED == post.getStatusCode()) {
  Header location = post.getRequestHeader("Location");
  if (location != null) {
    System.out.println("Created new booking at :" + location.getValue());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>RestTemplate provides higher level methods that correspond to each of the six main HTTP methods that make invoking many RESTful services a one-liner and enforce REST best practices.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 13. Overview of RestTemplate methods</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP Method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RestTemplate
              Method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getForObject</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getForEntity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">headForHeaders(String
              url, String&#8230; urlVariables)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optionsForAllow(String
              url, String&#8230; urlVariables)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">postForLocation(String
              url, Object request, String&#8230; urlVariables)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postForObject(String
                  url, Object request, Class&lt;T&gt; responseType, String&#8230;
                  uriVariables)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">put(String
              url, Object request, String&#8230;urlVariables)</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The names of <code class="class">RestTemplate</code> methods follow a naming convention, the first part indicates what HTTP method is being invoked and the second part indicates what is returned.
For example, the method <code class="method">getForObject()</code> will perform a GET, convert the HTTP response into an object type of your choice and return that object.
The method <code class="method">postForLocation()</code> will do a POST, converting the given object into a HTTP request and return the response HTTP Location header where the newly created object can be found.
In case of an exception processing the HTTP request, an exception of the type <code class="class">RestClientException</code> will be thrown; this behavior can be changed by plugging in another <code class="interface">ResponseErrorHandler</code> implementation into the <code class="class">RestTemplate</code>.</p>
</div>
<div class="paragraph">
<p>Objects passed to and returned from these methods are converted to and from HTTP messages by <code class="interface">HttpMessageConverter</code> instances.
Converters for the main mime types are registered by default, but you can also write your own converter and register it via the <code class="method">messageConverters()</code> bean property.
The default converter instances registered with the template are <code class="class">ByteArrayHttpMessageConverter</code>, <code class="class">StringHttpMessageConverter</code>, <code class="class">FormHttpMessageConverter</code> and <code class="class">SourceHttpMessageConverter</code>.
You can override these defaults using the <code class="method">messageConverters()</code> bean property as would be required if using the <code class="class">MarshallingHttpMessageConverter</code> or <code class="class">MappingJackson2HttpMessageConverter</code>.</p>
</div>
<div class="paragraph">
<p>Each method takes URI template arguments in two forms, either as a <code>String</code> variable length argument or a <code>Map&lt;String,String&gt;</code>.
For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>String result = restTemplate.getForObject("http://example.com/hotels/{hotel}/bookings/{booking}",
                                          String.class,"42", "21");</code></pre>
</div>
</div>
<div class="paragraph">
<p>using variable length arguments and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>Map&lt;String, String&gt; vars = Collections.singletonMap("hotel", "42");
String result =
  restTemplate.getForObject("http://example.com/hotels/{hotel}/rooms/{hotel}", String.class, vars);</code></pre>
</div>
</div>
<div class="paragraph">
<p>using a <code>Map&lt;String,String&gt;</code>.</p>
</div>
<div class="paragraph">
<p>To create an instance of <code class="class">RestTemplate</code> you can simply call the default no-arg constructor.
This will use standard Java classes from the <code>java.net</code> package as the underlying implementation to create HTTP requests.
This can be overridden by specifying an implementation of <code class="interface">ClientHttpRequestFactory</code>.
Spring provides the implementation <code class="class">HttpComponentsClientHttpRequestFactory</code> that uses the Apache HttpComponents <code class="class">HttpClient</code> to create requests.
<code class="class">HttpComponentsClientHttpRequestFactory</code> is configured using an instance of <code class="class">org.apache.http.client.HttpClient</code> which can in turn be configured with credentials information or connection pooling functionality.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Note that the <code>java.net</code> implementation for HTTP requests may raise an exception when accessing the status of a response that represents an error (e.g.
401).
If this is an issue, switch to <code class="class">HttpComponentsClientHttpRequestFactory</code> instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous example using Apache HttpComponents <code class="class">HttpClient</code> directly rewritten to use the <code class="class">RestTemplate</code> is shown below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>uri = "http://example.com/hotels/{id}/bookings";

RestTemplate template = new RestTemplate();

Booking booking = // create booking object

URI location = template.postForLocation(uri, booking, "1");</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use Apache HttpComponents instead of the native <code>java.net</code> functionality, construct the <code class="class">RestTemplate</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>RestTemplate template = new RestTemplate(new HttpComponentsClientHttpRequestFactory());</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Apache HttpClient supports gzip encoding via the <code class="class">DecompressingHttpClient</code>.
To use it, construct a <code class="class">HttpComponentsClientHttpRequestFactory</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>HttpClient httpClient = new DecompressingHttpClient(new DefaultHttpClient());
ClientHttpRequestFactory requestFactory = new HttpComponentsClientHttpRequestFactory(httpClient);
RestTemplate template = new RestTemplate(requestFactory);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The general callback interface is <code class="interface">RequestCallback</code> and is called when the execute method is invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public &lt;T&gt; T execute(String url, HttpMethod method, RequestCallback requestCallback,
                     ResponseExtractor&lt;T&gt; responseExtractor,
                     String... urlVariables)


// also has an overload with urlVariables as a Map&lt;String, String&gt;.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="interface">RequestCallback</code> interface is defined as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface RequestCallback {
 void doWithRequest(ClientHttpRequest request) throws IOException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and allows you to manipulate the request headers and write to the request body.
When using the execute method you do not have to worry about any resource management, the template will always close the request and handle any errors.
Refer to the API documentation for more information on using the execute method and the meaning of its other method arguments.</p>
</div>
<div class="sect3">
<h4 id="working-with-the-uri"><a class="anchor" href="#working-with-the-uri"></a>Working with the URI</h4>
<div class="paragraph">
<p>For each of the main HTTP methods, the <code class="class">RestTemplate</code> provides variants that either take a String URI or <code class="class">java.net.URI</code> as the first argument.</p>
</div>
<div class="paragraph">
<p>The String URI variants accept template arguments as a String variable length argument or as a <code class="class">Map&lt;String,String&gt;</code>.
They also assume the URL String is not encoded and needs to be encoded.
For example the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>restTemplate.getForObject("http://example.com/hotel list", String.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>will perform a GET on <code class="file">http://example.com/hotel%20list</code>.
That means if the input URL String is already encoded, it will be encoded twice&#8201;&#8212;&#8201;i.e.
<code class="file">http://example.com/hotel%20list</code> will become <code class="file">http://example.com/hotel%2520list</code>.
If this is not the intended effect, use the <code class="class">java.net.URI</code> method variant, which assumes the URL is already encoded is also generally useful if you want to reuse a single (fully expanded) <code class="class">URI</code> multiple times.</p>
</div>
<div class="paragraph">
<p>The <code class="class">UriComponentsBuilder</code> class can be used to build and encode the <code class="class">URI</code> including support for URI templates.
For example you can start with a URL String:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>UriComponents uriComponents =
        UriComponentsBuilder.fromUriString("http://example.com/hotels/{hotel}/bookings/{booking}").build()
            .expand("42", "21")
            .encode();

URI uri = uriComponents.toUri();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or specify each URI component individually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>UriComponents uriComponents =
        UriComponentsBuilder.newInstance()
            .scheme("http").host("example.com").path("/hotels/{hotel}/bookings/{booking}").build()
            .expand("42", "21")
            .encode();

URI uri = uriComponents.toUri();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dealing-with-request-and-response-headers"><a class="anchor" href="#dealing-with-request-and-response-headers"></a>Dealing with request and response headers</h4>
<div class="paragraph">
<p>Besides the methods described above, the <code class="class">RestTemplate</code> also has the <code class="method">exchange()</code> method, which can be used for arbitrary HTTP method execution based on the <code class="class">HttpEntity</code> class.</p>
</div>
<div class="paragraph">
<p>Perhaps most importantly, the <code class="method">exchange()</code> method can be used to add request headers and read response headers.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>HttpHeaders requestHeaders = new HttpHeaders();
requestHeaders.set("MyRequestHeader", "MyValue");
HttpEntity&lt;?&gt; requestEntity = new HttpEntity(requestHeaders);

HttpEntity&lt;String&gt; response = template.exchange("http://example.com/hotels/{hotel}",
  HttpMethod.GET, requestEntity, String.class, "42");

String responseHeader = response.getHeaders().getFirst("MyResponseHeader");
String body = response.getBody();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, we first prepare a request entity that contains the <code>MyRequestHeader</code> header.
We then retrieve the response, and read the <code>MyResponseHeader</code> and body.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="http-message-conversion"><a class="anchor" href="#http-message-conversion"></a>HTTP Message Conversion</h3>
<div class="paragraph">
<p>Objects passed to and returned from the methods <code class="method">getForObject()</code>, <code class="method">postForLocation()</code>, and <code class="method">put()</code> are converted to HTTP requests and from HTTP responses by <code class="interface">HttpMessageConverters</code>.
The <code class="interface">HttpMessageConverter</code> interface is shown below to give you a better feel for its functionality</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface HttpMessageConverter&lt;T&gt; {

      // Indicate whether the given class and media type can be read by this converter.
      boolean canRead(Class&lt;?&gt; clazz, MediaType mediaType);

      // Indicate whether the given class and media type can be written by this converter.
      boolean canWrite(Class&lt;?&gt; clazz, MediaType mediaType);

      // Return the list of MediaType objects supported by this converter.
      List&lt;MediaType&gt; getSupportedMediaTypes();

      // Read an object of the given type from the given input message, and returns it.
      T read(Class&lt;T&gt; clazz, HttpInputMessage inputMessage) throws IOException,
                                                                   HttpMessageNotReadableException;

      // Write an given object to the given output message.
      void write(T t, HttpOutputMessage outputMessage) throws IOException,
                                                              HttpMessageNotWritableException;

    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Concrete implementations for the main media (mime) types are provided in the framework and are registered by default with the <code class="class">RestTemplate</code> on the client-side and with <code class="class">AnnotationMethodHandlerAdapter</code> on the server-side.</p>
</div>
<div class="paragraph">
<p>The implementations of <code class="class">HttpMessageConverter`s are described in the following sections.
For all converters a default media type is used but can be overridden by setting the [class]`supportedMediaTypes</code> bean property</p>
</div>
<div class="sect3">
<h4 id="stringhttpmessageconverter"><a class="anchor" href="#stringhttpmessageconverter"></a>StringHttpMessageConverter</h4>
<div class="paragraph">
<p>An <code class="interface">HttpMessageConverter</code> implementation that can read and write Strings from the HTTP request and response.
By default, this converter supports all text media types (<code>text/*</code>), and writes with a <code>Content-Type</code> of <code>text/plain</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="formhttpmessageconverter"><a class="anchor" href="#formhttpmessageconverter"></a>FormHttpMessageConverter</h4>
<div class="paragraph">
<p>An <code class="interface">HttpMessageConverter</code> implementation that can read and write form data from the HTTP request and response.
By default, this converter reads and writes the media type <code>application/x-www-form-urlencoded</code>.
Form data is read from and written into a <code>MultiValueMap&lt;String,
        String&gt;</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="bytearrayhttpmessageconverter"><a class="anchor" href="#bytearrayhttpmessageconverter"></a>ByteArrayHttpMessageConverter</h4>
<div class="paragraph">
<p>An <code class="interface">HttpMessageConverter</code> implementation that can read and write byte arrays from the HTTP request and response.
By default, this converter supports all media types (<code>*/*</code>), and writes with a <code>Content-Type</code> of <code>application/octet-stream</code>.
This can be overridden by setting the  property, and overriding <code>getContentType(byte[])</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="marshallinghttpmessageconverter"><a class="anchor" href="#marshallinghttpmessageconverter"></a>MarshallingHttpMessageConverter</h4>
<div class="paragraph">
<p>An <code class="interface">HttpMessageConverter</code> implementation that can read and write XML using Spring&#8217;s <code class="interface">Marshaller</code> and <code class="interface">Unmarshaller</code> abstractions from the <code class="class">org.springframework.oxm</code> package.
This converter requires a <code class="interface">Marshaller</code> and <code class="interface">Unmarshaller</code> before it can be used.
These can be injected via constructor or bean properties.
By default this converter supports (<code>text/xml</code>) and (<code>application/xml</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="mappingjackson2httpmessageconverter-or-mappingjacksonhttpmessageconverter-with-jackson-1-x"><a class="anchor" href="#mappingjackson2httpmessageconverter-or-mappingjacksonhttpmessageconverter-with-jackson-1-x"></a>MappingJackson2HttpMessageConverter (or MappingJacksonHttpMessageConverter with Jackson 1.x)</h4>
<div class="paragraph">
<p>An <code class="interface">HttpMessageConverter</code> implementation that can read and write JSON using Jackson&#8217;s <code class="interface">ObjectMapper</code>.
JSON mapping can be customized as needed through the use of Jackson&#8217;s provided annotations.
When further control is needed, a custom <code class="interface">ObjectMapper</code> can be injected through the <code>ObjectMapper</code> property for cases where custom JSON serializers/deserializers need to be provided for specific types.
By default this converter supports (<code>application/json</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="sourcehttpmessageconverter"><a class="anchor" href="#sourcehttpmessageconverter"></a>SourceHttpMessageConverter</h4>
<div class="paragraph">
<p>An <code class="interface">HttpMessageConverter</code> implementation that can read and write <code class="class">javax.xml.transform.Source</code> from the HTTP request and response.
Only <code class="class">DOMSource</code>, <code class="class">SAXSource</code>, and <code class="class">StreamSource</code> are supported.
By default, this converter supports (<code>text/xml</code>) and (<code>application/xml</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="bufferedimagehttpmessageconverter"><a class="anchor" href="#bufferedimagehttpmessageconverter"></a>BufferedImageHttpMessageConverter</h4>
<div class="paragraph">
<p>An <code class="interface">HttpMessageConverter</code> implementation that can read and write <code class="class">java.awt.image.BufferedImage</code> from the HTTP request and response.
This converter reads and writes the media type supported by the Java I/O API.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="enterprise-javabeans-ejb-integration" class="sect0"><a class="anchor" href="#enterprise-javabeans-ejb-integration"></a>Enterprise JavaBeans (EJB) integration</h1>
<div class="sect1">
<h2 id="introduction-8"><a class="anchor" href="#introduction-8"></a>Introduction</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> As a lightweight container, Spring is often considered an EJB replacement.
We do believe that for many if not most applications and use cases, Spring as a container, combined with its rich supporting functionality in the area of transactions, ORM and JDBC access, is a better choice than implementing equivalent functionality via an EJB container and EJBs.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> However, it is important to note that using Spring does not prevent you from using EJBs.
In fact, Spring makes it much easier to access EJBs and implement EJBs and functionality within them.
Additionally, using Spring to access services provided by EJBs allows the implementation of those services to later transparently be switched between local EJB, remote EJB, or POJO (plain old Java object) variants, without the client code having to be changed.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> In this chapter, we look at how Spring can help you access and implement EJBs.
Spring provides particular value when accessing stateless session beans (SLSBs), so we'll begin by discussing this.</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accessing-ejbs"><a class="anchor" href="#accessing-ejbs"></a>Accessing EJBs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="concepts"><a class="anchor" href="#concepts"></a>Concepts</h3>
<div class="literalblock">
<div class="content">
<pre> To invoke a method on a local or remote stateless session bean, client code must normally perform a JNDI lookup to obtain the (local or remote) EJB Home object, then use a 'create' method call on that object to obtain the actual (local or remote) EJB object.
One or more methods are then invoked on the EJB.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> To avoid repeated low-level code, many EJB applications use the Service Locator and Business Delegate patterns.
These are better than spraying JNDI lookups throughout client code, but their usual implementations have significant disadvantages.
For example:</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Typically code using EJBs depends on Service Locator or Business Delegate singletons, making it hard to test.</p>
</li>
<li>
<p>In the case of the Service Locator pattern used without a Business Delegate, application code still ends up having to invoke the create() method on an EJB home, and deal with the resulting exceptions.
Thus it remains tied to the EJB API and the complexity of the EJB programming model.</p>
</li>
<li>
<p>Implementing the Business Delegate pattern typically results in significant code duplication, where we have to write numerous methods that simply call the same method on the EJB.</p>
<div class="literalblock">
<div class="content">
<pre> The Spring approach is to allow the creation and use of proxy objects, normally configured inside a Spring container, which act as codeless business delegates.
You do not need	to write another Service Locator, another JNDI lookup, or duplicate methods in a hand-coded Business Delegate unless you are actually adding real value in such code.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="accessing-local-slsbs"><a class="anchor" href="#accessing-local-slsbs"></a>Accessing local SLSBs</h3>
<div class="literalblock">
<div class="content">
<pre> Assume that we have a web controller that needs to use a local EJB. We'll follow best practice and use the EJB Business Methods Interface pattern, so that the EJB's local interface extends a non EJB-specific business methods interface.
Let's call this business methods interface [class]`MyComponent`.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface MyComponent {
    ...
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> One of the main reasons to use the Business Methods Interface pattern is to ensure that synchronization between method signatures in local interface and bean implementation class is automatic.
Another reason is that it later makes it much easier for us to switch to a POJO (plain old Java object) implementation of the service if it makes sense to do so.
Of course we'll also need to implement the local home interface and provide an implementation class that implements [class]`SessionBean` and the [class]`MyComponent` business methods interface.
Now the only Java coding we'll  need to do to hook up our web tier controller to the EJB implementation is to expose a setter method of type [class]`MyComponent` on the controller.
This will save the reference as an instance variable in the controller:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>private MyComponent myComponent;

public void setMyComponent(MyComponent myComponent) {
    this.myComponent = myComponent;
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> We can subsequently use this instance variable in any business method in the controller.
Now assuming we are obtaining our controller object out of a Spring container, we can (in the same context) configure a [class]`LocalStatelessSessionProxyFactoryBean` instance, which will be the EJB proxy object.
The configuration of the proxy, and setting of the `myComponent` property of the controller is done with a configuration entry such as:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="myComponent"
      class="org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean"&gt;
  &lt;property name="jndiName" value="ejb/myBean"/&gt;
  &lt;property name="businessInterface" value="com.mycom.MyComponent"/&gt;
&lt;/bean&gt;

&lt;bean id="myController" class="com.mycom.myController"&gt;
  &lt;property name="myComponent" ref="myComponent"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> There's a lot of work happening behind the scenes, courtesy of the Spring AOP framework, although you aren't forced to work with AOP concepts to enjoy the results.
The `myComponent` bean definition creates a proxy for the EJB, which implements the business method interface.
The EJB local home is cached on startup, so there's only a single JNDI lookup.
Each time the EJB is invoked, the proxy invokes the `classname` method on the local EJB and invokes the	corresponding business method on the EJB.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>The `myController` bean definition sets the `myComponent` property of the controller class to the EJB proxy.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Alternatively (and preferably in case of many such proxy definitions), consider using the `&lt;jee:local-slsb&gt;` configuration element in Spring's "jee" namespace:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;jee:local-slsb id="myComponent" jndi-name="ejb/myBean"
      business-interface="com.mycom.MyComponent"/&gt;

&lt;bean id="myController" class="com.mycom.myController"&gt;
  &lt;property name="myComponent" ref="myComponent"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> This EJB access mechanism delivers huge simplification of application code: the web tier code (or other EJB client code) has no dependence on the use of EJB. If we want to replace this EJB reference with a POJO or a mock object or other test stub, we could simply change the `myComponent` bean definition without changing a line of Java code.
Additionally, we haven't had to write a single line of JNDI lookup or other EJB plumbing code as part of our application.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Benchmarks and experience in real applications indicate that the performance overhead of this approach (which involves reflective invocation of the target EJB) is minimal, and is typically undetectable in typical use.
Remember that we don't want to make fine-grained calls to EJBs anyway, as there's a cost associated with the EJB infrastructure in the application server.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> There is one caveat with regards to the JNDI lookup.
In a bean container, this class is normally best used as a singleton (there simply is no reason to make it a prototype).
However, if that bean container pre-instantiates singletons (as do the various XML [class]`ApplicationContext` variants) you may have a problem if the bean container is loaded before the EJB container loads the target EJB. That is because the JNDI lookup will be performed in the `init()` method of this class and then cached, but the EJB will not have been bound at the target location yet.
The solution is to not pre-instantiate this factory object, but allow it to be created on first use.
In the XML containers, this is controlled via the `lazy-init` attribute.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Although this will not be of interest to the majority of Spring users, those doing programmatic AOP work with EJBs may want to look at [class]`LocalSlsbInvokerInterceptor`.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="accessing-remote-slsbs"><a class="anchor" href="#accessing-remote-slsbs"></a>Accessing remote SLSBs</h3>
<div class="literalblock">
<div class="content">
<pre> Accessing remote EJBs is essentially identical to accessing local EJBs, except that the [class]`SimpleRemoteStatelessSessionProxyFactoryBean` or `&lt;jee:remote-slsb&gt;` configuration element is used.
Of course, with or without Spring, remote invocation semantics apply; a call to a method on an object in another VM in another computer does sometimes have to be treated differently in terms of usage scenarios and failure handling.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Spring's EJB client support adds one more advantage over the non-Spring approach.
Normally it is problematic for EJB client code to be easily switched back and forth between calling EJBs locally or remotely.
This is because the remote interface methods must declare that they throw [class]`RemoteException`, and client code must deal with this, while the local interface methods don't.
Client code written for local EJBs which needs to be moved to remote EJBs typically has to be modified to add handling for the remote exceptions, and client code written for remote EJBs which needs to be moved to local EJBs, can either stay the same but do a lot of unnecessary handling of remote exceptions, or needs to be modified to remove that code.
With the Spring remote EJB proxy, you can instead not declare any thrown [class]`RemoteException` in your Business Method Interface and implementing EJB code, have a remote interface which is identical except that it does throw [class]`RemoteException`, and rely on the proxy to dynamically treat the two interfaces as if they were the same.
That is, client code does not have to deal with the checked [class]`RemoteException` class.
Any actual [class]`RemoteException` that is thrown during the EJB invocation will be re-thrown as the non-checked [class]`RemoteAccessException` class, which is a subclass of [class]`RuntimeException`.
The target service can then be switched at will between a local EJB or remote EJB (or even plain Java object) implementation, without the client code knowing or caring.
Of course, this is optional; there is nothing stopping you from declaring [class]`RemoteExceptions` in your business interface.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="accessing-ejb-2-x-slsbs-versus-ejb-3-slsbs"><a class="anchor" href="#accessing-ejb-2-x-slsbs-versus-ejb-3-slsbs"></a>Accessing EJB 2.x SLSBs versus EJB 3 SLSBs</h3>
<div class="literalblock">
<div class="content">
<pre> Accessing EJB 2.x Session Beans and EJB 3 Session Beans via Spring is largely transparent.
Spring's EJB accessors, including the `&lt;jee:local-slsb&gt;` and `&lt;jee:remote-slsb&gt;` facilities, transparently adapt to the actual component at runtime.
They handle a home interface if found (EJB 2.x style), or perform straight component invocations if no home interface is available (EJB 3 style).</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Note: For EJB 3 Session Beans, you could effectively use a [class]`JndiObjectFactoryBean` / `&lt;jee:jndi-lookup&gt;` as well, since fully usable component references are exposed for plain JNDI lookups there.
Defining explicit `&lt;jee:local-slsb&gt;` / `&lt;jee:remote-slsb&gt;` lookups simply provides consistent and more explicit EJB access configuration.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-spring-s-ejb-implementation-support-classes"><a class="anchor" href="#using-spring-s-ejb-implementation-support-classes"></a>Using Spring&#8217;s EJB implementation support classes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ejb-3-injection-interceptor"><a class="anchor" href="#ejb-3-injection-interceptor"></a>EJB 3 injection interceptor</h3>
<div class="literalblock">
<div class="content">
<pre> For EJB 3 Session Beans and Message-Driven Beans, Spring provides a convenient interceptor that resolves Spring 2.5's `@Autowired` annotation in the EJB component class: [class]`org.springframework.ejb.interceptor.SpringBeanAutowiringInterceptor`.
This interceptor can be applied through an `@Interceptors` annotation in the EJB component class, or through an `interceptor-binding` XML element in the EJB deployment descriptor.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Stateless
@Interceptors(SpringBeanAutowiringInterceptor.class)
public class MyFacadeEJB implements MyFacadeLocal {

    // automatically injected with a matching Spring bean
    @Autowired
    private MyComponent myComp;

    // for business method, delegate to POJO service impl.
    public String myFacadeMethod(...) {
        return myComp.myMethod(...);
    }
    ...
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> [class]`SpringBeanAutowiringInterceptor` by default obtains target beans from a [class]`ContextSingletonBeanFactoryLocator`, with the context defined in a bean definition file named `beanRefContext.xml`.
By default, a single context definition is expected, which is obtained by type rather than by name.
However, if you need to choose between multiple context definitions, a specific locator key is required.
The locator key (i.e.
the name of the context definition in `beanRefContext.xml`) can be explicitly specified either through overriding the `getBeanFactoryLocatorKey` method in a custom [class]`SpringBeanAutowiringInterceptor` subclass.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Alternatively, consider overriding [class]`SpringBeanAutowiringInterceptor`'s `getBeanFactory` method, e.g.
obtaining a shared [interface]`ApplicationContext` from a custom holder class.</pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="jms-java-message-service" class="sect0"><a class="anchor" href="#jms-java-message-service"></a>JMS (Java Message Service)</h1>
<div class="sect1">
<h2 id="introduction-9"><a class="anchor" href="#introduction-9"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring provides a JMS integration framework that simplifies the use of the JMS API much like Spring&#8217;s integration does for the JDBC API.</p>
</div>
<div class="paragraph">
<p>JMS can be roughly divided into two areas of functionality, namely the production and consumption of messages.
The <code class="class">JmsTemplate</code> class is used for message production and synchronous message reception.
For asynchronous reception similar to Java EE&#8217;s message-driven bean style, Spring provides a number of message listener containers that are used to create Message-Driven POJOs (MDPs).</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.core</code> provides the core functionality for using JMS. It contains JMS template classes that simplify the use of the JMS by handling the creation and release of resources, much like the <code class="class">JdbcTemplate</code> does for JDBC. The design principle common to Spring template classes is to provide helper methods to perform common operations and for more sophisticated usage, delegate the essence of the processing task to user implemented callback interfaces.
The JMS template follows the same design.
The classes offer various convenience methods for the sending of messages, consuming a message synchronously, and exposing the JMS session and message producer to the user.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.support</code> provides <code class="class">JMSException</code> translation functionality.
The translation converts the checked <code class="class">JMSException</code> hierarchy to a mirrored hierarchy of unchecked exceptions.
If there are any provider specific subclasses of the checked <code class="class">javax.jms.JMSException</code>, this exception is wrapped in the unchecked <code class="class">UncategorizedJmsException</code>.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.support.converter</code> provides a <code class="interface">MessageConverter</code> abstraction to convert between Java objects and JMS messages.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.support.destination</code> provides various strategies for managing JMS destinations, such as providing a service locator for destinations stored in JNDI.</p>
</div>
<div class="paragraph">
<p>Finally, the package <code>org.springframework.jms.connection</code> provides an implementation of the <code class="class">ConnectionFactory</code> suitable for use in standalone applications.
It also contains an implementation of Spring&#8217;s <code class="interface">PlatformTransactionManager</code> for JMS (the cunningly named <code class="class">JmsTransactionManager</code>).
This allows for seamless integration of JMS as a transactional resource into Spring&#8217;s transaction management mechanisms.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-spring-jms"><a class="anchor" href="#using-spring-jms"></a>Using Spring JMS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="code-class-class-jmstemplate-code"><a class="anchor" href="#code-class-class-jmstemplate-code"></a><code class="class">JmsTemplate</code></h3>
<div class="paragraph">
<p>The <code class="class">JmsTemplate</code> class is the central class in the JMS core package.
It simplifies the use of JMS since it handles the creation and release of resources when sending or synchronously receiving messages.</p>
</div>
<div class="paragraph">
<p>Code that uses the <code class="class">JmsTemplate</code> only needs to implement callback interfaces giving them a clearly defined high level contract.
The <code class="class">MessageCreator</code> callback interface creates a message given a <code class="interface">Session</code> provided by the calling code in <code class="class">JmsTemplate</code>.
In order to allow for more complex usage of the JMS API, the callback <code class="class">SessionCallback</code> provides the user with the JMS session and the callback <code class="class">ProducerCallback</code> exposes a <code class="interface">Session</code> and <code class="interface">MessageProducer</code> pair.</p>
</div>
<div class="paragraph">
<p>The JMS API exposes two types of send methods, one that takes delivery mode, priority, and time-to-live as Quality of Service (QOS) parameters and one that takes no QOS parameters which uses default values.
Since there are many send methods in <code class="class">JmsTemplate</code>, the setting of the QOS parameters have been exposed as bean properties to avoid duplication in the number of send methods.
Similarly, the timeout value for synchronous receive calls is set using the property <code class="class">setReceiveTimeout</code>.</p>
</div>
<div class="paragraph">
<p>Some JMS providers allow the setting of default QOS values administratively through the configuration of the ConnectionFactory.
This has the effect that a call to <code class="class">MessageProducer</code>'s send method <code class="method">send(Destination destination, Message message)</code> will use different QOS default values than those specified in the JMS specification.
In order to provide consistent management of QOS values, the <code class="class">JmsTemplate</code> must therefore be specifically enabled to use its own QOS values by setting the boolean property  to <code>true</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Instances of the <code class="class">JmsTemplate</code> class are <em>thread-safe once configured</em>.
This is important because it means that you can configure a single instance of a <code class="class">JmsTemplate</code> and then safely inject this <em>shared</em> reference into multiple collaborators.
To be clear, the <code class="class">JmsTemplate</code> is stateful, in that it maintains a reference to a <code class="interface">ConnectionFactory</code>, but this state is <em>not</em> conversational state.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="connections"><a class="anchor" href="#connections"></a>Connections</h3>
<div class="paragraph">
<p>The <code class="class">JmsTemplate</code> requires a reference to a <code class="class">ConnectionFactory</code>.
The <code class="class">ConnectionFactory</code> is part of the JMS specification and serves as the entry point for working with JMS. It is used by the client application as a factory to create connections with the JMS provider and encapsulates various configuration parameters, many of which are vendor specific such as SSL configuration options.</p>
</div>
<div class="paragraph">
<p>When using JMS inside an EJB, the vendor provides implementations of the JMS interfaces so that they can participate in declarative transaction management and perform pooling of connections and sessions.
In order to use this implementation, Java EE containers typically require that you declare a JMS connection factory as a  inside the EJB or servlet deployment descriptors.
To ensure the use of these features with the <code class="class">JmsTemplate</code> inside an EJB, the client application should ensure that it references the managed implementation of the <code class="class">ConnectionFactory</code>.</p>
</div>
<div class="sect3">
<h4 id="caching-messaging-resources"><a class="anchor" href="#caching-messaging-resources"></a>Caching Messaging Resources</h4>
<div class="paragraph">
<p>The standard API involves creating many intermediate objects.
To send a message the following <em>API</em> walk is performed</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>ConnectionFactory-&gt;Connection-&gt;Session-&gt;MessageProducer-&gt;send</code></pre>
</div>
</div>
<div class="paragraph">
<p>Between the ConnectionFactory and the Send operation there are three intermediate objects that are created and destroyed.
To optimise the resource usage and increase performance two implementations of IConnectionFactory are provided.</p>
</div>
</div>
<div class="sect3">
<h4 id="singleconnectionfactory"><a class="anchor" href="#singleconnectionfactory"></a>SingleConnectionFactory</h4>
<div class="paragraph">
<p>Spring provides an implementation of the <code class="class">ConnectionFactory</code> interface, <code class="class">SingleConnectionFactory</code>, that will return the same <code class="class">Connection</code> on all <code class="method">createConnection()</code> calls and ignore calls to <code class="method">close()</code>.
This is useful for testing and standalone environments so that the same connection can be used for multiple <code class="class">JmsTemplate</code> calls that may span any number of transactions.
<code class="class">SingleConnectionFactory</code> takes a reference to a standard <code class="class">ConnectionFactory</code> that would typically come from JNDI.</p>
</div>
</div>
<div class="sect3">
<h4 id="cachingconnectionfactory"><a class="anchor" href="#cachingconnectionfactory"></a>CachingConnectionFactory</h4>
<div class="paragraph">
<p>The <code class="class">CachingConnectionFactory</code> extends the functionality of <code class="class">SingleConnectionFactory</code> and adds the caching of Sessions, MessageProducers, and MessageConsumers.
The initial cache size is set to 1, use the property  to increase the number of cached sessions.
Note that the number of actual cached sessions will be more than that number as sessions are cached based on their acknowledgment mode, so there can be up to 4 cached session instances when  is set to one, one for each AcknowledgementMode.
MessageProducers and MessageConsumers are cached within their owning session and also take into account the unique properties of the producers and consumers when caching.
MessageProducers are cached based on their destination.
MessageConsumers are cached based on a key composed of the destination, selector, noLocal delivery flag, and the durable subscription name (if creating durable consumers).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="destination-management"><a class="anchor" href="#destination-management"></a>Destination Management</h3>
<div class="paragraph">
<p>Destinations, like ConnectionFactories, are JMS administered objects that can be stored and retrieved in JNDI. When configuring a Spring application context you can use the JNDI factory class <code class="class">JndiObjectFactoryBean</code> / <code>&lt;jee:jndi-lookup&gt;</code> to perform dependency injection on your object&#8217;s references to JMS destinations.
However, often this strategy is cumbersome if there are a large number of destinations in the application or if there are advanced destination management features unique to the JMS provider.
Examples of such advanced destination management would be the creation of dynamic destinations or support for a hierarchical namespace of destinations.
The <code class="class">JmsTemplate</code> delegates the resolution of a destination name to a JMS destination object to an implementation of the interface <code class="class">DestinationResolver</code>.
<code class="class">DynamicDestinationResolver</code> is the default implementation used by <code class="class">JmsTemplate</code> and accommodates resolving dynamic destinations.
A <code class="class">JndiDestinationResolver</code> is also provided that acts as a service locator for destinations contained in JNDI and optionally falls back to the behavior contained in <code class="class">DynamicDestinationResolver</code>.</p>
</div>
<div class="paragraph">
<p>Quite often the destinations used in a JMS application are only known at runtime and therefore cannot be administratively created when the application is deployed.
This is often because there is shared application logic between interacting system components that create destinations at runtime according to a well-known naming convention.
Even though the creation of dynamic destinations is not part of the JMS specification, most vendors have provided this functionality.
Dynamic destinations are created with a name defined by the user which differentiates them from temporary destinations and are often not registered in JNDI. The API used to create dynamic destinations varies from provider to provider since the properties associated with the destination are vendor specific.
However, a simple implementation choice that is sometimes made by vendors is to disregard the warnings in the JMS specification and to use the <code class="class">TopicSession</code> method <code class="method">createTopic(String topicName)</code> or the <code class="class">QueueSession</code> method <code class="method">createQueue(String queueName)</code> to create a new destination with default destination properties.
Depending on the vendor implementation, <code class="class">DynamicDestinationResolver</code> may then also create a physical destination instead of only resolving one.</p>
</div>
<div class="paragraph">
<p>The boolean property  is used to configure the <code class="class">JmsTemplate</code> with knowledge of what JMS domain is being used.
By default the value of this property is false, indicating that the point-to-point domain, Queues, will be used.
This property used by <code class="class">JmsTemplate</code> determines the behavior of dynamic destination resolution via implementations of the <code class="interface">DestinationResolver</code> interface.</p>
</div>
<div class="paragraph">
<p>You can also configure the <code class="class">JmsTemplate</code> with a default destination via the property .
The default destination will be used with send and receive operations that do not refer to a specific destination.</p>
</div>
</div>
<div class="sect2">
<h3 id="message-listener-containers"><a class="anchor" href="#message-listener-containers"></a>Message Listener Containers</h3>
<div class="paragraph">
<p>One of the most common uses of JMS messages in the EJB world is to drive message-driven beans (MDBs).
Spring offers a solution to create message-driven POJOs (MDPs) in a way that does not tie a user to an EJB container.
(See <a href="#jms-asynchronousMessageReception">[jms-asynchronousMessageReception]</a> for detailed coverage of Spring&#8217;s MDP support.)</p>
</div>
<div class="paragraph">
<p>A message listener container is used to receive messages from a JMS message queue and drive the MessageListener that is injected into it.
The listener container is responsible for all threading of message reception and dispatches into the listener for processing.
A message listener container is the intermediary between an MDP and a messaging provider, and takes care of registering to receive messages, participating in transactions, resource acquisition and release, exception conversion and suchlike.
This allows you as an application developer to write the (possibly complex) business logic associated with receiving a message (and possibly responding to it), and delegates boilerplate JMS infrastructure concerns to the framework.</p>
</div>
<div class="paragraph">
<p>There are two standard JMS message listener containers packaged with Spring, each with its specialised feature set.</p>
</div>
<div class="sect3">
<h4 id="simplemessagelistenercontainer"><a class="anchor" href="#simplemessagelistenercontainer"></a>SimpleMessageListenerContainer</h4>
<div class="paragraph">
<p>This message listener container is the simpler of the two standard flavors.
It creates a fixed number of JMS sessions and consumers at startup, registers the listener using the standard JMS <code class="method">MessageConsumer.setMessageListener()</code> method, and leaves it up the JMS provider to perform listener callbacks.
This variant does not allow for dynamic adaption to runtime demands or for participation in externally managed transactions.
Compatibility-wise, it stays very close to the spirit of the standalone JMS specification - but is generally not compatible with Java EE&#8217;s JMS restrictions.</p>
</div>
</div>
<div class="sect3">
<h4 id="defaultmessagelistenercontainer"><a class="anchor" href="#defaultmessagelistenercontainer"></a>DefaultMessageListenerContainer</h4>
<div class="paragraph">
<p>This message listener container is the one used in most cases.
In contrast to <code class="class">SimpleMessageListenerContainer</code>, this container variant does allow for dynamic adaption to runtime demands and is able to participate in externally managed transactions.
Each received message is registered with an XA transaction when configured with a <code class="class">JtaTransactionManager</code>; so processing may take advantage of XA transaction semantics.
This listener container strikes a good balance between low requirements on the JMS provider, advanced functionality such as transaction participation, and compatibility with Java EE environments.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transaction-management-5"><a class="anchor" href="#transaction-management-5"></a>Transaction management</h3>
<div class="paragraph">
<p>Spring provides a <code class="class">JmsTransactionManager</code> that manages transactions for a single JMS <code class="class">ConnectionFactory</code>.
This allows JMS applications to leverage the managed transaction features of Spring as described in <a href="#transaction">[transaction]</a>.
The <code class="class">JmsTransactionManager</code> performs local resource transactions, binding a JMS Connection/Session pair from the specified <code class="class">ConnectionFactory</code> to the thread.
<code class="class">JmsTemplate</code> automatically detects such transactional resources and operates on them accordingly.</p>
</div>
<div class="paragraph">
<p>In a Java EE environment, the <code class="class">ConnectionFactory</code> will pool Connections and Sessions, so those resources are efficiently reused across transactions.
In a standalone environment, using Spring&#8217;s <code class="class">SingleConnectionFactory</code> will result in a shared JMS <code class="class">Connection</code>, with each transaction having its own independent <code class="class">Session</code>.
Alternatively, consider the use of a provider-specific pooling adapter such as ActiveMQ&#8217;s <code class="class">PooledConnectionFactory</code> class.</p>
</div>
<div class="paragraph">
<p><code class="class">JmsTemplate</code> can also be used with the <code class="class">JtaTransactionManager</code> and an XA-capable JMS <code class="class">ConnectionFactory</code> for performing distributed transactions.
Note that this requires the use of a JTA transaction manager as well as a properly XA-configured ConnectionFactory! (Check your Java EE server&#8217;s / JMS provider&#8217;s documentation.)</p>
</div>
<div class="paragraph">
<p>Reusing code across a managed and unmanaged transactional environment can be confusing when using the JMS API to create a <code class="class">Session</code> from a <code class="class">Connection</code>.
This is because the JMS API has only one factory method to create a <code class="class">Session</code> and it requires values for the transaction and acknowledgement modes.
In a managed environment, setting these values is the responsibility of the environment&#8217;s transactional infrastructure, so these values are ignored by the vendor&#8217;s wrapper to the JMS Connection.
When using the <code class="class">JmsTemplate</code> in an unmanaged environment you can specify these values through the use of the properties <code>sessionTransacted</code> and <code>sessionAcknowledgeMode</code>.
When using a <code class="class">PlatformTransactionManager</code> with <code class="class">JmsTemplate</code>, the template will always be given a transactional JMS <code class="class">Session</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sending-a-code-class-interface-message-code"><a class="anchor" href="#sending-a-code-class-interface-message-code"></a>Sending a <code class="interface">Message</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code class="class">JmsTemplate</code> contains many convenience methods to send a message.
There are send methods that specify the destination using a <code class="class">javax.jms.Destination</code> object and those that specify the destination using a string for use in a JNDI lookup.
The send method that takes no destination argument uses the default destination.
Here is an example that sends a message to a queue using the 1.0.2 implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import javax.jms.ConnectionFactory;
import javax.jms.JMSException;
import javax.jms.Message;
import javax.jms.Queue;
import javax.jms.Session;

import org.springframework.jms.core.MessageCreator;
import org.springframework.jms.core.JmsTemplate;

public class JmsQueueSender {

    private JmsTemplate jmsTemplate;
    private Queue queue;

    public void setConnectionFactory(ConnectionFactory cf) {
        this.jmsTemplate = new JmsTemplate(cf);
    }

    public void setQueue(Queue queue) {
        this.queue = queue;
    }

    public void simpleSend() {
        this.jmsTemplate.send(this.queue, new MessageCreator() {
            public Message createMessage(Session session) throws JMSException {
              return session.createTextMessage("hello queue world");
            }
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example uses the <code class="class">MessageCreator</code> callback to create a text message from the supplied <code class="class">Session</code> object.
The <code class="class">JmsTemplate</code> is constructed by passing a reference to a <code class="class">ConnectionFactory</code>.
As an alternative, a zero argument constructor and  is provided and can be used for constructing the instance in JavaBean style (using a BeanFactory or plain Java code).
Alternatively, consider deriving from Spring&#8217;s <code class="class">JmsGatewaySupport</code> convenience base class, which provides pre-built bean properties for JMS configuration.</p>
</div>
<div class="paragraph">
<p>The method <code class="method">send(String destinationName, MessageCreator
    creator)</code> lets you send a message using the string name of the destination.
If these names are registered in JNDI, you should set the  property of the template to an instance of <code class="class">JndiDestinationResolver</code>.</p>
</div>
<div class="paragraph">
<p>If you created the <code class="class">JmsTemplate</code> and specified a default destination, the <code class="method">send(MessageCreator c)</code> sends a message to that destination.</p>
</div>
<div class="sect2">
<h3 id="using-message-converters"><a class="anchor" href="#using-message-converters"></a>Using Message Converters</h3>
<div class="paragraph">
<p>In order to facilitate the sending of domain model objects, the <code class="class">JmsTemplate</code> has various send methods that take a Java object as an argument for a message&#8217;s data content.
The overloaded methods <code class="method">convertAndSend()</code> and <code class="method">receiveAndConvert()</code> in <code class="class">JmsTemplate</code> delegate the conversion process to an instance of the <code>MessageConverter</code> interface.
This interface defines a simple contract to convert between Java objects and JMS messages.
The default implementation <code class="class">SimpleMessageConverter</code> supports conversion between <code class="class">String</code> and <code class="class">TextMessage</code>, <code class="class">byte[]</code> and <code class="class">BytesMesssage</code>, and <code class="class">java.util.Map</code> and <code class="class">MapMessage</code>.
By using the converter, you and your application code can focus on the business object that is being sent or received via JMS and not be concerned with the details of how it is represented as a JMS message.</p>
</div>
<div class="paragraph">
<p>The sandbox currently includes a <code class="class">MapMessageConverter</code> which uses reflection to convert between a JavaBean and a <code class="class">MapMessage</code>.
Other popular implementation choices you might implement yourself are Converters that use an existing XML marshalling package, such as JAXB, Castor, XMLBeans, or XStream, to create a <code class="interface">TextMessage</code> representing the object.</p>
</div>
<div class="paragraph">
<p>To accommodate the setting of a message&#8217;s properties, headers, and body that can not be generically encapsulated inside a converter class, the <code class="interface">MessagePostProcessor</code> interface gives you access to the message after it has been converted, but before it is sent.
The example below demonstrates how to modify a message header and a property after a <code class="interface">java.util.Map</code> is converted to a message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public void sendWithConversion() {
    Map map = new HashMap();
    map.put("Name", "Mark");
    map.put("Age", new Integer(47));
    jmsTemplate.convertAndSend("testQueue", map, new MessagePostProcessor() {
        public Message postProcessMessage(Message message) throws JMSException {
            message.setIntProperty("AccountID", 1234);
            message.setJMSCorrelationID("123-00001");
            return message;
        }
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in a message of the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>MapMessage={
    Header={
        ... standard headers ...
        CorrelationID={123-00001}
    }
    Properties={
        AccountID={Integer:1234}
    }
    Fields={
        Name={String:Mark}
        Age={Integer:47}
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="code-class-interface-sessioncallback-code-and-code-class-interface-producercallback-code"><a class="anchor" href="#code-class-interface-sessioncallback-code-and-code-class-interface-producercallback-code"></a><code class="interface">SessionCallback</code> and <code class="interface">ProducerCallback</code></h3>
<div class="paragraph">
<p>While the send operations cover many common usage scenarios, there are cases when you want to perform multiple operations on a JMS <code class="interface">Session</code> or <code class="interface">MessageProducer</code>.
The <code class="interface">SessionCallback</code> and <code class="interface">ProducerCallback</code> expose the JMS <code class="interface">Session</code> and <code class="interface">Session</code> / <code class="interface">MessageProducer</code> pair respectively.
The <code class="method">execute()</code> methods on <code class="class">JmsTemplate</code> execute these callback methods.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="receiving-a-message"><a class="anchor" href="#receiving-a-message"></a>Receiving a message</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="synchronous-reception"><a class="anchor" href="#synchronous-reception"></a>Synchronous Reception</h3>
<div class="paragraph">
<p>While JMS is typically associated with asynchronous processing, it is possible to consume messages synchronously.
The overloaded <code class="method">receive(..)</code> methods provide this functionality.
During a synchronous receive, the calling thread blocks until a message becomes available.
This can be a dangerous operation since the calling thread can potentially be blocked indefinitely.
The property  specifies how long the receiver should wait before giving up waiting for a message.</p>
</div>
</div>
<div class="sect2">
<h3 id="asynchronous-reception-message-driven-pojos"><a class="anchor" href="#asynchronous-reception-message-driven-pojos"></a>Asynchronous Reception - Message-Driven POJOs</h3>
<div class="paragraph">
<p>In a fashion similar to a Message-Driven Bean (MDB) in the EJB world, the Message-Driven POJO (MDP) acts as a receiver for JMS messages.
The one restriction (but see also below for the discussion of the <code class="class">MessageListenerAdapter</code> class) on an MDP is that it must implement the <code class="interface">javax.jms.MessageListener</code> interface.
Please also be aware that in the case where your POJO will be receiving messages on multiple threads, it is important to ensure that your implementation is thread-safe.</p>
</div>
<div class="paragraph">
<p>Below is a simple implementation of an MDP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import javax.jms.JMSException;
import javax.jms.Message;
import javax.jms.MessageListener;
import javax.jms.TextMessage;

public class ExampleListener implements MessageListener {

    public void onMessage(Message message) {
        if (message instanceof TextMessage) {
            try {
                System.out.println(((TextMessage) message).getText());
            }
            catch (JMSException ex) {
                throw new RuntimeException(ex);
            }
        }
        else {
            throw new IllegalArgumentException("Message must be of type TextMessage");
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you&#8217;ve implemented your <code class="interface">MessageListener</code>, it&#8217;s time to create a message listener container.</p>
</div>
<div class="paragraph">
<p>Find below an example of how to define and configure one of the message listener containers that ships with Spring (in this case the <code class="class">DefaultMessageListenerContainer</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- this is the Message Driven POJO (MDP) --&gt;
&lt;bean id="messageListener" class="jmsexample.ExampleListener" /&gt;

&lt;!-- and this is the message listener container --&gt;
&lt;bean id="jmsContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
    &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
    &lt;property name="destination" ref="destination"/&gt;
    &lt;property name="messageListener" ref="messageListener" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the Spring Javadoc of the various message listener containers for a full description of the features supported by each implementation.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-code-class-interface-sessionawaremessagelistener-code-interface"><a class="anchor" href="#the-code-class-interface-sessionawaremessagelistener-code-interface"></a>The <code class="interface">SessionAwareMessageListener</code> interface</h3>
<div class="paragraph">
<p>The <code class="interface">SessionAwareMessageListener</code> interface is a Spring-specific interface that provides a similar contract to the JMS <code class="interface">MessageListener</code> interface, but also provides the message handling method with access to the JMS <code class="interface">Session</code> from which the <code class="interface">Message</code> was received.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.jms.listener;

public interface SessionAwareMessageListener {

    void onMessage(Message message, Session session) throws JMSException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can choose to have your MDPs implement this interface (in preference to the standard JMS <code class="interface">MessageListener</code> interface) if you want your MDPs to be able to respond to any received messages (using the <code class="interface">Session</code> supplied in the <code>onMessage(Message, Session)</code> method).
All of the message listener container implementations that ship with Spring have support for MDPs that implement either the <code class="interface">MessageListener</code> or <code class="interface">SessionAwareMessageListener</code> interface.
Classes that implement the <code class="interface">SessionAwareMessageListener</code> come with the caveat that they are then tied to Spring through the interface.
The choice of whether or not to use it is left entirely up to you as an application developer or architect.</p>
</div>
<div class="paragraph">
<p>Please note that the <code>'onMessage(..)'</code> method of the <code class="interface">SessionAwareMessageListener</code> interface throws <code class="class">JMSException</code>.
In contrast to the standard JMS <code class="interface">MessageListener</code> interface, when using the <code class="interface">SessionAwareMessageListener</code> interface, it is the responsibility of the client code to handle any exceptions thrown.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-code-class-class-messagelisteneradapter-code"><a class="anchor" href="#the-code-class-class-messagelisteneradapter-code"></a>The <code class="class">MessageListenerAdapter</code></h3>
<div class="paragraph">
<p>The <code class="class">MessageListenerAdapter</code> class is the final component in Spring&#8217;s asynchronous messaging support: in a nutshell, it allows you to expose almost <em>any</em> class as a MDP (there are of course some constraints).</p>
</div>
<div class="paragraph">
<p>Consider the following interface definition.
Notice that although the interface extends neither the <code class="interface">MessageListener</code> nor <code class="interface">SessionAwareMessageListener</code> interfaces, it can still be used as a MDP via the use of the <code class="class">MessageListenerAdapter</code> class.
Notice also how the various message handling methods are strongly typed according to the <em>contents</em> of the various <code class="interface">Message</code> types that they can receive and handle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface MessageDelegate {

    void handleMessage(String message);

    void handleMessage(Map message);

    void handleMessage(byte[] message);

    void handleMessage(Serializable message);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class DefaultMessageDelegate implements MessageDelegate {
    // implementation elided for clarity...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In particular, note how the above implementation of the <code class="interface">MessageDelegate</code> interface (the above <code class="class">DefaultMessageDelegate</code> class) has <em>no</em> JMS dependencies at all.
It truly is a POJO that we will make into an MDP via the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- this is the Message Driven POJO (MDP) --&gt;
&lt;bean id="messageListener" class="org.springframework.jms.listener.adapter.MessageListenerAdapter"&gt;
    &lt;constructor-arg&gt;
        &lt;bean class="jmsexample.DefaultMessageDelegate"/&gt;
    &lt;/constructor-arg&gt;
&lt;/bean&gt;

&lt;!-- and this is the message listener container... --&gt;
&lt;bean id="jmsContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
    &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
    &lt;property name="destination" ref="destination"/&gt;
    &lt;property name="messageListener" ref="messageListener" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is an example of another MDP that can only handle the receiving of JMS <code class="interface">TextMessage</code> messages.
Notice how the message handling method is actually called <code>'receive'</code> (the name of the message handling method in a <code class="class">MessageListenerAdapter</code> defaults to <code>'handleMessage'</code>), but it is configurable (as you will see below).
Notice also how the <code>'receive(..)'</code> method is strongly typed to receive and respond only to JMS <code class="interface">TextMessage</code> messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface TextMessageDelegate {

    void receive(TextMessage message);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class DefaultTextMessageDelegate implements TextMessageDelegate {
    // implementation elided for clarity...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration of the attendant <code class="class">MessageListenerAdapter</code> would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="messageListener" class="org.springframework.jms.listener.adapter.MessageListenerAdapter"&gt;
    &lt;constructor-arg&gt;
        &lt;bean class="jmsexample.DefaultTextMessageDelegate"/&gt;
    &lt;/constructor-arg&gt;
    &lt;property name="defaultListenerMethod" value="receive"/&gt;
    &lt;!-- we don't want automatic message context extraction --&gt;
    &lt;property name="messageConverter"&gt;
        &lt;null/&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that if the above <code>'messageListener'</code> receives a JMS <code class="interface">Message</code> of a type other than <code class="interface">TextMessage</code>, an <code class="class">IllegalStateException</code> will be thrown (and subsequently swallowed).
Another of the capabilities of the <code class="class">MessageListenerAdapter</code> class is the ability to automatically send back a response <code class="interface">Message</code> if a handler method returns a non-void value.
Consider the interface and class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface ResponsiveTextMessageDelegate {

    // notice the return type...
    String receive(TextMessage message);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class DefaultResponsiveTextMessageDelegate implements ResponsiveTextMessageDelegate {
    // implementation elided for clarity...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the above <code class="class">DefaultResponsiveTextMessageDelegate</code> is used in conjunction with a <code class="class">MessageListenerAdapter</code> then any non-null value that is returned from the execution of the <code>'receive(..)'</code> method will (in the default configuration) be converted into a <code class="interface">TextMessage</code>.
The resulting <code class="interface">TextMessage</code> will then be sent to the <code class="interface">Destination</code> (if one exists) defined in the JMS Reply-To property of the original <code class="interface">Message</code>, or the default <code class="interface">Destination</code> set on the <code class="class">MessageListenerAdapter</code> (if one has been configured); if no <code class="interface">Destination</code> is found then an <code class="class">InvalidDestinationException</code> will be thrown (and please note that this exception <em>will
      not</em> be swallowed and <em>will</em> propagate up the call stack).</p>
</div>
</div>
<div class="sect2">
<h3 id="processing-messages-within-transactions"><a class="anchor" href="#processing-messages-within-transactions"></a>Processing messages within transactions</h3>
<div class="paragraph">
<p>Invoking a message listener within a transaction only requires reconfiguration of the listener container.</p>
</div>
<div class="paragraph">
<p>Local resource transactions can simply be activated through the <code>sessionTransacted</code> flag on the listener container definition.
Each message listener invocation will then operate within an active JMS transaction, with message reception rolled back in case of listener execution failure.
Sending a response message (via <code class="interface">SessionAwareMessageListener</code>) will be part of the same local transaction, but any other resource operations (such as database access) will operate independently.
This usually requires duplicate message detection in the listener implementation, covering the case where database processing has committed but message processing failed to commit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="jmsContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
    &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
    &lt;property name="destination" ref="destination"/&gt;
    &lt;property name="messageListener" ref="messageListener"/&gt;
    &lt;property name="sessionTransacted" value="true"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For participating in an externally managed transaction, you will need to configure a transaction manager and use a listener container which supports externally managed transactions: typically <code class="class">DefaultMessageListenerContainer</code>.</p>
</div>
<div class="paragraph">
<p>To configure a message listener container for XA transaction participation, you&#8217;ll want to configure a <code class="class">JtaTransactionManager</code> (which, by default, delegates to the Java EE server&#8217;s transaction subsystem).
Note that the underlying JMS ConnectionFactory needs to be XA-capable and properly registered with your JTA transaction coordinator! (Check your Java EE server&#8217;s configuration of JNDI resources.) This allows message reception as well as e.g.
database access to be part of the same transaction (with unified commit semantics, at the expense of XA transaction log overhead).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you just need to add it to our earlier container configuration.
The container will take care of the rest.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="jmsContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
    &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
    &lt;property name="destination" ref="destination"/&gt;
    &lt;property name="messageListener" ref="messageListener"/&gt;
    &lt;property name="transactionManager" ref="transactionManager"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="support-for-jca-message-endpoints"><a class="anchor" href="#support-for-jca-message-endpoints"></a>Support for JCA Message Endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Beginning with version 2.5, Spring also provides support for a JCA-based <code class="interface">MessageListener</code> container.
The <code class="class">JmsMessageEndpointManager</code> will attempt to automatically determine the <code class="interface">ActivationSpec</code> class name from the provider&#8217;s <code class="interface">ResourceAdapter</code> class name.
Therefore, it is typically possible to just provide Spring&#8217;s generic <code class="class">JmsActivationSpecConfig</code> as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.jms.listener.endpoint.JmsMessageEndpointManager"&gt;
    &lt;property name="resourceAdapter" ref="resourceAdapter"/&gt;
    &lt;property name="activationSpecConfig"&gt;
        &lt;bean class="org.springframework.jms.listener.endpoint.JmsActivationSpecConfig"&gt;
            &lt;property name="destinationName" value="myQueue"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="messageListener" ref="myMessageListener"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you may set up a <code class="class">JmsMessageEndpointManager</code> with a given <code class="interface">ActivationSpec</code> object.
The <code class="interface">ActivationSpec</code> object may also come from a JNDI lookup (using <code>&lt;jee:jndi-lookup&gt;</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.jms.listener.endpoint.JmsMessageEndpointManager"&gt;
    &lt;property name="resourceAdapter" ref="resourceAdapter"/&gt;
    &lt;property name="activationSpec"&gt;
        &lt;bean class="org.apache.activemq.ra.ActiveMQActivationSpec"&gt;
            &lt;property name="destination" value="myQueue"/&gt;
            &lt;property name="destinationType" value="javax.jms.Queue"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="messageListener" ref="myMessageListener"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Spring&#8217;s <code class="class">ResourceAdapterFactoryBean</code>, the target <code class="interface">ResourceAdapter</code> may be configured locally as depicted in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="resourceAdapter" class="org.springframework.jca.support.ResourceAdapterFactoryBean"&gt;
    &lt;property name="resourceAdapter"&gt;
        &lt;bean class="org.apache.activemq.ra.ActiveMQResourceAdapter"&gt;
            &lt;property name="serverUrl" value="tcp://localhost:61616"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="workManager"&gt;
        &lt;bean class="org.springframework.jca.work.SimpleTaskWorkManager"/&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The specified <code class="interface">WorkManager</code> may also point to an environment-specific thread pool - typically through <code class="class">SimpleTaskWorkManager's</code> "asyncTaskExecutor" property.
Consider defining a shared thread pool for all your <code class="interface">ResourceAdapter</code> instances if you happen to use multiple adapters.</p>
</div>
<div class="paragraph">
<p>In some environments (e.g.
WebLogic 9 or above), the entire <code class="interface">ResourceAdapter</code> object may be obtained from JNDI instead (using <code>&lt;jee:jndi-lookup&gt;</code>).
The Spring-based message listeners can then interact with the server-hosted <code class="interface">ResourceAdapter</code>, also using the server&#8217;s built-in <code class="interface">WorkManager</code>.</p>
</div>
<div class="paragraph">
<p>Please consult the JavaDoc for <code class="class">JmsMessageEndpointManager</code>, <code class="class">JmsActivationSpecConfig</code>, and <code class="class">ResourceAdapterFactoryBean</code> for more details.</p>
</div>
<div class="paragraph">
<p>Spring also provides a generic JCA message endpoint manager which is not tied to JMS: <code class="class">org.springframework.jca.endpoint.GenericMessageEndpointManager</code>.
This component allows for using any message listener type (e.g.
a CCI MessageListener) and any provider-specific ActivationSpec object.
Check out your JCA provider&#8217;s documentation to find out about the actual capabilities of your connector, and consult <code class="class">GenericMessageEndpointManager</code>'s JavaDoc for the Spring-specific configuration details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
JCA-based message endpoint management is very analogous to EJB 2.1 Message-Driven Beans; it uses the same underlying resource provider contract.
Like with EJB 2.1 MDBs, any message listener interface supported by your JCA provider can be used in the Spring context as well.
Spring nevertheless provides explicit <em>convenience</em> support for JMS, simply because JMS is the most common endpoint API used with the JCA endpoint management contract.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms-namespace-support"><a class="anchor" href="#jms-namespace-support"></a>JMS Namespace Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring 2.5 introduces an XML namespace for simplifying JMS configuration.
To use the JMS namespace elements you will need to reference the JMS schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jms="http://www.springframework.org/schema/jms"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms.xsd"&gt;

&lt;!-- &lt;bean/&gt; definitions here --&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The namespace consists of two top-level elements: <code>&lt;listener-container/&gt;</code> and <code>&lt;jca-listener-container/&gt;</code> both of which may contain one or more <code>&lt;listener/&gt;</code> child elements.
Here is an example of a basic configuration for two listeners.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;jms:listener-container&gt;

    &lt;jms:listener destination="queue.orders" ref="orderService" method="placeOrder"/&gt;

    &lt;jms:listener destination="queue.confirmations" ref="confirmationLogger" method="log"/&gt;

&lt;/jms:listener-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above is equivalent to creating two distinct listener container bean definitions and two distinct <code class="class">MessageListenerAdapter</code> bean definitions as demonstrated in <a href="#jms-receiving-async-message-listener-adapter">[jms-receiving-async-message-listener-adapter]</a>.
In addition to the attributes shown above, the <code>listener</code> element may contain several optional ones.
The following table describes all available attributes:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 14. Attributes of the JMS <code>&lt;listener&gt;</code> element</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A bean name for the hosting listener container. If
            not specified, a bean name will be automatically
            generated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination (required)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The destination name for this listener, resolved
            through the DestinationResolver
            strategy.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref (required)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bean name of the handler object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the handler method to invoke. If the
            ref points to a
            MessageListener or Spring
            SessionAwareMessageListener, this
            attribute may be omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the default response destination to send
            response messages to. This will be applied in case of a request
            message that does not carry a "JMSReplyTo" field. The type of this
            destination will be determined by the listener-container&#8217;s
            "destination-type" attribute. Note: This only applies to a
            listener method with a return value, for which each result object
            will be converted into a response message.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the durable subscription, if
            any.</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The <code>&lt;listener-container/&gt;</code> element also accepts several optional attributes.
This allows for customization of the various strategies (for example,  and ) as well as basic JMS settings and resource references.
Using these attributes, it is possible to define highly-customized listener containers while still benefiting from the convenience of the namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;jms:listener-container connection-factory="myConnectionFactory"
                        task-executor="myTaskExecutor"
                        destination-resolver="myDestinationResolver"
                        transaction-manager="myTransactionManager"
                        concurrency="10"&gt;

    &lt;jms:listener destination="queue.orders" ref="orderService" method="placeOrder"/&gt;

    &lt;jms:listener destination="queue.confirmations" ref="confirmationLogger" method="log"/&gt;

&lt;/jms:listener-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table describes all available attributes.
Consult the class-level Javadoc of the <code class="class">AbstractMessageListenerContainer</code> and its concrete subclasses for more details on the individual properties.
The Javadoc also provides a discussion of transaction choices and message redelivery scenarios.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 15. Attributes of the JMS <code>&lt;listener-container&gt;</code> element</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of this listener container. Available
            options are: default,
            simple, default102, or
            simple102 (the default value is
            <em>default</em>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom listener container implementation class
            as fully qualified class name. Default is Spring&#8217;s standard
            DefaultMessageListenerContainer or
            SimpleMessageListenerContainer,
            according to the "container-type" attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the JMS
            ConnectionFactory bean (the default
            bean name is
            <em>connectionFactory</em>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the Spring
            TaskExecutor for the JMS listener
            invokers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the
            DestinationResolver strategy for
            resolving JMS
            Destinations.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the
            MessageConverter strategy for
            converting JMS Messages to listener method arguments. Default is a
            SimpleMessageConverter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to an
            ErrorHandler strategy for handling
            any uncaught Exceptions that may occur during the execution of the
            MessageListener.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS destination type for this listener:
            queue, topic or
            durableTopic. The default is
            queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS client id for this listener container. Needs
            to be specified when using durable subscriptions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cache level for JMS resources:
            none, connection,
            session, consumer or
            auto. By default (auto), the
            cache level will effectively be "consumer", unless an external
            transaction manager has been specified - in which case the
            effective default will be none (assuming
            Java EE-style transaction management where the given
            ConnectionFactory is an XA-aware pool).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The native JMS acknowledge mode:
            auto, client,
            dups-ok or transacted. A
            value of transacted activates a locally
            transacted Session. As an
            alternative, specify the transaction-manager
            attribute described below. Default is
            auto.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to an external
            PlatformTransactionManager
            (typically an XA-based transaction coordinator, e.g. Spring&#8217;s
            JtaTransactionManager). If not specified,
            native acknowledging will be used (see "acknowledge"
            attribute).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of concurrent sessions/consumers to start
            for each listener. Can either be a simple number indicating the
            maximum number (e.g. "5") or a range indicating the lower as well
            as the upper limit (e.g. "3-5"). Note that a specified minimum is
            just a hint and might be ignored at runtime. Default is 1; keep
            concurrency limited to 1 in case of a topic listener or if queue
            ordering is important; consider raising it for general
            queues.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of messages to load into a single
            session. Note that raising this number might lead to starvation of
            concurrent consumers!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The timeout to use for receive calls (in milliseconds).
			The default is 1000 ms (1 sec); -1
			indicates no timeout at all.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the interval between recovery attempts, in
            milliseconds. The default is 5000 ms, that is,
            5 seconds.</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Configuring a JCA-based listener container with the "jms" schema support is very similar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;jms:jca-listener-container resource-adapter="myResourceAdapter"
                            destination-resolver="myDestinationResolver"
                            transaction-manager="myTransactionManager"
                            concurrency="10"&gt;

    &lt;jms:listener destination="queue.orders" ref="myMessageListener"/&gt;

&lt;/jms:jca-listener-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The available configuration options for the JCA variant are described in the following table:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 16. Attributes of the JMS <code>&lt;jca-listener-container/&gt;</code> element</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the JCA
            ResourceAdapter bean (the default
            bean name is <em>resourceAdapter</em>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the
            JmsActivationSpecFactory. The
            default is to autodetect the JMS provider and its
            ActivationSpec class (see
            DefaultJmsActivationSpecFactory)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the
            DestinationResolver strategy for
            resolving JMS Destinations.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the
            MessageConverter strategy for
            converting JMS Messages to listener method arguments. Default is a
            SimpleMessageConverter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS destination type for this listener:
            queue, topic or
            durableTopic. The default is
            queue.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS client id for this listener container. Needs
            to be specified when using durable subscriptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The native JMS acknowledge mode:
            auto, client,
            dups-ok or transacted. A
            value of transacted activates a locally
            transacted Session. As an
            alternative, specify the transaction-manager
            attribute described below. Default is
            auto.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to a Spring
            JtaTransactionManager or a
            javax.transaction.TransactionManager
            for kicking off an XA transaction for each incoming message. If
            not specified, native acknowledging will be used (see the
            "acknowledge" attribute).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of concurrent sessions/consumers to start
            for each listener. Can either be a simple number indicating the
            maximum number (e.g. "5") or a range indicating the lower as well
            as the upper limit (e.g. "3-5"). Note that a specified minimum is
            just a hint and will typically be ignored at runtime when using a
            JCA listener container. Default is 1.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of messages to load into a single
            session. Note that raising this number might lead to starvation of
            concurrent consumers!</p></td>
</tr>
</tbody>
</table>

</div>
</div>
<h1 id="jmx" class="sect0"><a class="anchor" href="#jmx"></a>JMX</h1>
<div class="sect1">
<h2 id="introduction-10"><a class="anchor" href="#introduction-10"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JMX support in Spring provides you with the features to easily and transparently integrate your Spring application into a JMX infrastructure.</p>
</div>
<div class="paragraph">
<div class="title">JMX?</div>
<p>[sidebar]This chapter is not an introduction to JMX&#8230;
it doesn&#8217;t try to explain the motivations of why one might want to use JMX (or indeed what the letters JMX actually stand for).
If you are new to JMX, check out <a href="#jmx-resources">[jmx-resources]</a> at the end of this chapter.</p>
</div>
<div class="paragraph">
<p>Specifically, Spring&#8217;s JMX support provides four core features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The automatic registration of <em>any</em> Spring bean as a JMX MBean</p>
</li>
<li>
<p>A flexible mechanism for controlling the management interface of your beans</p>
</li>
<li>
<p>The declarative exposure of MBeans over remote, JSR-160 connectors</p>
</li>
<li>
<p>The simple proxying of both local and remote MBean resources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These features are designed to work without coupling your application components to either Spring or JMX interfaces and classes.
Indeed, for the most part your application classes need not be aware of either Spring or JMX in order to take advantage of the Spring JMX features.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exporting-your-beans-to-jmx"><a class="anchor" href="#exporting-your-beans-to-jmx"></a>Exporting your beans to JMX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The core class in Spring&#8217;s JMX framework is the <code class="class">MBeanExporter</code>.
This class is responsible for taking your Spring beans and registering them with a JMX <code class="interface">MBeanServer</code>.
For example, consider the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.jmx;

public class JmxTestBean implements IJmxTestBean {

    private String name;
    private int age;
    private boolean isSuperman;

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public int add(int x, int y) {
        return x + y;
    }

    public void dontExposeMe() {
        throw new RuntimeException();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To expose the properties and methods of this bean as attributes and operations of an MBean you simply configure an instance of the <code class="class">MBeanExporter</code> class in your configuration file and pass in the bean as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;!-- this bean must not be lazily initialized if the exporting is to happen --&gt;
  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter" lazy-init="false"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pertinent bean definition from the above configuration snippet is the <code>exporter</code> bean.
The <code>beans</code> property tells the <code class="class">MBeanExporter</code> exactly which of your beans must be exported to the JMX <code class="interface">MBeanServer</code>.
In the default configuration, the key of each entry in the <code>beans</code> <code class="interface">Map</code> is used as the <code class="class">ObjectName</code> for the bean referenced by the corresponding entry value.
This behavior can be changed as described in <a href="#jmx-naming">[jmx-naming]</a>.</p>
</div>
<div class="paragraph">
<p>With this configuration the <code>testBean</code> bean is exposed as an MBean under the <code class="class">ObjectName</code> <code>bean:name=testBean1</code>.
By default, all <em>public</em> properties of the bean are exposed as attributes and all <em>public</em> methods (bar those inherited from the <code class="class">Object</code> class) are exposed as operations.</p>
</div>
<div class="sect2">
<h3 id="creating-an-code-class-interface-mbeanserver-code"><a class="anchor" href="#creating-an-code-class-interface-mbeanserver-code"></a>Creating an <code class="interface">MBeanServer</code></h3>
<div class="paragraph">
<p>The above configuration assumes that the application is running in an environment that has one (and only one) <code class="interface">MBeanServer</code> already running.
In this case, Spring will attempt to locate the running <code class="interface">MBeanServer</code> and register your beans with that server (if any).
This behavior is useful when your application is running inside a container such as Tomcat or IBM WebSphere that has its own <code class="interface">MBeanServer</code>.</p>
</div>
<div class="paragraph">
<p>However, this approach is of no use in a standalone environment, or when running inside a container that does not provide an <code class="interface">MBeanServer</code>.
To address this you can create an <code class="interface">MBeanServer</code> instance declaratively by adding an instance of the <code class="class">org.springframework.jmx.support.MBeanServerFactoryBean</code> class to your configuration.
You can also ensure that a specific <code class="interface">MBeanServer</code> is used by setting the value of the <code class="class">MBeanExporter</code>'s <code>server</code> property to the <code class="interface">MBeanServer</code> value returned by an <code class="class">MBeanServerFactoryBean</code>; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="mbeanServer" class="org.springframework.jmx.support.MBeanServerFactoryBean"/&gt;

  &lt;!--
    this bean needs to be eagerly pre-instantiated in order for the exporting to occur;
    this means that it must not be marked as lazily initialized
  --&gt;
  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="server" ref="mbeanServer"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here an instance of <code class="interface">MBeanServer</code> is created by the <code class="class">MBeanServerFactoryBean</code> and is supplied to the <code class="class">MBeanExporter</code> via the server property.
When you supply your own <code class="interface">MBeanServer</code> instance, the <code class="class">MBeanExporter</code> will not attempt to locate a running <code class="interface">MBeanServer</code> and will use the supplied <code class="interface">MBeanServer</code> instance.
For this to work correctly, you must (of course) have a JMX implementation on your classpath.</p>
</div>
</div>
<div class="sect2">
<h3 id="reusing-an-existing-code-class-interface-mbeanserver-code"><a class="anchor" href="#reusing-an-existing-code-class-interface-mbeanserver-code"></a>Reusing an existing <code class="interface">MBeanServer</code></h3>
<div class="paragraph">
<p>If no server is specified, the <code class="class">MBeanExporter</code> tries to automatically detect a running <code class="interface">MBeanServer</code>.
This works in most environment where only one <code class="interface">MBeanServer</code> instance is used, however when multiple instances exist, the exporter might pick the wrong server.
In such cases, one should use the <code class="interface">MBeanServer</code> <code>agentId</code> to indicate which instance to be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;
   &lt;bean id="mbeanServer" class="org.springframework.jmx.support.MBeanServerFactoryBean"&gt;
     &lt;!-- indicate to first look for a server --&gt;
     &lt;property name="locateExistingServerIfPossible" value="true"/&gt;
     &lt;!-- search for the MBeanServer instance with the given agentId --&gt;
     &lt;property name="agentId" value="&lt;MBeanServer instance agentId&gt;"/&gt;
   &lt;/bean&gt;

   &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
     &lt;property name="server" ref="mbeanServer"/&gt;
   ...
   &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For platforms/cases where the existing <code class="interface">MBeanServer</code> has a dynamic (or unknown) <code>agentId</code> which is retrieved through lookup methods, one should use <a href="#beans-factory-class-static-factory-method">factory-method</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;
   &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
     &lt;property name="server"&gt;
       &lt;!-- Custom MBeanServerLocator --&gt;
       &lt;bean class="platform.package.MBeanServerLocator" factory-method="locateMBeanServer"/&gt;
     &lt;/property&gt;

     &lt;!-- other beans here --&gt;

   &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lazy-initialized-mbeans"><a class="anchor" href="#lazy-initialized-mbeans"></a>Lazy-initialized MBeans</h3>
<div class="paragraph">
<p>If you configure a bean with the <code class="class">MBeanExporter</code> that is also configured for lazy initialization, then the <code class="class">MBeanExporter</code> will <em>not</em> break this contract and will avoid instantiating the bean.
Instead, it will register a proxy with the <code class="interface">MBeanServer</code> and will defer obtaining the bean from the container until the first invocation on the proxy occurs.</p>
</div>
</div>
<div class="sect2">
<h3 id="automatic-registration-of-mbeans"><a class="anchor" href="#automatic-registration-of-mbeans"></a>Automatic registration of MBeans</h3>
<div class="paragraph">
<p>Any beans that are exported through the <code class="class">MBeanExporter</code> and are already valid MBeans are registered as-is with the <code class="interface">MBeanServer</code> without further intervention from Spring.
MBeans can be automatically detected by the <code class="class">MBeanExporter</code> by setting the <code>autodetect</code> property to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
  &lt;property name="autodetect" value="true"/&gt;
&lt;/bean&gt;

&lt;bean name="spring:mbean=true" class="org.springframework.jmx.export.TestDynamicMBean"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the bean called <code>spring:mbean=true</code> is already a valid JMX MBean and will be automatically registered by Spring.
By default, beans that are autodetected for JMX registration have their bean name used as the <code class="class">ObjectName</code>.
This behavior can be overridden as detailed in <a href="#jmx-naming">[jmx-naming]</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="controlling-the-registration-behavior"><a class="anchor" href="#controlling-the-registration-behavior"></a>Controlling the registration behavior</h3>
<div class="paragraph">
<p>Consider the scenario where a Spring <code class="class">MBeanExporter</code> attempts to register an <code class="class">MBean</code> with an <code class="interface">MBeanServer</code> using the <code class="class">ObjectName</code> <code>'bean:name=testBean1'</code>.
If an <code class="class">MBean</code> instance has already been registered under that same <code class="class">ObjectName</code>, the default behavior is to fail (and throw an ).</p>
</div>
<div class="paragraph">
<p>It is possible to control the behavior of exactly what happens when an <code class="class">MBean</code> is registered with an <code class="interface">MBeanServer</code>.
Spring&#8217;s JMX support allows for three different registration behaviors to control the registration behavior when the registration process finds that an <code class="class">MBean</code> has already been registered under the same <code class="class">ObjectName</code>; these registration behaviors are summarized on the following table:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 17. Registration Behaviors</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Registration behavior</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REGISTRATION_FAIL_ON_EXISTING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the default registration behavior. If an
                MBean instance has already been
                registered under the same ObjectName,
                the MBean that is being registered will
                not be registered and an
                InstanceAlreadyExistsException will be
                thrown. The existing MBean is
                unaffected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REGISTRATION_IGNORE_EXISTING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If an MBean instance has
                already been registered under the same
                ObjectName, the
                MBean that is being registered will
                not be registered. The existing
                MBean is unaffected, and no
                Exception will be thrown.
                 This is useful in settings where multiple applications
                want to share a common MBean in a
                shared MBeanServer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REGISTRATION_REPLACE_EXISTING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If an MBean instance has
                already been registered under the same
                ObjectName, the existing
                MBean that was previously registered
                will be unregistered and the new MBean
                will be registered in its place (the new
                MBean effectively replaces the previous
                instance).</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The above values are defined as constants on the <code class="class">MBeanRegistrationSupport</code> class (the <code class="class">MBeanExporter</code> class derives from this superclass).
If you want to change the default registration behavior, you simply need to set the value of the <code>registrationBehaviorName</code> property on your <code class="class">MBeanExporter</code> definition to one of those values.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how to effect a change from the default registration behavior to the <code>REGISTRATION_REPLACE_EXISTING</code> behavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

    &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
        &lt;property name="beans"&gt;
            &lt;map&gt;
                &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
            &lt;/map&gt;
        &lt;/property&gt;
        &lt;property name="registrationBehaviorName" value="REGISTRATION_REPLACE_EXISTING"/&gt;
    &lt;/bean&gt;

    &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
        &lt;property name="name" value="TEST"/&gt;
        &lt;property name="age" value="100"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controlling-the-management-interface-of-your-beans"><a class="anchor" href="#controlling-the-management-interface-of-your-beans"></a>Controlling the management interface of your beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous example, you had little control over the management interface of your bean; <em>all</em> of the <em>public</em> properties and methods of each exported bean was exposed as JMX attributes and operations respectively.
To exercise finer-grained control over exactly which properties and methods of your exported beans are actually exposed as JMX attributes and operations, Spring JMX provides a comprehensive and extensible mechanism for controlling the management interfaces of your beans.</p>
</div>
<div class="sect2">
<h3 id="the-code-class-interface-mbeaninfoassembler-code-interface"><a class="anchor" href="#the-code-class-interface-mbeaninfoassembler-code-interface"></a>The <code class="interface">MBeanInfoAssembler</code> Interface</h3>
<div class="paragraph">
<p>Behind the scenes, the <code class="class">MBeanExporter</code> delegates to an implementation of the <code class="class">org.springframework.jmx.export.assembler.MBeanInfoAssembler</code> interface which is responsible for defining the management interface of each bean that is being exposed.
The default implementation, <code class="class">org.springframework.jmx.export.assembler.SimpleReflectiveMBeanInfoAssembler</code>, simply defines a management interface that exposes all public properties and methods (as you saw in the previous examples).
Spring provides two additional implementations of the <code class="interface">MBeanInfoAssembler</code> interface that allow you to control the generated management interface using either source-level metadata or any arbitrary interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-source-level-metadata-jdk-5-0-annotations"><a class="anchor" href="#using-source-level-metadata-jdk-5-0-annotations"></a>Using Source-Level Metadata (JDK 5.0 annotations)</h3>
<div class="paragraph">
<p>Using the <code class="class">MetadataMBeanInfoAssembler</code> you can define the management interfaces for your beans using source level metadata.
The reading of metadata is encapsulated by the <code class="class">org.springframework.jmx.export.metadata.JmxAttributeSource</code> interface.
Spring JMX provides a default implementation which uses JDK 5.0 annotations, namely <code class="class">org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource</code>.
The <code class="class">MetadataMBeanInfoAssembler</code> <em>must</em> be configured with an implementation instance of the <code class="class">JmxAttributeSource</code> interface for it to function correctly (there is <em>no</em> default).</p>
</div>
<div class="paragraph">
<p>To mark a bean for export to JMX, you should annotate the bean class with the <code class="class">ManagedResource</code> annotation.
Each method you wish to expose as an operation must be marked with the <code class="class">ManagedOperation</code> annotation and each property you wish to expose must be marked with the <code class="class">ManagedAttribute</code> annotation.
When marking properties you can omit either the annotation of the getter or the setter to create a write-only or read-only attribute respectively.</p>
</div>
<div class="paragraph">
<p>The example below shows the annotated version of the <code class="class">JmxTestBean</code> class that you saw earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.jmx;

import org.springframework.jmx.export.annotation.ManagedResource;
import org.springframework.jmx.export.annotation.ManagedOperation;
import org.springframework.jmx.export.annotation.ManagedAttribute;

@ManagedResource(objectName="bean:name=testBean4", description="My Managed Bean", log=true,
    logFile="jmx.log", currencyTimeLimit=15, persistPolicy="OnUpdate", persistPeriod=200,
    persistLocation="foo", persistName="bar")
public class AnnotationTestBean implements IJmxTestBean {

  private String name;
  private int age;

  @ManagedAttribute(description="The Age Attribute", currencyTimeLimit=15)
  public int getAge() {
    return age;
  }

  public void setAge(int age) {
    this.age = age;
  }

  @ManagedAttribute(description="The Name Attribute",
      currencyTimeLimit=20,
      defaultValue="bar",
      persistPolicy="OnUpdate")
  public void setName(String name) {
    this.name = name;
  }

  @ManagedAttribute(defaultValue="foo", persistPeriod=300)
  public String getName() {
    return name;
  }

  @ManagedOperation(description="Add two numbers")
  @ManagedOperationParameters({
    @ManagedOperationParameter(name = "x", description = "The first number"),
    @ManagedOperationParameter(name = "y", description = "The second number")})
  public int add(int x, int y) {
    return x + y;
  }

  public void dontExposeMe() {
    throw new RuntimeException();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the <code class="class">JmxTestBean</code> class is marked with the <code class="class">ManagedResource</code> annotation and that this <code class="class">ManagedResource</code> annotation is configured with a set of properties.
These properties can be used to configure various aspects of the MBean that is generated by the <code class="class">MBeanExporter</code>, and are explained in greater detail later in section entitled <a href="#jmx-interface-metadata-types">[jmx-interface-metadata-types]</a>.</p>
</div>
<div class="paragraph">
<p>You will also notice that both the <code>age</code> and <code>name</code> properties are annotated with the <code class="class">ManagedAttribute</code> annotation, but in the case of the <code>age</code> property, only the getter is marked.
This will cause both of these properties to be included in the management interface as attributes, but the <code>age</code> attribute will be read-only.</p>
</div>
<div class="paragraph">
<p>Finally, you will notice that the <code>add(int, int)</code> method is marked with the <code class="class">ManagedOperation</code> attribute whereas the <code>dontExposeMe()</code> method is not.
This will cause the management interface to contain only one operation, <code>add(int, int)</code>, when using the <code class="class">MetadataMBeanInfoAssembler</code>.</p>
</div>
<div class="paragraph">
<p>The configuration below shows how you configure the <code class="class">MBeanExporter</code> to use the <code class="class">MetadataMBeanInfoAssembler</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;
    &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
        &lt;property name="assembler" ref="assembler"/&gt;
        &lt;property name="namingStrategy" ref="namingStrategy"/&gt;
        &lt;property name="autodetect" value="true"/&gt;
    &lt;/bean&gt;

    &lt;bean id="jmxAttributeSource"
          class="org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource"/&gt;

    &lt;!-- will create management interface using annotation metadata --&gt;
    &lt;bean id="assembler"
          class="org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler"&gt;
        &lt;property name="attributeSource" ref="jmxAttributeSource"/&gt;
    &lt;/bean&gt;

    &lt;!-- will pick up the ObjectName from the annotation --&gt;
    &lt;bean id="namingStrategy"
          class="org.springframework.jmx.export.naming.MetadataNamingStrategy"&gt;
        &lt;property name="attributeSource" ref="jmxAttributeSource"/&gt;
    &lt;/bean&gt;

    &lt;bean id="testBean" class="org.springframework.jmx.AnnotationTestBean"&gt;
        &lt;property name="name" value="TEST"/&gt;
        &lt;property name="age" value="100"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that an <code class="class">MetadataMBeanInfoAssembler</code> bean has been configured with an instance of the <code class="class">AnnotationJmxAttributeSource</code> class and passed to the <code class="class">MBeanExporter</code> through the assembler property.
This is all that is required to take advantage of metadata-driven management interfaces for your Spring-exposed MBeans.</p>
</div>
</div>
<div class="sect2">
<h3 id="source-level-metadata-types"><a class="anchor" href="#source-level-metadata-types"></a>Source-Level Metadata Types</h3>
<div class="paragraph">
<p>The following source level metadata types are available for use in Spring JMX:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 18. Source-Level Metadata Types</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Annotation Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark all instances of a Class as
                JMX managed resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@ManagedResource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@ManagedOperation</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The following configuration parameters are available for use on these source-level metadata types:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 19. Source-Level Metadata Parameters</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Applies to</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObjectName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used by MetadataNamingStrategy
                to determine the ObjectName of a
                managed resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedResource</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedResource,
                ManagedAttribute,
                ManagedOperation,
                ManagedOperationParameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">currencyTimeLimit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the
                currencyTimeLimit descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedResource,
                ManagedAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the defaultValue
                descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the log descriptor
                field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedResource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logFile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the logFile
                descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedResource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistPolicy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the persistPolicy
                descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedResource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistPeriod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the persistPeriod
                descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedResource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistLocation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the
                persistLocation descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedResource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the persistName
                descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedResource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedOperationParameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagedOperationParameter</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="the-code-class-class-autodetectcapablembeaninfoassembler-code-interface"><a class="anchor" href="#the-code-class-class-autodetectcapablembeaninfoassembler-code-interface"></a>The <code class="class">AutodetectCapableMBeanInfoAssembler</code> interface</h3>
<div class="paragraph">
<p>To simplify configuration even further, Spring introduces the <code class="class">AutodetectCapableMBeanInfoAssembler</code> interface which extends the <code class="interface">MBeanInfoAssembler</code> interface to add support for autodetection of MBean resources.
If you configure the <code class="class">MBeanExporter</code> with an instance of <code class="class">AutodetectCapableMBeanInfoAssembler</code> then it is allowed to "vote" on the inclusion of beans for exposure to JMX.</p>
</div>
<div class="paragraph">
<p>Out of the box, the only implementation of the <code class="class">AutodetectCapableMBeanInfo</code> interface is the <code class="class">MetadataMBeanInfoAssembler</code> which will vote to include any bean which is marked with the <code class="class">ManagedResource</code> attribute.
The default approach in this case is to use the bean name as the <code class="class">ObjectName</code> which results in a configuration like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;!-- notice how no 'beans' are explicitly configured here --&gt;
    &lt;property name="autodetect" value="true"/&gt;
    &lt;property name="assembler" ref="assembler"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  &lt;bean id="assembler" class="org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler"&gt;
    &lt;property name="attributeSource"&gt;
        &lt;bean class="org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource"/&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that in this configuration no beans are passed to the <code class="class">MBeanExporter</code>; however, the <code class="class">JmxTestBean</code> will still be registered since it is marked with the <code class="class">ManagedResource</code> attribute and the <code class="class">MetadataMBeanInfoAssembler</code> detects this and votes to include it.
The only problem with this approach is that the name of the <code class="class">JmxTestBean</code> now has business meaning.
You can address this issue by changing the default behavior for <code class="class">ObjectName</code> creation as defined in <a href="#jmx-naming">[jmx-naming]</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="defining-management-interfaces-using-java-interfaces"><a class="anchor" href="#defining-management-interfaces-using-java-interfaces"></a>Defining management interfaces using Java interfaces</h3>
<div class="paragraph">
<p>In addition to the <code class="class">MetadataMBeanInfoAssembler</code>, Spring also includes the <code class="class">InterfaceBasedMBeanInfoAssembler</code> which allows you to constrain the methods and properties that are exposed based on the set of methods defined in a collection of interfaces.</p>
</div>
<div class="paragraph">
<p>Although the standard mechanism for exposing MBeans is to use interfaces and a simple naming scheme, the <code class="class">InterfaceBasedMBeanInfoAssembler</code> extends this functionality by removing the need for naming conventions, allowing you to use more than one interface and removing the need for your beans to implement the MBean interfaces.</p>
</div>
<div class="paragraph">
<p>Consider this interface that is used to define a management interface for the <code class="class">JmxTestBean</code> class that you saw earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface IJmxTestBean {

  public int add(int x, int y);

  public long myOperation();

  public int getAge();

  public void setAge(int age);

  public void setName(String name);

  public String getName();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This interface defines the methods and properties that will be exposed as operations and attributes on the JMX MBean.
The code below shows how to configure Spring JMX to use this interface as the definition for the management interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean5" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="assembler"&gt;
      &lt;bean class="org.springframework.jmx.export.assembler.InterfaceBasedMBeanInfoAssembler"&gt;
        &lt;property name="managedInterfaces"&gt;
          &lt;value&gt;org.springframework.jmx.IJmxTestBean&lt;/value&gt;
        &lt;/property&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the <code class="class">InterfaceBasedMBeanInfoAssembler</code> is configured to use the <code class="interface">IJmxTestBean</code> interface when constructing the management interface for any bean.
It is important to understand that beans processed by the <code class="class">InterfaceBasedMBeanInfoAssembler</code> are <em>not</em> required to implement the interface used to generate the JMX management interface.</p>
</div>
<div class="paragraph">
<p>In the case above, the <code class="interface">IJmxTestBean</code> interface is used to construct all management interfaces for all beans.
In many cases this is not the desired behavior and you may want to use different interfaces for different beans.
In this case, you can pass <code class="class">InterfaceBasedMBeanInfoAssembler</code> a <code class="class">Properties</code> instance via the <code>interfaceMappings</code> property, where the key of each entry is the bean name and the value of each entry is a comma-separated list of interface names to use for that bean.</p>
</div>
<div class="paragraph">
<p>If no management interface is specified through either the <code>managedInterfaces</code> or <code>interfaceMappings</code> properties, then the <code class="class">InterfaceBasedMBeanInfoAssembler</code> will reflect on the bean and use all of the interfaces implemented by that bean to create the management interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-code-class-class-methodnamebasedmbeaninfoassembler-code"><a class="anchor" href="#using-code-class-class-methodnamebasedmbeaninfoassembler-code"></a>Using <code class="class">MethodNameBasedMBeanInfoAssembler</code></h3>
<div class="paragraph">
<p>The <code class="class">MethodNameBasedMBeanInfoAssembler</code> allows you to specify a list of method names that will be exposed to JMX as attributes and operations.
The code below shows a sample configuration for this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean5" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="assembler"&gt;
      &lt;bean class="org.springframework.jmx.export.assembler.MethodNameBasedMBeanInfoAssembler"&gt;
        &lt;property name="managedMethods"&gt;
          &lt;value&gt;add,myOperation,getName,setName,getAge&lt;/value&gt;
        &lt;/property&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the methods <code>add</code> and <code>myOperation</code> will be exposed as JMX operations and <code>getName()</code>, <code>setName(String)</code> and <code>getAge()</code> will be exposed as the appropriate half of a JMX attribute.
In the code above, the method mappings apply to beans that are exposed to JMX. To control method exposure on a bean-by-bean basis, use the <code>methodMappings</code> property of <code class="class">MethodNameMBeanInfoAssembler</code> to map bean names to lists of method names.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controlling-the-class-objectname-s-for-your-beans"><a class="anchor" href="#controlling-the-class-objectname-s-for-your-beans"></a>Controlling the [class]`ObjectName`s for your beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Behind the scenes, the <code class="class">MBeanExporter</code> delegates to an implementation of the <code class="class">ObjectNamingStrategy</code> to obtain <code class="class">ObjectName`s for each of the beans it is registering.
The default implementation, [class]`KeyNamingStrategy</code>, will, by default, use the key of the <code>beans</code> <code class="interface">Map</code> as the <code class="class">ObjectName</code>.
In addition, the <code class="class">KeyNamingStrategy</code> can map the key of the <code>beans</code> <code class="interface">Map</code> to an entry in a <code class="class">Properties</code> file (or files) to resolve the <code class="class">ObjectName</code>.
In addition to the <code class="class">KeyNamingStrategy</code>, Spring provides two additional <code class="class">ObjectNamingStrategy</code> implementations: the <code class="class">IdentityNamingStrategy</code> that builds an <code class="class">ObjectName</code> based on the JVM identity of the bean and the <code class="class">MetadataNamingStrategy</code> that uses source level metadata to obtain the <code class="class">ObjectName</code>.</p>
</div>
<div class="sect2">
<h3 id="reading-code-class-class-objectname-s-from-class-properties-code"><a class="anchor" href="#reading-code-class-class-objectname-s-from-class-properties-code"></a>Reading <code class="class">ObjectName`s from [class]`Properties</code></h3>
<div class="paragraph">
<p>You can configure your own <code class="class">KeyNamingStrategy</code> instance and configure it to read <code class="class">ObjectName`s from a [class]`Properties</code> instance rather than use bean key.
The <code class="class">KeyNamingStrategy</code> will attempt to locate an entry in the <code class="class">Properties</code> with a key corresponding to the bean key.
If no entry is found or if the <code class="class">Properties</code> instance is <code>null</code> then the bean key itself is used.</p>
</div>
<div class="paragraph">
<p>The code below shows a sample configuration for the <code class="class">KeyNamingStrategy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="testBean" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="namingStrategy" ref="namingStrategy"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  &lt;bean id="namingStrategy" class="org.springframework.jmx.export.naming.KeyNamingStrategy"&gt;
    &lt;property name="mappings"&gt;
      &lt;props&gt;
        &lt;prop key="testBean"&gt;bean:name=testBean1&lt;/prop&gt;
      &lt;/props&gt;
    &lt;/property&gt;
    &lt;property name="mappingLocations"&gt;
      &lt;value&gt;names1.properties,names2.properties&lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here an instance of <code class="class">KeyNamingStrategy</code> is configured with a <code class="class">Properties</code> instance that is merged from the <code class="class">Properties</code> instance defined by the mapping property and the properties files located in the paths defined by the mappings property.
In this configuration, the <code>testBean</code> bean will be given the <code class="class">ObjectName</code> <code>bean:name=testBean1</code> since this is the entry in the <code class="class">Properties</code> instance that has a key corresponding to the bean key.</p>
</div>
<div class="paragraph">
<p>If no entry in the <code class="class">Properties</code> instance can be found then the bean key name is used as the <code class="class">ObjectName</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-code-class-class-metadatanamingstrategy-code"><a class="anchor" href="#using-the-code-class-class-metadatanamingstrategy-code"></a>Using the <code class="class">MetadataNamingStrategy</code></h3>
<div class="paragraph">
<p>The <code class="class">MetadataNamingStrategy</code> uses the <code>objectName</code> property of the <code class="class">ManagedResource</code> attribute on each bean to create the <code class="class">ObjectName</code>.
The code below shows the configuration for the <code class="class">MetadataNamingStrategy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="testBean" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="namingStrategy" ref="namingStrategy"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  &lt;bean id="namingStrategy" class="org.springframework.jmx.export.naming.MetadataNamingStrategy"&gt;
    &lt;property name="attributeSource" ref="attributeSource"/&gt;
  &lt;/bean&gt;

  &lt;bean id="attributeSource"
      class="org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no <code>objectName</code> has been provided for the <code class="class">ManagedResource</code> attribute, then an <code class="class">ObjectName</code> will be created with the following format: <em>[fully-qualified-package-name]:type=[short-classname],name=[bean-name]</em>.
For example, the generated <code class="class">ObjectName</code> for the following bean would be: <em>com.foo:type=MyClass,name=myBean</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="myBean" class="com.foo.MyClass"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-annotation-based-mbean-export"><a class="anchor" href="#configuring-annotation-based-mbean-export"></a>Configuring annotation based MBean export</h3>
<div class="paragraph">
<p>If you prefer using <a href="#jmx-interface-metadata">the annotation based
      approach</a> to define your management interfaces, then a convenience subclass of <code class="class">MBeanExporter</code> is available: <code class="class">AnnotationMBeanExporter</code>.
When defining an instance of this subclass, the <code>namingStrategy</code>, <code>assembler</code>, and <code>attributeSource</code> configuration is no longer needed, since it will always use standard Java annotation-based metadata (autodetection is always enabled as well).
In fact, rather than defining an <code class="class">MBeanExporter</code> bean, an even simpler syntax is supported by the <code class="interface">@EnableMBeanExport</code> <code class="interface">@Configuration</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableMBeanExport
public class AppConfig {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer XML based configuration the '<code>context:mbean-export'</code> element serves the same purpose.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;context:mbean-export/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide a reference to a particular MBean <code>server</code> if necessary, and the <code>defaultDomain</code> attribute (a property of <code class="class">AnnotationMBeanExporter</code>) accepts an alternate value for the generated MBean <code class="class">ObjectNames</code>' domains.
This would be used in place of the fully qualified package name as described in the previous section on <a href="#jmx-naming-metadata"><code class="class">MetadataNamingStrategy</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@EnableMBeanExport(server="myMBeanServer", defaultDomain="myDomain")
@Configuration
ContextConfiguration {

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;context:mbean-export server="myMBeanServer" default-domain="myDomain"/&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Do not use interface-based AOP proxies in combination with autodetection of JMX annotations in your bean classes.
Interface-based proxies <em>hide</em> the target class, which also hides the JMX managed resource annotations.
Hence, use target-class proxies in that case: through setting the <em>proxy-target-class</em> flag on <code>&lt;aop:config/&gt;</code>, <code>&lt;tx:annotation-driven/&gt;</code>, etc.
Otherwise, your JMX beans might be silently ignored at startup&#8230;
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jsr-160-connectors"><a class="anchor" href="#jsr-160-connectors"></a>JSR-160 Connectors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For remote access, Spring JMX module offers two <code class="class">FactoryBean</code> implementations inside the <code>org.springframework.jmx.support</code> package for creating both server- and client-side connectors.</p>
</div>
<div class="sect2">
<h3 id="server-side-connectors"><a class="anchor" href="#server-side-connectors"></a>Server-side Connectors</h3>
<div class="paragraph">
<p>To have Spring JMX create, start and expose a JSR-160 <code class="class">JMXConnectorServer</code> use the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="serverConnector" class="org.springframework.jmx.support.ConnectorServerFactoryBean"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default <code>ConnectorServerFactoryBean</code> creates a <code class="class">JMXConnectorServer</code> bound to <code>"service:jmx:jmxmp://localhost:9875"</code>.
The <code>serverConnector</code> bean thus exposes the local <code class="interface">MBeanServer</code> to clients through the JMXMP protocol on localhost, port 9875.
Note that the JMXMP protocol is marked as optional by the JSR 160 specification: currently, the main open-source JMX implementation, MX4J, and the one provided with J2SE 5.0 do <em>not</em> support JMXMP.</p>
</div>
<div class="paragraph">
<p>To specify another URL and register the <code class="class">JMXConnectorServer</code> itself with the <code class="interface">MBeanServer</code> use the <code>serviceUrl</code> and <code class="class">ObjectName</code> properties respectively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="serverConnector"
      class="org.springframework.jmx.support.ConnectorServerFactoryBean"&gt;
  &lt;property name="objectName" value="connector:name=rmi"/&gt;
  &lt;property name="serviceUrl"
            value="service:jmx:rmi://localhost/jndi/rmi://localhost:1099/myconnector"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code class="class">ObjectName</code> property is set Spring will automatically register your connector with the <code class="interface">MBeanServer</code> under that <code class="class">ObjectName</code>.
The example below shows the full set of parameters which you can pass to the <code class="class">ConnectorServerFactoryBean</code> when creating a JMXConnector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="serverConnector"
      class="org.springframework.jmx.support.ConnectorServerFactoryBean"&gt;
  &lt;property name="objectName" value="connector:name=iiop"/&gt;
  &lt;property name="serviceUrl"
               value="service:jmx:iiop://localhost/jndi/iiop://localhost:900/myconnector"/&gt;
  &lt;property name="threaded" value="true"/&gt;
  &lt;property name="daemon" value="true"/&gt;
  &lt;property name="environment"&gt;
    &lt;map&gt;
      &lt;entry key="someKey" value="someValue"/&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that when using a RMI-based connector you need the lookup service (tnameserv or rmiregistry) to be started in order for the name registration to complete.
If you are using Spring to export remote services for you via RMI, then Spring will already have constructed an RMI registry.
If not, you can easily start a registry using the following snippet of configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="registry" class="org.springframework.remoting.rmi.RmiRegistryFactoryBean"&gt;
  &lt;property name="port" value="1099"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="client-side-connectors"><a class="anchor" href="#client-side-connectors"></a>Client-side Connectors</h3>
<div class="paragraph">
<p>To create an <code class="class">MBeanServerConnection</code> to a remote JSR-160 enabled <code class="interface">MBeanServer</code> use the <code class="class">MBeanServerConnectionFactoryBean</code> as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="clientConnector" class="org.springframework.jmx.support.MBeanServerConnectionFactoryBean"&gt;
  &lt;property name="serviceUrl" value="service:jmx:rmi://localhost/jndi/rmi://localhost:1099/jmxrmi"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jmx-over-burlap-hessian-soap"><a class="anchor" href="#jmx-over-burlap-hessian-soap"></a>JMX over Burlap/Hessian/SOAP</h3>
<div class="paragraph">
<p>JSR-160 permits extensions to the way in which communication is done between the client and the server.
The examples above are using the mandatory RMI-based implementation required by the JSR-160 specification (IIOP and JRMP) and the (optional) JMXMP. By using other providers or JMX implementations (such as &lt;&lt;,MX4J&gt;&gt;) you can take advantage of protocols like SOAP, Hessian, Burlap over simple HTTP or SSL and others:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="serverConnector" class="org.springframework.jmx.support.ConnectorServerFactoryBean"&gt;
  &lt;property name="objectName" value="connector:name=burlap"/&gt;
  &lt;property name="serviceUrl" value="service:jmx:burlap://localhost:9874"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of the above example, MX4J 3.0.0 was used; see the official MX4J documentation for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accessing-mbeans-via-proxies"><a class="anchor" href="#accessing-mbeans-via-proxies"></a>Accessing MBeans via Proxies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring JMX allows you to create proxies that re-route calls to MBeans registered in a local or remote <code class="interface">MBeanServer</code>.
These proxies provide you with a standard Java interface through which you can interact with your MBeans.
The code below shows how to configure a proxy for an MBean running in a local <code class="interface">MBeanServer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="proxy" class="org.springframework.jmx.access.MBeanProxyFactoryBean"&gt;
    &lt;property name="objectName" value="bean:name=testBean"/&gt;
    &lt;property name="proxyInterface" value="org.springframework.jmx.IJmxTestBean"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that a proxy is created for the MBean registered under the <code class="class">ObjectName</code>: <code>bean:name=testBean</code>.
The set of interfaces that the proxy will implement is controlled by the <code>proxyInterfaces</code> property and the rules for mapping methods and properties on these interfaces to operations and attributes on the MBean are the same rules used by the <code class="class">InterfaceBasedMBeanInfoAssembler</code>.</p>
</div>
<div class="paragraph">
<p>The <code class="class">MBeanProxyFactoryBean</code> can create a proxy to any MBean that is accessible via an <code class="class">MBeanServerConnection</code>.
By default, the local <code class="interface">MBeanServer</code> is located and used, but you can override this and provide an <code class="class">MBeanServerConnection</code> pointing to a remote <code class="interface">MBeanServer</code> to cater for proxies pointing to remote MBeans:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="clientConnector"
      class="org.springframework.jmx.support.MBeanServerConnectionFactoryBean"&gt;
  &lt;property name="serviceUrl" value="service:jmx:rmi://remotehost:9875"/&gt;
&lt;/bean&gt;

&lt;bean id="proxy" class="org.springframework.jmx.access.MBeanProxyFactoryBean"&gt;
  &lt;property name="objectName" value="bean:name=testBean"/&gt;
  &lt;property name="proxyInterface" value="org.springframework.jmx.IJmxTestBean"/&gt;
  &lt;property name="server" ref="clientConnector"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that we create an <code class="class">MBeanServerConnection</code> pointing to a remote machine using the <code class="class">MBeanServerConnectionFactoryBean</code>.
This <code class="class">MBeanServerConnection</code> is then passed to the <code class="class">MBeanProxyFactoryBean</code> via the <code>server</code> property.
The proxy that is created will forward all invocations to the <code class="interface">MBeanServer</code> via this <code class="class">MBeanServerConnection</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="notifications"><a class="anchor" href="#notifications"></a>Notifications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring&#8217;s JMX offering includes comprehensive support for JMX notifications.</p>
</div>
<div class="sect2">
<h3 id="registering-listeners-for-notifications"><a class="anchor" href="#registering-listeners-for-notifications"></a>Registering Listeners for Notifications</h3>
<div class="paragraph">
<p>Spring&#8217;s JMX support makes it very easy to register any number of <code class="class">NotificationListeners</code> with any number of MBeans (this includes MBeans exported by Spring&#8217;s <code class="class">MBeanExporter</code> and MBeans registered via some other mechanism).
By way of an example, consider the scenario where one would like to be informed (via a <code class="class">Notification</code>) each and every time an attribute of a target MBean changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.example;

import javax.management.AttributeChangeNotification;
import javax.management.Notification;
import javax.management.NotificationFilter;
import javax.management.NotificationListener;

public class ConsoleLoggingNotificationListener
               implements NotificationListener, NotificationFilter {

    public void handleNotification(Notification notification, Object handback) {
        System.out.println(notification);
        System.out.println(handback);
    }

    public boolean isNotificationEnabled(Notification notification) {
        return AttributeChangeNotification.class.isAssignableFrom(notification.getClass());
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListenerMappings"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1"&gt;
          &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
        &lt;/entry&gt;
      &lt;/map&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above configuration in place, every time a JMX <code class="class">Notification</code> is broadcast from the target MBean (<code>bean:name=testBean1</code>), the <code class="class">ConsoleLoggingNotificationListener</code> bean that was registered as a listener via the <code>notificationListenerMappings</code> property will be notified.
The <code class="class">ConsoleLoggingNotificationListener</code> bean can then take whatever action it deems appropriate in response to the <code class="class">Notification</code>.</p>
</div>
<div class="paragraph">
<p>You can also use straight bean names as the link between exported beans and listeners:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListenerMappings"&gt;
      &lt;map&gt;
        &lt;entry key="testBean"&gt;
          &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
        &lt;/entry&gt;
      &lt;/map&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If one wants to register a single <code class="class">NotificationListener</code> instance for all of the beans that the enclosing <code class="class">MBeanExporter</code> is exporting, one can use the special wildcard <code>'*'</code> (sans quotes) as the key for an entry in the <code>notificationListenerMappings</code> property map; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;property name="notificationListenerMappings"&gt;
  &lt;map&gt;
    &lt;entry key="*"&gt;
      &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
    &lt;/entry&gt;
  &lt;/map&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If one needs to do the inverse (that is, register a number of distinct listeners against an MBean), then one has to use the <code>notificationListeners</code> list property instead (and in preference to the <code>notificationListenerMappings</code> property).
This time, instead of configuring simply a <code class="class">NotificationListener</code> for a single MBean, one configures <code class="class">NotificationListenerBean</code> instances&#8230;
a <code class="class">NotificationListenerBean</code> encapsulates a <code class="class">NotificationListener</code> and the <code class="class">ObjectName</code> (or <code class="class">ObjectNames</code>) that it is to be registered against in an <code class="interface">MBeanServer</code>.
The <code class="class">NotificationListenerBean</code> also encapsulates a number of other properties such as a <code class="class">NotificationFilter</code> and an arbitrary handback object that can be used in advanced JMX notification scenarios.</p>
</div>
<div class="paragraph">
<p>The configuration when using <code class="class">NotificationListenerBean</code> instances is not wildly different to what was presented previously:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListeners"&gt;
        &lt;list&gt;
            &lt;bean class="org.springframework.jmx.export.NotificationListenerBean"&gt;
                &lt;constructor-arg&gt;
                    &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
                &lt;/constructor-arg&gt;
                &lt;property name="mappedObjectNames"&gt;
                    &lt;list&gt;
                        &lt;value&gt;bean:name=testBean1&lt;/value&gt;
                    &lt;/list&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example is equivalent to the first notification example.
Lets assume then that we want to be given a handback object every time a <code class="class">Notification</code> is raised, and that additionally we want to filter out extraneous <code class="class">Notifications</code> by supplying a <code class="class">NotificationFilter</code>.
(For a full discussion of just what a handback object is, and indeed what a <code class="class">NotificationFilter</code> is, please do consult that section of the JMX specification (1.2) entitled <code>'The JMX
      Notification Model'</code>.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean1"/&gt;
        &lt;entry key="bean:name=testBean2" value-ref="testBean2"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListeners"&gt;
        &lt;list&gt;
            &lt;bean class="org.springframework.jmx.export.NotificationListenerBean"&gt;
                &lt;constructor-arg ref="customerNotificationListener"/&gt;
                &lt;property name="mappedObjectNames"&gt;
                    &lt;list&gt;
                        &lt;!-- handles notifications from two distinct MBeans --&gt;
                        &lt;value&gt;bean:name=testBean1&lt;/value&gt;
                        &lt;value&gt;bean:name=testBean2&lt;/value&gt;
                    &lt;/list&gt;
                &lt;/property&gt;
                &lt;property name="handback"&gt;
                    &lt;bean class="java.lang.String"&gt;
                        &lt;constructor-arg value="This could be anything..."/&gt;
                    &lt;/bean&gt;
                &lt;/property&gt;
                &lt;property name="notificationFilter" ref="customerNotificationListener"/&gt;
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;!-- implements both the NotificationListener and NotificationFilter interfaces --&gt;
  &lt;bean id="customerNotificationListener" class="com.example.ConsoleLoggingNotificationListener"/&gt;

  &lt;bean id="testBean1" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean2" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="ANOTHER TEST"/&gt;
    &lt;property name="age" value="200"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="publishing-notifications"><a class="anchor" href="#publishing-notifications"></a>Publishing Notifications</h3>
<div class="paragraph">
<p>Spring provides support not just for registering to receive <code class="class">Notifications</code>, but also for publishing <code class="class">Notifications</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Please note that this section is really only relevant to Spring managed beans that have been exposed as MBeans via an <code class="class">MBeanExporter</code>; any existing, user-defined MBeans should use the standard JMX APIs for notification publication.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The key interface in Spring&#8217;s JMX notification publication support is the <code class="class">NotificationPublisher</code> interface (defined in the <code>org.springframework.jmx.export.notification</code> package).
Any bean that is going to be exported as an MBean via an <code class="class">MBeanExporter</code> instance can implement the related <code class="class">NotificationPublisherAware</code> interface to gain access to a <code class="class">NotificationPublisher</code> instance.
The <code class="class">NotificationPublisherAware</code> interface simply supplies an instance of a <code class="class">NotificationPublisher</code> to the implementing bean via a simple setter method, which the bean can then use to publish <code class="class">Notifications</code>.</p>
</div>
<div class="paragraph">
<p>As stated in the Javadoc for the <code class="class">NotificationPublisher</code> class, managed beans that are publishing events via the <code class="class">NotificationPublisher</code> mechanism are <em>not</em> responsible for the state management of any notification listeners and the like &#8230;
Spring&#8217;s JMX support will take care of handling all the JMX infrastructure issues.
All one need do as an application developer is implement the <code class="class">NotificationPublisherAware</code> interface and start publishing events using the supplied <code class="class">NotificationPublisher</code> instance.
Note that the <code class="class">NotificationPublisher</code> will be set <em>after</em> the managed bean has been registered with an <code class="interface">MBeanServer</code>.</p>
</div>
<div class="paragraph">
<p>Using a <code class="class">NotificationPublisher</code> instance is quite straightforward&#8230;
one simply creates a JMX <code class="class">Notification</code> instance (or an instance of an appropriate <code class="class">Notification</code> subclass), populates the notification with the data pertinent to the event that is to be published, and one then invokes the <code class="method">sendNotification(Notification)</code> on the <code class="class">NotificationPublisher</code> instance, passing in the <code class="class">Notification</code>.</p>
</div>
<div class="paragraph">
<p>Find below a simple example&#8230;
in this scenario, exported instances of the <code class="class">JmxTestBean</code> are going to publish a <code class="class">NotificationEvent</code> every time the <code>add(int, int)</code> operation is invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.jmx;

import org.springframework.jmx.export.notification.NotificationPublisherAware;
import org.springframework.jmx.export.notification.NotificationPublisher;
import javax.management.Notification;

public class JmxTestBean implements IJmxTestBean, NotificationPublisherAware {

    private String name;
    private int age;
    private boolean isSuperman;
    private NotificationPublisher publisher;

    // other getters and setters omitted for clarity

    public int add(int x, int y) {
        int answer = x + y;
        this.publisher.sendNotification(new Notification("add", this, 0));
        return answer;
    }

    public void dontExposeMe() {
        throw new RuntimeException();
    }

    public void setNotificationPublisher(NotificationPublisher notificationPublisher) {
        this.publisher = notificationPublisher;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">NotificationPublisher</code> interface and the machinery to get it all working is one of the nicer features of Spring&#8217;s JMX support.
It does however come with the price tag of coupling your classes to both Spring and JMX; as always, the advice here is to be pragmatic&#8230;
if you need the functionality offered by the <code class="class">NotificationPublisher</code> and you can accept the coupling to both Spring and JMX, then do so.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="further-resources-3"><a class="anchor" href="#further-resources-3"></a>Further Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains links to further resources about JMX.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The &lt;&lt;,JMX homepage&gt;&gt; at Sun</p>
</li>
<li>
<p>The &lt;&lt;,JMX specification&gt;&gt; (JSR-000003)</p>
</li>
<li>
<p>The &lt;&lt;,JMX Remote API specification&gt;&gt; (JSR-000160)</p>
</li>
<li>
<p>The &lt;&lt;,MX4J
homepage&gt;&gt; (an Open Source implementation of various JMX specs)</p>
</li>
<li>
<p>&lt;&lt;,Getting Started with JMX&gt;&gt; - an introductory article from Sun.</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="jca-cci" class="sect0"><a class="anchor" href="#jca-cci"></a>JCA CCI</h1>
<div class="sect1">
<h2 id="introduction-11"><a class="anchor" href="#introduction-11"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Java EE provides a specification to standardize access to enterprise information systems (EIS): the JCA (J2EE Connector Architecture).
This specification is divided into several different parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SPI (Service provider interfaces) that the connector provider must implement.
These interfaces constitute a resource adapter which can be deployed on a Java EE application server.
In such a scenario, the server manages connection pooling, transaction and security (managed mode).
The application server is also responsible for managing the configuration, which is held outside the client application.
A connector can be used without an application server as well; in this case, the application must configure it directly (non-managed mode).</p>
</li>
<li>
<p>CCI (Common Client Interface) that an application can use to interact with the connector and thus communicate with an EIS. An API for local transaction demarcation is provided as well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The aim of the Spring CCI support is to provide classes to access a CCI connector in typical Spring style, leveraging the Spring Framework&#8217;s general resource and transaction management facilities.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The client side of connectors doesn&#8217;t alway use CCI. Some connectors expose their own APIs, only providing JCA resource adapter to use the system contracts of a Java EE container (connection pooling, global transactions, security).
Spring does not offer special support for such connector-specific APIs.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-cci"><a class="anchor" href="#configuring-cci"></a>Configuring CCI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="connector-configuration"><a class="anchor" href="#connector-configuration"></a>Connector configuration</h3>
<div class="paragraph">
<p>The base resource to use JCA CCI is the <code class="interface">ConnectionFactory</code> interface.
The connector used must provide an implementation of this interface.</p>
</div>
<div class="paragraph">
<p>To use your connector, you can deploy it on your application server and fetch the <code class="interface">ConnectionFactory</code> from the server&#8217;s JNDI environment (managed mode).
The connector must be packaged as a RAR file (resource adapter archive) and contain a <code class="file">ra.xml</code> file to describe its deployment characteristics.
The actual name of the resource is specified when you deploy it.
To access it within Spring, simply use Spring&#8217;s <code class="class">JndiObjectFactoryBean</code> / <code>&lt;jee:jndi-lookup&gt;</code> fetch the factory by its JNDI name.</p>
</div>
<div class="paragraph">
<p>Another way to use a connector is to embed it in your application (non-managed mode), not using an application server to deploy and configure it.
Spring offers the possibility to configure a connector as a bean, through a provided <code>FactoryBean</code> (<code class="class">LocalConnectionFactoryBean</code>).
In this manner, you only need the connector library in the classpath (no RAR file and no <code class="file">ra.xml</code> descriptor needed).
The library must be extracted from the connector&#8217;s RAR file, if necessary.</p>
</div>
<div class="paragraph">
<p>Once you have got access to your <code class="interface">ConnectionFactory</code> instance, you can inject it into your components.
These components can either be coded against the plain CCI API or leverage Spring&#8217;s support classes for CCI access (e.g.
<code class="class">CciTemplate</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
When you use a connector in non-managed mode, you can&#8217;t use global transactions because the resource is never enlisted / delisted in the current global transaction of the current thread.
The resource is simply not aware of any global Java EE transactions that might be running.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="code-class-interface-connectionfactory-code-configuration-in-spring"><a class="anchor" href="#code-class-interface-connectionfactory-code-configuration-in-spring"></a><code class="interface">ConnectionFactory</code> configuration in Spring</h3>
<div class="paragraph">
<p>In order to make connections to the EIS, you need to obtain a <code class="interface">ConnectionFactory</code> from the application server if you are in a managed mode, or directly from Spring if you are in a non-managed mode.</p>
</div>
<div class="paragraph">
<p>In a managed mode, you access a <code class="interface">ConnectionFactory</code> from JNDI; its properties will be configured in the application server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;jee:jndi-lookup id="eciConnectionFactory" jndi-name="eis/cicseci"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In non-managed mode, you must configure the <code class="interface">ConnectionFactory</code> you want to use in the configuration of Spring as a JavaBean.
The <code class="class">LocalConnectionFactoryBean</code> class offers this setup style, passing in the <code class="class">ManagedConnectionFactory</code> implementation of your connector, exposing the application-level CCI <code class="interface">ConnectionFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="eciManagedConnectionFactory" class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TXSERIES"/&gt;
  &lt;property name="connectionURL" value="tcp://localhost/"/&gt;
  &lt;property name="portNumber" value="2006"/&gt;
&lt;/bean&gt;

&lt;bean id="eciConnectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="eciManagedConnectionFactory"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
You can&#8217;t directly instantiate a specific <code class="interface">ConnectionFactory</code>.
You need to go through the corresponding implementation of the <code class="class">ManagedConnectionFactory</code> interface for your connector.
This interface is part of the JCA SPI specification.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-cci-connections"><a class="anchor" href="#configuring-cci-connections"></a>Configuring CCI connections</h3>
<div class="paragraph">
<p>JCA CCI allow the developer to configure the connections to the EIS using the <code class="interface">ConnectionSpec</code> implementation of your connector.
In order to configure its properties, you need to wrap the target connection factory with a dedicated adapter, <code class="class">ConnectionSpecConnectionFactoryAdapter</code>.
So, the dedicated <code class="interface">ConnectionSpec</code> can be configured with the property <code>connectionSpec</code> (as an inner bean).</p>
</div>
<div class="paragraph">
<p>This property is not mandatory because the CCI <code class="interface">ConnectionFactory</code> interface defines two different methods to obtain a CCI connection.
Some of the <code class="interface">ConnectionSpec</code> properties can often be configured in the application server (in managed mode) or on the corresponding local <code class="class">ManagedConnectionFactory</code> implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface ConnectionFactory implements Serializable, Referenceable {
  ...
  Connection getConnection() throws ResourceException;
  Connection getConnection(ConnectionSpec connectionSpec) throws ResourceException;
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring provides a <code class="class">ConnectionSpecConnectionFactoryAdapter</code> that allows for specifying a <code class="interface">ConnectionSpec</code> instance to use for all operations on a given factory.
If the adapter&#8217;s <code>connectionSpec</code> property is specified, the adapter uses the <code>getConnection</code> variant with the <code class="interface">ConnectionSpec</code> argument, otherwise the variant without argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="managedConnectionFactory"
    class="com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory"&gt;
  &lt;property name="connectionURL" value="jdbc:hsqldb:hsql://localhost:9001"/&gt;
  &lt;property name="driverName" value="org.hsqldb.jdbcDriver"/&gt;
&lt;/bean&gt;

&lt;bean id="targetConnectionFactory"
    class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory"
    class="org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"&gt;
  &lt;property name="targetConnectionFactory" ref="targetConnectionFactory"/&gt;
  &lt;property name="connectionSpec"&gt;
    &lt;bean class="com.sun.connector.cciblackbox.CciConnectionSpec"&gt;
      &lt;property name="user" value="sa"/&gt;
      &lt;property name="password" value=""/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-a-single-cci-connection"><a class="anchor" href="#using-a-single-cci-connection"></a>Using a single CCI connection</h3>
<div class="paragraph">
<p>If you want to use a single CCI connection, Spring provides a further <code class="interface">ConnectionFactory</code> adapter to manage this.
The <code class="class">SingleConnectionFactory</code> adapter class will open a single connection lazily and close it when this bean is destroyed at application shutdown.
This class will expose special <code class="interface">Connection</code> proxies that behave accordingly, all sharing the same underlying physical connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="eciManagedConnectionFactory"
    class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TEST"/&gt;
  &lt;property name="connectionURL" value="tcp://localhost/"/&gt;
  &lt;property name="portNumber" value="2006"/&gt;
&lt;/bean&gt;

&lt;bean id="targetEciConnectionFactory"
    class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="eciManagedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="eciConnectionFactory"
    class="org.springframework.jca.cci.connection.SingleConnectionFactory"&gt;
  &lt;property name="targetConnectionFactory" ref="targetEciConnectionFactory"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
This <code class="interface">ConnectionFactory</code> adapter cannot directly be configured with a <code class="interface">ConnectionSpec</code>.
Use an intermediary <code class="class">ConnectionSpecConnectionFactoryAdapter</code> that the <code class="class">SingleConnectionFactory</code> talks to if you require a single connection for a specific <code class="interface">ConnectionSpec</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-spring-s-cci-access-support"><a class="anchor" href="#using-spring-s-cci-access-support"></a>Using Spring&#8217;s CCI access support</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="record-conversion"><a class="anchor" href="#record-conversion"></a>Record conversion</h3>
<div class="paragraph">
<p>One of the aims of the JCA CCI support is to provide convenient facilities for manipulating CCI records.
The developer can specify the strategy to create records and extract datas from records, for use with Spring&#8217;s <code class="class">CciTemplate</code>.
The following interfaces will configure the strategy to use input and output records if you don&#8217;t want to work with records directly in your application.</p>
</div>
<div class="paragraph">
<p>In order to create an input <code class="interface">Record</code>, the developer can use a dedicated implementation of the <code class="interface">RecordCreator</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface RecordCreator {

  Record createRecord(RecordFactory recordFactory) throws ResourceException, DataAccessException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>createRecord(..)</code> method receives a <code class="interface">RecordFactory</code> instance as parameter, which corresponds to the <code class="interface">RecordFactory</code> of the <code class="interface">ConnectionFactory</code> used.
This reference can be used to create <code class="interface">IndexedRecord</code> or <code class="interface">MappedRecord</code> instances.
The following sample shows how to use the <code class="interface">RecordCreator</code> interface and indexed/mapped records.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyRecordCreator implements RecordCreator {

  public Record createRecord(RecordFactory recordFactory) throws ResourceException {
    IndexedRecord input = recordFactory.createIndexedRecord("input");
    input.add(new Integer(id));
    return input;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An output <code class="interface">Record</code> can be used to receive data back from the EIS. Hence, a specific implementation of the <code class="interface">RecordExtractor</code> interface can be passed to Spring&#8217;s <code class="class">CciTemplate</code> for extracting data from the output <code class="interface">Record</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface RecordExtractor {

  Object extractData(Record record) throws ResourceException, SQLException, DataAccessException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sample shows how to use the <code class="interface">RecordExtractor</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyRecordExtractor implements RecordExtractor {

  public Object extractData(Record record) throws ResourceException {
    CommAreaRecord commAreaRecord = (CommAreaRecord) record;
    String str = new String(commAreaRecord.toByteArray());
    String field1 = string.substring(0,6);
    String field2 = string.substring(6,1);
    return new OutputObject(Long.parseLong(field1), field2);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-code-class-class-ccitemplate-code"><a class="anchor" href="#the-code-class-class-ccitemplate-code"></a>The <code class="class">CciTemplate</code></h3>
<div class="paragraph">
<p>The <code class="class">CciTemplate</code> is the central class of the core CCI support package (<code>org.springframework.jca.cci.core</code>).
It simplifies the use of CCI since it handles the creation and release of resources.
This helps to avoid common errors like forgetting to always close the connection.
It cares for the lifecycle of connection and interaction objects, letting application code focus on generating input records from application data and extracting application data from output records.</p>
</div>
<div class="paragraph">
<p>The JCA CCI specification defines two distinct methods to call operations on an EIS. The CCI <code class="interface">Interaction</code> interface provides two execute method signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface javax.resource.cci.Interaction {
  ...
  boolean execute(InteractionSpec spec, Record input, Record output) throws ResourceException;

  Record execute(InteractionSpec spec, Record input) throws ResourceException;
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on the template method called, <code class="class">CciTemplate</code> will know which <code>execute</code> method to call on the interaction.
In any case, a correctly initialized <code class="interface">InteractionSpec</code> instance is mandatory.</p>
</div>
<div class="paragraph">
<p><code>CciTemplate.execute(..)</code> can be used in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With direct <code class="interface">Record</code> arguments.
In this case, you simply need to pass the CCI input record in, and the returned object be the corresponding CCI output record.</p>
</li>
<li>
<p>With application objects, using record mapping.
In this case, you need to provide corresponding <code class="interface">RecordCreator</code> and <code class="interface">RecordExtractor</code> instances.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the first approach, the following methods of the template will be used.
These methods directly correspond to those on the <code class="interface">Interaction</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class CciTemplate implements CciOperations {

  public Record execute(InteractionSpec spec, Record inputRecord)
      throws DataAccessException { ... }

  public void execute(InteractionSpec spec, Record inputRecord, Record outputRecord)
      throws DataAccessException { ... }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the second approach, we need to specify the record creation and record extraction strategies as arguments.
The interfaces used are those describe in the previous section on record conversion.
The corresponding <code class="class">CciTemplate</code> methods are the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class CciTemplate implements CciOperations {

  public Record execute(InteractionSpec spec, RecordCreator inputCreator)
      throws DataAccessException { ... }

  public Object execute(InteractionSpec spec, Record inputRecord, RecordExtractor outputExtractor)
      throws DataAccessException { ... }

  public Object execute(InteractionSpec spec, RecordCreator creator, RecordExtractor extractor)
      throws DataAccessException { ... }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unless the <code>outputRecordCreator</code> property is set on the template (see the following section), every method will call the corresponding <code>execute</code> method of the CCI <code class="interface">Interaction</code> with two parameters: <code class="interface">InteractionSpec</code> and input <code class="interface">Record</code>, receiving an output <code class="interface">Record</code> as return value.</p>
</div>
<div class="paragraph">
<p><code class="class">CciTemplate</code> also provides methods to create <code>IndexRecord</code> and <code>MappedRecord</code> outside a <code class="interface">RecordCreator</code> implementation, through its <code>createIndexRecord(..)</code> and <code>createMappedRecord(..)</code> methods.
This can be used within DAO implementations to create <code class="interface">Record</code> instances to pass into corresponding <code>CciTemplate.execute(..)</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class CciTemplate implements CciOperations {

  public IndexedRecord createIndexedRecord(String name) throws DataAccessException { ... }

  public MappedRecord createMappedRecord(String name) throws DataAccessException { ... }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dao-support"><a class="anchor" href="#dao-support"></a>DAO support</h3>
<div class="paragraph">
<p>Spring&#8217;s CCI support provides a abstract class for DAOs, supporting injection of a <code class="interface">ConnectionFactory</code> or a <code class="class">CciTemplate</code> instances.
The name of the class is <code class="class">CciDaoSupport</code>: It provides simple <code>setConnectionFactory</code> and <code>setCciTemplate</code> methods.
Internally, this class will create a <code class="class">CciTemplate</code> instance for a passed-in <code class="interface">ConnectionFactory</code>, exposing it to concrete data access implementations in subclasses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public abstract class CciDaoSupport {

  public void setConnectionFactory(ConnectionFactory connectionFactory) { ... }
  public ConnectionFactory getConnectionFactory() { ... }

  public void setCciTemplate(CciTemplate cciTemplate) { ... }
  public CciTemplate getCciTemplate() { ... }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="automatic-output-record-generation"><a class="anchor" href="#automatic-output-record-generation"></a>Automatic output record generation</h3>
<div class="paragraph">
<p>If the connector used only supports the <code class="method">Interaction.execute(..)</code> method with input and output records as parameters (that is, it requires the desired output record to be passed in instead of returning an appropriate output record), you can set the <code>outputRecordCreator</code> property of the <code class="class">CciTemplate</code> to automatically generate an output record to be filled by the JCA connector when the response is received.
This record will be then returned to the caller of the template.</p>
</div>
<div class="paragraph">
<p>This property simply holds an implementation of the <code class="interface">RecordCreator</code> interface, used for that purpose.
The <code class="interface">RecordCreator</code> interface has already been discussed in <a href="#cci-record-creator">[cci-record-creator]</a>.
The <code>outputRecordCreator</code> property must be directly specified on the <code class="class">CciTemplate</code>.
This could be done in the application code like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>cciTemplate.setOutputRecordCreator(new EciOutputRecordCreator());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or (recommended) in the Spring configuration, if the <code class="class">CciTemplate</code> is configured as a dedicated bean instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="eciOutputRecordCreator" class="eci.EciOutputRecordCreator"/&gt;

&lt;bean id="cciTemplate" class="org.springframework.jca.cci.core.CciTemplate"&gt;
  &lt;property name="connectionFactory" ref="eciConnectionFactory"/&gt;
  &lt;property name="outputRecordCreator" ref="eciOutputRecordCreator"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
As the <code class="class">CciTemplate</code> class is thread-safe, it will usually be configured as a shared instance.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="summary-2"><a class="anchor" href="#summary-2"></a>Summary</h3>
<div class="paragraph">
<p>The following table summarizes the mechanisms of the <code class="class">CciTemplate</code> class and the corresponding methods called on the CCI <code class="interface">Interaction</code> interface:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 20. Usage of <code class="interface">Interaction</code> execute methods</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CciTemplate method signature</th>
<th class="tableblock halign-left valign-top">CciTemplate outputRecordCreator
                property</th>
<th class="tableblock halign-left valign-top">execute method called on the CCI
                Interaction</th>
</tr>
</thead>
</table>

</div>
<div class="sect2">
<h3 id="using-a-cci-code-class-interface-connection-code-and-code-class-interface-interaction-code-directly"><a class="anchor" href="#using-a-cci-code-class-interface-connection-code-and-code-class-interface-interaction-code-directly"></a>Using a CCI <code class="interface">Connection</code> and <code class="interface">Interaction</code> directly</h3>
<div class="paragraph">
<p><code class="class">CciTemplate</code> also offers the possibility to work directly with CCI connections and interactions, in the same manner as <code class="class">JdbcTemplate</code> and <code class="class">JmsTemplate</code>.
This is useful when you want to perform multiple operations on a CCI connection or interaction, for example.</p>
</div>
<div class="paragraph">
<p>The interface <code class="interface">ConnectionCallback</code> provides a CCI <code class="interface">Connection</code> as argument, in order to perform custom operations on it, plus the CCI <code class="interface">ConnectionFactory</code> which the <code class="interface">Connection</code> was created with.
The latter can be useful for example to get an associated <code class="interface">RecordFactory</code> instance and create indexed/mapped records, for example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface ConnectionCallback {

  Object doInConnection(Connection connection, ConnectionFactory connectionFactory)
      throws ResourceException, SQLException, DataAccessException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interface <code class="interface">InteractionCallback</code> provides the CCI <code class="interface">Interaction</code>, in order to perform custom operations on it, plus the corresponding CCI <code class="interface">ConnectionFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface InteractionCallback {

  Object doInInteraction(Interaction interaction, ConnectionFactory connectionFactory)
      throws ResourceException, SQLException, DataAccessException;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code class="interface">InteractionSpec</code> objects can either be shared across multiple template calls or newly created inside every callback method.
This is completely up to the DAO implementation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="example-for-code-class-class-ccitemplate-code-usage"><a class="anchor" href="#example-for-code-class-class-ccitemplate-code-usage"></a>Example for <code class="class">CciTemplate</code> usage</h3>
<div class="paragraph">
<p>In this section, the usage of the <code class="class">CciTemplate</code> will be shown to acces to a CICS with ECI mode, with the IBM CICS ECI connector.</p>
</div>
<div class="paragraph">
<p>Firstly, some initializations on the CCI <code class="interface">InteractionSpec</code> must be done to specify which CICS program to access and how to interact with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>ECIInteractionSpec interactionSpec = new ECIInteractionSpec();
interactionSpec.setFunctionName("MYPROG");
interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the program can use CCI via Spring&#8217;s template and specify mappings between custom objects and CCI <code>Records</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public OutputObject getData(InputObject input) {
    ECIInteractionSpec interactionSpec = ...;

    OutputObject output = (ObjectOutput) getCciTemplate().execute(interactionSpec,
        new RecordCreator() {
          public Record createRecord(RecordFactory recordFactory) throws ResourceException {
            return new CommAreaRecord(input.toString().getBytes());
          }
        },
        new RecordExtractor() {
          public Object extractData(Record record) throws ResourceException {
            CommAreaRecord commAreaRecord = (CommAreaRecord)record;
            String str = new String(commAreaRecord.toByteArray());
            String field1 = string.substring(0,6);
            String field2 = string.substring(6,1);
            return new OutputObject(Long.parseLong(field1), field2);
          }
        });

    return output;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As discussed previously, callbacks can be used to work directly on CCI connections or interactions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public OutputObject getData(InputObject input) {
    ObjectOutput output = (ObjectOutput) getCciTemplate().execute(
        new ConnectionCallback() {
          public Object doInConnection(Connection connection, ConnectionFactory factory)
              throws ResourceException {

            // do something...
          }
        });
    }
    return output;
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
With a <code class="interface">ConnectionCallback</code>, the <code class="interface">Connection</code> used will be managed and closed by the <code class="class">CciTemplate</code>, but any interactions created on the connection must be managed by the callback implementation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For a more specific callback, you can implement an <code class="interface">InteractionCallback</code>.
The passed-in <code class="interface">Interaction</code> will be managed and closed by the <code class="class">CciTemplate</code> in this case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public String getData(String input) {
    ECIInteractionSpec interactionSpec = ...;

    String output = (String) getCciTemplate().execute(interactionSpec,
        new InteractionCallback() {
          public Object doInInteraction(Interaction interaction, ConnectionFactory factory)
              throws ResourceException {
            Record input = new CommAreaRecord(inputString.getBytes());
            Record output = new CommAreaRecord();
            interaction.execute(holder.getInteractionSpec(), input, output);
            return new String(output.toByteArray());
          }
        });

    return output;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the examples above, the corresponding configuration of the involved Spring beans could look like this in non-managed mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="managedConnectionFactory" class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TXSERIES"/&gt;
  &lt;property name="connectionURL" value="local:"/&gt;
  &lt;property name="userName" value="CICSUSER"/&gt;
  &lt;property name="password" value="CICS"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="mypackage.MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In managed mode (that is, in a Java EE environment), the configuration could look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;jee:jndi-lookup id="connectionFactory" jndi-name="eis/cicseci"/&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modeling-cci-access-as-operation-objects"><a class="anchor" href="#modeling-cci-access-as-operation-objects"></a>Modeling CCI access as operation objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>org.springframework.jca.cci.object</code> package contains support classes that allow you to access the EIS in a different style: through reusable operation objects, analogous to Spring&#8217;s JDBC operation objects (see JDBC chapter).
This will usually encapsulate the CCI API: an application-level input object will be passed to the operation object, so it can construct the input record and then convert the received record data to an application-level output object and return it.</p>
</div>
<div class="paragraph">
<p><em>Note</em>: This approach is internally based on the <code class="class">CciTemplate</code> class and the <code class="interface">RecordCreator</code> / <code class="interface">RecordExtractor</code> interfaces, reusing the machinery of Spring&#8217;s core CCI support.</p>
</div>
<div class="sect2">
<h3 id="code-class-class-mappingrecordoperation-code"><a class="anchor" href="#code-class-class-mappingrecordoperation-code"></a><code class="class">MappingRecordOperation</code></h3>
<div class="paragraph">
<p><code class="class">MappingRecordOperation</code> essentially performs the same work as <code class="class">CciTemplate</code>, but represents a specific, pre-configured operation as an object.
It provides two template methods to specify how to convert an input object to a input record, and how to convert an output record to an output object (record mapping):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>createInputRecord(..)</code> to specify how to convert an input object to an input <code class="interface">Record</code></p>
</li>
<li>
<p><code>extractOutputData(..)</code> to specify how to extract an output object from an output <code class="interface">Record</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here are the signatures of these methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public abstract class MappingRecordOperation extends EisOperation {
  ...
  protected abstract Record createInputRecord(RecordFactory recordFactory, Object inputObject)
      throws ResourceException, DataAccessException { ... }

  protected abstract Object extractOutputData(Record outputRecord)
      throws ResourceException, SQLException, DataAccessException { ... }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thereafter, in order to execute an EIS operation, you need to use a single execute method, passing in an application-level input object and receiving an application-level output object as result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public abstract class MappingRecordOperation extends EisOperation {
  ...
  public Object execute(Object inputObject) throws DataAccessException {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, contrary to the <code class="class">CciTemplate</code> class, this <code class="method">execute(..)</code> method does not have an <code class="interface">InteractionSpec</code> as argument.
Instead, the <code class="interface">InteractionSpec</code> is global to the operation.
The following constructor must be used to instantiate an operation object with a specific <code class="interface">InteractionSpec</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>InteractionSpec spec = ...;
MyMappingRecordOperation eisOperation = new MyMappingRecordOperation(getConnectionFactory(), spec);
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="code-class-class-mappingcommareaoperation-code"><a class="anchor" href="#code-class-class-mappingcommareaoperation-code"></a><code class="class">MappingCommAreaOperation</code></h3>
<div class="paragraph">
<p>Some connectors use records based on a COMMAREA which represents an array of bytes containing parameters to send to the EIS and data returned by it.
Spring provides a special operation class for working directly on COMMAREA rather than on records.
The <code class="class">MappingCommAreaOperation</code> class extends the <code class="class">MappingRecordOperation</code> class to provide such special COMMAREA support.
It implicitly uses the <code class="class">CommAreaRecord</code> class as input and output record type, and provides two new methods to convert an input object into an input COMMAREA and the output COMMAREA into an output object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public abstract class MappingCommAreaOperation extends MappingRecordOperation {
  ...
  protected abstract byte[] objectToBytes(Object inObject)
      throws IOException, DataAccessException;

  protected abstract Object bytesToObject(byte[] bytes)
      throws IOException, DataAccessException;
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="automatic-output-record-generation-2"><a class="anchor" href="#automatic-output-record-generation-2"></a>Automatic output record generation</h3>
<div class="paragraph">
<p>As every <code class="class">MappingRecordOperation</code> subclass is based on CciTemplate internally, the same way to automatically generate output records as with <code class="class">CciTemplate</code> is available.
Every operation object provides a corresponding <code>setOutputRecordCreator(..)</code> method.
For further information, see <a href="#automatic-output-generation">[automatic-output-generation]</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="summary-3"><a class="anchor" href="#summary-3"></a>Summary</h3>
<div class="paragraph">
<p>The operation object approach uses records in the same manner as the <code class="class">CciTemplate</code> class.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 21. Usage of Interaction execute methods</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MappingRecordOperation
              method signature</th>
<th class="tableblock halign-left valign-top">MappingRecordOperation
              outputRecordCreator property</th>
<th class="tableblock halign-left valign-top">execute method called on the CCI
              Interaction</th>
</tr>
</thead>
</table>

</div>
<div class="sect2">
<h3 id="example-for-code-class-class-mappingrecordoperation-code-usage"><a class="anchor" href="#example-for-code-class-class-mappingrecordoperation-code-usage"></a>Example for <code class="class">MappingRecordOperation</code> usage</h3>
<div class="paragraph">
<p>In this section, the usage of the <code class="class">MappingRecordOperation</code> will be shown to access a database with the Blackbox CCI connector.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The original version of this connector is provided by the Java EE SDK (version 1.3), available from Sun.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Firstly, some initializations on the CCI <code class="interface">InteractionSpec</code> must be done to specify which SQL request to execute.
In this sample, we directly define the way to convert the parameters of the request to a CCI record and the way to convert the CCI result record to an instance of the <code class="class">Person</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class PersonMappingOperation extends MappingRecordOperation {

  public PersonMappingOperation(ConnectionFactory connectionFactory) {
    setConnectionFactory(connectionFactory);
    CciInteractionSpec interactionSpec = new CciConnectionSpec();
    interactionSpec.setSql("select * from person where person_id=?");
    setInteractionSpec(interactionSpec);
  }

  protected Record createInputRecord(RecordFactory recordFactory, Object inputObject)
      throws ResourceException {
    Integer id = (Integer) inputObject;
    IndexedRecord input = recordFactory.createIndexedRecord("input");
    input.add(new Integer(id));
    return input;
  }

  protected Object extractOutputData(Record outputRecord)
      throws ResourceException, SQLException {
    ResultSet rs = (ResultSet) outputRecord;
    Person person = null;
    if (rs.next()) {
      Person person = new Person();
      person.setId(rs.getInt("person_id"));
      person.setLastName(rs.getString("person_last_name"));
      person.setFirstName(rs.getString("person_first_name"));
    }
    return person;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the application can execute the operation object, with the person identifier as argument.
Note that operation object could be set up as shared instance, as it is thread-safe.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public Person getPerson(int id) {
    PersonMappingOperation query = new PersonMappingOperation(getConnectionFactory());
    Person person = (Person) query.execute(new Integer(id));
    return person;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding configuration of Spring beans could look as follows in non-managed mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="managedConnectionFactory"
    class="com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory"&gt;
  &lt;property name="connectionURL" value="jdbc:hsqldb:hsql://localhost:9001"/&gt;
  &lt;property name="driverName" value="org.hsqldb.jdbcDriver"/&gt;
&lt;/bean&gt;

&lt;bean id="targetConnectionFactory"
    class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory"
    class="org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"&gt;
  &lt;property name="targetConnectionFactory" ref="targetConnectionFactory"/&gt;
  &lt;property name="connectionSpec"&gt;
    &lt;bean class="com.sun.connector.cciblackbox.CciConnectionSpec"&gt;
      &lt;property name="user" value="sa"/&gt;
      &lt;property name="password" value=""/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In managed mode (that is, in a Java EE environment), the configuration could look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;jee:jndi-lookup id="targetConnectionFactory" jndi-name="eis/blackbox"/&gt;

&lt;bean id="connectionFactory"
    class="org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"&gt;
  &lt;property name="targetConnectionFactory" ref="targetConnectionFactory"/&gt;
  &lt;property name="connectionSpec"&gt;
    &lt;bean class="com.sun.connector.cciblackbox.CciConnectionSpec"&gt;
      &lt;property name="user" value="sa"/&gt;
      &lt;property name="password" value=""/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-for-code-class-class-mappingcommareaoperation-code-usage"><a class="anchor" href="#example-for-code-class-class-mappingcommareaoperation-code-usage"></a>Example for <code class="class">MappingCommAreaOperation</code> usage</h3>
<div class="paragraph">
<p>In this section, the usage of the <code class="class">MappingCommAreaOperation</code> will be shown: accessing a CICS with ECI mode with the IBM CICS ECI connector.</p>
</div>
<div class="paragraph">
<p>Firstly, the CCI <code class="interface">InteractionSpec</code> needs to be initialized to specify which CICS program to access and how to interact with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public abstract class EciMappingOperation extends MappingCommAreaOperation {

  public EciMappingOperation(ConnectionFactory connectionFactory, String programName) {
    setConnectionFactory(connectionFactory);
    ECIInteractionSpec interactionSpec = new ECIInteractionSpec(),
    interactionSpec.setFunctionName(programName);
    interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);
    interactionSpec.setCommareaLength(30);
    setInteractionSpec(interactionSpec);
    setOutputRecordCreator(new EciOutputRecordCreator());
  }

  private static class EciOutputRecordCreator implements RecordCreator {
    public Record createRecord(RecordFactory recordFactory) throws ResourceException {
      return new CommAreaRecord();
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The abstract <code class="class">EciMappingOperation</code> class can then be subclassed to specify mappings between custom objects and <code>Records</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public OutputObject getData(Integer id) {
    EciMappingOperation query = new EciMappingOperation(getConnectionFactory(), "MYPROG") {
      protected abstract byte[] objectToBytes(Object inObject) throws IOException {
        Integer id = (Integer) inObject;
        return String.valueOf(id);
      }
      protected abstract Object bytesToObject(byte[] bytes) throws IOException;
        String str = new String(bytes);
        String field1 = str.substring(0,6);
        String field2 = str.substring(6,1);
        String field3 = str.substring(7,1);
        return new OutputObject(field1, field2, field3);
      }
    });

    return (OutputObject) query.execute(new Integer(id));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding configuration of Spring beans could look as follows in non-managed mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="managedConnectionFactory" class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TXSERIES"/&gt;
  &lt;property name="connectionURL" value="local:"/&gt;
  &lt;property name="userName" value="CICSUSER"/&gt;
  &lt;property name="password" value="CICS"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In managed mode (that is, in a Java EE environment), the configuration could look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;jee:jndi-lookup id="connectionFactory" jndi-name="eis/cicseci"/&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions"><a class="anchor" href="#transactions"></a>Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JCA specifies several levels of transaction support for resource adapters.
The kind of transactions that your resource adapter supports is specified in its <code class="file">ra.xml</code> file.
There are essentially three options: none (for example with CICS EPI connector), local transactions (for example with a CICS ECI connector), global transactions (for example with an IMS connector).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;connector&gt;

  &lt;resourceadapter&gt;

    &lt;!-- &lt;transaction-support&gt;NoTransaction&lt;/transaction-support&gt; --&gt;
    &lt;!-- &lt;transaction-support&gt;LocalTransaction&lt;/transaction-support&gt; --&gt;
    &lt;transaction-support&gt;XATransaction&lt;/transaction-support&gt;

  &lt;resourceadapter&gt;

&lt;connector&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For global transactions, you can use Spring&#8217;s generic transaction infrastructure to demarcate transactions, with <code class="class">JtaTransactionManager</code> as backend (delegating to the Java EE server&#8217;s distributed transaction coordinator underneath).</p>
</div>
<div class="paragraph">
<p>For local transactions on a single CCI <code class="interface">ConnectionFactory</code>, Spring provides a specific transaction management strategy for CCI, analogous to the <code class="class">DataSourceTransactionManager</code> for JDBC. The CCI API defines a local transaction object and corresponding local transaction demarcation methods.
Spring&#8217;s <code class="class">CciLocalTransactionManager</code> executes such local CCI transactions, fully compliant with Spring&#8217;s generic <code class="interface">PlatformTransactionManager</code> abstraction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;jee:jndi-lookup id="eciConnectionFactory" jndi-name="eis/cicseci"/&gt;

&lt;bean id="eciTransactionManager"
    class="org.springframework.jca.cci.connection.CciLocalTransactionManager"&gt;
  &lt;property name="connectionFactory" ref="eciConnectionFactory"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both transaction strategies can be used with any of Spring&#8217;s transaction demarcation facilities, be it declarative or programmatic.
This is a consequence of Spring&#8217;s generic <code class="interface">PlatformTransactionManager</code> abstraction, which decouples transaction demarcation from the actual execution strategy.
Simply switch between <code class="class">JtaTransactionManager</code> and <code class="class">CciLocalTransactionManager</code> as needed, keeping your transaction demarcation as-is.</p>
</div>
<div class="paragraph">
<p>For more information on Spring&#8217;s transaction facilities, see the chapter entitled <a href="#transaction">[transaction]</a>.</p>
</div>
</div>
</div>
<h1 id="email" class="sect0"><a class="anchor" href="#email"></a>Email</h1>
<div class="sect1">
<h2 id="introduction-12"><a class="anchor" href="#introduction-12"></a>Introduction</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">Library dependencies</div>
<div class="paragraph">
<p>The following additional jars to be on the classpath of your application in order to be able to use the Spring Framework&#8217;s email library.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The &lt;&lt;,JavaMail&gt;&gt; <code class="file">mail.jar</code> library</p>
</li>
<li>
<p>The &lt;&lt;,JAF&gt;&gt; <code class="file">activation.jar</code> library</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these libraries are freely available on the web.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The Spring Framework provides a helpful utility library for sending email that shields the user from the specifics of the underlying mailing system and is responsible for low level resource handling on behalf of the client.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.mail</code> package is the root level package for the Spring Framework&#8217;s email support.
The central interface for sending emails is the <code class="interface">MailSender</code> interface; a simple value object encapsulating the properties of a simple mail such as <em>from</em> and <em>to</em> (plus many others) is the <code class="class">SimpleMailMessage</code> class.
This package also contains a hierarchy of checked exceptions which provide a higher level of abstraction over the lower level mail system exceptions with the root exception being .
Please refer to the JavaDocs for more information on the rich mail exception hierarchy.</p>
</div>
<div class="paragraph">
<p>The <code class="interface">org.springframework.mail.javamail.JavaMailSender</code> interface adds specialized <em>JavaMail</em> features such as MIME message support to the <code class="interface">MailSender</code> interface (from which it inherits).
<code class="interface">JavaMailSender</code> also provides a callback interface for preparation of JavaMail MIME messages, called <code class="interface">org.springframework.mail.javamail.MimeMessagePreparator</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s assume there is a business interface called <code class="interface">OrderManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface OrderManager {

    void placeOrder(Order order);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let us also assume that there is a requirement stating that an email message with an order number needs to be generated and sent to a customer placing the relevant order.</p>
</div>
<div class="sect2">
<h3 id="basic-code-class-interface-mailsender-code-and-code-class-class-simplemailmessage-code-usage"><a class="anchor" href="#basic-code-class-interface-mailsender-code-and-code-class-class-simplemailmessage-code-usage"></a>Basic <code class="interface">MailSender</code> and <code class="class">SimpleMailMessage</code> usage</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import org.springframework.mail.MailException;
import org.springframework.mail.MailSender;
import org.springframework.mail.SimpleMailMessage;

public class SimpleOrderManager implements OrderManager {

    private MailSender mailSender;
    private SimpleMailMessage templateMessage;

    public void setMailSender(MailSender mailSender) {
        this.mailSender = mailSender;
    }

    public void setTemplateMessage(SimpleMailMessage templateMessage) {
        this.templateMessage = templateMessage;
    }

    public void placeOrder(Order order) {

        // Do the business calculations...

        // Call the collaborators to persist the order...

        // Create a thread safe "copy" of the template message and customize it
        SimpleMailMessage msg = new SimpleMailMessage(this.templateMessage);
        msg.setTo(order.getCustomer().getEmailAddress());
        msg.setText(
            "Dear " + order.getCustomer().getFirstName()
                + order.getCustomer().getLastName()
                + ", thank you for placing order. Your order number is "
                + order.getOrderNumber());
        try{
            this.mailSender.send(msg);
        }
        catch(MailException ex) {
            // simply log it and go on...
            System.err.println(ex.getMessage());
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Find below the bean definitions for the above code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl"&gt;
  &lt;property name="host" value="mail.mycompany.com"/&gt;
&lt;/bean&gt;

&lt;!-- this is a template message that we can pre-load with default state --&gt;
&lt;bean id="templateMessage" class="org.springframework.mail.SimpleMailMessage"&gt;
  &lt;property name="from" value="customerservice@mycompany.com"/&gt;
  &lt;property name="subject" value="Your order"/&gt;
&lt;/bean&gt;

&lt;bean id="orderManager" class="com.mycompany.businessapp.support.SimpleOrderManager"&gt;
  &lt;property name="mailSender" ref="mailSender"/&gt;
  &lt;property name="templateMessage" ref="templateMessage"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-code-class-interface-javamailsender-code-and-the-code-class-class-mimemessagepreparator-code"><a class="anchor" href="#using-the-code-class-interface-javamailsender-code-and-the-code-class-class-mimemessagepreparator-code"></a>Using the <code class="interface">JavaMailSender</code> and the <code class="class">MimeMessagePreparator</code></h3>
<div class="paragraph">
<p>Here is another implementation of <code class="interface">OrderManager</code> using the <code class="interface">MimeMessagePreparator</code> callback interface.
Please note in this case that the <code>mailSender</code> property is of type <code class="interface">JavaMailSender</code> so that we are able to use the JavaMail <code class="class">MimeMessage</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;

import javax.mail.internet.MimeMessage;
import org.springframework.mail.MailException;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessagePreparator;

public class SimpleOrderManager implements OrderManager {

    private JavaMailSender mailSender;

    public void setMailSender(JavaMailSender mailSender) {
        this.mailSender = mailSender;
    }

    public void placeOrder(final Order order) {

        // Do the business calculations...

        // Call the collaborators to persist the order...

        MimeMessagePreparator preparator = new MimeMessagePreparator() {

            public void prepare(MimeMessage mimeMessage) throws Exception {

                mimeMessage.setRecipient(Message.RecipientType.TO,
                        new InternetAddress(order.getCustomer().getEmailAddress()));
                mimeMessage.setFrom(new InternetAddress("mail@mycompany.com"));
                mimeMessage.setText(
                    "Dear " + order.getCustomer().getFirstName() + " "
                        + order.getCustomer().getLastName()
                        + ", thank you for placing order. Your order number is "
                        + order.getOrderNumber());
            }
        };
        try {
            this.mailSender.send(preparator);
        }
        catch (MailException ex) {
            // simply log it and go on...
            System.err.println(ex.getMessage());
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The mail code is a crosscutting concern and could well be a candidate for refactoring into a <a href="#aop">custom Spring AOP aspect</a>, which then could be executed at appropriate joinpoints on the <code class="interface">OrderManager</code> target.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Spring Framework&#8217;s mail support ships with the standard JavaMail implementation.
Please refer to the relevant JavaDocs for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-javamail-code-class-class-mimemessagehelper-code"><a class="anchor" href="#using-the-javamail-code-class-class-mimemessagehelper-code"></a>Using the JavaMail <code class="class">MimeMessageHelper</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A class that comes in pretty handy when dealing with JavaMail messages is the <code class="class">org.springframework.mail.javamail.MimeMessageHelper</code> class, which shields you from having to use the verbose JavaMail API. Using the <code class="class">MimeMessageHelper</code> it is pretty easy to create a <code class="class">MimeMessage</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// of course you would use DI in any real-world cases
JavaMailSenderImpl sender = new JavaMailSenderImpl();
sender.setHost("mail.host.com");

MimeMessage message = sender.createMimeMessage();
MimeMessageHelper helper = new MimeMessageHelper(message);
helper.setTo("test@host.com");
helper.setText("Thank you for ordering!");

sender.send(message);</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="sending-attachments-and-inline-resources"><a class="anchor" href="#sending-attachments-and-inline-resources"></a>Sending attachments and inline resources</h3>
<div class="paragraph">
<p>Multipart email messages allow for both attachments and inline resources.
Examples of inline resources would be images or a stylesheet you want to use in your message, but that you don&#8217;t want displayed as an attachment.</p>
</div>
<div class="sect3">
<h4 id="attachments"><a class="anchor" href="#attachments"></a>Attachments</h4>
<div class="paragraph">
<p>The following example shows you how to use the <code class="class">MimeMessageHelper</code> to send an email along with a single JPEG image attachment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>JavaMailSenderImpl sender = new JavaMailSenderImpl();
sender.setHost("mail.host.com");

MimeMessage message = sender.createMimeMessage();

// use the true flag to indicate you need a multipart message
MimeMessageHelper helper = new MimeMessageHelper(message, true);
helper.setTo("test@host.com");

helper.setText("Check out this image!");

// let's attach the infamous windows Sample file (this time copied to c:/)
FileSystemResource file = new FileSystemResource(new File("c:/Sample.jpg"));
helper.addAttachment("CoolImage.jpg", file);

sender.send(message);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="inline-resources"><a class="anchor" href="#inline-resources"></a>Inline resources</h4>
<div class="paragraph">
<p>The following example shows you how to use the <code class="class">MimeMessageHelper</code> to send an email along with an inline image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>JavaMailSenderImpl sender = new JavaMailSenderImpl();
sender.setHost("mail.host.com");

MimeMessage message = sender.createMimeMessage();

// use the true flag to indicate you need a multipart message
MimeMessageHelper helper = new MimeMessageHelper(message, true);
helper.setTo("test@host.com");

// use the true flag to indicate the text included is HTML
helper.setText("&lt;html&gt;&lt;body&gt;&lt;img src='cid:identifier1234'&gt;&lt;/body&gt;&lt;/html&gt;", true);

// let's include the infamous windows Sample file (this time copied to c:/)
FileSystemResource res = new FileSystemResource(new File("c:/Sample.jpg"));
helper.addInline("identifier1234", res);

sender.send(message);</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Inline resources are added to the mime message using the specified <code>Content-ID</code> (<code>identifier1234</code> in the above example).
The order in which you are adding the text and the resource are <em>very</em> important.
Be sure to <em>first add the text</em> and after that the resources.
If you are doing it the other way around, it won&#8217;t work!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-email-content-using-a-templating-library"><a class="anchor" href="#creating-email-content-using-a-templating-library"></a>Creating email content using a templating library</h3>
<div class="paragraph">
<p>The code in the previous examples explicitly created the content of the email message, using methods calls such as <code class="method">message.setText(..)</code>.
This is fine for simple cases, and it is okay in the context of the aforementioned examples, where the intent was to show you the very basics of the API.</p>
</div>
<div class="paragraph">
<p>In your typical enterprise application though, you are not going to create the content of your emails using the above approach for a number of reasons.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating HTML-based email content in Java code is tedious and error prone</p>
</li>
<li>
<p>There is no clear separation between display logic and business logic</p>
</li>
<li>
<p>Changing the display structure of the email content requires writing Java code, recompiling, redeploying&#8230;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Typically the approach taken to address these issues is to use a template library such as FreeMarker or Velocity to define the display structure of email content.
This leaves your code tasked only with creating the data that is to be rendered in the email template and sending the email.
It is definitely a best practice for when the content of your emails becomes even moderately complex, and with the Spring Framework&#8217;s support classes for FreeMarker and Velocity becomes quite easy to do.
Find below an example of using the Velocity template library to create email content.</p>
</div>
<div class="sect3">
<h4 id="a-velocity-based-example"><a class="anchor" href="#a-velocity-based-example"></a>A Velocity-based example</h4>
<div class="paragraph">
<p>To use &lt;&lt;,Velocity&gt;&gt; to create your email template(s), you will need to have the Velocity libraries available on your classpath.
You will also need to create one or more Velocity templates for the email content that your application needs.
Find below the Velocity template that this example will be using.
As you can see it is HTML-based, and since it is plain text it can be created using your favorite HTML or text editor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code># in the com/foo/package
&lt;html&gt;
&lt;body&gt;
&lt;h3&gt;Hi ${user.userName}, welcome to the Chipping Sodbury On-the-Hill message boards!&lt;/h3&gt;

&lt;div&gt;
   Your email address is &lt;a href="mailto:${user.emailAddress}"&gt;${user.emailAddress}&lt;/a&gt;.
&lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Find below some simple code and Spring XML configuration that makes use of the above Velocity template to create email content and send email(s).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package com.foo;

import org.apache.velocity.app.VelocityEngine;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.mail.javamail.MimeMessagePreparator;
import org.springframework.ui.velocity.VelocityEngineUtils;

import javax.mail.internet.MimeMessage;
import java.util.HashMap;
import java.util.Map;

public class SimpleRegistrationService implements RegistrationService {

   private JavaMailSender mailSender;
   private VelocityEngine velocityEngine;

   public void setMailSender(JavaMailSender mailSender) {
      this.mailSender = mailSender;
   }

   public void setVelocityEngine(VelocityEngine velocityEngine) {
      this.velocityEngine = velocityEngine;
   }

   public void register(User user) {

      // Do the registration logic...

      sendConfirmationEmail(user);
   }

   private void sendConfirmationEmail(final User user) {
      MimeMessagePreparator preparator = new MimeMessagePreparator() {
         public void prepare(MimeMessage mimeMessage) throws Exception {
            MimeMessageHelper message = new MimeMessageHelper(mimeMessage);
            message.setTo(user.getEmailAddress());
            message.setFrom("webmaster@csonth.gov.uk"); // could be parameterized...
            Map model = new HashMap();
            model.put("user", user);
            String text = VelocityEngineUtils.mergeTemplateIntoString(
               velocityEngine, "com/dns/registration-confirmation.vm", model);
            message.setText(text, true);
         }
      };
      this.mailSender.send(preparator);
   }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
   http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

   &lt;bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl"&gt;
      &lt;property name="host" value="mail.csonth.gov.uk"/&gt;
   &lt;/bean&gt;

   &lt;bean id="registrationService" class="com.foo.SimpleRegistrationService"&gt;
      &lt;property name="mailSender" ref="mailSender"/&gt;
      &lt;property name="velocityEngine" ref="velocityEngine"/&gt;
   &lt;/bean&gt;

   &lt;bean id="velocityEngine" class="org.springframework.ui.velocity.VelocityEngineFactoryBean"&gt;
      &lt;property name="velocityProperties"&gt;
         &lt;value&gt;
          resource.loader=class
          class.resource.loader.class=org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader
         &lt;/value&gt;
      &lt;/property&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="task-execution-and-scheduling" class="sect0"><a class="anchor" href="#task-execution-and-scheduling"></a>Task Execution and Scheduling</h1>
<div class="sect1">
<h2 id="introduction-13"><a class="anchor" href="#introduction-13"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Framework provides abstractions for asynchronous execution and scheduling of tasks with the <code class="interface">TaskExecutor</code> and <code class="interface">TaskScheduler</code> interfaces, respectively.
Spring also features implementations of those interfaces that support thread pools or delegation to CommonJ within an application server environment.
Ultimately the use of these implementations behind the common interfaces abstracts away the differences between Java SE 5, Java SE 6 and Java EE environments.</p>
</div>
<div class="paragraph">
<p>Spring also features integration classes for supporting scheduling with the <code class="class">Timer</code>, part of the JDK since 1.3, and the Quartz Scheduler (&lt;&lt;,&gt;&gt;).
Both of those schedulers are set up using a <code class="interface">FactoryBean</code> with optional references to <code class="class">Timer</code> or <code class="class">Trigger</code> instances, respectively.
Furthermore, a convenience class for both the Quartz Scheduler and the <code class="class">Timer</code> is available that allows you to invoke a method of an existing target object (analogous to the normal <code class="class">MethodInvokingFactoryBean</code> operation).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-spring-code-class-interface-taskexecutor-code-abstraction"><a class="anchor" href="#the-spring-code-class-interface-taskexecutor-code-abstraction"></a>The Spring <code class="interface">TaskExecutor</code> abstraction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring 2.0 introduces a new abstraction for dealing with executors.
Executors are the Java 5 name for the concept of thread pools.
The "executor" naming is due to the fact that there is no guarantee that the underlying implementation is actually a pool; an executor may be single-threaded or even synchronous.
Spring&#8217;s abstraction hides implementation details between Java SE 1.4, Java SE 5 and Java EE environments.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s <code class="interface">TaskExecutor</code> interface is identical to the <code class="class">java.util.concurrent.Executor</code> interface.
In fact, its primary reason for existence is to abstract away the need for Java 5 when using thread pools.
The interface has a single method <code class="class">execute(Runnable task)</code> that accepts a task for execution based on the semantics and configuration of the thread pool.</p>
</div>
<div class="paragraph">
<p>The <code class="interface">TaskExecutor</code> was originally created to give other Spring components an abstraction for thread pooling where needed.
Components such as the <code class="class">ApplicationEventMulticaster</code>, JMS&#8217;s <code class="class">AbstractMessageListenerContainer</code>, and Quartz integration all use the <code class="interface">TaskExecutor</code> abstraction to pool threads.
However, if your beans need thread pooling behavior, it is possible to use this abstraction for your own needs.</p>
</div>
<div class="sect2">
<h3 id="code-class-interface-taskexecutor-code-types"><a class="anchor" href="#code-class-interface-taskexecutor-code-types"></a><code class="interface">TaskExecutor</code> types</h3>
<div class="paragraph">
<p>There are a number of pre-built implementations of <code class="interface">TaskExecutor</code> included with the Spring distribution.
In all likelihood, you shouldn&#8217;t ever need to implement your own.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="class">SimpleAsyncTaskExecutor</code></p>
<div class="paragraph">
<p>This implementation does not reuse any threads, rather it starts up a new thread for each invocation.
However, it does support a concurrency limit which will block any invocations that are over the limit until a slot has been freed up.
If you&#8217;re looking for true pooling, keep scrolling further down the page.</p>
</div>
</li>
<li>
<p><code class="class">SyncTaskExecutor</code></p>
<div class="paragraph">
<p>This implementation doesn&#8217;t execute invocations asynchronously.
Instead, each invocation takes place in the calling thread.
It is primarily used in situations where multithreading isn&#8217;t necessary such as simple test cases.</p>
</div>
</li>
<li>
<p><code class="class">ConcurrentTaskExecutor</code></p>
<div class="paragraph">
<p>This implementation is a wrapper for a Java 5 <code class="class">java.util.concurrent.Executor</code>.
There is an alternative, <code class="class">ThreadPoolTaskExecutor</code>, that exposes the <code class="class">Executor</code> configuration parameters as bean properties.
It is rare to need to use the <code class="class">ConcurrentTaskExecutor</code> but if the <a href="#threadPoolTaskExecutor"><code class="class">ThreadPoolTaskExecutor</code></a> isn&#8217;t robust enough for your needs, the <code class="class">ConcurrentTaskExecutor</code> is an alternative.</p>
</div>
</li>
<li>
<p><code class="class">SimpleThreadPoolTaskExecutor</code></p>
<div class="paragraph">
<p>This implementation is actually a subclass of Quartz&#8217;s <code class="class">SimpleThreadPool</code> which listens to Spring&#8217;s lifecycle callbacks.
This is typically used when you have a thread pool that may need to be shared by both Quartz and non-Quartz components.</p>
</div>
</li>
<li>
<p><code class="class">ThreadPoolTaskExecutor</code></p>
<div class="sidebarblock">
<div class="content">
It is not possible to use any backport or alternate versions of the <code class="class">java.util.concurrent</code> package with this implementation.
Both Doug Lea&#8217;s and Dawid Kurzyniec&#8217;s implementations use different package structures which will prevent them from working correctly.
</div>
</div>
<div class="paragraph">
<p>This implementation can only be used in a Java 5 environment but is also the most commonly used one in that environment.
It exposes bean properties for configuring a <code class="class">java.util.concurrent.ThreadPoolExecutor</code> and wraps it in a <code class="interface">TaskExecutor</code>.
If you need something advanced such as a <code class="class">ScheduledThreadPoolExecutor</code>, it is recommended that you use a <a href="#concurrentTaskExecutor"><code class="class">ConcurrentTaskExecutor</code></a> instead.</p>
</div>
</li>
<li>
<p><code class="class">TimerTaskExecutor</code></p>
<div class="paragraph">
<p>This implementation uses a single <code class="class">TimerTask</code> as its backing implementation.
It&#8217;s different from the <a href="#syncTaskExecutor"><code class="class">SyncTaskExecutor</code></a> in that the method invocations are executed in a separate thread, although they are synchronous in that thread.</p>
</div>
</li>
<li>
<p><code class="class">WorkManagerTaskExecutor</code></p>
<div class="sidebarblock">
<div class="content">
CommonJ is a set of specifications jointly developed between BEA and IBM. These specifications are not Java EE standards, but are standard across BEA&#8217;s and IBM&#8217;s Application Server implementations.
</div>
</div>
<div class="paragraph">
<p>This implementation uses the CommonJ WorkManager as its backing implementation and is the central convenience class for setting up a CommonJ WorkManager reference in a Spring context.
Similar to the <a href="#simpleThreadPoolTaskExecutor"><code class="class">SimpleThreadPoolTaskExecutor</code></a>, this class implements the WorkManager interface and therefore can be used directly as a WorkManager as well.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-a-code-class-interface-taskexecutor-code"><a class="anchor" href="#using-a-code-class-interface-taskexecutor-code"></a>Using a <code class="interface">TaskExecutor</code></h3>
<div class="paragraph">
<p>Spring&#8217;s <code class="interface">TaskExecutor</code> implementations are used as simple JavaBeans.
In the example below, we define a bean that uses the <code class="class">ThreadPoolTaskExecutor</code> to asynchronously print out a set of messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import org.springframework.core.task.TaskExecutor;

public class TaskExecutorExample {

  private class MessagePrinterTask implements Runnable {

    private String message;

    public MessagePrinterTask(String message) {
      this.message = message;
    }

    public void run() {
      System.out.println(message);
    }

  }

  private TaskExecutor taskExecutor;

  public TaskExecutorExample(TaskExecutor taskExecutor) {
    this.taskExecutor = taskExecutor;
  }

  public void printMessages() {
    for(int i = 0; i &lt; 25; i++) {
      taskExecutor.execute(new MessagePrinterTask("Message" + i));
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, rather than retrieving a thread from the pool and executing yourself, you add your <code class="class">Runnable</code> to the queue and the <code class="interface">TaskExecutor</code> uses its internal rules to decide when the task gets executed.</p>
</div>
<div class="paragraph">
<p>To configure the rules that the <code class="interface">TaskExecutor</code> will use, simple bean properties have been exposed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="taskExecutor" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor"&gt;
  &lt;property name="corePoolSize" value="5" /&gt;
  &lt;property name="maxPoolSize" value="10" /&gt;
  &lt;property name="queueCapacity" value="25" /&gt;
&lt;/bean&gt;

&lt;bean id="taskExecutorExample" class="TaskExecutorExample"&gt;
  &lt;constructor-arg ref="taskExecutor" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-spring-code-class-interface-taskscheduler-code-abstraction"><a class="anchor" href="#the-spring-code-class-interface-taskscheduler-code-abstraction"></a>The Spring <code class="interface">TaskScheduler</code> abstraction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to the <code class="interface">TaskExecutor</code> abstraction, Spring 3.0 introduces a <code class="interface">TaskScheduler</code> with a variety of methods for scheduling tasks to run at some point in the future.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface TaskScheduler {

    ScheduledFuture schedule(Runnable task, Trigger trigger);

    ScheduledFuture schedule(Runnable task, Date startTime);

    ScheduledFuture scheduleAtFixedRate(Runnable task, Date startTime, long period);

    ScheduledFuture scheduleAtFixedRate(Runnable task, long period);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, Date startTime, long delay);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, long delay);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The simplest method is the one named <em>schedule</em> that takes a <code class="interface">Runnable</code> and <code class="class">Date</code> only.
That will cause the task to run once after the specified time.
All of the other methods are capable of scheduling tasks to run repeatedly.
The fixed-rate and fixed-delay methods are for simple, periodic execution, but the method that accepts a Trigger is much more flexible.</p>
</div>
<div class="sect2">
<h3 id="the-code-class-interface-trigger-code-interface"><a class="anchor" href="#the-code-class-interface-trigger-code-interface"></a>The <code class="interface">Trigger</code> interface</h3>
<div class="paragraph">
<p>The <code class="interface">Trigger</code> interface is essentially inspired by JSR-236, which, as of Spring 3.0, has not yet been officially implemented.
The basic idea of the <code class="interface">Trigger</code> is that execution times may be determined based on past execution outcomes or even arbitrary conditions.
If these determinations do take into account the outcome of the preceding execution, that information is available within a <code class="interface">TriggerContext</code>.
The <code class="interface">Trigger</code> interface itself is quite simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface Trigger {

    Date nextExecutionTime(TriggerContext triggerContext);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code class="interface">TriggerContext</code> is the most important part.
It encapsulates all of the relevant data, and is open for extension in the future if necessary.
The <code class="interface">TriggerContext</code> is an interface (a <code class="class">SimpleTriggerContext</code> implementation is used by default).
Here you can see what methods are available for <code class="interface">Trigger</code> implementations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface TriggerContext {

    Date lastScheduledExecutionTime();

    Date lastActualExecutionTime();

    Date lastCompletionTime();

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="code-class-interface-trigger-code-implementations"><a class="anchor" href="#code-class-interface-trigger-code-implementations"></a><code class="interface">Trigger</code> implementations</h3>
<div class="paragraph">
<p>Spring provides two implementations of the <code class="interface">Trigger</code> interface.
The most interesting one is the <code class="class">CronTrigger</code>.
It enables the scheduling of tasks based on cron expressions.
For example the following task is being scheduled to run 15 minutes past each hour but only during the 9-to-5 "business hours" on weekdays.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>scheduler.schedule(task, new CronTrigger("* 15 9-17 * * MON-FRI"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other out-of-the-box implementation is a <code class="class">PeriodicTrigger</code> that accepts a fixed period, an optional initial delay value, and a boolean to indicate whether the period should be interpreted as a fixed-rate or a fixed-delay.
Since the <code class="interface">TaskScheduler</code> interface already defines methods for scheduling tasks at a fixed-rate or with a fixed-delay, those methods should be used directly whenever possible.
The value of the <code class="class">PeriodicTrigger</code> implementation is that it can be used within components that rely on the <code class="interface">Trigger</code> abstraction.
For example, it may be convenient to allow periodic triggers, cron-based triggers, and even custom trigger implementations to be used interchangeably.
Such a component could take advantage of dependency injection so that such <code class="interface">Triggers</code> could be configured externally.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-class-interface-taskscheduler-code-implementations"><a class="anchor" href="#code-class-interface-taskscheduler-code-implementations"></a><code class="interface">TaskScheduler</code> implementations</h3>
<div class="paragraph">
<p>As with Spring&#8217;s <code class="interface">TaskExecutor</code> abstraction, the primary benefit of the <code class="interface">TaskScheduler</code> is that code relying on scheduling behavior need not be coupled to a particular scheduler implementation.
The flexibility this provides is particularly relevant when running within Application Server environments where threads should not be created directly by the application itself.
For such cases, Spring provides a <code class="class">TimerManagerTaskScheduler</code> that delegates to a CommonJ TimerManager instance, typically configured with a JNDI-lookup.</p>
</div>
<div class="paragraph">
<p>A simpler alternative, the <code class="class">ThreadPoolTaskScheduler</code>, can be used whenever external thread management is not a requirement.
Internally, it delegates to a <code class="interface">ScheduledExecutorService</code> instance.
<code class="class">ThreadPoolTaskScheduler</code> actually implements Spring&#8217;s <code class="interface">TaskExecutor</code> interface as well, so that a single instance can be used for asynchronous execution <em>as soon as possible</em> as well as scheduled, and potentially recurring, executions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="annotation-support-for-scheduling-and-asynchronous-execution"><a class="anchor" href="#annotation-support-for-scheduling-and-asynchronous-execution"></a>Annotation Support for Scheduling and Asynchronous Execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring provides annotation support for both task scheduling and asynchronous method execution.</p>
</div>
<div class="sect2">
<h3 id="enable-scheduling-annotations"><a class="anchor" href="#enable-scheduling-annotations"></a>Enable scheduling annotations</h3>
<div class="paragraph">
<p>To enable support for <code class="interface">@Scheduled</code> and <code class="interface">@Async</code> annotations add <code class="interface">@EnableScheduling</code> and <code class="interface">@EnableAsync</code> to one of your <code class="interface">@Configuration</code> classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableAsync
@EnableScheduling
public class AppConfig {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are free to pick and choose the relevant annotations for your application.
For example, if you only need support for <code class="interface">@Scheduled</code>, simply omit <code class="interface">@EnableAsync</code>.
For more fine-grained control you can additionally implement the <code class="interface">SchedulingConfigurer</code> and/or <code class="interface">AsyncConfigurer</code> interfaces.
See the Javadoc for full details.</p>
</div>
<div class="paragraph">
<p>If you prefer XML configuration use the <code>&lt;task:annotation-driven&gt;</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;task:annotation-driven executor="myExecutor" scheduler="myScheduler"/&gt;
&lt;task:executor id="myExecutor" pool-size="5"/&gt;
&lt;task:scheduler id="myScheduler" pool-size="10"/&gt;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice with the above XML that an executor reference is provided for handling those tasks that correspond to methods with the <code class="interface">@Async</code> annotation, and the scheduler reference is provided for managing those methods annotated with <code class="interface">@Scheduled</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-scheduled-annotation"><a class="anchor" href="#the-scheduled-annotation"></a>The @Scheduled Annotation</h3>
<div class="paragraph">
<p>The @Scheduled annotation can be added to a method along with trigger metadata.
For example, the following method would be invoked every 5 seconds with a fixed delay, meaning that the period will be measured from the completion time of each preceding invocation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Scheduled(fixedDelay=5000)
public void doSomething() {
    // something that should execute periodically
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a fixed rate execution is desired, simply change the property name specified within the annotation.
The following would be executed every 5 seconds measured between the successive start times of each invocation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Scheduled(fixedRate=5000)
public void doSomething() {
    // something that should execute periodically
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For fixed-delay and fixed-rate tasks, an initial delay may be specified indicating the number of milliseconds to wait before the first execution of the method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Scheduled(initialDelay=1000, fixedRate=5000)
public void doSomething() {
    // something that should execute periodically
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If simple periodic scheduling is not expressive enough, then a cron expression may be provided.
For example, the following will only execute on weekdays.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Scheduled(cron="*/5 * * * * MON-FRI")
public void doSomething() {
    // something that should execute on weekdays only
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the methods to be scheduled must have void returns and must not expect any arguments.
If the method needs to interact with other objects from the Application Context, then those would typically have been provided through dependency injection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Make sure that you are not initializing multiple instances of the same @Scheduled annotation class at runtime, unless you do want to schedule callbacks to each such instance.
Related to this, make sure that you do not use @Configurable on bean classes which are annotated with @Scheduled and registered as regular Spring beans with the container: You would get double initialization otherwise, once through the container and once through the @Configurable aspect, with the consequence of each @Scheduled method being invoked twice.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="the-async-annotation"><a class="anchor" href="#the-async-annotation"></a>The @Async Annotation</h3>
<div class="paragraph">
<p>The <code class="interface">@Async</code> annotation can be provided on a method so that invocation of that method will occur asynchronously.
In other words, the caller will return immediately upon invocation and the actual execution of the method will occur in a task that has been submitted to a Spring <code class="interface">TaskExecutor</code>.
In the simplest case, the annotation may be applied to a <code>void</code>-returning method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Async
void doSomething() {
    // this will be executed asynchronously
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike the methods annotated with the <code class="interface">@Scheduled</code> annotation, these methods can expect arguments, because they will be invoked in the "normal" way by callers at runtime rather than from a scheduled task being managed by the container.
For example, the following is a legitimate application of the <code class="interface">@Async</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Async
void doSomething(String s) {
    // this will be executed asynchronously
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even methods that return a value can be invoked asynchronously.
However, such methods are required to have a <code class="interface">Future</code> typed return value.
This still provides the benefit of asynchronous execution so that the caller can perform other tasks prior to calling <code class="method">get()</code> on that Future.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Async
Future&lt;String&gt; returnSomething(int i) {
    // this will be executed asynchronously
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="interface">@Async</code> can not be used in conjunction with lifecycle callbacks such as <code class="interface">@PostConstruct</code>.
To asynchronously initialize Spring beans you currently have to use a separate initializing Spring bean that invokes the <code class="interface">@Async</code> annotated method on the target then.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class SampleBeanImpl implements SampleBean {

  @Async
  void doSomething() {  }
}


public class SampleBeanInititalizer {

  private final SampleBean bean;

  public SampleBeanInitializer(SampleBean bean) {
    this.bean = bean;
  }

  @PostConstruct
  public void initialize() {
    bean.doSomething();
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="executor-qualification-with-async"><a class="anchor" href="#executor-qualification-with-async"></a>Executor qualification with @Async</h3>
<div class="paragraph">
<p>By default when specifying <code class="interface">@Async</code> on a method, the executor that will be used is the one supplied to the <em>annotation-driven</em> element as described above.
However, the <code>value</code> attribute of the <code class="interface">@Async</code> annotation can be used when needing to indicate that an executor other than the default should be used when executing a given method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Async("otherExecutor")
void doSomething(String s) {
    // this will be executed asynchronously by "otherExecutor"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, "otherExecutor" may be the name of any <code class="interface">Executor</code> bean in the Spring container, or may be the name of a <em>qualifier</em> associated with any <code class="interface">Executor</code>, e.g.
as specified with the <code>&lt;qualifier&gt;</code> element or Spring&#8217;s <code class="interface">@Qualifier</code> annotation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-task-namespace"><a class="anchor" href="#the-task-namespace"></a>The Task Namespace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Beginning with Spring 3.0, there is an XML namespace for configuring <code class="interface">TaskExecutor</code> and <code class="interface">TaskScheduler</code> instances.
It also provides a convenient way to configure tasks to be scheduled with a trigger.</p>
</div>
<div class="sect2">
<h3 id="the-em-scheduler-em-element"><a class="anchor" href="#the-em-scheduler-em-element"></a>The <em>scheduler</em> element</h3>
<div class="paragraph">
<p>The following element will create a <code class="class">ThreadPoolTaskScheduler</code> instance with the specified thread pool size.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;task:scheduler id="scheduler" pool-size="10"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value provided for the <em>id</em> attribute will be used as the prefix for thread names within the pool.
The <em>scheduler</em> element is relatively straightforward.
If you do not provide a <em>pool-size</em> attribute, the default thread pool will only have a single thread.
There are no other configuration options for the scheduler.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-em-executor-em-element"><a class="anchor" href="#the-em-executor-em-element"></a>The <em>executor</em> element</h3>
<div class="paragraph">
<p>The following will create a <code class="class">ThreadPoolTaskExecutor</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;task:executor id="executor" pool-size="10"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the scheduler above, the value provided for the <em>id</em> attribute will be used as the prefix for thread names within the pool.
As far as the pool size is concerned, the <em>executor</em> element supports more configuration options than the <em>scheduler</em> element.
For one thing, the thread pool for a <code class="class">ThreadPoolTaskExecutor</code> is itself more configurable.
Rather than just a single size, an executor&#8217;s thread pool may have different values for the <em>core</em> and the <em>max</em> size.
If a single value is provided then the executor will have a fixed-size thread pool (the core and max sizes are the same).
However, the <em>executor</em> element&#8217;s <em>pool-size</em> attribute also accepts a range in the form of "min-max".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;task:executor id="executorWithPoolSizeRange"
                 pool-size="5-25"
                 queue-capacity="100"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from that configuration, a <em>queue-capacity</em> value has also been provided.
The configuration of the thread pool should also be considered in light of the executor&#8217;s queue capacity.
For the full description of the relationship between pool size and queue capacity, consult the documentation for &lt;&lt;,ThreadPoolExecutor&gt;&gt;.
The main idea is that when a task is submitted, the executor will first try to use a free thread if the number of active threads is currently less than the core size.
If the core size has been reached, then the task will be added to the queue as long as its capacity has not yet been reached.
Only then, if the queue&#8217;s capacity <em>has</em> been reached, will the executor create a new thread beyond the core size.
If the max size has also been reached, then the executor will reject the task.</p>
</div>
<div class="paragraph">
<p>By default, the queue is <em>unbounded</em>, but this is rarely the desired configuration, because it can lead to <code class="class">OutOfMemoryErrors</code> if enough tasks are added to that queue while all pool threads are busy.
Furthermore, if the queue is unbounded, then the max size has no effect at all.
Since the executor will always try the queue before creating a new thread beyond the core size, a queue must have a finite capacity for the thread pool to grow beyond the core size (this is why a <em>fixed size</em> pool is the only sensible case when using an unbounded queue).</p>
</div>
<div class="paragraph">
<p>In a moment, we will review the effects of the keep-alive setting which adds yet another factor to consider when providing a pool size configuration.
First, let&#8217;s consider the case, as mentioned above, when a task is rejected.
By default, when a task is rejected, a thread pool executor will throw a <code class="class">TaskRejectedException</code>.
However, the rejection policy is actually configurable.
The exception is thrown when using the default rejection policy which is the <code class="class">AbortPolicy</code> implementation.
For applications where some tasks can be skipped under heavy load, either the <code class="class">DiscardPolicy</code> or <code class="class">DiscardOldestPolicy</code> may be configured instead.
Another option that works well for applications that need to throttle the submitted tasks under heavy load is the <code class="class">CallerRunsPolicy</code>.
Instead of throwing an exception or discarding tasks, that policy will simply force the thread that is calling the submit method to run the task itself.
The idea is that such a caller will be busy while running that task and not able to submit other tasks immediately.
Therefore it provides a simple way to throttle the incoming load while maintaining the limits of the thread pool and queue.
Typically this allows the executor to "catch up" on the tasks it is handling and thereby frees up some capacity on the queue, in the pool, or both.
Any of these options can be chosen from an enumeration of values available for the <em>rejection-policy</em> attribute on the <em>executor</em> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;task:executor id="executorWithCallerRunsPolicy"
               pool-size="5-25"
               queue-capacity="100"
               rejection-policy="CALLER_RUNS"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-em-scheduled-tasks-em-element"><a class="anchor" href="#the-em-scheduled-tasks-em-element"></a>The <em>scheduled-tasks</em> element</h3>
<div class="paragraph">
<p>The most powerful feature of Spring&#8217;s task namespace is the support for configuring tasks to be scheduled within a Spring Application Context.
This follows an approach similar to other "method-invokers" in Spring, such as that provided by the JMS namespace for configuring Message-driven POJOs.
Basically a "ref" attribute can point to any Spring-managed object, and the "method" attribute provides the name of a method to be invoked on that object.
Here is a simple example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;task:scheduled-tasks scheduler="myScheduler"&gt;
    &lt;task:scheduled ref="beanA" method="methodA" fixed-delay="5000"/&gt;
&lt;/task:scheduled-tasks&gt;

&lt;task:scheduler id="myScheduler" pool-size="10"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the scheduler is referenced by the outer element, and each individual task includes the configuration of its trigger metadata.
In the preceding example, that metadata defines a periodic trigger with a fixed delay indicating the number of milliseconds to wait after each task execution has completed.
Another option is <em>fixed-rate</em>, indicating how often the method should be executed regardless of how long any previous execution takes.
Additionally, for both fixed-delay and fixed-rate tasks an <em>initial-delay</em> parameter may be specified indicating the number of milliseconds to wait before the first execution of the method.
For more control, a "cron" attribute may be provided instead.
Here is an example demonstrating these other options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;task:scheduled-tasks scheduler="myScheduler"&gt;
    &lt;task:scheduled ref="beanA" method="methodA" fixed-delay="5000" initial-delay="1000"/&gt;
    &lt;task:scheduled ref="beanB" method="methodB" fixed-rate="5000"/&gt;
    &lt;task:scheduled ref="beanC" method="methodC" cron="*/5 * * * * MON-FRI"/&gt;
&lt;/task:scheduled-tasks&gt;

&lt;task:scheduler id="myScheduler" pool-size="10"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-quartz-scheduler"><a class="anchor" href="#using-the-quartz-scheduler"></a>Using the Quartz Scheduler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quartz uses <code class="class">Trigger</code>, <code class="class">Job</code> and <code class="class">JobDetail</code> objects to realize scheduling of all kinds of jobs.
For the basic concepts behind Quartz, have a look at &lt;&lt;,&gt;&gt;.
For convenience purposes, Spring offers a couple of classes that simplify the usage of Quartz within Spring-based applications.</p>
</div>
<div class="sect2">
<h3 id="using-the-jobdetailbean"><a class="anchor" href="#using-the-jobdetailbean"></a>Using the JobDetailBean</h3>
<div class="paragraph">
<p><code class="class">JobDetail</code> objects contain all information needed to run a job.
The Spring Framework provides a <code class="class">JobDetailBean</code> that makes the <code class="class">JobDetail</code> more of an actual JavaBean with sensible defaults.
Let&#8217;s have a look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;bean name="exampleJob" class="org.springframework.scheduling.quartz.JobDetailBean"&gt;
  &lt;property name="jobClass" value="example.ExampleJob" /&gt;
  &lt;property name="jobDataAsMap"&gt;
    &lt;map&gt;
      &lt;entry key="timeout" value="5" /&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The job detail bean has all information it needs to run the job (<code class="class">ExampleJob</code>).
The timeout is specified in the job data map.
The job data map is available through the <code class="class">JobExecutionContext</code> (passed to you at execution time), but the <code class="class">JobDetailBean</code> also maps the properties from the job data map to properties of the actual job.
So in this case, if the <code class="class">ExampleJob</code> contains a property named <code>timeout</code>, the <code class="class">JobDetailBean</code> will automatically apply it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package example;

public class ExampleJob extends QuartzJobBean {

  private int timeout;

  /**
   * Setter called after the ExampleJob is instantiated
   * with the value from the JobDetailBean (5)
   */
  public void setTimeout(int timeout) {
    this.timeout = timeout;
  }

  protected void executeInternal(JobExecutionContext ctx) throws JobExecutionException {
      // do the actual work
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All additional settings from the job detail bean are of course available to you as well.</p>
</div>
<div class="paragraph">
<p><em>Note: Using the <code>name</code> and
      <code>group</code> properties, you can modify the name and the
      group of the job, respectively. By default, the name of the job matches
      the bean name of the job detail bean (in the example above, this is
      <code>exampleJob</code>).</em></p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-code-class-class-methodinvokingjobdetailfactorybean-code"><a class="anchor" href="#using-the-code-class-class-methodinvokingjobdetailfactorybean-code"></a>Using the <code class="class">MethodInvokingJobDetailFactoryBean</code></h3>
<div class="paragraph">
<p>Often you just need to invoke a method on a specific object.
Using the <code class="class">MethodInvokingJobDetailFactoryBean</code> you can do exactly this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="jobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"&gt;
  &lt;property name="targetObject" ref="exampleBusinessObject" /&gt;
  &lt;property name="targetMethod" value="doIt" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will result in the <code>doIt</code> method being called on the <code>exampleBusinessObject</code> method (see below):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ExampleBusinessObject {

  // properties and collaborators

  public void doIt() {
    // do the actual work
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;bean id="exampleBusinessObject" class="examples.ExampleBusinessObject"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code class="class">MethodInvokingJobDetailFactoryBean</code>, you don&#8217;t need to create one-line jobs that just invoke a method, and you only need to create the actual business object and wire up the detail object.</p>
</div>
<div class="paragraph">
<p>By default, Quartz Jobs are stateless, resulting in the possibility of jobs interfering with each other.
If you specify two triggers for the same <code class="class">JobDetail</code>, it might be possible that before the first job has finished, the second one will start.
If <code class="class">JobDetail</code> classes implement the <code class="interface">Stateful</code> interface, this won&#8217;t happen.
The second job will not start before the first one has finished.
To make jobs resulting from the <code class="class">MethodInvokingJobDetailFactoryBean</code> non-concurrent, set the <code>concurrent</code> flag to <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
&lt;bean id="jobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"&gt;
  &lt;property name="targetObject" ref="exampleBusinessObject" /&gt;
  &lt;property name="targetMethod" value="doIt" /&gt;
  &lt;property name="concurrent" value="false" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
By default, jobs will run in a concurrent fashion.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="wiring-up-jobs-using-triggers-and-the-code-class-class-schedulerfactorybean-code"><a class="anchor" href="#wiring-up-jobs-using-triggers-and-the-code-class-class-schedulerfactorybean-code"></a>Wiring up jobs using triggers and the <code class="class">SchedulerFactoryBean</code></h3>
<div class="paragraph">
<p>We&#8217;ve created job details and jobs.
We&#8217;ve also reviewed the convenience bean that allows you to invoke a method on a specific object.
Of course, we still need to schedule the jobs themselves.
This is done using triggers and a <code class="class">SchedulerFactoryBean</code>.
Several triggers are available within Quartz and Spring offers two Quartz <code class="interface">FactoryBean</code> implementations with convenient defaults: <code class="class">CronTriggerFactoryBean</code> and <code class="class">SimpleTriggerFactoryBean</code>.</p>
</div>
<div class="paragraph">
<p>Triggers need to be scheduled.
Spring offers a <code class="class">SchedulerFactoryBean</code> that exposes triggers to be set as properties.
<code class="class">SchedulerFactoryBean</code> schedules the actual jobs with those triggers.</p>
</div>
<div class="paragraph">
<p>Find below a couple of examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="simpleTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerFactoryBean"&gt;
    &lt;!-- see the example of method invoking job above --&gt;
    &lt;property name="jobDetail" ref="jobDetail" /&gt;
    &lt;!-- 10 seconds --&gt;
    &lt;property name="startDelay" value="10000" /&gt;
    &lt;!-- repeat every 50 seconds --&gt;
    &lt;property name="repeatInterval" value="50000" /&gt;
&lt;/bean&gt;

&lt;bean id="cronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean"&gt;
    &lt;property name="jobDetail" ref="exampleJob" /&gt;
    &lt;!-- run every morning at 6 AM --&gt;
    &lt;property name="cronExpression" value="0 0 6 * * ?" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we&#8217;ve set up two triggers, one running every 50 seconds with a starting delay of 10 seconds and one every morning at 6 AM. To finalize everything, we need to set up the <code class="class">SchedulerFactoryBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean class="org.springframework.scheduling.quartz.SchedulerFactoryBean"&gt;
    &lt;property name="triggers"&gt;
        &lt;list&gt;
            &lt;ref bean="cronTrigger" /&gt;
            &lt;ref bean="simpleTrigger" /&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>More properties are available for the <code class="class">SchedulerFactoryBean</code> for you to set, such as the calendars used by the job details, properties to customize Quartz with, etc.
Have a look at the &lt;&lt;,SchedulerFactoryBean
      Javadoc&gt;&gt; for more information.</p>
</div>
</div>
</div>
</div>
<h1 id="dynamic-language-support" class="sect0"><a class="anchor" href="#dynamic-language-support"></a>Dynamic language support</h1>
<div class="sect1">
<h2 id="introduction-14"><a class="anchor" href="#introduction-14"></a>Introduction</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">Why only these languages?</div>
<div class="literalblock">
<div class="content">
<pre>The supported languages were chosen because a) the languages have a lot of traction in the Java enterprise community, b) no requests were made for other languages within the Spring 2.0 development timeframe, and c) the Spring developers were most familiar with them.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> There is nothing stopping the inclusion of further languages though.
If you want to see support for &lt;_insert your favourite dynamic language here_&gt;, you can always raise an issue on Spring's &lt;&lt;,JIRA&gt;&gt; page (or implement such support yourself).</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Spring 2.0 introduces comprehensive support for using classes and objects that have been defined using a dynamic language (such as JRuby) with Spring.
This support allows you to write any number of classes in a supported dynamic language, and have the Spring container transparently instantiate, configure and dependency inject the resulting objects.</p>
</div>
<div class="paragraph">
<p>The dynamic languages currently supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JRuby 0.9 / 1.0</p>
</li>
<li>
<p>Groovy 1.0 / 1.5</p>
</li>
<li>
<p>BeanShell 2.0</p>
<div class="literalblock">
<div class="content">
<pre>Fully working examples of where this dynamic language support can be immediately useful are described in &lt;&lt;dynamic-language-scenarios&gt;&gt;.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _Note:_ Only the specific versions as listed above are supported in Spring 2.5.
In particular, JRuby 1.1 (which introduced many incompatible API changes) is _not_ supported at this point of time.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-first-example"><a class="anchor" href="#a-first-example"></a>A first example</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> This bulk of this chapter is concerned with describing the dynamic language support in detail.
Before diving into all of the ins and outs of the dynamic language support, let's look at a quick example of a bean defined in a dynamic language.
The dynamic language for this first bean is Groovy (the basis of this example was taken from the Spring test suite, so if you want to see equivalent examples in any of the other supported languages, take a look at the source code).</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Find below the [interface]`Messenger` interface that the Groovy bean is going to be implementing, and note that this interface is defined in plain Java.
Dependent objects that are injected with a reference to the [interface]`Messenger` won't know that the underlying implementation is a Groovy script.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.scripting;

public interface Messenger {

    String getMessage();
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Here is the definition of a class that has a dependency on the [interface]`Messenger` interface.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.scripting;

public class DefaultBookingService implements BookingService {

    private Messenger messenger;

    public void setMessenger(Messenger messenger) {
        this.messenger = messenger;
    }

    public void processBooking() {
        // use the injected Messenger object...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an implementation of the <code class="interface">Messenger</code> interface in Groovy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// from the file 'Messenger.groovy'
package org.springframework.scripting.groovy;

// import the Messenger interface (written in Java) that is to be implemented
import org.springframework.scripting.Messenger

// define the implementation in Groovy
class GroovyMessenger implements Messenger {

    String message
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Finally, here are the bean definitions that will effect the injection of the Groovy-defined [interface]`Messenger` implementation into an instance of the [class]`DefaultBookingService` class.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="literalblock">
<div class="content">
<pre> To use the custom dynamic language tags to define dynamic-language-backed beans, you need to have the XML Schema preamble at the top of your Spring XML configuration file.
You also need to be using a Spring [interface]`ApplicationContext` implementation as your IoC container.
Using the dynamic-language-backed beans with a plain [interface]`BeanFactory` implementation is supported, but you have to manage the plumbing of the Spring internals to do so.</pre>
</div>
</div>
<div class="paragraph">
<p>For more information on schema-based configuration, see <a href="#xsd-config">[xsd-config]</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd"&gt;

    &lt;!-- this is the bean definition for the Groovy-backed Messenger implementation --&gt;
    &lt;lang:groovy id="messenger" script-source="classpath:Messenger.groovy"&gt;
        &lt;lang:property name="message" value="I Can Do The Frug" /&gt;
    &lt;/lang:groovy&gt;

    &lt;!-- an otherwise normal bean that will be injected by the Groovy-backed Messenger --&gt;
    &lt;bean id="bookingService" class="x.y.DefaultBookingService"&gt;
        &lt;property name="messenger" ref="messenger" /&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The `bookingService` bean (a [class]`DefaultBookingService`) can now use its private `messenger` member variable as normal because the [interface]`Messenger` instance that was injected into it _is_ a [interface]`Messenger` instance.
There is nothing special going on here, just plain Java and plain Groovy.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Hopefully the above XML snippet is self-explanatory, but don't worry unduly if it isn't.
Keep reading for the in-depth detail on the whys and wherefores of the above configuration.</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="defining-beans-that-are-backed-by-dynamic-languages"><a class="anchor" href="#defining-beans-that-are-backed-by-dynamic-languages"></a>Defining beans that are backed by dynamic languages</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>This section describes exactly how you define Spring managed beans in any of the supported dynamic languages.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Please note that this chapter does not attempt to explain the syntax and idioms of the supported dynamic languages.
For example, if you want to use Groovy to write certain of the classes in your application, then the assumption is that you already know Groovy.
If you need further details about the dynamic languages themselves, please consult &lt;&lt;dynamic-language-resources&gt;&gt; at the end of this chapter.</pre>
</div>
</div>
<div class="sect2">
<h3 id="common-concepts"><a class="anchor" href="#common-concepts"></a>Common concepts</h3>
<div class="paragraph">
<p>The steps involved in using dynamic-language-backed beans are as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Write the test for the dynamic language source code (naturally)</p>
</li>
<li>
<p><em>Then</em> write the dynamic language source code itself :)</p>
</li>
<li>
<p>Define your dynamic-language-backed beans using the appropriate <code>&lt;lang:language/&gt;</code> element in the XML configuration (you can of course define such beans programmatically using the Spring API - although you will have to consult the source code for directions on how to do this as this type of advanced configuration is not covered in this chapter).
Note this is an iterative step.
You will need at least one bean definition per dynamic language source file (although the same dynamic language source file can of course be referenced by multiple bean definitions).</p>
<div class="literalblock">
<div class="content">
<pre> The first two steps (testing and writing your dynamic language source files) are beyond the scope of this chapter.
Refer to the language specification and / or reference manual for your chosen dynamic language and crack on with developing your dynamic language source files.
You _will_ first want to read the rest of this chapter though, as Spring's dynamic language support does make some (small) assumptions about the contents of your dynamic language source files.</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="the-code-lang-language-code-element"><a class="anchor" href="#the-code-lang-language-code-element"></a>The <code>&lt;lang:language/&gt;</code> element</h4>
<div class="sidebarblock">
<div class="content">
<div class="title">XML Schema</div>
<div class="literalblock">
<div class="content">
<pre>All of the configuration examples in this chapter make use of the new XML Schema support that was added in Spring 2.0.</pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to forego the use of XML Schema and stick with the old-style DTD based validation of your Spring XML files, but then you lose out on the convenience offered by the <code>&lt;lang:language/&gt;</code> element.
See the Spring test suite for examples of the older style configuration that doesn&#8217;t require XML Schema-based validation (it is quite verbose and doesn&#8217;t hide any of the underlying Spring implementation from you).</p>
</div>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The final step involves defining dynamic-language-backed bean definitions, one for each bean that you want to configure (this is no different from normal JavaBean configuration).
However, instead of specifying the fully qualified classname of the class that is to be instantiated and configured by the container, you use the `&lt;lang:language/&gt;` element to define the dynamic language-backed bean.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Each of the supported languages has a corresponding `&lt;lang:language/&gt;` element:</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;lang:jruby/&gt;</code> (JRuby)</p>
</li>
<li>
<p><code>&lt;lang:groovy/&gt;</code> (Groovy)</p>
</li>
<li>
<p><code>&lt;lang:bsh/&gt;</code> (BeanShell)</p>
<div class="literalblock">
<div class="content">
<pre>The exact attributes and child elements that are available for configuration depends on exactly which language the bean has been defined in (the language-specific sections below provide the full lowdown on this).</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="refreshable-beans"><a class="anchor" href="#refreshable-beans"></a>Refreshable beans</h4>
<div class="literalblock">
<div class="content">
<pre>One of the (if not _the_) most compelling value adds of the dynamic language support in Spring is the  feature.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>A refreshable bean is a dynamic-language-backed bean that with a small amount of configuration, a dynamic-language-backed bean can monitor changes in its underlying source file resource, and then reload itself when the dynamic language source file is changed (for example when a developer edits and saves changes to the file on the filesystem).</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> This allows a developer to deploy any number of dynamic language source files as part of an application, configure the Spring container to create beans backed by dynamic language source files (using the mechanisms described in this chapter), and then later, as requirements change or some other external factor comes into play, simply edit a dynamic language source file and have any change they make reflected in the bean that is backed by the changed dynamic language source file.
There is no need to shut down a running application (or redeploy in the case of a web application).
The dynamic-language-backed bean so amended will pick up the new state and logic from the changed dynamic language source file.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Please note that this feature is <em>off</em> by default.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre> Let's take a look at an example to see just how easy it is to start using refreshable beans.
To _turn on_ the refreshable beans feature, you simply have to specify exactly _one_ additional attribute on the `&lt;lang:language/&gt;` element of your bean definition.
So if we stick with &lt;&lt;dynamic-language-a-first-example,the example&gt;&gt; from earlier in this chapter, here's what we would change in the Spring XML configuration to effect refreshable beans:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

    &lt;!-- this bean is now 'refreshable' due to the presence of the 'refresh-check-delay' attribute --&gt;
    &lt;lang:groovy id="messenger"
          refresh-check-delay="5000" &lt;!-- switches refreshing on with 5 seconds between checks --&gt;
          script-source="classpath:Messenger.groovy"&gt;
        &lt;lang:property name="message" value="I Can Do The Frug" /&gt;
    &lt;/lang:groovy&gt;

    &lt;bean id="bookingService" class="x.y.DefaultBookingService"&gt;
        &lt;property name="messenger" ref="messenger" /&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> That really is all you have to do.
The `'refresh-check-delay'` attribute defined on the `'messenger'` bean definition is the number of milliseconds after which the bean will be refreshed with any changes made to the underlying dynamic language source file.
You can turn off the refresh behavior by assigning a negative value to the `'refresh-check-delay'` attribute.
Remember that, by default, the refresh behavior is disabled.
If you don't want the refresh behavior, then simply don't define the attribute.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> If we then run the following application we can exercise the refreshable feature; please do excuse the _'jumping-through-hoops-to-pause-the-execution'_ shenanigans in this next slice of code.
The `System.in.read()` call is only there so that the execution of the program pauses while I (the author) go off and edit the underlying dynamic language source file so that the refresh will trigger on the dynamic-language-backed bean when the program resumes execution.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.scripting.Messenger;

public final class Boot {

    public static void main(final String[] args) throws Exception {

        ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");
        Messenger messenger = (Messenger) ctx.getBean("messenger");
        System.out.println(messenger.getMessage());
        // pause execution while I go off and make changes to the source file...
        System.in.read();
        System.out.println(messenger.getMessage());
    }
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Let's assume then, for the purposes of this example, that all calls to the `getMessage()` method of [interface]`Messenger` implementations have to be changed such that the message is surrounded by quotes.
Below are the changes that I (the author) make to the [file]`Messenger.groovy` source file when the execution of the program is paused.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.scripting

class GroovyMessenger implements Messenger {

    private String message = "Bingo"

    public String getMessage() {
        // change the implementation to surround the message in quotes
        return "'" + this.message + "'"
    }

    public void setMessage(String message) {
        this.message = message
    }
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> When the program executes, the output before the input pause will be .
After the change to the source file is made and saved, and the program resumes execution, the result of calling the `getMessage()` method on the dynamic-language-backed [interface]`Messenger` implementation will be  (notice the inclusion of the additional quotes).</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> It is important to understand that changes to a script will _not_ trigger a refresh if the changes occur within the window of the `'refresh-check-delay'` value.
It is equally important to understand that changes to the script are _not_ actually 'picked up' until a method is called on the dynamic-language-backed bean.
It is only when a method is called on a dynamic-language-backed bean that it checks to see if its underlying script source has changed.
Any exceptions relating to refreshing the script (such as encountering a compilation error, or finding that the script file has been deleted) will result in a _fatal_ exception being propagated to the calling code.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The refreshable bean behavior described above does _not_ apply to dynamic language source files defined using the `&lt;lang:inline-script/&gt;` element notation (see &lt;&lt;dynamic-language-beans-inline&gt;&gt;).
Additionally, it _only_ applies to beans where changes to the underlying source file can actually be detected; for example, by code that checks the last modified date of a dynamic language source file that exists on the filesystem.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="inline-dynamic-language-source-files"><a class="anchor" href="#inline-dynamic-language-source-files"></a>Inline dynamic language source files</h4>
<div class="literalblock">
<div class="content">
<pre> The dynamic language support can also cater for dynamic language source files that are embedded directly in Spring bean definitions.
More specifically, the `&lt;lang:inline-script/&gt;` element allows you to define dynamic language source immediately inside a Spring configuration file.
An example will perhaps make the inline script feature crystal clear:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;lang:groovy id="messenger"&gt;
    &lt;lang:inline-script&gt;
package org.springframework.scripting.groovy;

import org.springframework.scripting.Messenger

class GroovyMessenger implements Messenger {

    String message
}
    &lt;/lang:inline-script&gt;
    &lt;lang:property name="message" value="I Can Do The Frug" /&gt;
&lt;/lang:groovy&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> If we put to one side the issues surrounding whether it is good practice to define dynamic language source inside a Spring configuration file, the `&lt;lang:inline-script/&gt;` element can be useful in some scenarios.
For instance, we might want to quickly add a Spring [interface]`Validator` implementation to a Spring MVC [interface]`Controller`.
This is but a moment's work using inline source.
(See &lt;&lt;dynamic-language-scenarios-validators&gt;&gt; for such an example.)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Find below an example of defining the source for a JRuby-based bean directly in a Spring XML configuration file using the `inline:` notation.
(Notice the use of the  characters to denote a `'&lt;'` character.
In such a case surrounding the inline source in a `&lt;![CDATA[]]&gt;` region might be better.)</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;lang:jruby id="messenger" script-interfaces="org.springframework.scripting.Messenger"&gt;
    &lt;lang:inline-script&gt;
require 'java'

include_class 'org.springframework.scripting.Messenger'

class RubyMessenger &amp;lt; Messenger

 def setMessage(message)
  @@message = message
 end

 def getMessage
  @@message
 end

end
    &lt;/lang:inline-script&gt;
    &lt;lang:property name="message" value="Hello World!" /&gt;
&lt;/lang:jruby&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="understanding-constructor-injection-in-the-context-of-dynamic-language-backed-beans"><a class="anchor" href="#understanding-constructor-injection-in-the-context-of-dynamic-language-backed-beans"></a>Understanding Constructor Injection in the context of dynamic-language-backed beans</h4>
<div class="literalblock">
<div class="content">
<pre> There is one _very_ important thing to be aware of with regard to Spring's dynamic language support.
Namely, it is not (currently) possible to supply constructor arguments to dynamic-language-backed beans (and hence constructor-injection is not available for dynamic-language-backed beans).
In the interests of making this special handling of constructors and properties 100% clear, the following mixture of code and configuration will _not_ work.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// from the file 'Messenger.groovy'
package org.springframework.scripting.groovy;

import org.springframework.scripting.Messenger

class GroovyMessenger implements Messenger {

    GroovyMessenger() {}

    // this constructor is not available for Constructor Injection
    GroovyMessenger(String message) {
        this.message = message;
    }

    String message

    String anotherMessage
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;lang:groovy id="badMessenger"
    script-source="classpath:Messenger.groovy"&gt;

    &lt;!-- this next constructor argument will *not* be injected into the GroovyMessenger --&gt;
    &lt;!--     in fact, this isn't even allowed according to the schema --&gt;
    &lt;constructor-arg value="This will *not* work" /&gt;

    &lt;!-- only property values are injected into the dynamic-language-backed object --&gt;
    &lt;lang:property name="anotherMessage" value="Passed straight through to the dynamic-language-backed object" /&gt;

&lt;/lang&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>In practice this limitation is not as significant as it first appears since setter injection is the injection style favored by the overwhelming majority of developers anyway (let's leave the discussion as to whether that is a good thing to another day).</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jruby-beans"><a class="anchor" href="#jruby-beans"></a>JRuby beans</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">The JRuby library dependencies</div>
<div class="literalblock">
<div class="content">
<pre>The JRuby scripting support in Spring requires the following libraries to be on the classpath of your application.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="file">jruby.jar</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>From the JRuby homepage&#8230;</p>
</div>
<div class="literalblock">
<div class="content">
<pre> In keeping with the Spring philosophy of offering choice, Spring's dynamic language support also supports beans defined in the JRuby language.
The JRuby language is based on the quite intuitive Ruby language, and has support for inline regular expressions, blocks (closures), and a whole host of other features that do make solutions for some domain problems a whole lot easier to develop.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>The implementation of the JRuby dynamic language support in Spring is interesting in that what happens is this: Spring creates a JDK dynamic proxy implementing all of the interfaces that are specified in the `'script-interfaces'` attribute value of the `&lt;lang:ruby&gt;` element (this is why you _must_ supply at least one interface in the value of the attribute, and (accordingly) program to interfaces when using JRuby-backed beans).</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Let us look at a fully working example of using a JRuby-based bean.
Here is the JRuby implementation of the [interface]`Messenger` interface that was defined earlier in this chapter (for your convenience it is repeated below).</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint ruby language-ruby"><code>package org.springframework.scripting;

public interface Messenger {

    String getMessage();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint ruby language-ruby"><code>require 'java'

class RubyMessenger
    include org.springframework.scripting.Messenger

    def setMessage(message)
        @@message = message
    end

    def getMessage
        @@message
    end
end

# this last line is not essential (but see below)
RubyMessenger.new</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>And here is the Spring XML that defines an instance of the [class]`RubyMessenger` JRuby bean.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;lang:jruby id="messageService"
            script-interfaces="org.springframework.scripting.Messenger"
            script-source="classpath:RubyMessenger.rb"&gt;

    &lt;lang:property name="message" value="Hello World!" /&gt;

&lt;/lang:jruby&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Take note of the last line of that JRuby source (`'RubyMessenger.new'`).
When using JRuby in the context of Spring's dynamic language support, you are encouraged to instantiate and return a new instance of the JRuby class that you want to use as a dynamic-language-backed bean as the result of the execution of your JRuby source.
You can achieve this by simply instantiating a new instance of your JRuby class on the last line of the source file like so:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint ruby language-ruby"><code>require 'java'

include_class 'org.springframework.scripting.Messenger'

# class definition same as above...

# instantiate and return a new instance of the RubyMessenger class
RubyMessenger.new</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> If you forget to do this, it is not the end of the world; this will however result in Spring having to trawl (reflectively) through the type representation of your JRuby class looking for a class to instantiate.
In the grand scheme of things this will be so fast that you'll never notice it, but it is something that can be avoided by simply having a line such as the one above as the last line of your JRuby script.
If you don't supply such a line, or if Spring cannot find a JRuby class in your script to instantiate then an opaque [class]`ScriptCompilationException` will be thrown immediately after the source is executed by the JRuby interpreter.
The key text that identifies this as the root cause of an exception can be found immediately below (so if your Spring container throws the following exception when creating your dynamic-language-backed bean and the following text is there in the corresponding stacktrace, this will hopefully allow you to identify and then easily rectify the issue):</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> To rectify this, simply instantiate a new instance of whichever class you want to expose as a JRuby-dynamic-language-backed bean (as shown above).
Please also note that you can actually define as many classes and objects as you want in your JRuby script; what is important is that the source file as a whole must return an object (for Spring to configure).</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>See &lt;&lt;dynamic-language-scenarios&gt;&gt; for some scenarios where you might want to use JRuby-based beans.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="groovy-beans"><a class="anchor" href="#groovy-beans"></a>Groovy beans</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">The Groovy library dependencies</div>
<div class="literalblock">
<div class="content">
<pre>The Groovy scripting support in Spring requires the following libraries to be on the classpath of your application.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="file">groovy-1.5.5.jar</code></p>
</li>
<li>
<p><code class="file">asm-2.2.2.jar</code></p>
</li>
<li>
<p><code class="file">antlr-2.7.6.jar</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>From the Groovy homepage&#8230;</p>
</div>
<div class="literalblock">
<div class="content">
<pre> If you have read this chapter straight from the top, you will already have &lt;&lt;dynamic-language-a-first-example,seen an example&gt;&gt; of a Groovy-dynamic-language-backed bean.
Let's look at another example (again using an example from the Spring test suite).</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.scripting;

public interface Calculator {

    int add(int x, int y);
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Here is an implementation of the [interface]`Calculator` interface in Groovy.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// from the file 'calculator.groovy'
package org.springframework.scripting.groovy

class GroovyCalculator implements Calculator {

    int add(int x, int y) {
        x + y
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;-- from the file 'beans.xml' --&gt;
&lt;beans&gt;
    &lt;lang:groovy id="calculator" script-source="classpath:calculator.groovy"/&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Lastly, here is a small application to exercise the above configuration.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.scripting;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class Main {

    public static void Main(String[] args) {
        ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");
        Calculator calc = (Calculator) ctx.getBean("calculator");
        System.out.println(calc.add(2, 8));
    }
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The resulting output from running the above program will be (unsurprisingly) .
(Exciting example, huh? Remember that the intent is to illustrate the concept.
Please consult the dynamic language showcase project for a more complex example, or indeed &lt;&lt;dynamic-language-scenarios&gt;&gt; later in this chapter).</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> It is important that you _do not_ define more than one class per Groovy source file.
While this is perfectly legal in Groovy, it is (arguably) a bad practice: in the interests of a consistent approach, you should (in the opinion of this author) respect the standard Java conventions of one (public) class per source file.</pre>
</div>
</div>
<div class="sect3">
<h4 id="customising-groovy-objects-via-a-callback"><a class="anchor" href="#customising-groovy-objects-via-a-callback"></a>Customising Groovy objects via a callback</h4>
<div class="literalblock">
<div class="content">
<pre> The [interface]`GroovyObjectCustomizer` interface is a callback that allows you to hook additional creation logic into the process of creating a Groovy-backed bean.
For example, implementations of this interface could invoke any required initialization method(s), or set some default property values, or specify a custom [class]`MetaClass`.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface GroovyObjectCustomizer {

   void customize(GroovyObject goo);
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The Spring Framework will instantiate an instance of your Groovy-backed bean, and will then pass the created [interface]`GroovyObject` to the specified [interface]`GroovyObjectCustomizer` if one has been defined.
You can do whatever you like with the supplied [interface]`GroovyObject` reference: it is expected that the setting of a custom [class]`MetaClass` is what most folks will want to do with this callback, and you can see an example of doing that below.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public final class SimpleMethodTracingCustomizer implements GroovyObjectCustomizer {

   public void customize(GroovyObject goo) {
      DelegatingMetaClass metaClass = new DelegatingMetaClass(goo.getMetaClass()) {

         public Object invokeMethod(Object object, String methodName, Object[] arguments) {
            System.out.println("Invoking '" + methodName + "'.");
            return super.invokeMethod(object, methodName, arguments);
         }
      };
      metaClass.initialize();
      goo.setMetaClass(metaClass);
   }
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> A full discussion of meta-programming in Groovy is beyond the scope of the Spring reference manual.
Consult the relevant section of the Groovy reference manual, or do a search online: there are plenty of articles concerning this topic.
Actually making use of a [interface]`GroovyObjectCustomizer` is easy if you are using the Spring 2.0 namespace support.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- define the GroovyObjectCustomizer just like any other bean --&gt;
&lt;bean id="tracingCustomizer" class="example.SimpleMethodTracingCustomizer" /&gt;

   &lt;!-- ... and plug it into the desired Groovy bean via the 'customizer-ref' attribute --&gt;
   &lt;lang:groovy id="calculator"
      script-source="classpath:org/springframework/scripting/groovy/Calculator.groovy"
      customizer-ref="tracingCustomizer" /&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>If you are not using the Spring 2.0 namespace support, you can still use the [interface]`GroovyObjectCustomizer` functionality.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="calculator" class="org.springframework.scripting.groovy.GroovyScriptFactory"&gt;
      &lt;constructor-arg value="classpath:org/springframework/scripting/groovy/Calculator.groovy"/&gt;
      &lt;!-- define the GroovyObjectCustomizer (as an inner bean) --&gt;
      &lt;constructor-arg&gt;
         &lt;bean id="tracingCustomizer" class="example.SimpleMethodTracingCustomizer" /&gt;
      &lt;/constructor-arg&gt;
&lt;/bean&gt;

&lt;bean class="org.springframework.scripting.support.ScriptFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beanshell-beans"><a class="anchor" href="#beanshell-beans"></a>BeanShell beans</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">The BeanShell library dependencies</div>
<div class="literalblock">
<div class="content">
<pre>The BeanShell scripting support in Spring requires the following libraries to be on the classpath of your application.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="file">bsh-2.0b4.jar</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>From the BeanShell homepage&#8230;</p>
</div>
<div class="literalblock">
<div class="content">
<pre> In contrast to Groovy, BeanShell-backed bean definitions require some (small) additional configuration.
The implementation of the BeanShell dynamic language support in Spring is interesting in that what happens is this: Spring creates a JDK dynamic proxy implementing all of the interfaces that are specified in the `'script-interfaces'` attribute value of the `&lt;lang:bsh&gt;` element (this is why you _must_ supply at least one interface in the value of the attribute, and (accordingly) program to interfaces when using BeanShell-backed beans).
This means that every method call on a BeanShell-backed object is going through the JDK dynamic proxy invocation mechanism.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Let's look at a fully working example of using a BeanShell-based bean that implements the [interface]`Messenger` interface that was defined earlier in this chapter (repeated below for your convenience).</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>package org.springframework.scripting;

public interface Messenger {

    String getMessage();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the BeanShell <em>implementation</em> (the term is used loosely here) of the <code class="interface">Messenger</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>String message;

String getMessage() {
    return message;
}

void setMessage(String aMessage) {
    message = aMessage;
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>And here is the Spring XML that defines an 'instance' of the above 'class' (again, the term is used very loosely here).</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;lang:bsh id="messageService" script-source="classpath:BshMessenger.bsh"
    script-interfaces="org.springframework.scripting.Messenger"&gt;

    &lt;lang:property name="message" value="Hello World!" /&gt;
&lt;/lang:bsh&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#dynamic-language-scenarios">[dynamic-language-scenarios]</a> for some scenarios where you might want to use BeanShell-based beans.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scenarios"><a class="anchor" href="#scenarios"></a>Scenarios</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre> The possible scenarios where defining Spring managed beans in a scripting language would be beneficial are, of course, many and varied.
This section describes two possible use cases for the dynamic language support in Spring.</pre>
</div>
</div>
<div class="sect2">
<h3 id="scripted-spring-mvc-controllers"><a class="anchor" href="#scripted-spring-mvc-controllers"></a>Scripted Spring MVC Controllers</h3>
<div class="literalblock">
<div class="content">
<pre> One group of classes that may benefit from using dynamic-language-backed beans is that of Spring MVC controllers.
In pure Spring MVC applications, the  navigational flow through a web application is to a large extent determined by code encapsulated within your Spring MVC controllers.
As the navigational flow and other presentation layer logic of a web application needs to be updated to respond to support issues or changing business requirements, it may well be easier to effect any such required changes  by editing one or more dynamic language source files and seeing those changes being immediately reflected in the state of a running application.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Remember that in the lightweight architectural model espoused by projects such as Spring, you are typically aiming to have a really _thin_ presentation layer, with all the meaty business logic of an application being contained in the domain and service layer classes.
Developing Spring MVC controllers as dynamic-language-backed beans allows you to change presentation layer logic by simply editing and saving text files; any changes to such dynamic language source files will (depending on the configuration) automatically be reflected in the beans that are backed by dynamic language source files.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
In order to effect this automatic <em>pickup</em> of any changes to dynamic-language-backed beans, you will have had to enable the <em>refreshable beans</em> functionality.
See <a href="#dynamic-language-refreshable-beans">[dynamic-language-refreshable-beans]</a> for a full treatment of this feature.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>Find below an example of an [interface]`org.springframework.web.servlet.mvc.Controller` implemented using the Groovy dynamic language.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>// from the file '/WEB-INF/groovy/FortuneController.groovy'
package org.springframework.showcase.fortune.web

import org.springframework.showcase.fortune.service.FortuneService
import org.springframework.showcase.fortune.domain.Fortune
import org.springframework.web.servlet.ModelAndView
import org.springframework.web.servlet.mvc.Controller

import javax.servlet.http.HttpServletRequest
import javax.servlet.http.HttpServletResponse

class FortuneController implements Controller {

    @Property FortuneService fortuneService

    ModelAndView handleRequest(
            HttpServletRequest request, HttpServletResponse httpServletResponse) {

        return new ModelAndView("tell", "fortune", this.fortuneService.tellFortune())
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;lang:groovy id="fortune"
             refresh-check-delay="3000"
             script-source="/WEB-INF/groovy/FortuneController.groovy"&gt;
    &lt;lang:property name="fortuneService" ref="fortuneService"/&gt;
&lt;/lang:groovy&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scripted-validators"><a class="anchor" href="#scripted-validators"></a>Scripted Validators</h3>
<div class="literalblock">
<div class="content">
<pre> Another area of application development with Spring that may benefit from the flexibility afforded by dynamic-language-backed beans is that of validation.
It _may_ be easier to express complex validation logic using a loosely typed dynamic language (that may also have support for inline regular expressions) as opposed to regular Java.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Again, developing validators as dynamic-language-backed beans allows you to change validation logic by simply editing and saving a simple text file; any such changes will (depending on the configuration) automatically be reflected in the execution of a running application and would not require the restart of an application.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Please note that in order to effect the automatic <em>pickup</em> of any changes to dynamic-language-backed beans, you will have had to enable the <em>refreshable beans</em> feature.
See <a href="#dynamic-language-refreshable-beans">[dynamic-language-refreshable-beans]</a> for a full and detailed treatment of this feature.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre> Find below an example of a Spring [interface]`org.springframework.validation.Validator` implemented using the Groovy dynamic language.
(See &lt;&lt;validator&gt;&gt; for a discussion of the [interface]`Validator` interface.)</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>import org.springframework.validation.Validator
import org.springframework.validation.Errors
import org.springframework.beans.TestBean

class TestBeanValidator implements Validator {

    boolean supports(Class clazz) {
        return TestBean.class.isAssignableFrom(clazz)
    }

    void validate(Object bean, Errors errors) {
        if(bean.name?.trim()?.size() &gt; 0) {
            return
        }
        errors.reject("whitespace", "Cannot be composed wholly of whitespace.")
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bits-and-bobs"><a class="anchor" href="#bits-and-bobs"></a>Bits and bobs</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>This last section contains some bits and bobs related to the dynamic language support.</pre>
</div>
</div>
<div class="sect2">
<h3 id="aop-advising-scripted-beans"><a class="anchor" href="#aop-advising-scripted-beans"></a>AOP - advising scripted beans</h3>
<div class="literalblock">
<div class="content">
<pre> It is possible to use the Spring AOP framework to advise scripted beans.
The Spring AOP framework actually is unaware that a bean that is being advised might be a scripted bean, so all of the AOP use cases and functionality that you may be using or aim to use will work with scripted beans.
There is just one (small) thing that you need to be aware of when advising scripted beans...
you cannot use class-based proxies, you must use &lt;&lt;aop-proxying,interface-based proxies&gt;&gt;.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> You are of course not just limited to advising scripted beans...
you can also write aspects themselves in a supported dynamic language and use such beans to advise other Spring beans.
This really would be an advanced use of the dynamic language support though.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scoping"><a class="anchor" href="#scoping"></a>Scoping</h3>
<div class="literalblock">
<div class="content">
<pre> In case it is not immediately obvious, scripted beans can of course be scoped just like any other bean.
The `scope` attribute on the various `&lt;lang:language/&gt;` elements allows you to control the scope of the underlying scripted bean, just as it does with a regular bean.
(The default scope is &lt;&lt;beans-factory-scopes-singleton,singleton&gt;&gt;, just as it is with 'regular' beans.)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Find below an example of using the `scope` attribute to define a Groovy bean scoped as a &lt;&lt;beans-factory-scopes-prototype,prototype&gt;&gt;.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd"&gt;

    &lt;lang:groovy id="messenger" script-source="classpath:Messenger.groovy" scope="prototype"&gt;
        &lt;lang:property name="message" value="I Can Do The RoboCop" /&gt;
    &lt;/lang:groovy&gt;

    &lt;bean id="bookingService" class="x.y.DefaultBookingService"&gt;
        &lt;property name="messenger" ref="messenger" /&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>See &lt;&lt;beans-factory-scopes&gt;&gt; in &lt;&lt;beans&gt;&gt; for a fuller discussion of the scoping support in the Spring Framework.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="further-resources-4"><a class="anchor" href="#further-resources-4"></a>Further Resources</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>Find below links to further resources about the various dynamic languages described in this chapter.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The &lt;&lt;,JRuby&gt;&gt; homepage</p>
</li>
<li>
<p>The &lt;&lt;,Groovy&gt;&gt; homepage</p>
</li>
<li>
<p>The &lt;&lt;,BeanShell&gt;&gt; homepage</p>
<div class="literalblock">
<div class="content">
<pre> Some of the more active members of the Spring community have also added support for a number of additional dynamic languages above and beyond the ones covered in this chapter.
While it is possible that such third party contributions may be added to the list of languages supported by the main Spring distribution, your best bet for seeing if your favourite scripting language is supported is the &lt;&lt;,Spring Modules project&gt;&gt;.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<h1 id="cache-abstraction" class="sect0"><a class="anchor" href="#cache-abstraction"></a>Cache Abstraction</h1>
<div class="sect1">
<h2 id="introduction-15"><a class="anchor" href="#introduction-15"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since version 3.1, Spring Framework provides support for transparently adding caching into an existing Spring application.
Similar to the <a href="#transaction">transaction</a> support, the caching abstraction allows consistent use of various caching solutions with minimal impact on the code.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-the-cache-abstraction"><a class="anchor" href="#understanding-the-cache-abstraction"></a>Understanding the cache abstraction</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">Cache vs Buffer</div>
<div class="paragraph">
<p>The terms "buffer" and "cache" tend to be used interchangeably; note however they represent different things.
A buffer is used traditionally as an intermediate temporary store for data between a fast and a slow entity.
As one party would have to <em>wait</em> for the other affecting performance, the buffer alleviates this by allowing entire blocks of data to move at once rather then in small chunks.
The data is written and read only once from the buffer.
Furthermore, the buffers are <em>visible</em> to at least one party which is aware of it.</p>
</div>
<div class="paragraph">
<p>A cache on the other hand by definition is hidden and neither party is aware that caching occurs.It as well improves performance but does that by allowing the same data to be read multiple times in a fast fashion.</p>
</div>
<div class="paragraph">
<p>A further explanation of the differences between two can be found &lt;&lt;,here&gt;&gt;.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>At its core, the abstraction applies caching to Java methods, reducing thus the number of executions based on the information available in the cache.
That is, each time a <em>targeted</em> method is invoked, the abstraction will apply a caching behavior checking whether the method has been already executed for the given arguments.
If it has, then the cached result is returned without having to execute the actual method; if it has not, then method is executed, the result cached and returned to the user so that, the next time the method is invoked, the cached result is returned.
This way, expensive methods (whether CPU or IO bound) can be executed only once for a given set of parameters and the result reused without having to actually execute the method again.
The caching logic is applied transparently without any interference to the invoker.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
Obviously this approach works only for methods that are guaranteed to return the same output (result) for a given input (or arguments) no matter how many times it is being executed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the cache abstraction, the developer needs to take care of two aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>caching declaration - identify the methods that need to be cached and their policy</p>
</li>
<li>
<p>cache configuration - the backing cache where the data is stored and read from</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that just like other services in Spring Framework, the caching service is an abstraction (not a cache implementation) and requires the use of an actual storage to store the cache data - that is, the abstraction frees the developer from having to write the caching logic but does not provide the actual stores.
There are two integrations available out of the box, for JDK <code>java.util.concurrent.ConcurrentMap</code> and &lt;&lt;,EhCache&gt;&gt; - see <a href="#cache-plug">[cache-plug]</a> for more information on plugging in other cache stores/providers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="declarative-annotation-based-caching"><a class="anchor" href="#declarative-annotation-based-caching"></a>Declarative annotation-based caching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For caching declaration, the abstraction provides two Java annotations: <code>@Cacheable</code> and <code>@CacheEvict</code> which allow methods to trigger cache population or cache eviction.
Let us take a closer look at each annotation:</p>
</div>
<div class="sect2">
<h3 id="code-cacheable-code-annotation"><a class="anchor" href="#code-cacheable-code-annotation"></a><code>@Cacheable</code> annotation</h3>
<div class="paragraph">
<p>As the name implies, <code>@Cacheable</code> is used to demarcate methods that are cacheable - that is, methods for whom the result is stored into the cache so on subsequent invocations (with the same arguments), the value in the cache is returned without having to actually execute the method.
In its simplest form, the annotation declaration requires the name of the cache associated with the annotated method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Cacheable("books")
public Book findBook(ISBN isbn) {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, the method <code>findBook</code> is associated with the cache named <code>books</code>.
Each time the method is called, the cache is checked to see whether the invocation has been already executed and does not have to be repeated.
While in most cases, only one cache is declared, the annotation allows multiple names to be specified so that more then one cache are being used.
In this case, each of the caches will be checked before executing the method - if at least one cache is hit, then the associated value will be returned:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
All the other caches that do not contain the method will be updated as well even though the cached method was not actually executed.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Cacheable({ "books", "isbns" })
public Book findBook(ISBN isbn) {...}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="default-key-generation"><a class="anchor" href="#default-key-generation"></a>Default Key Generation</h4>
<div class="paragraph">
<p>Since caches are essentially key-value stores, each invocation of a cached method needs to be translated into a suitable key for cache access.
Out of the box, the caching abstraction uses a simple <code class="interface">KeyGenerator</code> based on the following algorithm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no params are given, return 0.</p>
</li>
<li>
<p>If only one param is given, return that instance.</p>
</li>
<li>
<p>If more the one param is given, return a key computed from the hashes of all parameters.</p>
<div class="literalblock">
<div class="content">
<pre> This approach works well for objects with _natural keys_ as long as the `hashCode()` reflects that.
If that is not the case then for distributed or persistent environments, the strategy needs to be changed as the objects hashCode is not preserved.
In fact, depending on the JVM implementation or running conditions, the same hashCode can be reused for different objects, in the same VM instance.</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To provide a different <em>default</em> key generator, one needs to implement the <code class="interface">org.springframework.cache.KeyGenerator</code> interface.
Once configured, the generator will be used for each declaration that does not specify its own key generation strategy (see below).</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-key-generation-declaration"><a class="anchor" href="#custom-key-generation-declaration"></a>Custom Key Generation Declaration</h4>
<div class="paragraph">
<p>Since caching is generic, it is quite likely the target methods have various signatures that cannot be simply mapped on top of the cache structure.
This tends to become obvious when the target method has multiple arguments out of which only some are suitable for caching (while the rest are used only by the method logic).
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Cacheable("books")
public Book findBook(ISBN isbn, boolean checkWarehouse, boolean includeUsed</code></pre>
</div>
</div>
<div class="paragraph">
<p>At first glance, while the two <code>boolean</code> arguments influence the way the book is found, they are no use for the cache.
Further more what if only one of the two is important while the other is not?</p>
</div>
<div class="paragraph">
<p>For such cases, the <code>@Cacheable</code> annotation allows the user to specify how the key is generated through its <code>key</code> attribute.
The developer can use <a href="#expressions">SpEL</a> to pick the arguments of interest (or their nested properties), perform operations or even invoke arbitrary methods without having to write any code or implement any interface.
This is the recommended approach over the <a href="#cache-annotations-cacheable-default-key">default</a> generator since methods tend to be quite different in signatures as the code base grows; while the default strategy might work for some methods, it rarely does for all methods.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Below are some examples of various SpEL declarations - if you are not familiar with it, do yourself a favour and read &lt;&lt;expressions&gt;&gt;:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>
@Cacheable(value="books", key="#isbn"
public Book findBook(ISBN isbn, boolean checkWarehouse, boolean includeUsed)


@Cacheable(value="books", key="#isbn.rawNumber")
public Book findBook(ISBN isbn, boolean checkWarehouse, boolean includeUsed)


@Cacheable(value="books", key="T(someType).hash(#isbn)")
public Book findBook(ISBN isbn, boolean checkWarehouse, boolean includeUsed)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippets above, show how easy it is to select a certain argument, one of its properties or even an arbitrary (static) method.</p>
</div>
</div>
<div class="sect3">
<h4 id="conditional-caching"><a class="anchor" href="#conditional-caching"></a>Conditional caching</h4>
<div class="paragraph">
<p>Sometimes, a method might not be suitable for caching all the time (for example, it might depend on the given arguments).
The cache annotations support such functionality through the <code>conditional</code> parameter which takes a <code>SpEL</code> expression that is evaluated to either <code>true</code> or <code>false</code>.
If <code>true</code>, the method is cached - if not, it behaves as if the method is not cached, that is executed every since time no matter what values are in the cache or what arguments are used.
A quick example - the following method will be cached, only if the argument <code>name</code> has a length shorter then 32:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Cacheable(value="book", condition="#name.length &lt; 32")
public Book findBook(String name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition the <code>conditional</code> parameter, the <code>unless</code> parameter can be used to veto the adding of a value to the cache.
Unlike <code>conditional</code>, <code>unless</code> <code>SpEL</code> expressions are evalulated <em>after</em> the method has been called.
Expanding on the previous example - perhaps we only want to cache paperback books:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Cacheable(value="book", condition="#name.length &lt; 32", unless="#result.hardback")
public Book findBook(String name)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="available-caching-code-spel-code-evaluation-context"><a class="anchor" href="#available-caching-code-spel-code-evaluation-context"></a>Available caching <code>SpEL</code> evaluation context</h4>
<div class="paragraph">
<p>Each <code>SpEL</code> expression evaluates again a dedicated <code>context</code>.
In addition to the build in parameters, the framework provides dedicated caching related metadata such as the argument names.
The next table lists the items made available to the context so one can use them for key and conditional(see next section) computations:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 22. Cache SpEL available metadata</caption>
<colgroup>
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">#root.methodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#root.method.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#root.target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#root.targetClass</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">#root.args[0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#root.caches[0].name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">argument name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of any of the method argument. If for some reason the names are not available (ex: no debug information),
                            the argument names are also available under the a&lt;#arg&gt; where
                            #arg stands for the argument index (starting from 0).</p></td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sect2">
<h3 id="code-cacheput-code-annotation"><a class="anchor" href="#code-cacheput-code-annotation"></a><code>@CachePut</code> annotation</h3>
<div class="paragraph">
<p>For cases where the cache needs to be updated without interfering with the method execution, one can use the <code>@CachePut</code> annotation.
That is, the method will always be executed and its result placed into the cache (according to the <code>@CachePut</code> options).
It supports the same options as <code>@Cacheable</code> and should be used for cache population rather then method flow optimization.</p>
</div>
<div class="paragraph">
<p>Note that using <code>@CachePut</code> and <code>@Cacheable</code> annotations on the same method is generally discouraged because they have different behaviors.
While the latter causes the method execution to be skipped by using the cache, the former forces the execution in order to execute a cache update.
This leads to unexpected behavior and with the exception of specific corner-cases (such as annotations having conditions that exclude them from each other), such declarations should be avoided.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-cacheevict-code-annotation"><a class="anchor" href="#code-cacheevict-code-annotation"></a><code>@CacheEvict</code> annotation</h3>
<div class="paragraph">
<p>The cache abstraction allows not just population of a cache store but also eviction.
This process is useful for removing stale or unused data from the cache.
Opposed to <code>@Cacheable</code>, annotation <code>@CacheEvict</code> demarcates methods that perform cache <em>eviction</em>, that is methods that act as triggers for removing data from the cache.
Just like its sibling, <code>@CacheEvict</code> requires one to specify one (or multiple) caches that are affected by the action, allows a key or a condition to be specified but in addition, features an extra parameter <code>allEntries</code> which indicates whether a cache-wide eviction needs to be performed rather then just an entry one (based on the key):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@CacheEvict(value = "books", allEntries=true)
public void loadBooks(InputStream batch)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This option comes in handy when an entire cache region needs to be cleared out - rather then evicting each entry (which would take a long time since it is inefficient), all the entires are removed in one operation as shown above.
Note that the framework will ignore any key specified in this scenario as it does not apply (the entire cache is evicted not just one entry).</p>
</div>
<div class="paragraph">
<p>One can also indicate whether the eviction should occur after (the default) or before the method executes through the <code>beforeInvocation</code> attribute.
The former provides the same semantics as the rest of the annotations - once the method completes successfully, an action (in this case eviction) on the cache is executed.
If the method does not execute (as it might be cached) or an exception is thrown, the eviction does not occur.
The latter (<code>beforeInvocation=true</code>) causes the eviction to occur always, before the method is invoked - this is useful in cases where the eviction does not need to be tied to the method outcome.</p>
</div>
<div class="paragraph">
<p>It is important to note that void methods can be used with <code>@CacheEvict</code> - as the methods act as triggers, the return values are ignored (as they don&#8217;t interact with the cache) - this is not the case with <code>@Cacheable</code> which adds/update data into the cache and thus requires a result.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-caching-code-annotation"><a class="anchor" href="#code-caching-code-annotation"></a><code>@Caching</code> annotation</h3>
<div class="paragraph">
<p>There are cases when multiple annotations of the same type, such as <code>@CacheEvict</code> or <code>@CachePut</code> need to be specified, for example because the condition or the key expression is different between different caches.
Unfortunately Java does not support such declarations however there is a workaround - using a <em>enclosing</em> annotation, in this case, <code>@Caching</code>.
<code>@Caching</code> allows multiple nested <code>@Cacheable</code>, <code>@CachePut</code> and <code>@CacheEvict</code> to be used on the same method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Caching(evict = { @CacheEvict("primary"), @CacheEvict(value = "secondary", key = "#p0") })
public Book importBooks(String deposit, Date date)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-caching-annotations"><a class="anchor" href="#enable-caching-annotations"></a>Enable caching annotations</h3>
<div class="paragraph">
<p>It is important to note that even though declaring the cache annotations does not automatically triggers their actions - like many things in Spring, the feature has to be declaratively enabled (which means if you ever suspect caching is to blame, you can disable it by removing only one configuration line rather then all the annotations in your code).</p>
</div>
<div class="paragraph">
<p>To enable caching annotations add the annotation <code class="interface">@EnableCaching</code> to one of your <code class="interface">@Configuration</code> classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Configuration
@EnableCaching
public class AppConfig {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively for XML configuration use the <code>cache:annotation-driven</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:cache="http://www.springframework.org/schema/cache"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd"&gt;
    &lt;cache:annotation-driven /&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both the <code>cache:annotation-driven</code> element and <code class="interface">@EnableCaching</code> annotation allow various options to be specified that influence the way the caching behavior is added to the application through AOP. The configuration is intentionally similar with that of <a href="#tx-annotation-driven-settings"><code class="interface">@Transactional</code></a>:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 23. Cache annotation settings</caption>
<colgroup>
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">XML Attribute</th>
<th class="tableblock halign-left valign-top">Annotation Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache-manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A (See CachingConfigurer Javadoc)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of cache manager to use. Only required
                if the name of the cache manager is not
                cacheManager, as in the example
                above.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default mode "proxy" processes annotated
                beans to be proxied using Spring&#8217;s AOP framework (following
                proxy semantics, as discussed above, applying to method calls
                coming in through the proxy only). The alternative mode
                "aspectj" instead weaves the affected classes with Spring&#8217;s
                AspectJ caching aspect, modifying the target class byte
                code to apply to any kind of method call. AspectJ weaving
                requires spring-aspects.jar in the classpath as well as
                load-time weaving (or compile-time weaving) enabled. (See
                 for details on how to set
                up load-time weaving.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy-target-class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyTargetClass</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applies to proxy mode only. Controls what type of
                caching proxies are created for classes annotated with
                the @Cacheable or @CacheEvict annotations.
                If the proxy-target-class attribute is set
                to true, then class-based proxies are
                created. If proxy-target-class is
                false or if the attribute is omitted, then
                standard JDK interface-based proxies are created. (See  for a detailed examination of the
                different proxy types.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the order of the cache advice that
                is applied to beans annotated with
                @Cacheable or @CacheEvict.
                (For more
                information about the rules related to ordering of AOP advice,
                see .) No
                specified ordering means that the AOP subsystem determines the
                order of the advice.</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code>&lt;cache:annotation-driven/&gt;</code> only looks for <code class="interface">@Cacheable/@CacheEvict</code> on beans in the same application context it is defined in.
This means that, if you put <code>&lt;cache:annotation-driven/&gt;</code> in a <code class="interface">WebApplicationContext</code> for a <code class="class">DispatcherServlet</code>, it only checks for <code class="interface">@Cacheable/@CacheEvict</code> beans in your controllers, and not your services.
See <a href="#mvc-servlet">[mvc-servlet]</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Method visibility and <code class="interface">@Cacheable/@CachePut/@CacheEvict</code></div>
<p>[sidebar]When using proxies, you should apply the <code class="interface">@Cache*</code> annotations only to methods with <em>public</em> visibility.
If you do annotate protected, private or package-visible methods with these annotations, no error is raised, but the annotated method does not exhibit the configured caching settings.
Consider the use of AspectJ (see below) if you need to annotate non-public methods as it changes the bytecode itself.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Spring recommends that you only annotate concrete classes (and methods of concrete classes) with the <code class="interface">@Cache*</code> annotation, as opposed to annotating interfaces.
You certainly can place the <code class="interface">@Cache*</code> annotation on an interface (or an interface method), but this works only as you would expect it to if you are using interface-based proxies.
The fact that Java annotations are <em>not inherited from interfaces</em> means that if you are using class-based proxies (<code>proxy-target-class="true"</code>) or the weaving-based aspect (<code>mode="aspectj"</code>), then the caching settings are not recognized by the proxying and weaving infrastructure, and the object will not be wrapped in a caching proxy, which would be decidedly <em>bad</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
In proxy mode (which is the default), only external method calls coming in through the proxy are intercepted.
This means that self-invocation, in effect, a method within the target object calling another method of the target object, will not lead to an actual caching at runtime even if the invoked method is marked with <code class="interface">@Cacheable</code> - considering using the aspectj mode in this case.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="using-custom-annotations"><a class="anchor" href="#using-custom-annotations"></a>Using custom annotations</h3>
<div class="paragraph">
<p>The caching abstraction allows one to use her own annotations to identify what method trigger cache population or eviction.
This is quite handy as a template mechanism as it eliminates the need to duplicate cache annotation declarations (especially useful if the key or condition are specified) or if the foreign imports (<code>org.springframework</code>) are not allowed in your code base.
Similar to the rest of the <a href="#beans-stereotype-annotations">stereotype</a> annotations, both <code>@Cacheable</code> and <code>@CacheEvict</code> can be used as meta-annotations, that is annotations that can annotate other annotations.
To wit, let us replace a common <code>@Cacheable</code> declaration with our own, custom annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.METHOD})
@Cacheable(value=books, key="#isbn")
public @interface SlowService {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above, we have defined our own <code>SlowService</code> annotation which itself is annotated with <code>@Cacheable</code> - now we can replace the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@Cacheable(value="books", key="#isbn")
public Book findBook(ISBN isbn, boolean checkWarehouse, boolean includeUsed)</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>@SlowService
public Book findBook(ISBN isbn, boolean checkWarehouse, boolean includeUsed)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though <code>@SlowService</code> is not a Spring annotation, the container automatically picks up its declaration at runtime and understands its meaning.
Note that as mentioned <a href="#cache-annotation-enable">above</a>, the annotation-driven behavior needs to be enabled.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="declarative-xml-based-caching"><a class="anchor" href="#declarative-xml-based-caching"></a>Declarative XML-based caching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If annotations are not an option (no access to the sources or no external code), one can use XML for declarative caching.
So instead of annotating the methods for caching, one specifies the target method and the caching directives externally (similar to the declarative transaction management <a href="#transaction-declarative-first-example">advice</a>).
The previous example can be translated into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- the service we want to make cacheable --&gt;
&lt;bean id="bookService" class="x.y.service.DefaultBookService"/&gt;

&lt;!-- cache definitions --&gt;
&lt;cache:advice id="cacheAdvice" cache-manager="cacheManager"&gt;
    &lt;cache:caching cache="books"&gt;
        &lt;cache:cacheable method="findBook" key="#isbn"/&gt;
        &lt;cache:cache-evict method="loadBooks" all-entries="true"/&gt;
    &lt;/cache:caching&gt;
&lt;/cache:advice&gt;

&lt;!-- apply the cacheable behavior to all BookService interfaces --&gt;
&lt;aop:config&gt;
    &lt;aop:advisor advice-ref="cacheAdvice" pointcut="execution(* x.y.BookService.*(..))"/&gt;
&lt;/aop:config&gt;
...
// cache manager definition omitted</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the configuration above, the <code>bookService</code> is made cacheable.
The caching semantics to apply are encapsulated in the <code>cache:advice</code> definition which instructs method <code>findBooks</code> to be used for putting data into the cache while method <code>loadBooks</code> for evicting data.
Both definitions are working against the <code>books</code> cache.</p>
</div>
<div class="paragraph">
<p>The <code>aop:config</code> definition applies the cache advice to the appropriate points in the program by using the AspectJ pointcut expression (more information is available in <a href="#aop">[aop]</a>).
In the example above, all methods from the <code class="interface">BookService</code> are considered and the cache advice applied to them.</p>
</div>
<div class="paragraph">
<p>The declarative XML caching supports all of the annotation-based model so moving between the two should be fairly easy - further more both can be used inside the same application.
The XML based approach does not touch the target code however it is inherently more verbose; when dealing with classes with overloaded methods that are targeted for caching, identifying the proper methods does take an extra effort since the <code>method</code> argument is not a good discriminator - in these cases, the AspectJ pointcut can be used to cherry pick the target methods and apply the appropriate caching functionality.
However through XML, it is easier to apply a package/group/interface-wide caching (again due to the AspectJ pointcut) and to create template-like definitions (as we did in the example above by defining the target cache through the <code>cache:definitions ``cache</code> attribute).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-cache-storage"><a class="anchor" href="#configuring-the-cache-storage"></a>Configuring the cache storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Out of the box, the cache abstraction provides integration with two storages - one on top of the JDK <code class="interface">ConcurrentMap</code> and one for &lt;&lt;,ehcache&gt;&gt; library.
To use them, one needs to simply declare an appropriate <code class="interface">CacheManager</code> - an entity that controls and manages [interface]`Cache`s and can be used to retrieve these for storage.</p>
</div>
<div class="sect2">
<h3 id="jdk-code-class-interface-concurrentmap-code-based-code-class-interface-cache-code"><a class="anchor" href="#jdk-code-class-interface-concurrentmap-code-based-code-class-interface-cache-code"></a>JDK <code class="interface">ConcurrentMap</code>-based <code class="interface">Cache</code></h3>
<div class="paragraph">
<p>The JDK-based <code class="interface">Cache</code> implementation resides under <code>org.springframework.cache.concurrent</code> package.
It allows one to use [class]`
        ConcurrentHashMap` as a backing <code class="interface">Cache</code> store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;!-- generic cache manager --&gt;
&lt;bean id="cacheManager" class="org.springframework.cache.support.SimpleCacheManager"&gt;
    &lt;property name="caches"&gt;
    &lt;set&gt;
        &lt;bean class="org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean" p:name="default"/&gt;
        &lt;bean class="org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean" p:name="books"/&gt;
    &lt;/set&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above uses the <code class="class">SimpleCacheManager</code> to create a <code class="interface">CacheManager</code> for the two, nested <code class="interface">Concurrent</code> <code class="interface">Cache</code> implementations named <em>default</em> and <em>books</em>.
Note that the names are configured directly for each cache.</p>
</div>
<div class="paragraph">
<p>As the cache is created by the application, it is bound to its lifecycle, making it suitable for basic use cases, tests or simple applications.
The cache scales well and is very fast but it does not provide any management or persistence capabilities nor eviction contracts.</p>
</div>
</div>
<div class="sect2">
<h3 id="ehcache-based-code-class-interface-cache-code"><a class="anchor" href="#ehcache-based-code-class-interface-cache-code"></a>EhCache-based <code class="interface">Cache</code></h3>
<div class="paragraph">
<p>The EhCache implementation is located under <code>org.springframework.cache.ehcache</code> package.
Again, to use it, one simply needs to declare the appropriate <code class="interface">CacheManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheCacheManager" p:cache-manager-ref="ehcache"/&gt;

&lt;!-- EhCache library setup --&gt;
&lt;bean id="ehcache" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean" p:config-location="ehcache.xml"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This setup bootstraps ehcache library inside Spring IoC (through bean <code>ehcache</code>) which is then wired into the dedicated <code class="interface">CacheManager</code> implementation.
Note the entire ehcache-specific configuration is read from the resource <code>ehcache.xml</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="gemfire-based-code-class-interface-cache-code"><a class="anchor" href="#gemfire-based-code-class-interface-cache-code"></a>GemFire-based <code class="interface">Cache</code></h3>
<div class="paragraph">
<p>GemFire is a memory-oriented/disk-backed, elastically scalable, continuously available, active (with built-in pattern-based subscription notifications), globally replicated database and provides fully-featured edge caching.
For further information on how to use GemFire as a CacheManager (and more), please refer to the &lt;&lt;,Spring GemFire reference documentation&gt;&gt;.</p>
</div>
</div>
<div class="sect2">
<h3 id="dealing-with-caches-without-a-backing-store"><a class="anchor" href="#dealing-with-caches-without-a-backing-store"></a>Dealing with caches without a backing store</h3>
<div class="paragraph">
<p>Sometimes when switching environments or doing testing, one might have cache declarations without an actual backing cache configured.
As this is an invalid configuration, at runtime an exception will be through since the caching infrastructure is unable to find a suitable store.
In situations like this, rather then removing the cache declarations (which can prove tedious), one can wire in a simple, dummy cache that performs no caching - that is, forces the cached methods to be executed every time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="cacheManager" class="org.springframework.cache.support.CompositeCacheManager"&gt;
    &lt;property name="cacheManagers"&gt;&lt;list&gt;
        &lt;ref bean="jdkCache"/&gt;
        &lt;ref bean="gemfireCache"/&gt;
    &lt;/list&gt;&lt;/property&gt;
    &lt;property name="fallbackToNoOpCache" value="true"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CompositeCacheManager</code> above chains multiple <code>CacheManager`s and additionally, through the `fallbackToNoOpCache</code> flag, adds a <em>no op</em> cache that for all the definitions not handled by the configured cache managers.
That is, every cache definition not found in either <code>jdkCache</code> or <code>gemfireCache</code> (configured above) will be handled by the no op cache, which will not store any information causing the target method to be executed every time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plugging-in-different-back-end-caches"><a class="anchor" href="#plugging-in-different-back-end-caches"></a>Plugging-in different back-end caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clearly there are plenty of caching products out there that can be used as a backing store.
To plug them in, one needs to provide a <code class="interface">CacheManager</code> and <code class="interface">Cache</code> implementation since unfortunately there is no available standard that we can use instead.
This may sound harder then it is since in practice, the classes tend to be simple &lt;&lt;,adapter&gt;&gt;s that map the caching abstraction framework on top of the storage API as the <code>ehcache</code> classes can show.
Most <code class="interface">CacheManager</code> classes can use the classes in <code>org.springframework.cache.support</code> package, such as <code class="class">AbstractCacheManager</code> which takes care of the boiler-plate code leaving only the actual <em>mapping</em> to be completed.
We hope that in time, the libraries that provide integration with Spring can fill in this small configuration gap.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-can-i-set-the-ttl-tti-eviction-policy-xxx-feature"><a class="anchor" href="#how-can-i-set-the-ttl-tti-eviction-policy-xxx-feature"></a>How can I set the TTL/TTI/Eviction policy/XXX feature?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Directly through your cache provider.
The cache abstraction is&#8230;
well, an abstraction not a cache implementation.
The solution you are using might support various data policies and different topologies which other solutions do not (take for example the JDK <code>ConcurrentHashMap</code>) - exposing that in the cache abstraction would be useless simply because there would no backing support.
Such functionality should be controlled directly through the backing cache, when configuring it or through its native API.</p>
</div>
</div>
</div>
<h1 id="spring-appendices" class="sect0"><a class="anchor" href="#spring-appendices"></a>Appendices</h1>

<div class="sect1">
<h2 id="classic-spring-usage"><a class="anchor" href="#classic-spring-usage"></a>Appendix A: Classic Spring Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix discusses some classic Spring usage patterns as a reference for developers maintaining legacy Spring applications.
These usage patterns no longer reflect the recommended way of using these features and the current recommended usage is covered in the respective sections of the reference manual.</p>
</div>
<div class="sect1">
<h2 id="classic-orm-usage"><a class="anchor" href="#classic-orm-usage"></a>Classic ORM usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section documents the classic usage patterns that you might encounter in a legacy Spring application.
For the currently recommended usage patterns, please refer to the <a href="#orm">[orm]</a> chapter.</p>
</div>
<div class="sect2">
<h3 id="hibernate-2"><a class="anchor" href="#hibernate-2"></a>Hibernate</h3>
<div class="paragraph">
<p>For the currently recommended usage patterns for Hibernate see <a href="#orm-hibernate">[orm-hibernate]</a></p>
</div>
<div class="sect3">
<h4 id="the-code-class-class-hibernatetemplate-code"><a class="anchor" href="#the-code-class-class-hibernatetemplate-code"></a>The <code class="class">HibernateTemplate</code></h4>
<div class="paragraph">
<p>The basic programming model for templating looks as follows, for methods that can be part of any custom data access object or business service.
There are no restrictions on the implementation of the surrounding object at all, it just needs to provide a Hibernate <code class="interface">SessionFactory</code>.
It can get the latter from anywhere, but preferably as bean reference from a Spring IoC container - via a simple <code class="method">setSessionFactory(..)</code> bean property setter.
The following snippets show a DAO definition in a Spring container, referencing the above defined <code class="interface">SessionFactory</code>, and an example for a DAO method implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl implements ProductDao {

    private HibernateTemplate hibernateTemplate;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.hibernateTemplate = new HibernateTemplate(sessionFactory);
    }

    public Collection loadProductsByCategory(String category) throws DataAccessException {
        return this.hibernateTemplate.find("from test.Product product where product.category=?", category);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="class">HibernateTemplate</code> class provides many methods that mirror the methods exposed on the Hibernate <code class="interface">Session</code> interface, in addition to a number of convenience methods such as the one shown above.
If you need access to the <code class="interface">Session</code> to invoke methods that are not exposed on the <code class="class">HibernateTemplate</code>, you can always drop down to a callback-based approach like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl implements ProductDao {

    private HibernateTemplate hibernateTemplate;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.hibernateTemplate = new HibernateTemplate(sessionFactory);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return this.hibernateTemplate.execute(new HibernateCallback() {

            public Object doInHibernate(Session session) {
                Criteria criteria = session.createCriteria(Product.class);
                criteria.add(Expression.eq("category", category));
                criteria.setMaxResults(6);
                return criteria.list();
            }
        };
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A callback implementation effectively can be used for any Hibernate data access.
<code class="class">HibernateTemplate</code> will ensure that <code class="interface">Session</code> instances are properly opened and closed, and automatically participate in transactions.
The template instances are thread-safe and reusable, they can thus be kept as instance variables of the surrounding class.
For simple single step actions like a single find, load, saveOrUpdate, or delete call, <code class="class">HibernateTemplate</code> offers alternative convenience methods that can replace such one line callback implementations.
Furthermore, Spring provides a convenient <code class="class">HibernateDaoSupport</code> base class that provides a <code class="method">setSessionFactory(..)</code> method for receiving a <code class="interface">SessionFactory</code>, and <code class="method">getSessionFactory()</code> and [method]`getHibernateTemplate()`for use by subclasses.
In combination, this allows for very simple DAO implementations for typical requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl extends HibernateDaoSupport implements ProductDao {

    public Collection loadProductsByCategory(String category) throws DataAccessException {
        return this.getHibernateTemplate().find(
            "from test.Product product where product.category=?", category);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implementing-spring-based-daos-without-callbacks"><a class="anchor" href="#implementing-spring-based-daos-without-callbacks"></a>Implementing Spring-based DAOs without callbacks</h4>
<div class="paragraph">
<p>As alternative to using Spring&#8217;s <code class="class">HibernateTemplate</code> to implement DAOs, data access code can also be written in a more traditional fashion, without wrapping the Hibernate access code in a callback, while still respecting and participating in Spring&#8217;s generic <code class="class">DataAccessException</code> hierarchy.
The <code class="class">HibernateDaoSupport</code> base class offers methods to access the current transactional <code class="interface">Session</code> and to convert exceptions in such a scenario; similar methods are also available as static helpers on the <code class="class">SessionFactoryUtils</code> class.
Note that such code will usually pass <em><code>false</code></em> as the value of the <code class="method">getSession(..)</code> methods <em><code>allowCreate</code></em> argument, to enforce running within a transaction (which avoids the need to close the returned <code class="interface">Session</code>, as its lifecycle is managed by the transaction).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class HibernateProductDao extends HibernateDaoSupport implements ProductDao {

    public Collection loadProductsByCategory(String category) throws DataAccessException, MyException {
        Session session = getSession(false);
        try {
            Query query = session.createQuery("from test.Product product where product.category=?");
            query.setString(0, category);
            List result = query.list();
            if (result == null) {
                throw new MyException("No search results.");
            }
            return result;
        }
        catch (HibernateException ex) {
            throw convertHibernateAccessException(ex);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The advantage of such direct Hibernate access code is that it allows <em>any</em> checked application exception to be thrown within the data access code; contrast this to the <code class="class">HibernateTemplate</code> class which is restricted to throwing only unchecked exceptions within the callback.
Note that you can often defer the corresponding checks and the throwing of application exceptions to after the callback, which still allows working with <code class="class">HibernateTemplate</code>.
In general, the <code class="class">HibernateTemplate</code> class' convenience methods are simpler and more convenient for many scenarios.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdo-2"><a class="anchor" href="#jdo-2"></a>JDO</h3>
<div class="paragraph">
<p>For the currently recommended usage patterns for JDO see <a href="#orm-jdo">[orm-jdo]</a></p>
</div>
<div class="sect3">
<h4 id="code-class-class-jdotemplate-code-and-code-class-class-jdodaosupport-code"><a class="anchor" href="#code-class-class-jdotemplate-code-and-code-class-class-jdodaosupport-code"></a><code class="class">JdoTemplate</code> and <code class="class">JdoDaoSupport</code></h4>
<div class="paragraph">
<p>Each JDO-based DAO will then receive the <code class="interface">PersistenceManagerFactory</code> through dependency injection.
Such a DAO could be coded against plain JDO API, working with the given <code class="interface">PersistenceManagerFactory</code>, but will usually rather be used with the Spring Framework&#8217;s <code class="class">JdoTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl implements ProductDao {

    private JdoTemplate jdoTemplate;

    public void setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        this.jdoTemplate = new JdoTemplate(pmf);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return (Collection) this.jdoTemplate.execute(new JdoCallback() {
            public Object doInJdo(PersistenceManager pm) throws JDOException {
                Query query = pm.newQuery(Product.class, "category = pCategory");
                query.declareParameters("String pCategory");
                List result = query.execute(category);
                // do some further stuff with the result list
                return result;
            }
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A callback implementation can effectively be used for any JDO data access.
<code class="class">JdoTemplate</code> will ensure that <code class="class">PersistenceManager`s are properly opened and closed, and automatically participate in transactions.
The template instances are thread-safe and reusable, they can thus be kept as instance variables of the surrounding class.
For simple single-step actions such as a single `find</code>, <code>load</code>, <code>makePersistent</code>, or <code>delete</code> call, <code class="class">JdoTemplate</code> offers alternative convenience methods that can replace such one line callback implementations.
Furthermore, Spring provides a convenient <code class="class">JdoDaoSupport</code> base class that provides a <code>setPersistenceManagerFactory(..)</code> method for receiving a <code class="class">PersistenceManagerFactory</code>, and <code class="method">getPersistenceManagerFactory()</code> and <code class="method">getJdoTemplate()</code> for use by subclasses.
In combination, this allows for very simple DAO implementations for typical requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl extends JdoDaoSupport implements ProductDao {

    public Collection loadProductsByCategory(String category) throws DataAccessException {
        return getJdoTemplate().find(
            Product.class, "category = pCategory", "String category", new Object[] {category});
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As alternative to working with Spring&#8217;s <code class="class">JdoTemplate</code>, you can also code Spring-based DAOs at the JDO API level, explicitly opening and closing a <code class="interface">PersistenceManager</code>.
As elaborated in the corresponding Hibernate section, the main advantage of this approach is that your data access code is able to throw checked exceptions.
<code class="class">JdoDaoSupport</code> offers a variety of support methods for this scenario, for fetching and releasing a transactional <code class="interface">PersistenceManager</code> as well as for converting exceptions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jpa-2"><a class="anchor" href="#jpa-2"></a>JPA</h3>
<div class="paragraph">
<p>For the currently recommended usage patterns for JPA see <a href="#orm-jpa">[orm-jpa]</a></p>
</div>
<div class="sect3">
<h4 id="code-class-class-jpatemplate-code-and-code-class-class-jpadaosupport-code"><a class="anchor" href="#code-class-class-jpatemplate-code-and-code-class-class-jpadaosupport-code"></a><code class="class">JpaTemplate</code> and <code class="class">JpaDaoSupport</code></h4>
<div class="paragraph">
<p>Each JPA-based DAO will then receive a <code class="interface">EntityManagerFactory</code> via dependency injection.
Such a DAO can be coded against plain JPA and work with the given <code class="interface">EntityManagerFactory</code> or through Spring&#8217;s <code class="class">JpaTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="entityManagerFactory" ref="myEmf"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class JpaProductDao implements ProductDao {

    private JpaTemplate jpaTemplate;

    public void setEntityManagerFactory(EntityManagerFactory emf) {
        this.jpaTemplate = new JpaTemplate(emf);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return (Collection) this.jpaTemplate.execute(new JpaCallback() {
            public Object doInJpa(EntityManager em) throws PersistenceException {
                Query query = em.createQuery("from Product as p where p.category = :category");
                query.setParameter("category", category);
                List result = query.getResultList();
                // do some further processing with the result list
                return result;
            }
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="interface">JpaCallback</code> implementation allows any type of JPA data access.
The <code class="class">JpaTemplate</code> will ensure that <code class="interface">EntityManager`s are properly opened and closed and automatically participate in transactions.
Moreover, the [class]`JpaTemplate</code> properly handles exceptions, making sure resources are cleaned up and the appropriate transactions rolled back.
The template instances are thread-safe and reusable and they can be kept as instance variable of the enclosing class.
Note that <code class="class">JpaTemplate</code> offers single-step actions such as find, load, merge, etc along with alternative convenience methods that can replace one line callback implementations.</p>
</div>
<div class="paragraph">
<p>Furthermore, Spring provides a convenient <code class="class">JpaDaoSupport</code> base class that provides the <code>get/setEntityManagerFactory</code> and <code class="method">getJpaTemplate()</code> to be used by subclasses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public class ProductDaoImpl extends JpaDaoSupport implements ProductDao {

    public Collection loadProductsByCategory(String category) throws DataAccessException {
        Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();
        params.put("category", category);
        return getJpaTemplate().findByNamedParams("from Product as p where p.category = :category", params);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides working with Spring&#8217;s <code class="class">JpaTemplate</code>, one can also code Spring-based DAOs against the JPA, doing one&#8217;s own explicit <code class="interface">EntityManager</code> handling.
As also elaborated in the corresponding Hibernate section, the main advantage of this approach is that your data access code is able to throw checked exceptions.
<code class="class">JpaDaoSupport</code> offers a variety of support methods for this scenario, for retrieving and releasing a transaction <code class="interface">EntityManager</code>, as well as for converting exceptions.</p>
</div>
<div class="paragraph">
<p><em>JpaTemplate mainly exists as a sibling of JdoTemplate
        and HibernateTemplate, offering the same style for people used to
        it.</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="classic-spring-mvc"><a class="anchor" href="#classic-spring-mvc"></a>Classic Spring MVC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&#8230;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms-usage"><a class="anchor" href="#jms-usage"></a>JMS Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the benefits of Spring&#8217;s JMS support is to shield the user from differences between the JMS 1.0.2 and 1.1 APIs.
(For a description of the differences between the two APIs see sidebar on Domain Unification).
Since it is now common to encounter only the JMS 1.1 API the use of classes that are based on the JMS 1.0.2 API has been deprecated in Spring 3.0.
This section describes Spring JMS support for the JMS 1.0.2 deprecated classes.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Domain Unification</div>
<div class="paragraph">
<p>There are two major releases of the JMS specification, 1.0.2 and 1.1.</p>
</div>
<div class="paragraph">
<p>JMS 1.0.2 defined two types of messaging domains, point-to-point (Queues) and publish/subscribe (Topics).
The 1.0.2 API reflected these two messaging domains by providing a parallel class hierarchy for each domain.
As a result, a client application became domain specific in its use of the JMS API. JMS 1.1 introduced the concept of domain unification that minimized both the functional differences and client API differences between the two domains.
As an example of a functional difference that was removed, if you use a JMS 1.1 provider you can transactionally consume a message from one domain and produce a message on the other using the same <code class="interface">Session</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The JMS 1.1 specification was released in April 2002 and incorporated as part of J2EE 1.4 in November 2003.
As a result, common J2EE 1.3 application servers which are still in widespread use (such as BEA WebLogic 8.1 and IBM WebSphere 5.1) are based on JMS 1.0.2.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jmstemplate"><a class="anchor" href="#jmstemplate"></a>JmsTemplate</h3>
<div class="paragraph">
<p>Located in the package <code>org.springframework.jms.core</code> the class <code class="class">JmsTemplate102</code> provides all of the features of the <code class="class">JmsTemplate</code> described the JMS chapter, but is based on the JMS 1.0.2 API instead of the JMS 1.1 API. As a consequence, if you are using JmsTemplate102 you need to set the boolean property  to configure the <code class="class">JmsTemplate</code> with knowledge of what JMS domain is being used.
By default the value of this property is false, indicating that the point-to-point domain, Queues, will be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="asynchronous-message-reception"><a class="anchor" href="#asynchronous-message-reception"></a>Asynchronous Message Reception</h3>
<div class="paragraph">
<p><a href="#jms-receiving-async-message-listener-adapter">MessageListenerAdapter&#8217;s</a> are used in conjunction with Spring&#8217;s <a href="#jms-mdp">message
      listener containers</a> to support asynchronous message reception by exposing almost any class as a Message-driven POJO. If you are using the JMS 1.0.2 API, you will want to use the 1.0.2 specific classes such as <code class="class">MessageListenerAdapter102</code>, <code class="class">SimpleMessageListenerContainer102</code>, and <code class="class">DefaultMessageListenerContainer102</code>.
These classes provide the same functionality as the JMS 1.1 based counterparts but rely only on the JMS 1.0.2 API.</p>
</div>
</div>
<div class="sect2">
<h3 id="connections-2"><a class="anchor" href="#connections-2"></a>Connections</h3>
<div class="paragraph">
<p>The <code class="class">ConnectionFactory</code> interface is part of the JMS specification and serves as the entry point for working with JMS. Spring provides an implementation of the <code class="class">ConnectionFactory</code> interface, <code class="class">SingleConnectionFactory102</code>, based on the JMS 1.0.2 API that will return the same <code class="class">Connection</code> on all <code class="method">createConnection()</code> calls and ignore calls to <code class="method">close()</code>.
You will need to set the boolean property  to indicate which messaging domain is used as <code class="class">SingleConnectionFactory102</code> will always explicitly differentiate between a <code class="class">javax.jms.QueueConnection</code> and a <code class="class">javax.jmsTopicConnection</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="transaction-management-6"><a class="anchor" href="#transaction-management-6"></a>Transaction Management</h3>
<div class="paragraph">
<p>In a JMS 1.0.2 environment the class <code class="class">JmsTransactionManager102</code> provides support for managing JMS transactions for a single Connection Factory.
Please refer to the reference documentation on <a href="#jms-tx">JMS Transaction
      Management</a> for more information on this functionality.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="classic-spring-aop-usage"><a class="anchor" href="#classic-spring-aop-usage"></a>Appendix B: Classic Spring AOP Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this appendix we discuss the lower-level Spring AOP APIs and the AOP support used in Spring 1.2 applications.
For new applications, we recommend the use of the Spring 2.0 AOP support described in the <a href="#aop">AOP</a> chapter, but when working with existing applications, or when reading books and articles, you may come across Spring 1.2 style examples.
Spring 2.0 is fully backwards compatible with Spring 1.2 and everything described in this appendix is fully supported in Spring 2.0.</p>
</div>
<div class="sect1">
<h2 id="pointcut-api-in-spring"><a class="anchor" href="#pointcut-api-in-spring"></a>Pointcut API in Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s look at how Spring handles the crucial pointcut concept.</p>
</div>
<div class="sect2">
<h3 id="concepts-2"><a class="anchor" href="#concepts-2"></a>Concepts</h3>
<div class="paragraph">
<p>Spring&#8217;s pointcut model enables pointcut reuse independent of advice types.
It&#8217;s possible to target different advice using the same pointcut.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.aop.Pointcut</code> interface is the central interface, used to target advices to particular classes and methods.
The complete interface is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface Pointcut {

    ClassFilter getClassFilter();

    MethodMatcher getMethodMatcher();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Splitting the <code class="interface">Pointcut</code> interface into two parts allows reuse of class and method matching parts, and fine-grained composition operations (such as performing a "union" with another method matcher).</p>
</div>
<div class="paragraph">
<p>The <code class="interface">ClassFilter</code> interface is used to restrict the pointcut to a given set of target classes.
If the <code>matches()</code> method always returns true, all target classes will be matched:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface ClassFilter {

    boolean matches(Class clazz);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="interface">MethodMatcher</code> interface is normally more important.
The complete interface is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>public interface MethodMatcher {

    boolean matches(Method m, Class targetClass);

    boolean isRuntime();

    boolean matches(Method m, Class targetClass, Object[] args);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>matches(Method, Class) `method is used to test whether this pointcut will ever match a given method on a target class.
This evaluation can be performed when an AOP proxy is created, to avoid the need for a test on every method invocation.
If the 2-argument matches method returns true for a given method, and the `isRuntime()</code> method for the MethodMatcher returns true, the 3-argument matches method will be invoked on every method invocation.
This enables a pointcut to look at the arguments passed to the method invocation immediately before the target advice is to execute.</p>
</div>
<div class="paragraph">
<p>Most MethodMatchers are static, meaning that their <code>isRuntime()</code> method returns false.
In this case, the 3-argument matches method will never be invoked.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
If possible, try to make pointcuts static, allowing the AOP framework to cache the results of pointcut evaluation when an AOP proxy is created.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="operations-on-pointcuts"><a class="anchor" href="#operations-on-pointcuts"></a>Operations on pointcuts</h3>
<div class="paragraph">
<p>Spring supports operations on pointcuts: notably, <em>union</em> and <em>intersection</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Union means the methods that either pointcut matches.</p>
</li>
<li>
<p>Intersection means the methods that both pointcuts match.</p>
</li>
<li>
<p>Union is usually more useful.</p>
</li>
<li>
<p>Pointcuts can be composed using the static methods in the <em>org.springframework.aop.support.Pointcuts</em> class, or using the <em>ComposablePointcut</em> class in the same package.
However, using AspectJ pointcut expressions is usually a simpler approach.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="aspectj-expression-pointcuts"><a class="anchor" href="#aspectj-expression-pointcuts"></a>AspectJ expression pointcuts</h3>
<div class="paragraph">
<p>Since 2.0, the most important type of pointcut used by Spring is <code>org.springframework.aop.aspectj.AspectJExpressionPointcut</code>.
This is a pointcut that uses an AspectJ supplied library to parse an AspectJ pointcut expression string.</p>
</div>
<div class="paragraph">
<p>See the previous chapter for a discussion of supported AspectJ pointcut primitives.</p>
</div>
</div>
<div class="sect2">
<h3 id="convenience-pointcut-implementations"><a class="anchor" href="#convenience-pointcut-implementations"></a>Convenience pointcut implementations</h3>
<div class="paragraph">
<p>Spring provides several convenient pointcut implementations.
Some can be used out of the box; others are intended to be subclassed in application-specific pointcuts.</p>
</div>
<div class="sect3">
<h4 id="static-pointcuts"><a class="anchor" href="#static-pointcuts"></a>Static pointcuts</h4>
<div class="paragraph">
<p>Static pointcuts are based on method and target class, and cannot take into account the method&#8217;s arguments.
Static pointcuts are sufficient - <em>and best</em> - for most usages.
It&#8217;s possible for Spring to evaluate a static pointcut only once, when a method is first invoked: after that, there is no need to evaluate the pointcut again with each method invocation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider some static pointcut implementations included with Spring.</p>
</div>
<div class="sect4">
<h5 id="regular-expression-pointcuts"><a class="anchor" href="#regular-expression-pointcuts"></a>Regular expression pointcuts</h5>
<div class="paragraph">
<p>One obvious way to specify static pointcuts is regular expressions.
Several AOP frameworks besides Spring make this possible.
<code>org.springframework.aop.support.Perl5RegexpMethodPointcut</code> is a generic regular expression pointcut, using Perl 5 regular expression syntax.
The <code>Perl5RegexpMethodPointcut</code> class depends on Jakarta ORO for regular expression matching.
Spring also provides the <code>JdkRegexpMethodPointcut</code> class that uses the regular expression support in JDK 1.4+.</p>
</div>
<div class="paragraph">
<p>Using the <code>Perl5RegexpMethodPointcut</code> class, you can provide a list of pattern Strings.
If any of these is a match, the pointcut will evaluate to true.
(So the result is effectively the union of these pointcuts.)</p>
</div>
<div class="paragraph">
<p>The usage is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="settersAndAbsquatulatePointcut"
    class="org.springframework.aop.support.Perl5RegexpMethodPointcut"&gt;
    &lt;property name="patterns"&gt;
        &lt;list&gt;
            &lt;value&gt;.*set.*&lt;/value&gt;
            &lt;value&gt;.*absquatulate&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring provides a convenience class, <code>RegexpMethodPointcutAdvisor</code>, that allows us to also reference an Advice (remember that an Advice can be an interceptor, before advice, throws advice etc.).
Behind the scenes, Spring will use a <code>JdkRegexpMethodPointcut</code>.
Using <code>RegexpMethodPointcutAdvisor</code> simplifies wiring, as the one bean encapsulates both pointcut and advice, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;bean id="settersAndAbsquatulateAdvisor"
    class="org.springframework.aop.support.RegexpMethodPointcutAdvisor"&gt;
    &lt;property name="advice"&gt;
        &lt;ref bean="beanNameOfAopAllianceInterceptor"/&gt;
    &lt;/property&gt;
    &lt;property name="patterns"&gt;
        &lt;list&gt;
            &lt;value&gt;.*set.*&lt;/value&gt;
            &lt;value&gt;.*absquatulate&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>RegexpMethodPointcutAdvisor</em> can be used with any Advice type.</p>
</div>
</div>
<div class="sect4">
<h5 id="attribute-driven-pointcuts"><a class="anchor" href="#attribute-driven-pointcuts"></a>Attribute-driven pointcuts</h5>
<div class="paragraph">
<p>An important type of static pointcut is a <em>metadata-driven</em> pointcut.
This uses the values of metadata attributes: typically, source-level metadata.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dynamic-pointcuts"><a class="anchor" href="#dynamic-pointcuts"></a>Dynamic pointcuts</h4>
<div class="paragraph">
<p>Dynamic pointcuts are costlier to evaluate than static pointcuts.
They take into account method <em>arguments</em>, as well as static information.
This means that they must be evaluated with every method invocation; the result cannot be cached, as arguments will vary.</p>
</div>
<div class="paragraph">
<p>The main example is the <code>control flow</code> pointcut.</p>
</div>
<div class="sect4">
<h5 id="control-flow-pointcuts"><a class="anchor" href="#control-flow-pointcuts"></a>Control flow pointcuts</h5>
<div class="paragraph">
<p>Spring control flow pointcuts are conceptually similar to AspectJ <em>cflow</em> pointcuts, although less powerful.
(There is currently no way to specify that a pointcut executes below a join point matched by another pointcut.) A control flow pointcut matches the current call stack.
For example, it might fire if the join point was invoked by a method in the <code>com.mycompany.web</code> package, or by the <code>SomeCaller</code> class.
Control flow pointcuts are specified using the `org.springframework.aop.support.ControlFlowPointcut
          `class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Control flow pointcuts are significantly more expensive to evaluate at runtime than even other dynamic pointcuts.
In Java 1.4, the cost is about 5 times that of other dynamic pointcuts.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pointcut-superclasses"><a class="anchor" href="#pointcut-superclasses"></a>Pointcut superclasses</h3>
<div class="paragraph">
<p>Spring provides useful pointcut superclasses to help you to implement your own pointcuts.</p>
</div>
<div class="paragraph">
<p>Because static pointcuts are most useful, you&#8217;ll probably subclass StaticMethodMatcherPointcut, as shown below.
This requires implementing just one abstract method (although it&#8217;s possible to override other methods to customize behavior):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>class TestStaticPointcut extends StaticMethodMatcherPointcut {

    public boolean matches(Method m, Class targetClass) {
        // return true if custom criteria match
    }
}
----There are also superclasses for dynamic pointcuts.

You can use custom pointcuts with any advice type in Spring 1.0 RC2 and above.

=== Custom pointcuts

Because pointcuts in Spring AOP are Java classes, rather than language features (as in AspectJ) it's possible to declare custom pointcuts, whether static or dynamic.
Custom pointcuts in Spring can be arbitrarily complex.
However, using the AspectJ pointcut expression language is recommended if possible.

NOTE: Later versions of Spring may offer support for "semantic pointcuts" as offered by JAC: for example, "all methods that change instance variables in the target object."

== Advice API in Spring

Let's now look at how Spring AOP handles advice.

=== Advice lifecycles

Each advice is a Spring bean.
An advice instance can be shared across all advised objects, or unique to each advised object.
This corresponds to _per-class_ or _per-instance_ advice.

Per-class advice is used most often.
It is appropriate for generic advice such as transaction advisors.
These do not depend on the state of the proxied object or add new state; they merely act on the method and arguments.

Per-instance advice is appropriate for introductions, to support mixins.
In this case, the advice adds state to the proxied object.

It's possible to use a mix of shared and per-instance advice in the same AOP proxy.

=== Advice types in Spring

Spring provides several advice types out of the box, and is extensible to support arbitrary advice types.
Let us look at the basic concepts and standard advice types.

==== Interception around advice

The most fundamental advice type in Spring is _interception around advice_.

Spring is compliant with the AOP Alliance interface for around advice using method interception.
MethodInterceptors implementing around advice should implement the following interface:

[source,java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>public interface MethodInterceptor extends Interceptor {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    Object invoke(MethodInvocation invocation) throws Throwable;
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The [class]`MethodInvocation` argument to the [method]`invoke()` method exposes the method being invoked; the target join point; the AOP proxy; and the arguments to the method.
The [method]`invoke()` method should return the invocation's result: the return value of the join point.

A simple [class]`MethodInterceptor` implementation looks as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class DebugInterceptor implements MethodInterceptor {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public Object invoke(MethodInvocation invocation) throws Throwable {
        System.out.println("Before: invocation=[" + invocation + "]");
        Object rval = invocation.proceed();
        System.out.println("Invocation returned");
        return rval;
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note the call to the MethodInvocation's [method]`proceed()` method.
This proceeds down the interceptor chain towards the join point.
Most interceptors will invoke this method, and return its return value.
However, a MethodInterceptor, like any around advice, can return a different value or throw an exception rather than invoke the proceed method.
However, you don't want to do this without good reason!

NOTE: MethodInterceptors offer interoperability with other AOP Alliance-compliant AOP implementations.
The other advice types discussed in the remainder of this section implement common AOP concepts, but in a Spring-specific way.
While there is an advantage in using the most specific advice type, stick with MethodInterceptor around advice if you are likely to want to run the aspect in another AOP framework.
Note that pointcuts are not currently interoperable between frameworks, and the AOP Alliance does not currently define pointcut interfaces.

==== Before advice

A simpler advice type is a _before
        advice_.
This does not need a `MethodInvocation` object, since it will only be called before entering the method.

The main advantage of a before advice is that there is no need to invoke the `proceed() `method, and therefore no possibility of inadvertently failing to proceed down the interceptor chain.

The `MethodBeforeAdvice` interface is shown below.
(Spring's API design would allow for field before advice, although the usual objects apply to field interception and it's unlikely that Spring will ever implement it).

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface MethodBeforeAdvice extends BeforeAdvice {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    void before(Method m, Object[] args, Object target) throws Throwable;
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note the return type is `void`.
Before advice can insert custom behavior before the join point executes, but cannot change the return value.
If a before advice throws an exception, this will abort further execution of the interceptor chain.
The exception will propagate back up the interceptor chain.
If it is unchecked, or on the signature of the invoked method, it will be passed directly to the client; otherwise it will be wrapped in an unchecked exception by the AOP proxy.

An example of a before advice in Spring, which counts all method invocations:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class CountingBeforeAdvice implements MethodBeforeAdvice {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private int count;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void before(Method m, Object[] args, Object target) throws Throwable {
    ++count;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public int getCount() {
        return count;
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
TIP: Before advice can be used with any pointcut.

==== Throws advice

_Throws advice_ is invoked after the return of the join point if the join point threw an exception.
Spring offers typed throws advice.
Note that this means that the `org.springframework.aop.ThrowsAdvice` interface does not contain any methods: It is a tag interface identifying that the given object implements one or more typed throws advice methods.
These should be in the form of:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>afterThrowing([Method, args, target], subclassOfThrowable)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Only the last argument is required.
The method signatures may have either one or four arguments, depending on whether the advice method is interested in the method and arguments.
The following classes are examples of throws advice.

The advice below is invoked if a  is thrown (including subclasses):

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class RemoteThrowsAdvice implements ThrowsAdvice {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void afterThrowing(RemoteException ex) throws Throwable {
        // Do something with remote exception
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The following advice is invoked if a  is thrown.
Unlike the above advice, it declares 4 arguments, so that it has access to the invoked method, method arguments and target object:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class ServletThrowsAdviceWithArguments implements ThrowsAdvice {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        // Do something with all arguments
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The final example illustrates how these two methods could be used in a single class, which handles both `RemoteException` and `ServletException`.
Any number of throws advice methods can be combined in a single class.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public static class CombinedThrowsAdvice implements ThrowsAdvice {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void afterThrowing(RemoteException ex) throws Throwable {
    // Do something with remote exception
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        // Do something with all arguments
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
_Note:_ If a throws-advice method throws an exception itself, it will override the original exception (i.e.
change the exception thrown to the user).
The overriding exception will typically be a RuntimeException; this is compatible with any method signature.
However, if a throws-advice method throws a checked exception, it will have to match the declared exceptions of the target method and is hence to some degree coupled to specific target method signatures.
_Do not throw an undeclared
        checked exception that is incompatible with the target method's signature!_

TIP: Throws advice can be used with any pointcut.

==== After Returning advice

An after returning advice in Spring must implement the _org.springframework.aop.AfterReturningAdvice_ interface, shown below:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface AfterReturningAdvice extends Advice {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    void afterReturning(Object returnValue, Method m, Object[] args, Object target)
            throws Throwable;
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
An after returning advice has access to the return value (which it cannot modify), invoked method, methods arguments and target.

The following after returning advice counts all successful method invocations that have not thrown exceptions:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class CountingAfterReturningAdvice implements AfterReturningAdvice {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private int count;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void afterReturning(Object returnValue, Method m, Object[] args, Object target)
        throws Throwable {
    ++count;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public int getCount() {
        return count;
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
This advice doesn't change the execution path.
If it throws an exception, this will be thrown up the interceptor chain instead of the return value.

TIP: After returning advice can be used with any pointcut.

==== Introduction advice

Spring treats introduction advice as a special kind of interception advice.

Introduction requires an `IntroductionAdvisor`, and an `IntroductionInterceptor`, implementing the following interface:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface IntroductionInterceptor extends MethodInterceptor {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    boolean implementsInterface(Class intf);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `invoke() `method inherited from the AOP Alliance `MethodInterceptor` interface must implement the introduction: that is, if the invoked method is on an introduced interface, the introduction interceptor is responsible for handling the method call - it cannot invoke `proceed()`.

Introduction advice cannot be used with any pointcut, as it applies only at class, rather than method, level.
You can only use introduction advice with the `IntroductionAdvisor`, which has the following methods:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface IntroductionAdvisor extends Advisor, IntroductionInfo {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ClassFilter getClassFilter();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    void validateInterfaces() throws IllegalArgumentException;
}</pre>
</div>
</div>
<div class="paragraph">
<p>public interface IntroductionInfo {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    Class[] getInterfaces();
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
There is no [interface]`MethodMatcher`, and hence no [interface]`Pointcut`, associated with introduction advice.
Only class filtering is logical.

The `getInterfaces()` method returns the interfaces introduced by this advisor.

The `validateInterfaces()` method is used internally to see whether or not the introduced interfaces can be implemented by the configured `IntroductionInterceptor`.

Let's look at a simple example from the Spring test suite.
Let's suppose we want to introduce the following interface to one or more objects:


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public interface Lockable {
    void lock();
    void unlock();
    boolean locked();
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
This illustrates a _mixin_.
We want to be able to cast advised objects to Lockable, whatever their type, and call lock and unlock methods.
If we call the lock() method, we want all setter methods to throw a `LockedException`.
Thus we can add an aspect that provides the ability to make objects immutable, without them having any knowledge of it: a good example of AOP.

Firstly, we'll need an `IntroductionInterceptor` that does the heavy lifting.
In this case, we extend the `org.springframework.aop.support.DelegatingIntroductionInterceptor` convenience class.
We could implement IntroductionInterceptor directly, but using `DelegatingIntroductionInterceptor` is best for most cases.

The `DelegatingIntroductionInterceptor` is designed to delegate an introduction to an actual implementation of the introduced interface(s), concealing the use of interception to do so.
The delegate can be set to any object using a constructor argument; the default delegate (when the no-arg constructor is used) is this.
Thus in the example below, the delegate is the `LockMixin` subclass of `DelegatingIntroductionInterceptor`.
Given a delegate (by default itself), a `DelegatingIntroductionInterceptor` instance looks for all interfaces implemented by the delegate (other than IntroductionInterceptor), and will support introductions against any of them.
It's possible for subclasses such as `LockMixin` to call the `suppressInterface(Class intf) `method to suppress interfaces that should not be exposed.
However, no matter how many interfaces an `IntroductionInterceptor` is prepared to support, the `IntroductionAdvisor` used will control which interfaces are actually exposed.
An introduced interface will conceal any implementation of the same interface by the target.

Thus LockMixin subclasses `DelegatingIntroductionInterceptor` and implements Lockable itself.
The superclass automatically picks up that Lockable can be supported for introduction, so we don't need to specify that.
We could introduce any number of interfaces in this way.

Note the use of the `locked` instance variable.
This effectively adds additional state to that held in the target object.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class LockMixin extends DelegatingIntroductionInterceptor
    implements Lockable {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private boolean locked;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void lock() {
    this.locked = true;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void unlock() {
    this.locked = false;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public boolean locked() {
    return this.locked;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Object invoke(MethodInvocation invocation) throws Throwable {
    if (locked() &amp;&amp; invocation.getMethod().getName().indexOf("set") == 0)
        throw new LockedException();
    return super.invoke(invocation);
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Often it isn't necessary to override the `invoke()
        `method: the `DelegatingIntroductionInterceptor` implementation - which calls the delegate method if the method is introduced, otherwise proceeds towards the join point - is usually sufficient.
In the present case, we need to add a check: no setter method can be invoked if in locked mode.

The introduction advisor required is simple.
All it needs to do is hold a distinct `LockMixin` instance, and specify the introduced interfaces - in this case, just `Lockable`.
A more complex example might take a reference to the introduction interceptor (which would be defined as a prototype): in this case, there's no configuration relevant for a `LockMixin`, so we simply create it using `new`.


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>public class LockMixinAdvisor extends DefaultIntroductionAdvisor {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public LockMixinAdvisor() {
        super(new LockMixin(), Lockable.class);
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
We can apply this advisor very simply: it requires no configuration.
(However, it _is_ necessary: It's impossible to use an `IntroductionInterceptor` without an _IntroductionAdvisor_.) As usual with introductions, the advisor must be per-instance, as it is stateful.
We need a different instance of `LockMixinAdvisor`, and hence `LockMixin`, for each advised object.
The advisor comprises part of the advised object's state.

We can apply this advisor programmatically, using the `Advised.addAdvisor() `method, or (the recommended way) in XML configuration, like any other advisor.
All proxy creation choices discussed below, including "auto proxy creators," correctly handle introductions and stateful mixins.

== Advisor API in Spring

In Spring, an Advisor is an aspect that contains just a single advice object associated with a pointcut expression.

Apart from the special case of introductions, any advisor can be used with any advice.
`org.springframework.aop.support.DefaultPointcutAdvisor` is the most commonly used advisor class.
For example, it can be used with a `MethodInterceptor`, `BeforeAdvice` or `ThrowsAdvice`.

It is possible to mix advisor and advice types in Spring in the same AOP proxy.
For example, you could use a interception around advice, throws advice and before advice in one proxy configuration: Spring will automatically create the necessary interceptor chain.

== Using the ProxyFactoryBean to create AOP proxies

If you're using the Spring IoC container (an ApplicationContext or BeanFactory) for your business objects - and you should be! - you will want to use one of Spring's AOP FactoryBeans.
(Remember that a factory bean introduces a layer of indirection, enabling it to create objects of a different type.)

NOTE: The Spring 2.0 AOP support also uses factory beans under the covers.

The basic way to create an AOP proxy in Spring is to use the _org.springframework.aop.framework.ProxyFactoryBean_.
This gives complete control over the pointcuts and advice that will apply, and their ordering.
However, there are simpler options that are preferable if you don't need such control.

=== Basics

The `ProxyFactoryBean`, like other Spring `FactoryBean` implementations, introduces a level of indirection.
If you define a `ProxyFactoryBean` with name `foo`, what objects referencing `foo` see is not the `ProxyFactoryBean` instance itself, but an object created by the `ProxyFactoryBean`'s implementation of the `getObject() `method.
This method will create an AOP proxy wrapping a target object.

One of the most important benefits of using a `ProxyFactoryBean` or another IoC-aware class to create AOP proxies, is that it means that advices and pointcuts can also be managed by IoC. This is a powerful feature, enabling certain approaches that are hard to achieve with other AOP frameworks.
For example, an advice may itself reference application objects (besides the target, which should be available in any AOP framework), benefiting from all the pluggability provided by Dependency Injection.

=== JavaBean properties

 In common with most [interface]`FactoryBean` implementations provided with Spring, the [class]`ProxyFactoryBean` class is itself a JavaBean.
Its properties are used to:

* Specify the target you want to proxy.
* Specify whether to use CGLIB (see below and also &lt;&lt;aop-pfb-proxy-types&gt;&gt;).

 Some key properties are inherited from [class]`org.springframework.aop.framework.ProxyConfig` (the superclass for all AOP proxy factories in Spring).
These key properties include:

*  `proxyTargetClass`: `true` if the target class is to be proxied, rather than the target class' interfaces.
  If this property value is set to `true`, then CGLIB proxies will be created (but see also below &lt;&lt;aop-pfb-proxy-types&gt;&gt;).
*  `optimize`: controls whether or not aggressive optimizations are applied to proxies _created via CGLIB_.
  One should not blithely use this setting unless one fully understands how the relevant AOP proxy handles optimization.
  This is currently used only for CGLIB proxies; it has no effect with JDK dynamic proxies.
* `frozen`: if a proxy configuration is `frozen`, then changes to the configuration are no longer allowed.
  This is useful both as a slight optimization and for those cases when you don't want callers to be able to manipulate the proxy (via the [interface]`Advised` interface) after the proxy has been created.
  The default value of this property is `false`, so changes such as adding additional advice are allowed.
*  `exposeProxy`: determines whether or not the current proxy should be exposed in a [class]`ThreadLocal` so that it can be accessed by the target.
  If a target needs to obtain the proxy and the `exposeProxy` property is set to `true`, the target can use the [method]`AopContext.currentProxy()` method.
*  `aopProxyFactory`: the implementation of [interface]`AopProxyFactory` to use.
  Offers a way of customizing whether to use dynamic proxies, CGLIB or any other proxy strategy.
  The default implementation will choose dynamic proxies or CGLIB appropriately.
  There should be no need to use this property; it is intended to allow the addition of new proxy types in Spring 1.1.

 Other properties specific to [class]`ProxyFactoryBean` include:

*  `proxyInterfaces`: array of String interface names.
  If this isn't supplied, a CGLIB proxy for the target class will be used (but see also below &lt;&lt;aop-pfb-proxy-types&gt;&gt;).
*  `interceptorNames`: String array of [interface]`Advisor`, interceptor or other advice names to apply.
  Ordering is significant, on a first come-first served basis.
  That is to say that the first interceptor in the list will be the first to be able to intercept the invocation.
+
 The names are bean names in the current factory, including bean names from ancestor factories.
You can't mention bean references here since doing so would result in the [class]`ProxyFactoryBean` ignoring the singleton setting of the advice.

+
 You can append an interceptor name with an asterisk (`*`).
This will result in the application of all advisor beans with names starting with the part before the asterisk to be applied.
An example of using this feature can be found in &lt;&lt;aop-global-advisors&gt;&gt;.


*  singleton: whether or not the factory should return a single object, no matter how often the `getObject()` method is called.
  Several [interface]`FactoryBean` implementations offer such a method.
  The default value is `true`.
  If you	want to use stateful advice - for example, for stateful mixins - use	prototype advices along with a singleton value of `false`.

=== JDK- and CGLIB-based proxies

 This section serves as the definitive documentation on how the [class]`ProxyFactoryBean` chooses to create one of either a JDK- and CGLIB-based proxy for a particular target object (that is to be proxied).


NOTE:  The behavior of the [class]`ProxyFactoryBean` with regard to creating JDK- or CGLIB-based proxies changed between versions 1.2.x and 2.0 of Spring.
The [class]`ProxyFactoryBean` now exhibits similar semantics with regard to auto-detecting interfaces as those of the [class]`TransactionProxyFactoryBean` class.


 If the class of a target object that is to be proxied (hereafter simply referred to as the target class) doesn't implement any interfaces, then a CGLIB-based proxy will be created.
This is the easiest scenario, because JDK proxies are interface based, and no interfaces means JDK proxying isn't even possible.
One simply plugs in the target bean, and specifies the list of interceptors via the `interceptorNames` property.
Note that a CGLIB-based proxy will be created even if the `proxyTargetClass` property of the [class]`ProxyFactoryBean` has been set to `false`.
(Obviously this makes no sense, and is best removed from the bean definition because it is at best redundant, and at worst confusing.)

 If the target class implements one (or more) interfaces, then the type of proxy that is created depends on the configuration of the [class]`ProxyFactoryBean`.


 If the `proxyTargetClass` property of the [class]`ProxyFactoryBean` has been set to `true`, then a CGLIB-based proxy will be created.
This makes sense, and is in keeping with the principle of least surprise.
Even if the `proxyInterfaces` property of the [class]`ProxyFactoryBean` has been set to one or more fully qualified interface names, the fact that the `proxyTargetClass` property is set to `true` _will_ cause CGLIB-based proxying to be in effect.


 If the `proxyInterfaces` property of the [class]`ProxyFactoryBean` has been set to one or more fully qualified interface names, then a JDK-based proxy will be created.
The created proxy will implement all of the interfaces that were specified in the `proxyInterfaces` property; if the target class happens to implement a whole lot more interfaces than those specified in the `proxyInterfaces` property, that is all well and good but those additional interfaces will not be implemented by the returned proxy.


 If the `proxyInterfaces` property of the [class]`ProxyFactoryBean` has _not_ been set, but the target class _does implement one (or more)_ interfaces, then the [class]`ProxyFactoryBean` will auto-detect the fact that the target class does actually implement at least one interface, and a JDK-based proxy will be created.
The interfaces that are actually proxied will be _all_ of the interfaces that the target class implements; in effect, this is the same as simply supplying a list of each and every interface that the target class implements to the `proxyInterfaces` property.
However, it is significantly less work, and less prone to typos.


=== Proxying interfaces

 Let's look at a simple example of [class]`ProxyFactoryBean` in action.
This example involves:

* A _target bean_ that will be proxied.
  This is the "personTarget" bean definition in the example below.
* An Advisor and an Interceptor used to provide advice.
* An AOP proxy bean definition specifying the target object (the personTarget bean) and the interfaces to proxy, along with the advices to apply.


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="personTarget" class="com.mycompany.PersonImpl"&gt;
    &lt;property name="name"&gt;&lt;value&gt;Tony&lt;/value&gt;&lt;/property&gt;
    &lt;property name="age"&gt;&lt;value&gt;51&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="myAdvisor" class="com.mycompany.MyAdvisor"&gt;
    &lt;property name="someProperty"&gt;&lt;value&gt;Custom string property value&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="debugInterceptor" class="org.springframework.aop.interceptor.DebugInterceptor"&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="person"
    class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
    &lt;property name="proxyInterfaces"&gt;&lt;value&gt;com.mycompany.Person&lt;/value&gt;&lt;/property&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;property name="target"&gt;&lt;ref bean="personTarget"/&gt;&lt;/property&gt;
    &lt;property name="interceptorNames"&gt;
        &lt;list&gt;
            &lt;value&gt;myAdvisor&lt;/value&gt;
            &lt;value&gt;debugInterceptor&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that the `interceptorNames` property takes a list of String: the bean names of the interceptor or advisors in the current factory.
Advisors, interceptors, before, after returning and throws advice objects can be used.
The ordering of advisors is significant.

NOTE: You might be wondering why the list doesn't hold bean references.
The reason for this is that if the ProxyFactoryBean's singleton property is set to false, it must be able to return independent proxy instances.
If any of the advisors is itself a prototype, an independent instance would need to be returned, so it's necessary to be able to obtain an instance of the prototype from the factory; holding a reference isn't sufficient.

The "person" bean definition above can be used in place of a Person implementation, as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Person person = (Person) factory.getBean("person");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Other beans in the same IoC context can express a strongly typed dependency on it, as with an ordinary Java object:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="personUser" class="com.mycompany.PersonUser"&gt;
  &lt;property name="person"&gt;&lt;ref bean="person" /&gt;&lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `PersonUser` class in this example would expose a property of type Person.
As far as it's concerned, the AOP proxy can be used transparently in place of a "real" person implementation.
However, its class would be a dynamic proxy class.
It would be possible to cast it to the `Advised` interface (discussed below).

It's possible to conceal the distinction between target and proxy using an anonymous _inner bean_, as follows.
Only the `ProxyFactoryBean` definition is different; the advice is included only for completeness:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="myAdvisor" class="com.mycompany.MyAdvisor"&gt;
  &lt;property name="someProperty"&gt;&lt;value&gt;Custom string property value&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="debugInterceptor" class="org.springframework.aop.interceptor.DebugInterceptor"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="person" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="proxyInterfaces"&gt;&lt;value&gt;com.mycompany.Person&lt;/value&gt;&lt;/property&gt;
  &lt;!-- Use inner bean, not local reference to target -&#8594;
  &lt;property name="target"&gt;
    &lt;bean class="com.mycompany.PersonImpl"&gt;
      &lt;property name="name"&gt;&lt;value&gt;Tony&lt;/value&gt;&lt;/property&gt;
      &lt;property name="age"&gt;&lt;value&gt;51&lt;/value&gt;&lt;/property&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
  &lt;property name="interceptorNames"&gt;
    &lt;list&gt;
      &lt;value&gt;myAdvisor&lt;/value&gt;
      &lt;value&gt;debugInterceptor&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
This has the advantage that there's only one object of type `Person`: useful if we want to prevent users of the application context from obtaining a reference to the un-advised object, or need to avoid any ambiguity with Spring IoC _autowiring_.
There's also arguably an advantage in that the ProxyFactoryBean definition is self-contained.
However, there are times when being able to obtain the un-advised target from the factory might actually be an _advantage_: for example, in certain test scenarios.

=== Proxying classes

What if you need to proxy a class, rather than one or more interfaces?

Imagine that in our example above, there was no `Person` interface: we needed to advise a class called `Person` that didn't implement any business interface.
In this case, you can configure Spring to use CGLIB proxying, rather than dynamic proxies.
Simply set the `proxyTargetClass` property on the ProxyFactoryBean above to true.
While it's best to program to interfaces, rather than classes, the ability to advise classes that don't implement interfaces can be useful when working with legacy code.
(In general, Spring isn't prescriptive.
While it makes it easy to apply good practices, it avoids forcing a particular approach.)

If you want to, you can force the use of CGLIB in any case, even if you do have interfaces.

CGLIB proxying works by generating a subclass of the target class at runtime.
Spring configures this generated subclass to delegate method calls to the original target: the subclass is used to implement the _Decorator_ pattern, weaving in the advice.

CGLIB proxying should generally be transparent to users.
However, there are some issues to consider:

* `Final` methods can't be advised, as they can't be overridden.
* As of Spring 3.2 it is no longer required to add CGLIB to your project classpath.
  CGLIB classes have been repackaged under org.springframework and included directly in the spring-core JAR. This is both for user convenience as well as to avoid potential conflicts with other projects that have dependence on a differing version of CGLIB.

There's little performance difference between CGLIB proxying and dynamic proxies.
As of Spring 1.0, dynamic proxies are slightly faster.
However, this may change in the future.
Performance should not be a decisive consideration in this case.

=== Using 'global' advisors

By appending an asterisk to an interceptor name, all advisors with bean names matching the part before the asterisk, will be added to the advisor chain.
This can come in handy if you need to add a standard set of 'global' advisors:
[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="proxy" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="target" ref="service"/&gt;
  &lt;property name="interceptorNames"&gt;
    &lt;list&gt;
      &lt;value&gt;global*&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="global_debug" class="org.springframework.aop.interceptor.DebugInterceptor"/&gt;
&lt;bean id="global_performance" class="org.springframework.aop.interceptor.PerformanceMonitorInterceptor"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Concise proxy definitions

Especially when defining transactional proxies, you may end up with many similar proxy definitions.
The use of parent and child bean definitions, along with inner bean definitions, can result in much cleaner and more concise proxy definitions.

First a parent, _template_, bean definition is created for the proxy:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="txProxyTemplate" abstract="true"
        class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="transactionAttributes"&gt;
    &lt;props&gt;
      &lt;prop key="*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
This will never be instantiated itself, so may actually be incomplete.
Then each proxy which needs to be created is just a child bean definition, which wraps the target of the proxy as an inner bean definition, since the target will never be used on its own anyway.
[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="myService" parent="txProxyTemplate"&gt;
  &lt;property name="target"&gt;
    &lt;bean class="org.springframework.samples.MyServiceImpl"&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
It is of course possible to override properties from the parent template, such as in this case, the transaction propagation settings:
[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="mySpecialService" parent="txProxyTemplate"&gt;
  &lt;property name="target"&gt;
    &lt;bean class="org.springframework.samples.MySpecialServiceImpl"&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
  &lt;property name="transactionAttributes"&gt;
    &lt;props&gt;
      &lt;prop key="get*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
      &lt;prop key="find*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
      &lt;prop key="load*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
      &lt;prop key="store*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that in the example above, we have explicitly marked the parent bean definition as _abstract_ by using the _abstract_ attribute, as described &lt;&lt;beans-child-bean-definitions,previously&gt;&gt;, so that it may not actually ever be instantiated.
Application contexts (but not simple bean factories) will by default pre-instantiate all singletons.
It is therefore important (at least for singleton beans) that if you have a (parent) bean definition which you intend to use only as a template, and this definition specifies a class, you must make sure to set the _abstract_ attribute to _true_, otherwise the application context will actually try to pre-instantiate it.

== Creating AOP proxies programmatically with the ProxyFactory

It's easy to create AOP proxies programmatically using Spring.
This enables you to use Spring AOP without dependency on Spring IoC.

The following listing shows creation of a proxy for a target object, with one interceptor and one advisor.
The interfaces implemented by the target object will automatically be proxied:


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>ProxyFactory factory = new ProxyFactory(myBusinessInterfaceImpl);
factory.addInterceptor(myMethodInterceptor);
factory.addAdvisor(myAdvisor);
MyBusinessInterface tb = (MyBusinessInterface) factory.getProxy();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The first step is to construct an object of type `org.springframework.aop.framework.ProxyFactory`.
You can create this with a target object, as in the above example, or specify the interfaces to be proxied in an alternate constructor.

You can add interceptors or advisors, and manipulate them for the life of the ProxyFactory.
If you add an IntroductionInterceptionAroundAdvisor you can cause the proxy to implement additional interfaces.

There are also convenience methods on ProxyFactory (inherited from [class]`AdvisedSupport`) which allow you to add other advice types such as before and throws advice.
AdvisedSupport is the superclass of both ProxyFactory and ProxyFactoryBean.

TIP: Integrating AOP proxy creation with the IoC framework is best practice in most applications.
We recommend that you externalize configuration from Java code with AOP, as in general.

== Manipulating advised objects

However you create AOP proxies, you can manipulate them using the `org.springframework.aop.framework.Advised` interface.
Any AOP proxy can be cast to this interface, whichever other interfaces it implements.
This interface includes the following methods:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Advisor[] getAdvisors();</p>
</div>
<div class="paragraph">
<p>void addAdvice(Advice advice) throws AopConfigException;</p>
</div>
<div class="paragraph">
<p>void addAdvice(int pos, Advice advice)
        throws AopConfigException;</p>
</div>
<div class="paragraph">
<p>void addAdvisor(Advisor advisor) throws AopConfigException;</p>
</div>
<div class="paragraph">
<p>void addAdvisor(int pos, Advisor advisor) throws AopConfigException;</p>
</div>
<div class="paragraph">
<p>int indexOf(Advisor advisor);</p>
</div>
<div class="paragraph">
<p>boolean removeAdvisor(Advisor advisor) throws AopConfigException;</p>
</div>
<div class="paragraph">
<p>void removeAdvisor(int index) throws AopConfigException;</p>
</div>
<div class="paragraph">
<p>boolean replaceAdvisor(Advisor a, Advisor b) throws AopConfigException;</p>
</div>
<div class="paragraph">
<p>boolean isFrozen();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `getAdvisors()` method will return an Advisor for every advisor, interceptor or other advice type that has been added to the factory.
If you added an Advisor, the returned advisor at this index will be the object that you added.
If you added an interceptor or other advice type, Spring will have wrapped this in an advisor with a pointcut that always returns true.
Thus if you added a `MethodInterceptor`, the advisor returned for this index will be an `DefaultPointcutAdvisor` returning your `MethodInterceptor` and a pointcut that matches all classes and methods.

The `addAdvisor()` methods can be used to add any Advisor.
Usually the advisor holding pointcut and advice will be the generic `DefaultPointcutAdvisor`, which can be used with any advice or pointcut (but not for introductions).

By default, it's possible to add or remove advisors or interceptors even once a proxy has been created.
The only restriction is that it's impossible to add or remove an introduction advisor, as existing proxies from the factory will not show the interface change.
(You can obtain a new proxy from the factory to avoid this problem.)

A simple example of casting an AOP proxy to the `Advised` interface and examining and manipulating its advice:


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>Advised advised = (Advised) myObject;
Advisor[] advisors = advised.getAdvisors();
int oldAdvisorCount = advisors.length;
System.out.println(oldAdvisorCount + " advisors");</p>
</div>
<div class="paragraph">
<p>advised.addAdvice(new DebugInterceptor());</p>
</div>
<div class="paragraph">
<p>advised.addAdvisor(new DefaultPointcutAdvisor(mySpecialPointcut, myAdvice));</p>
</div>
<div class="paragraph">
<p>assertEquals("Added two advisors",
     oldAdvisorCount + 2, advised.getAdvisors().length);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: It's questionable whether it's advisable (no pun intended) to modify advice on a business object in production, although there are no doubt legitimate usage cases.
However, it can be very useful in development: for example, in tests.
I have sometimes found it very useful to be able to add test code in the form of an interceptor or other advice, getting inside a method invocation I want to test.
(For example, the advice can get inside a transaction created for that method: for example, to run SQL to check that a database was correctly updated, before marking the transaction for roll back.)

Depending on how you created the proxy, you can usually set a `frozen` flag, in which case the `Advised` `isFrozen()` method will return true, and any attempts to modify advice through addition or removal will result in an `AopConfigException`.
The ability to freeze the state of an advised object is useful in some cases, for example, to prevent calling code removing a security interceptor.
It may also be used in Spring 1.1 to allow aggressive optimization if runtime advice modification is known not to be required.

== Using the "autoproxy" facility

So far we've considered explicit creation of AOP proxies using a `ProxyFactoryBean` or similar factory bean.

Spring also allows us to use "autoproxy" bean definitions, which can automatically proxy selected bean definitions.
This is built on Spring "bean post processor" infrastructure, which enables modification of any bean definition as the container loads.

In this model, you set up some special bean definitions in your XML bean definition file to configure the auto proxy infrastructure.
This allows you just to declare the targets eligible for autoproxying: you don't need to use `ProxyFactoryBean`.

There are two ways to do this:

* Using an autoproxy creator that refers to specific beans in the current context.
* A special case of autoproxy creation that deserves to be considered separately; autoproxy creation driven by source-level metadata attributes.

=== Autoproxy bean definitions

The `org.springframework.aop.framework.autoproxy` package provides the following standard autoproxy creators.

==== BeanNameAutoProxyCreator

The `BeanNameAutoProxyCreator` class is a `BeanPostProcessor` that automatically creates AOP proxies for beans with names matching literal values or wildcards.


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"&gt;
  &lt;property name="beanNames"&gt;&lt;value&gt;jdk*,onlyJdk&lt;/value&gt;&lt;/property&gt;
  &lt;property name="interceptorNames"&gt;
    &lt;list&gt;
      &lt;value&gt;myInterceptor&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
As with `ProxyFactoryBean`, there is an `interceptorNames` property rather than a list of interceptors, to allow correct behavior for prototype advisors.
Named "interceptors" can be advisors or any advice type.

As with auto proxying in general, the main point of using `BeanNameAutoProxyCreator` is to apply the same configuration consistently to multiple objects, with minimal volume of configuration.
It is a popular choice for applying declarative transactions to multiple objects.

Bean definitions whose names match, such as "jdkMyBean" and "onlyJdk" in the above example, are plain old bean definitions with the target class.
An AOP proxy will be created automatically by the `BeanNameAutoProxyCreator`.
The same advice will be applied to all matching beans.
Note that if advisors are used (rather than the interceptor in the above example), the pointcuts may apply differently to different beans.

==== DefaultAdvisorAutoProxyCreator

A more general and extremely powerful auto proxy creator is `DefaultAdvisorAutoProxyCreator`.
This will automagically apply eligible advisors in the current context, without the need to include specific bean names in the autoproxy advisor's bean definition.
It offers the same merit of consistent configuration and avoidance of duplication as `BeanNameAutoProxyCreator`.

Using this mechanism involves:

* Specifying a `DefaultAdvisorAutoProxyCreator` bean definition.
* Specifying any number of Advisors in the same or related contexts.
  Note that these _must_ be Advisors, not just interceptors or other advices.
  This is necessary because there must be a pointcut to evaluate, to check the eligibility of each advice to candidate bean definitions.

The `DefaultAdvisorAutoProxyCreator` will automatically evaluate the pointcut contained in each advisor, to see what (if any) advice it should apply to each business object (such as "businessObject1" and "businessObject2" in the example).

This means that any number of advisors can be applied automatically to each business object.
If no pointcut in any of the advisors matches any method in a business object, the object will not be proxied.
As bean definitions are added for new business objects, they will automatically be proxied if necessary.

Autoproxying in general has the advantage of making it impossible for callers or dependencies to obtain an un-advised object.
Calling getBean("businessObject1") on this ApplicationContext will return an AOP proxy, not the target business object.
(The "inner bean" idiom shown earlier also offers this benefit.)


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="transactionInterceptor"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="customAdvisor" class="com.mycompany.MyAdvisor"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="businessObject1" class="com.mycompany.BusinessObject1"&gt;
  &lt;!-- Properties omitted -&#8594;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="businessObject2" class="com.mycompany.BusinessObject2"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `DefaultAdvisorAutoProxyCreator` is very useful if you want to apply the same advice consistently to many business objects.
Once the infrastructure definitions are in place, you can simply add new business objects without including specific proxy configuration.
You can also drop in additional aspects very easily - for example, tracing or performance monitoring aspects - with minimal change to configuration.

The DefaultAdvisorAutoProxyCreator offers support for filtering (using a naming convention so that only certain advisors are evaluated, allowing use of multiple, differently configured, AdvisorAutoProxyCreators in the same factory) and ordering.
Advisors can implement the `org.springframework.core.Ordered` interface to ensure correct ordering if this is an issue.
The TransactionAttributeSourceAdvisor used in the above example has a configurable order value; the default setting is unordered.

==== AbstractAdvisorAutoProxyCreator

This is the superclass of DefaultAdvisorAutoProxyCreator.
You can create your own autoproxy creators by subclassing this class, in the unlikely event that advisor definitions offer insufficient customization to the behavior of the framework `DefaultAdvisorAutoProxyCreator`.

=== Using metadata-driven auto-proxying

A particularly important type of autoproxying is driven by metadata.
This produces a similar programming model to .NET `ServicedComponents`.
Instead of using XML deployment descriptors as in EJB, configuration for transaction management and other enterprise services is held in source-level attributes.

In this case, you use the `DefaultAdvisorAutoProxyCreator`, in combination with Advisors that understand metadata attributes.
The metadata specifics are held in the pointcut part of the candidate advisors, rather than in the autoproxy creation class itself.

This is really a special case of the `DefaultAdvisorAutoProxyCreator`, but deserves consideration on its own.
(The metadata-aware code is in the pointcuts contained in the advisors, not the AOP framework itself.)

The `/attributes` directory of the JPetStore sample application shows the use of attribute-driven autoproxying.
In this case, there's no need to use the `TransactionProxyFactoryBean`.
Simply defining transactional attributes on business objects is sufficient, because of the use of metadata-aware pointcuts.
The bean definitions include the following code, in `/WEB-INF/declarativeServices.xml`.
Note that this is generic, and can be used outside the JPetStore:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="transactionInterceptor"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="transactionInterceptor"
    class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="transactionAttributeSource"&gt;
    &lt;bean class="org.springframework.transaction.interceptor.AttributesTransactionAttributeSource"&gt;
      &lt;property name="attributes" ref="attributes"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="attributes" class="org.springframework.metadata.commons.CommonsAttributes"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `DefaultAdvisorAutoProxyCreator` bean definition (the name is not significant, hence it can even be omitted) will pick up all eligible pointcuts in the current application context.
In this case, the "transactionAdvisor" bean definition, of type `TransactionAttributeSourceAdvisor`, will apply to classes or methods carrying a transaction attribute.
The TransactionAttributeSourceAdvisor depends on a TransactionInterceptor, via constructor dependency.
The example resolves this via autowiring.
The `AttributesTransactionAttributeSource` depends on an implementation of the `org.springframework.metadata.Attributes` interface.
In this fragment, the "attributes" bean satisfies this, using the Jakarta Commons Attributes API to obtain attribute information.
(The application code must have been compiled using the Commons Attributes compilation task.)

The `/annotation` directory of the JPetStore sample application contains an analogous example for auto-proxying driven by JDK 1.5+ annotations.
The following configuration enables automatic detection of Spring's `Transactional` annotation, leading to implicit proxies for beans containing that annotation:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="transactionInterceptor"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="transactionInterceptor"
    class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="transactionAttributeSource"&gt;
    &lt;bean class="org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The `TransactionInterceptor` defined here depends on a `PlatformTransactionManager` definition, which is not included in this generic file (although it could be) because it will be specific to the application's transaction requirements (typically JTA, as in this example, or Hibernate, JDO or JDBC):

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="transactionManager"
    class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
TIP: If you require only declarative transaction management, using these generic XML definitions will result in Spring automatically proxying all classes or methods with transaction attributes.
You won't need to work directly with AOP, and the programming model is similar to that of .NET ServicedComponents.

This mechanism is extensible.
It's possible to do autoproxying based on custom attributes.
You need to:

* Define your custom attribute.
* Specify an Advisor with the necessary advice, including a pointcut that is triggered by the presence of the custom attribute on a class or method.
  You may be able to use an existing advice, merely implementing a static pointcut that picks up the custom attribute.

It's possible for such advisors to be unique to each advised class (for example, mixins): they simply need to be defined as prototype, rather than singleton, bean definitions.
For example, the `LockMixin` introduction interceptor from the Spring test suite, shown above, could be used in conjunction with an attribute-driven pointcut to target a mixin, as shown here.
We use the generic `DefaultPointcutAdvisor`, configured using JavaBean properties:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="lockMixin" class="org.springframework.aop.LockMixin"
    scope="prototype"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="lockableAdvisor" class="org.springframework.aop.support.DefaultPointcutAdvisor"
    scope="prototype"&gt;
  &lt;property name="pointcut" ref="myAttributeAwarePointcut"/&gt;
  &lt;property name="advice" ref="lockMixin"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="anyBean" class="anyclass" &#8230;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If the attribute aware pointcut matches any methods in the `anyBean` or other bean definitions, the mixin will be applied.
Note that both `lockMixin` and `lockableAdvisor` definitions are prototypes.
The `myAttributeAwarePointcut` pointcut can be a singleton definition, as it doesn't hold state for individual advised objects.

== Using TargetSources

Spring offers the concept of a _TargetSource_, expressed in the `org.springframework.aop.TargetSource` interface.
This interface is responsible for returning the "target object" implementing the join point.
The `TargetSource` implementation is asked for a target instance each time the AOP proxy handles a method invocation.

Developers using Spring AOP don't normally need to work directly with TargetSources, but this provides a powerful means of supporting pooling, hot swappable and other sophisticated targets.
For example, a pooling TargetSource can return a different target instance for each invocation, using a pool to manage instances.

If you do not specify a TargetSource, a default implementation is used that wraps a local object.
The same target is returned for each invocation (as you would expect).

Let's look at the standard target sources provided with Spring, and how you can use them.

TIP: When using a custom target source, your target will usually need to be a prototype rather than a singleton bean definition.
This allows Spring to create a new target instance when required.

=== Hot swappable target sources

The `org.springframework.aop.target.HotSwappableTargetSource` exists to allow the target of an AOP proxy to be switched while allowing callers to keep their references to it.

Changing the target source's target takes effect immediately.
The `HotSwappableTargetSource` is threadsafe.

You can change the target via the `swap()` method on HotSwappableTargetSource as follows:


[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>HotSwappableTargetSource swapper =
    (HotSwappableTargetSource) beanFactory.getBean("swapper");
Object oldTarget = swapper.swap(newTarget);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The XML definitions required look as follows:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="initialTarget" class="mycompany.OldTarget"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="swapper" class="org.springframework.aop.target.HotSwappableTargetSource"&gt;
  &lt;constructor-arg ref="initialTarget"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="swappable" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="targetSource" ref="swapper"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above `swap()` call changes the target of the swappable bean.
Clients who hold a reference to that bean will be unaware of the change, but will immediately start hitting the new target.

Although this example doesn't add any advice - and it's not necessary to add advice to use a `TargetSource` - of course any `TargetSource` can be used in conjunction with arbitrary advice.

=== Pooling target sources

Using a pooling target source provides a similar programming model to stateless session EJBs, in which a pool of identical instances is maintained, with method invocations going to free objects in the pool.

A crucial difference between Spring pooling and SLSB pooling is that Spring pooling can be applied to any POJO. As with Spring in general, this service can be applied in a non-invasive way.

Spring provides out-of-the-box support for Jakarta Commons Pool 1.3, which provides a fairly efficient pooling implementation.
You'll need the commons-pool Jar on your application's classpath to use this feature.
It's also possible to subclass `org.springframework.aop.target.AbstractPoolingTargetSource` to support any other pooling API.

Sample configuration is shown below:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="businessObjectTarget" class="com.mycompany.MyBusinessObject"
    scope="prototype"&gt;
  &#8230; properties omitted
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="poolTargetSource" class="org.springframework.aop.target.CommonsPoolTargetSource"&gt;
  &lt;property name="targetBeanName" value="businessObjectTarget"/&gt;
  &lt;property name="maxSize" value="25"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="businessObject" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="targetSource" ref="poolTargetSource"/&gt;
  &lt;property name="interceptorNames" value="myInterceptor"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that the target object - "businessObjectTarget" in the example - _must_ be a prototype.
This allows the `PoolingTargetSource` implementation to create new instances of the target to grow the pool as necessary.
See the Javadoc for `AbstractPoolingTargetSource` and the concrete subclass you wish to use for information about its properties: "maxSize" is the most basic, and always guaranteed to be present.

In this case, "myInterceptor" is the name of an interceptor that would need to be defined in the same IoC context.
However, it isn't necessary to specify interceptors to use pooling.
If you want only pooling, and no other advice, don't set the interceptorNames property at all.

It's possible to configure Spring so as to be able to cast any pooled object to the `org.springframework.aop.target.PoolingConfig` interface, which exposes information about the configuration and current size of the pool through an introduction.
You'll need to define an advisor like this:


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="poolConfigAdvisor" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean"&gt;
  &lt;property name="targetObject" ref="poolTargetSource"/&gt;
  &lt;property name="targetMethod" value="getPoolingConfigMixin"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
This advisor is obtained by calling a convenience method on the `AbstractPoolingTargetSource` class, hence the use of MethodInvokingFactoryBean.
This advisor's name ("poolConfigAdvisor" here) must be in the list of interceptors names in the ProxyFactoryBean exposing the pooled object.

The cast will look as follows:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>PoolingConfig conf = (PoolingConfig) beanFactory.getBean("businessObject");
System.out.println("Max pool size is " + conf.getMaxSize());</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: Pooling stateless service objects is not usually necessary.
We don't believe it should be the default choice, as most stateless objects are naturally thread safe, and instance pooling is problematic if resources are cached.

Simpler pooling is available using autoproxying.
It's possible to set the TargetSources used by any autoproxy creator.

=== Prototype target sources

Setting up a "prototype" target source is similar to a pooling TargetSource.
In this case, a new instance of the target will be created on every method invocation.
Although the cost of creating a new object isn't high in a modern JVM, the cost of wiring up the new object (satisfying its IoC dependencies) may be more expensive.
Thus you shouldn't use this approach without very good reason.

To do this, you could modify the `poolTargetSource` definition shown above as follows.
(I've also changed the name, for clarity.)

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="prototypeTargetSource" class="org.springframework.aop.target.PrototypeTargetSource"&gt;
  &lt;property name="targetBeanName" ref="businessObjectTarget"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
There's only one property: the name of the target bean.
Inheritance is used in the TargetSource implementations to ensure consistent naming.
As with the pooling target source, the target bean must be a prototype bean definition.

=== [class]`ThreadLocal` target sources

[class]`ThreadLocal` target sources are useful if you need an object to be created for each incoming request (per thread that is).
The concept of a [class]`ThreadLocal` provide a JDK-wide facility to transparently store resource alongside a thread.
Setting up a [class]`ThreadLocalTargetSource` is pretty much the same as was explained for the other types of target source:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="threadlocalTargetSource" class="org.springframework.aop.target.ThreadLocalTargetSource"&gt;
  &lt;property name="targetBeanName" value="businessObjectTarget"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: ThreadLocals come with serious issues (potentially resulting in memory leaks) when incorrectly using them in a multi-threaded and multi-classloader environments.
One should always consider wrapping a threadlocal in some other class and never directly use the [class]`ThreadLocal` itself (except of course in the wrapper class).
Also, one should always remember to correctly set and unset (where the latter simply involved a call to `ThreadLocal.set(null)`) the resource local to the thread.
Unsetting should be done in any case since not unsetting it might result in problematic behavior.
Spring's ThreadLocal support does this for you and should always be considered in favor of using ThreadLocals without other proper handling code.

== Defining new [interface]`Advice` types

Spring AOP is designed to be extensible.
While the interception implementation strategy is presently used internally, it is possible to support arbitrary advice types in addition to the out-of-the-box interception around advice, before, throws advice and after returning advice.

The `org.springframework.aop.framework.adapter` package is an SPI package allowing support for new custom advice types to be added without changing the core framework.
The only constraint on a custom [interface]`Advice` type is that it must implement the [interface]`org.aopalliance.aop.Advice` tag interface.

Please refer to the `org.springframework.aop.framework.adapter` package's Javadocs for further information.

== Further resources

Please refer to the Spring sample applications for further examples of Spring AOP:

* The JPetStore's default configuration illustrates the use of the [class]`TransactionProxyFactoryBean` for declarative transaction management.
* The `/attributes` directory of the JPetStore illustrates the use of attribute-driven declarative transaction management.

:numbered:


:numbered!:

[appendix]
= Migrating to Spring Framework 3.1

In this appendix we discuss what users will want to know when upgrading to Spring Framework 3.1.
For a general overview of features, please see &lt;&lt;new-in-3.1&gt;&gt;

== Component scanning against the "org" base package

Spring Framework 3.1 introduces a number of `@Configuration` classes such as `org.springframework.cache.annotation.ProxyCachingConfiguration
    ` and `org.springframework.scheduling.annotation.ProxyAsyncConfiguration`.
Because `@Configuration` is ultimately meta-annotated with Spring's `@Component` annotation, these classes will inadvertently be scanned and processed by the container for any component-scanning directive against the unqualified "org" package, e.g.:
[source,xml]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        &lt;context:component-scan base-package="org"/&gt;
---- Therefore, in order to avoid errors like the one reported in &lt;&lt;,SPR-9843&gt;&gt;, any such directives should be updated to at least one more level of qualification e.g.:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint xml language-xml"><code>
      &lt;context:component-scan base-package="org.xyz"/&gt;
---- Alternatively, an `exclude-filter` may be used.
See &lt;&lt;beans-scanning-filters,`context:component-scan`&gt;&gt; documentation for details.

:numbered:


:numbered!:

[appendix]
= Migrating to Spring Framework 3.2

In this appendix we discuss what users will want to know when upgrading to Spring Framework 3.2.
For a general overview of features, please see &lt;&lt;new-in-3.2&gt;&gt;

== Newly optional dependencies

Certain inter-module dependencies are now `optional` at the Maven POM level where they were once required.
For example, `spring-tx` and its dependence on `spring-context`.
This may result in `
    ClassNotFoundErrors` or other similar problems for users that have been relying on transitive dependency management to pull in affected downstream `spring-*
    `.
To resolve this problem, simply add the appropriate missing jars to your build configuration.

== EHCache support moved to spring-context-support

Along with Spring's new JCache support, the EHCache support classes in the `org.springframework.cache.ehcache` package moved from the `spring-context` module to `spring-context-support`.

== Inlining of spring-asm jar

In versions 3.0 and 3.1, we published a discrete `spring-asm` containing repackaged `org.objectweb.asm` 3.x sources.
As of Spring Framework 3.2, we have upgraded to `org.objectweb.asm` 4.0 and done away with the separate module jar, favoring inlining these classes directly within `spring-core`.
This should cause no migration issue for most users; but on the off chance that you have `spring-asm` declared directly within your project's build script, you'll want to remove it when upgrading to Spring Framework 3.2.

== Explicit CGLIB dependency no longer required

In prior versions, users of Spring's subclass-based AOP proxies (e.g.
via `proxy-target-class="true"`) and `@Configuration` class support were required to declare an explicit dependency on CGLIB 2.2.
As of Spring Framework 3.2, we now repackage and inline the newly-released CGLIB 3.0.

This means greater convenience for users, as well as correct functionality for Java 7 users who are creating subclass proxies of types that contain `
    invokedynamic` bytecode instructions.
Repackaging CGLIB internally ensures no classpath conflicts with other third party frameworks that may depend on other versions of CGLIB.

== For OSGi users

OSGi metadata is no longer published within individual Spring Framework jar MANIFEST.MF files.
Please see this &lt;&lt;,announcement&gt;&gt; for more information about how users can get OSGi-ready versions of Spring Framework 3.2 jars.

== MVC Java Config and MVC Namespace

As explained in &lt;&lt;mvc-config-content-negotiation&gt;&gt;, both the MVC Java config and the MVC namespace register extensions such as [file]`.json` and [file]`.xml` if the corresponding classpath dependencies are present.
That means controller methods may now return JSON or XML formatted content if those extensions are present in the request URI, even if the 'Accept' header doesn't request those media types.

The newly added support for matrix variables is explained in &lt;&lt;mvc-ann-matrix-variables&gt;&gt;.
To preserve backward compatibility, by default, semicolon content is removed from incoming request URIs and therefore [interface]`@MatrixVariable` cannot be used without additional configuration.
However, when using the MVC Java config and the MVC namespace, semicolon content is left in the URI so that matrix variables are automatically supported.
The removal of semicolon content is controlled through the [class]`UrlPathHelper` property of [class]`RequestMappingHandlerMapping`.

== Decoding of URI Variable Values

URI variable values now get decoded when `UrlPathHelper.setUrlDecode` is set to `false`.
See &lt;&lt;,SPR-9098&gt;&gt;.

== HTTP PATCH method

The [class]`DispatcherServlet` now allows the HTTP PATCH method where previously it didn't.

== Tiles 3

Besides the version number change, the set of Tiles dependencies has also changed.
You will need to have a subset or all of [file]`tiles-request-api`, [file]`tiles-api`, [file]`tiles-core`, [file]`tiles-servlet`, [file]`tiles-jsp`, [file]`tiles-el`.


== Spring MVC Test standalone project

If migrating from the &lt;&lt;,spring-test-mvc&gt;&gt; standalone project to the [file]`spring-test` module in Spring Framework 3.2, you will need to adjust the root package to be [class]`org.springframework.test.web.servlet`.

You will no longer be able to use the [class]`MockMvcBuilders` `annotationConfigSetup` and `xmlConfigSetup` options.
Instead you'll need to switch to using the [interface]`@WebAppConfiguration` support of [file]`spring-test` for loading Spring configuration, then inject a [interface]`WebApplicationContext` into the test and use it to create a [class]`MockMvc`.
See &lt;&lt;spring-mvc-test-framework&gt;&gt; for details.

== Spring Test Dependencies

The `spring-test` module has been upgraded to depend on JUnit 4.11 (`junit:junit`), TestNG 6.5.2 (`org.testng:testng`), and Hamcrest Core 1.3 (`org.hamcrest:hamcrest-core`).
Each of these dependencies is declared as an _optional_ dependency in the Maven POM. Furthermore, it is important to note that the JUnit team has stopped inlining Hamcrest Core within the `junit:junit` Maven artifact as of JUnit 4.11.
Hamcrest Core is now a _required_ transitive dependency of `junit`, and users may therefore need to remove any exclusions on `hamcrest-core` that they had previously configured for their build.

== Public API changes

=== JDiff reports

 Select JDiff reports are now being published to provide users with a convenient means of understanding what's changed between versions.
Going forward these will be published between each minor version, e.g.
from 3.1.3.RELEASE to 3.1.4.RELEASE; from the latest maintenance version to the latest GA release, e.g.
&lt;&lt;,
      3.1.3.RELEASE to 3.2.0.RELEASE&gt;&gt;; and in between each milestone and/or RC for users who are tracking next-generation development, e.g.
&lt;&lt;,
      3.2.0.RC2 to 3.2.0.RELEASE&gt;&gt;.


=== Deprecations

The following packages and types have been wholly or partially deprecated in Spring Framework 3.2 and may be removed in a future version.
Click through to the linked Javadoc for each item for exact details.
See also the &lt;&lt;,
      complete list of deprecations&gt;&gt; in the framework.

*  &lt;&lt;,
            org.springframework.orm.ibatis&gt;&gt;
*  &lt;&lt;,
            org.springframework.scheduling.backportconcurrent&gt;&gt;
*  &lt;&lt;,
            org.springframework.ejb.support&gt;&gt;
*  &lt;&lt;,
            org.springframework.http.converter.xml.XmlAwareFormHttpMessageConverter&gt;&gt;
*  &lt;&lt;,
            org.springframework.web.jsf.DelegatingVariableResolver&gt;&gt;
*  &lt;&lt;,
            org.springframework.web.jsf.SpringBeanVariableResolver&gt;&gt;
*  &lt;&lt;,
            org.springframework.ui.velocity.CommonsLoggingLogSystem&gt;&gt;
*  &lt;&lt;,
            org.springframework.ui.velocity.VelocityEngineUtils&gt;&gt;
*  &lt;&lt;,
            org.springframework.beans.factory.config.BeanReferenceFactoryBean&gt;&gt;
*  &lt;&lt;,
            org.springframework.beans.factory.config.CommonsLogFactoryBean&gt;&gt;
*  &lt;&lt;,
            org.springframework.beans.instrument.classloading.oc4j.OC4JLoadTimeWeaver&gt;&gt;
*  &lt;&lt;,
            org.springframework.transaction.jta.OC4JJtaTransactionManager&gt;&gt;
*  &lt;&lt;,
            org.springframework.web.util.ExpressionEvaluationUtils&gt;&gt;
*  &lt;&lt;,
            org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter&gt;&gt;
*  &lt;&lt;,
            org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerExceptionResolver&gt;&gt;
*  &lt;&lt;,
            org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping&gt;&gt;
*  &lt;&lt;,
            org.springframework.web.servlet.mvc.annotation.ServletAnnotationMappingUtils&gt;&gt;
*  &lt;&lt;,
            org.springframework.jmx.support.MBeanRegistrationSupport&gt;&gt;
*  &lt;&lt;,
            org.springframework.test.context.ContextConfigurationAttributes&gt;&gt;
*  &lt;&lt;,
            org.springframework.test.context.junit4.AbstractTransactionalJUnit4SpringContextTests&gt;&gt;: use of the  instance variable has been deprecated in favor of the new  instance variable.
*  &lt;&lt;,
            org.springframework.test.context.testng.AbstractTransactionalTestNGSpringContextTests&gt;&gt;: use of the  instance variable has been deprecated in favor of the new  instance variable.
*  &lt;&lt;,
            org.springframework.test.jdbc.SimpleJdbcTestUtils&gt;&gt; has been deprecated in favor of [class]`JdbcTestUtils` which now contains all of the functionality previously available in [class]`SimpleJdbcTestUtils`.
*  &lt;&lt;,
            org.springframework.web.servlet.view.ContentNegotiatingViewResolver&gt;&gt;
*  &lt;&lt;,
            org.springframework.transaction.interceptor.TransactionAspectUtils&gt;&gt;
*  &lt;&lt;,
            org.springframework.http.HttpStatus&gt;&gt;
*  &lt;&lt;,
            org.springframework.web.util.UriUtils&gt;&gt;
*  &lt;&lt;,
            org.springframework.orm.jpa.vendor.TopLinkJpaDialect&gt;&gt;
*  &lt;&lt;,
            org.springframework.orm.jpa.vendor.TopLinkJpaVendorAdapter&gt;&gt;
*  &lt;&lt;,
            org.springframework.orm.util.CachingMapDecorator&gt;&gt;

:numbered:


:numbered!:

[appendix]
= XML Schema-based configuration

== Introduction

This appendix details the XML Schema-based configuration introduced in Spring 2.0 and enhanced and extended in Spring 2.5 and 3.0.

.DTD support?
****
Authoring Spring configuration files using the older DTD style is still fully supported.

Nothing will break if you forego the use of the new XML Schema-based approach to authoring Spring XML configuration files.
All that you lose out on is the opportunity to have more succinct and clearer configuration.
Regardless of whether the XML configuration is DTD- or Schema-based, in the end it all boils down to the same object model in the container (namely one or more [interface]`BeanDefinition` instances).
****

The central motivation for moving to XML Schema based configuration files was to make Spring XML configuration easier.
The _'classic'_ `&lt;bean/&gt;`-based approach is good, but its generic-nature comes with a price in terms of configuration overhead.

From the Spring IoC containers point-of-view, _everything_ is a bean.
That's great news for the Spring IoC container, because if everything is a bean then everything can be treated in the exact same fashion.
The same, however, is not true from a developer's point-of-view.
The objects defined in a Spring XML configuration file are not all generic, vanilla beans.
Usually, each bean requires some degree of specific configuration.

Spring 2.0's new XML Schema-based configuration addresses this issue.
The `&lt;bean/&gt;` element is still present, and if you wanted to, you could continue to write the _exact same_ style of Spring XML configuration using only `&lt;bean/&gt;` elements.
The new XML Schema-based configuration does, however, make Spring XML configuration files substantially clearer to read.
In addition, it allows you to express the intent of a bean definition.

The key thing to remember is that the new custom tags work best for infrastructure or integration beans: for example, AOP, collections, transactions, integration with 3rd-party frameworks such as Mule, etc., while the existing bean tags are best suited to application-specific beans, such as DAOs, service layer objects, validators, etc.

The examples included below will hopefully convince you that the inclusion of XML Schema support in Spring 2.0 was a good idea.
The reception in the community has been encouraging; also, please note the fact that this new configuration mechanism is totally customisable and extensible.
This means you can write your own domain-specific configuration tags that would better represent your application's domain; the process involved in doing so is covered in the appendix entitled &lt;&lt;extensible-xml&gt;&gt;.

== XML Schema-based configuration

=== Referencing the schemas

To switch over from the DTD-style to the new XML Schema-style, you need to make the following change.

[source,xml]</code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN"
    "http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;</p>
</div>
<div class="paragraph">
<p>&lt;beans&gt;</p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The equivalent file in the XML Schema-style would be...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;">http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: The `'xsi:schemaLocation'` fragment is not actually required, but can be included to reference a local copy of a schema (which can be useful during development).

The above Spring XML configuration fragment is boilerplate that you can copy and paste (!) and then plug `&lt;bean/&gt;` definitions into like you have always done.
However, the entire point of switching over is to take advantage of the new Spring 2.0 XML tags since they make configuration easier.
The section entitled &lt;&lt;xsd-config-body-schemas-util&gt;&gt; demonstrates how you can start immediately by using some of the more common utility tags.

The rest of this chapter is devoted to showing examples of the new Spring XML Schema based configuration, with at least one example for every new tag.
The format follows a before and after style, with a _before_ snippet of XML showing the old (but still 100% legal and supported) style, followed immediately by an _after_ example showing the equivalent in the new XML Schema-based style.

=== The `util` schema

First up is coverage of the `util` tags.
As the name implies, the `util` tags deal with common, _utility_ configuration issues, such as configuring collections, referencing constants, and suchlike.

To use the tags in the `util` schema, you need to have the following preamble at the top of your Spring XML configuration file; the text in the snippet below references the correct schema so that the tags in the `util` namespace are available to you.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/util">http://www.springframework.org/schema/util</a> <a href="http://www.springframework.org/schema/util/spring-util.xsd"&gt;">http://www.springframework.org/schema/util/spring-util.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== `&lt;util:constant/&gt;`

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="&#8230;" class="&#8230;"&gt;
  &lt;property name="isolation"&gt;
    &lt;bean id="java.sql.Connection.TRANSACTION_SERIALIZABLE"
    class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean" /&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above configuration uses a Spring [interface]`FactoryBean` implementation, the [class]`FieldRetrievingFactoryBean`, to set the value of the `'isolation'` property on a bean to the value of the `'java.sql.Connection.TRANSACTION_SERIALIZABLE'` constant.
This is all well and good, but it is a tad verbose and (unnecessarily) exposes Spring's internal plumbing to the end user.


The following XML Schema-based version is more concise and clearly expresses the developer's intent (_'inject this constant
                value'_), and it just reads better.


[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="&#8230;" class="&#8230;"&gt;
  &lt;property name="isolation"&gt;
    &lt;util:constant static-field="java.sql.Connection.TRANSACTION_SERIALIZABLE"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
===== Setting a bean property or constructor arg from a field value

 &lt;&lt;,[class]`FieldRetrievingFactoryBean`&gt;&gt; is a [interface]`FactoryBean` which retrieves a `static` or non-static field value.
It is typically used for retrieving `public` `static` `final` constants, which may then be used to set a property value or constructor arg for another bean.


 Find below an example which shows how a `static` field is exposed, by using the &lt;&lt;,`staticField`&gt;&gt; property:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="myField"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"&gt;
  &lt;property name="staticField" value="java.sql.Connection.TRANSACTION_SERIALIZABLE"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
There is also a convenience usage form where the `static` field is specified as the bean name:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="java.sql.Connection.TRANSACTION_SERIALIZABLE"
    class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
 This does mean that there is no longer any choice in what the bean id is (so any other bean that refers to it will also have to use this longer name), but this form is very concise to define, and very convenient to use as an inner bean since the id doesn't have to be specified for the bean reference:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="&#8230;" class="&#8230;"&gt;
  &lt;property name="isolation"&gt;
    &lt;bean id="java.sql.Connection.TRANSACTION_SERIALIZABLE"
          class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean" /&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
 It is also possible to access a non-static (instance) field of another bean, as described in the API documentation for the &lt;&lt;,[class]`FieldRetrievingFactoryBean`&gt;&gt; class.


 Injecting enum values into beans as either property or constructor arguments is very easy to do in Spring, in that you don't actually have to _do_ anything or know anything about the Spring internals (or even about classes such as the [class]`FieldRetrievingFactoryBean`).
Let's look at an example to see how easy injecting an enum value is; consider this JDK 5 enum:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package javax.persistence;</p>
</div>
<div class="paragraph">
<p>public enum PersistenceContextType {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TRANSACTION,
EXTENDED</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Now consider a setter of type [class]`PersistenceContextType`:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package example;</p>
</div>
<div class="paragraph">
<p>public class Client {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private PersistenceContextType persistenceContextType;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void setPersistenceContextType(PersistenceContextType type) {
        this.persistenceContextType = type;
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
..
and the corresponding bean definition:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean class="example.Client"&gt;
    &lt;property name="persistenceContextType" value="TRANSACTION" /&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
 This works for classic type-safe emulated enums (on JDK 1.4 and JDK 1.3) as well; Spring will automatically attempt to match the string property value to a constant on the enum class.


==== `&lt;util:property-path/&gt;`

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- target bean to be referenced by name -&#8594;
&lt;bean id="testBean" class="org.springframework.beans.TestBean" scope="prototype"&gt;
  &lt;property name="age" value="10"/&gt;
  &lt;property name="spouse"&gt;
    &lt;bean class="org.springframework.beans.TestBean"&gt;
      &lt;property name="age" value="11"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;!-- will result in 10, which is the value of property <em>age</em> of bean <em>testBean</em> -&#8594;
&lt;bean id="testBean.age" class="org.springframework.beans.factory.config.PropertyPathFactoryBean"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above configuration uses a Spring [interface]`FactoryBean` implementation, the [class]`PropertyPathFactoryBean`, to create a bean (of type [class]`int`) called `'testBean.age'` that has a value equal to the `'age'` property of the `'testBean'` bean.


After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- target bean to be referenced by name -&#8594;
&lt;bean id="testBean" class="org.springframework.beans.TestBean" scope="prototype"&gt;
  &lt;property name="age" value="10"/&gt;
  &lt;property name="spouse"&gt;
    &lt;bean class="org.springframework.beans.TestBean"&gt;
      &lt;property name="age" value="11"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;!-- will result in 10, which is the value of property <em>age</em> of bean <em>testBean</em> -&#8594;
&lt;util:property-path id="name" path="testBean.age"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The value of the `'path'` attribute of the `&lt;property-path/&gt;` tag follows the form `'beanName.beanProperty'`.

===== Using `&lt;util:property-path/&gt;` to set a bean property or constructor-argument

[class]`PropertyPathFactoryBean` is a [interface]`FactoryBean` that evaluates a property path on a given target object.
The target object can be specified directly or via a bean name.
This value may then be used in another bean definition as a property value or constructor argument.

Here's an example where a path is used against another bean, by name:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="person" class="org.springframework.beans.TestBean" scope="prototype"&gt;
  &lt;property name="age" value="10"/&gt;
  &lt;property name="spouse"&gt;
    &lt;bean class="org.springframework.beans.TestBean"&gt;
      &lt;property name="age" value="11"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="theAge"
    class="org.springframework.beans.factory.config.PropertyPathFactoryBean"&gt;
  &lt;property name="targetBeanName" value="person"/&gt;
  &lt;property name="propertyPath" value="spouse.age"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In this example, a path is evaluated against an inner bean:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- will result in 12, which is the value of property <em>age</em> of the inner bean -&#8594;
&lt;bean id="theAge"
    class="org.springframework.beans.factory.config.PropertyPathFactoryBean"&gt;
  &lt;property name="targetObject"&gt;
    &lt;bean class="org.springframework.beans.TestBean"&gt;
      &lt;property name="age" value="12"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
  &lt;property name="propertyPath" value="age"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
There is also a shortcut form, where the bean name is the property path.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- will result in 10, which is the value of property <em>age</em> of bean <em>person</em> -&#8594;
&lt;bean id="person.age"
    class="org.springframework.beans.factory.config.PropertyPathFactoryBean"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
This form does mean that there is no choice in the name of the bean.
Any reference to it will also have to use the same id, which is the path.
Of course, if used as an inner bean, there is no need to refer to it at all:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="&#8230;" class="&#8230;"&gt;
  &lt;property name="age"&gt;
    &lt;bean id="person.age"
        class="org.springframework.beans.factory.config.PropertyPathFactoryBean"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The result type may be specifically set in the actual definition.
This is not necessary for most use cases, but can be of use for some.
Please see the Javadocs for more info on this feature.

==== `&lt;util:properties/&gt;`

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- creates a java.util.Properties instance with values loaded from the supplied location -&#8594;
&lt;bean id="jdbcConfiguration" class="org.springframework.beans.factory.config.PropertiesFactoryBean"&gt;
  &lt;property name="location" value="classpath:com/foo/jdbc-production.properties"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above configuration uses a Spring [interface]`FactoryBean` implementation, the [class]`PropertiesFactoryBean`, to instantiate a [class]`java.util.Properties` instance with values loaded from the supplied &lt;&lt;resources,[interface]`Resource`&gt;&gt; location).


After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- creates a java.util.Properties instance with values loaded from the supplied location -&#8594;
&lt;util:properties id="jdbcConfiguration" location="classpath:com/foo/jdbc-production.properties"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== `&lt;util:list/&gt;`

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- creates a java.util.List instance with values loaded from the supplied <em>sourceList</em> -&#8594;
&lt;bean id="emails" class="org.springframework.beans.factory.config.ListFactoryBean"&gt;
  &lt;property name="sourceList"&gt;
      &lt;list&gt;
        &lt;value&gt;<a href="mailto:pechorin@hero.org">pechorin@hero.org</a>&lt;/value&gt;
        &lt;value&gt;<a href="mailto:raskolnikov@slums.org">raskolnikov@slums.org</a>&lt;/value&gt;
        &lt;value&gt;<a href="mailto:stavrogin@gov.org">stavrogin@gov.org</a>&lt;/value&gt;
        &lt;value&gt;<a href="mailto:porfiry@gov.org">porfiry@gov.org</a>&lt;/value&gt;
      &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above configuration uses a Spring [interface]`FactoryBean` implementation, the [class]`ListFactoryBean`, to create a [class]`java.util.List` instance initialized with values taken from the supplied `'sourceList'`.


After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- creates a java.util.List instance with the supplied values -&#8594;
&lt;util:list id="emails"&gt;
    &lt;value&gt;<a href="mailto:pechorin@hero.org">pechorin@hero.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:raskolnikov@slums.org">raskolnikov@slums.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:stavrogin@gov.org">stavrogin@gov.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:porfiry@gov.org">porfiry@gov.org</a>&lt;/value&gt;
&lt;/util:list&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
You can also explicitly control the exact type of [interface]`List` that will be instantiated and populated via the use of the `'list-class'` attribute on the `&lt;util:list/&gt;` element.
For example, if we really need a [class]`java.util.LinkedList` to be instantiated, we could use the following configuration:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;util:list id="emails" list-class="java.util.LinkedList"&gt;
    &lt;value&gt;<a href="mailto:jackshaftoe@vagabond.org">jackshaftoe@vagabond.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:eliza@thinkingmanscrumpet.org">eliza@thinkingmanscrumpet.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:vanhoek@pirate.org">vanhoek@pirate.org</a>&lt;/value&gt;
    &lt;value&gt;d&#8217;<a href="mailto:Arcachon@nemesis.org">Arcachon@nemesis.org</a>&lt;/value&gt;
&lt;/util:list&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If no `'list-class'` attribute is supplied, a [interface]`List` implementation will be chosen by the container.

==== `&lt;util:map/&gt;`

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- creates a java.util.Map instance with values loaded from the supplied <em>sourceMap</em> -&#8594;
&lt;bean id="emails" class="org.springframework.beans.factory.config.MapFactoryBean"&gt;
  &lt;property name="sourceMap"&gt;
      &lt;map&gt;
        &lt;entry key="pechorin" value="<a href="mailto:pechorin@hero.org">pechorin@hero.org</a>"/&gt;
        &lt;entry key="raskolnikov" value="<a href="mailto:raskolnikov@slums.org">raskolnikov@slums.org</a>"/&gt;
        &lt;entry key="stavrogin" value="<a href="mailto:stavrogin@gov.org">stavrogin@gov.org</a>"/&gt;
        &lt;entry key="porfiry" value="<a href="mailto:porfiry@gov.org">porfiry@gov.org</a>"/&gt;
      &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above configuration uses a Spring [interface]`FactoryBean` implementation, the [class]`MapFactoryBean`, to create a [class]`java.util.Map` instance initialized with key-value pairs taken from the supplied `'sourceMap'`.


After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- creates a java.util.Map instance with the supplied key-value pairs -&#8594;
&lt;util:map id="emails"&gt;
    &lt;entry key="pechorin" value="<a href="mailto:pechorin@hero.org">pechorin@hero.org</a>"/&gt;
    &lt;entry key="raskolnikov" value="<a href="mailto:raskolnikov@slums.org">raskolnikov@slums.org</a>"/&gt;
    &lt;entry key="stavrogin" value="<a href="mailto:stavrogin@gov.org">stavrogin@gov.org</a>"/&gt;
    &lt;entry key="porfiry" value="<a href="mailto:porfiry@gov.org">porfiry@gov.org</a>"/&gt;
&lt;/util:map&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
You can also explicitly control the exact type of [interface]`Map` that will be instantiated and populated via the use of the `'map-class'` attribute on the `&lt;util:map/&gt;` element.
For example, if we really need a [class]`java.util.TreeMap` to be instantiated, we could use the following configuration:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;util:map id="emails" map-class="java.util.TreeMap"&gt;
    &lt;entry key="pechorin" value="<a href="mailto:pechorin@hero.org">pechorin@hero.org</a>"/&gt;
    &lt;entry key="raskolnikov" value="<a href="mailto:raskolnikov@slums.org">raskolnikov@slums.org</a>"/&gt;
    &lt;entry key="stavrogin" value="<a href="mailto:stavrogin@gov.org">stavrogin@gov.org</a>"/&gt;
    &lt;entry key="porfiry" value="<a href="mailto:porfiry@gov.org">porfiry@gov.org</a>"/&gt;
&lt;/util:map&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If no `'map-class'` attribute is supplied, a [interface]`Map` implementation will be chosen by the container.

==== `&lt;util:set/&gt;`

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- creates a java.util.Set instance with values loaded from the supplied <em>sourceSet</em> -&#8594;
&lt;bean id="emails" class="org.springframework.beans.factory.config.SetFactoryBean"&gt;
  &lt;property name="sourceSet"&gt;
      &lt;set&gt;
        &lt;value&gt;<a href="mailto:pechorin@hero.org">pechorin@hero.org</a>&lt;/value&gt;
        &lt;value&gt;<a href="mailto:raskolnikov@slums.org">raskolnikov@slums.org</a>&lt;/value&gt;
        &lt;value&gt;<a href="mailto:stavrogin@gov.org">stavrogin@gov.org</a>&lt;/value&gt;
        &lt;value&gt;<a href="mailto:porfiry@gov.org">porfiry@gov.org</a>&lt;/value&gt;
      &lt;/set&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above configuration uses a Spring [interface]`FactoryBean` implementation, the [class]`SetFactoryBean`, to create a [class]`java.util.Set` instance initialized with values taken from the supplied `'sourceSet'`.


After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- creates a java.util.Set instance with the supplied values -&#8594;
&lt;util:set id="emails"&gt;
    &lt;value&gt;<a href="mailto:pechorin@hero.org">pechorin@hero.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:raskolnikov@slums.org">raskolnikov@slums.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:stavrogin@gov.org">stavrogin@gov.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:porfiry@gov.org">porfiry@gov.org</a>&lt;/value&gt;
&lt;/util:set&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
You can also explicitly control the exact type of [interface]`Set` that will be instantiated and populated via the use of the `'set-class'` attribute on the `&lt;util:set/&gt;` element.
For example, if we really need a [class]`java.util.TreeSet` to be instantiated, we could use the following configuration:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;util:set id="emails" set-class="java.util.TreeSet"&gt;
    &lt;value&gt;<a href="mailto:pechorin@hero.org">pechorin@hero.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:raskolnikov@slums.org">raskolnikov@slums.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:stavrogin@gov.org">stavrogin@gov.org</a>&lt;/value&gt;
    &lt;value&gt;<a href="mailto:porfiry@gov.org">porfiry@gov.org</a>&lt;/value&gt;
&lt;/util:set&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
If no `'set-class'` attribute is supplied, a [interface]`Set` implementation will be chosen by the container.

=== The `jee` schema

The `jee` tags deal with Java EE (Java Enterprise Edition)-related configuration issues, such as looking up a JNDI object and defining EJB references.

To use the tags in the `jee` schema, you need to have the following preamble at the top of your Spring XML configuration file; the text in the following snippet references the correct schema so that the tags in the `jee` namespace are available to you.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/jee">http://www.springframework.org/schema/jee</a> <a href="http://www.springframework.org/schema/jee/spring-jee.xsd"&gt;">http://www.springframework.org/schema/jee/spring-jee.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== `&lt;jee:jndi-lookup/&gt;` (simple)

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="jdbc/MyDataSource"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="userDao" class="com.foo.JdbcUserDao"&gt;
    &lt;!-- Spring will do the cast automatically (as usual) -&#8594;
    &lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jee:jndi-lookup id="dataSource" jndi-name="jdbc/MyDataSource"/&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="userDao" class="com.foo.JdbcUserDao"&gt;
    &lt;!-- Spring will do the cast automatically (as usual) -&#8594;
    &lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== `&lt;jee:jndi-lookup/&gt;` (with single JNDI environment setting)

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="simple" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="jdbc/MyDataSource"/&gt;
    &lt;property name="jndiEnvironment"&gt;
        &lt;props&gt;
            &lt;prop key="foo"&gt;bar&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jee:jndi-lookup id="simple" jndi-name="jdbc/MyDataSource"&gt;
    &lt;jee:environment&gt;foo=bar&lt;/jee:environment&gt;
&lt;/jee:jndi-lookup&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== `&lt;jee:jndi-lookup/&gt;` (with multiple JNDI environment settings)

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="simple" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="jdbc/MyDataSource"/&gt;
    &lt;property name="jndiEnvironment"&gt;
        &lt;props&gt;
            &lt;prop key="foo"&gt;bar&lt;/prop&gt;
            &lt;prop key="ping"&gt;pong&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jee:jndi-lookup id="simple" jndi-name="jdbc/MyDataSource"&gt;
    &lt;!-- newline-separated, key-value pairs for the environment (standard Properties format) -&#8594;
    &lt;jee:environment&gt;
        foo=bar
        ping=pong
    &lt;/jee:environment&gt;
&lt;/jee:jndi-lookup&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== `&lt;jee:jndi-lookup/&gt;` (complex)

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="simple" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="jdbc/MyDataSource"/&gt;
    &lt;property name="cache" value="true"/&gt;
    &lt;property name="resourceRef" value="true"/&gt;
    &lt;property name="lookupOnStartup" value="false"/&gt;
    &lt;property name="expectedType" value="com.myapp.DefaultFoo"/&gt;
    &lt;property name="proxyInterface" value="com.myapp.Foo"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jee:jndi-lookup id="simple"
             jndi-name="jdbc/MyDataSource"
             cache="true"
             resource-ref="true"
             lookup-on-startup="false"
             expected-type="com.myapp.DefaultFoo"
             proxy-interface="com.myapp.Foo"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== `&lt;jee:local-slsb/&gt;` (simple)

The `&lt;jee:local-slsb/&gt;` tag configures a reference to an EJB Stateless SessionBean.

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="simple"
      class="org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean"&gt;
  &lt;property name="jndiName" value="ejb/RentalServiceBean"/&gt;
  &lt;property name="businessInterface" value="com.foo.service.RentalService"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jee:local-slsb id="simpleSlsb" jndi-name="ejb/RentalServiceBean"
    business-interface="com.foo.service.RentalService"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== `&lt;jee:local-slsb/&gt;` (complex)

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="complexLocalEjb"
      class="org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean"&gt;
  &lt;property name="jndiName" value="ejb/RentalServiceBean"/&gt;
  &lt;property name="businessInterface" value="com.foo.service.RentalService"/&gt;
  &lt;property name="cacheHome" value="true"/&gt;
  &lt;property name="lookupHomeOnStartup" value="true"/&gt;
  &lt;property name="resourceRef" value="true"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jee:local-slsb id="complexLocalEjb"
    jndi-name="ejb/RentalServiceBean"
    business-interface="com.foo.service.RentalService"
    cache-home="true"
    lookup-home-on-startup="true"
    resource-ref="true"&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
==== `&lt;jee:remote-slsb/&gt;`

The `&lt;jee:remote-slsb/&gt;` tag configures a reference to a `remote` EJB Stateless SessionBean.

Before...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="complexRemoteEjb"
      class="org.springframework.ejb.access.SimpleRemoteStatelessSessionProxyFactoryBean"&gt;
  &lt;property name="jndiName" value="ejb/MyRemoteBean"/&gt;
  &lt;property name="businessInterface" value="com.foo.service.RentalService"/&gt;
  &lt;property name="cacheHome" value="true"/&gt;
  &lt;property name="lookupHomeOnStartup" value="true"/&gt;
  &lt;property name="resourceRef" value="true"/&gt;
  &lt;property name="homeInterface" value="com.foo.service.RentalService"/&gt;
  &lt;property name="refreshHomeOnConnectFailure" value="true"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
After...

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;jee:remote-slsb id="complexRemoteEjb"
    jndi-name="ejb/MyRemoteBean"
    business-interface="com.foo.service.RentalService"
    cache-home="true"
    lookup-home-on-startup="true"
    resource-ref="true"
    home-interface="com.foo.service.RentalService"
    refresh-home-on-connect-failure="true"&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== The `lang` schema

The `lang` tags deal with exposing objects that have been written in a dynamic language such as JRuby or Groovy as beans in the Spring container.

These tags (and the dynamic language support) are comprehensively covered in the chapter entitled &lt;&lt;dynamic-language&gt;&gt;.
Please do consult that chapter for full details on this support and the `lang` tags themselves.

In the interest of completeness, to use the tags in the `lang` schema, you need to have the following preamble at the top of your Spring XML configuration file; the text in the following snippet references the correct schema so that the tags in the `lang` namespace are available to you.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/lang">http://www.springframework.org/schema/lang</a> <a href="http://www.springframework.org/schema/lang/spring-lang.xsd"&gt;">http://www.springframework.org/schema/lang/spring-lang.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== The `jms` schema

The `jms` tags deal with configuring JMS-related beans such as Spring's &lt;&lt;jms-mdp,MessageListenerContainers&gt;&gt;.
These tags are detailed in the section of the &lt;&lt;jms,JMS chapter&gt;&gt; entitled &lt;&lt;jms-namespace&gt;&gt;.
Please do consult that chapter for full details on this support and the `jms` tags themselves.

In the interest of completeness, to use the tags in the `jms` schema, you need to have the following preamble at the top of your Spring XML configuration file; the text in the following snippet references the correct schema so that the tags in the `jms` namespace are available to you.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jms="http://www.springframework.org/schema/jms"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/jms">http://www.springframework.org/schema/jms</a> <a href="http://www.springframework.org/schema/jms/spring-jms.xsd"&gt;">http://www.springframework.org/schema/jms/spring-jms.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== The `tx` (transaction) schema

The `tx` tags deal with configuring all of those beans in Spring's comprehensive support for transactions.
These tags are covered in the chapter entitled &lt;&lt;transaction&gt;&gt;.

TIP: You are strongly encouraged to look at the [file]`'spring-tx.xsd'` file that ships with the Spring distribution.
This file is (of course), the XML Schema for Spring's transaction configuration, and covers all of the various tags in the `tx` namespace, including attribute defaults and suchlike.
This file is documented inline, and thus the information is not repeated here in the interests of adhering to the DRY (Don't Repeat Yourself) principle.

In the interest of completeness, to use the tags in the `tx` schema, you need to have the following preamble at the top of your Spring XML configuration file; the text in the following snippet references the correct schema so that the tags in the `tx` namespace are available to you.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/tx">http://www.springframework.org/schema/tx</a> <a href="http://www.springframework.org/schema/tx/spring-tx.xsd">http://www.springframework.org/schema/tx/spring-tx.xsd</a>
<a href="http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop</a> <a href="http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;">http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: Often when using the tags in the `tx` namespace you will also be using the tags from the `aop` namespace (since the declarative transaction support in Spring is implemented using AOP).
The above XML snippet contains the relevant lines needed to reference the `aop` schema so that the tags in the `aop` namespace are available to you.

=== The `aop` schema

The `aop` tags deal with configuring all things AOP in Spring: this includes Spring's own proxy-based AOP framework and Spring's integration with the AspectJ AOP framework.
These tags are comprehensively covered in the chapter entitled &lt;&lt;aop&gt;&gt;.

In the interest of completeness, to use the tags in the `aop` schema, you need to have the following preamble at the top of your Spring XML configuration file; the text in the following snippet references the correct schema so that the tags in the `aop` namespace are available to you.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/aop">http://www.springframework.org/schema/aop</a> <a href="http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;">http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== The `context` schema

The `context` tags deal with [interface]`ApplicationContext` configuration that relates to plumbing - that is, not usually beans that are important to an end-user but rather beans that do a lot of grunt work in Spring, such as [interface]`BeanfactoryPostProcessors`.
The following snippet references the correct schema so that the tags in the `context` namespace are available to you.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/context">http://www.springframework.org/schema/context</a> <a href="http://www.springframework.org/schema/context/spring-context.xsd"&gt;">http://www.springframework.org/schema/context/spring-context.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: The `context` schema was only introduced in Spring 2.5.

==== `&lt;property-placeholder/&gt;`

This element activates the replacement of `${...}` placeholders, resolved against the specified properties file (as a &lt;&lt;resources,Spring resource location&gt;&gt;).
This element is a convenience mechanism that sets up a &lt;&lt;beans-factory-placeholderconfigurer,[class]`PropertyPlaceholderConfigurer`&gt;&gt; for you; if you need more control over the [class]`PropertyPlaceholderConfigurer`, just define one yourself explicitly.

==== `&lt;annotation-config/&gt;`

Activates the Spring infrastructure for various annotations to be detected in bean classes: Spring's &lt;&lt;beans-required-annotation,[interface]`@Required`&gt;&gt; and &lt;&lt;beans-annotation-config,[interface]`@Autowired`&gt;&gt;, as well as JSR 250's [interface]`@PostConstruct`, [interface]`@PreDestroy` and [interface]`@Resource` (if available), and JPA's [interface]`@PersistenceContext` and [interface]`@PersistenceUnit` (if available).
Alternatively, you can choose to activate the individual [interface]`BeanPostProcessors` for those annotations explicitly.

NOTE: This element does _not_ activate processing of Spring's &lt;&lt;transaction-declarative-annotations,[interface]`@Transactional`&gt;&gt; annotation.
Use the &lt;&lt;tx-decl-explained,`&lt;tx:annotation-driven/&gt;`&gt;&gt; element for that purpose.

==== `&lt;component-scan/&gt;`

This element is detailed in &lt;&lt;beans-annotation-config&gt;&gt;.

==== `&lt;load-time-weaver/&gt;`

This element is detailed in &lt;&lt;aop-aj-ltw&gt;&gt;.

==== `&lt;spring-configured/&gt;`

This element is detailed in &lt;&lt;aop-atconfigurable&gt;&gt;.

==== `&lt;mbean-export/&gt;`

This element is detailed in &lt;&lt;jmx-context-mbeanexport&gt;&gt;.

=== The `tool` schema

The `tool` tags are for use when you want to add tooling-specific metadata to your custom configuration elements.
This metadata can then be consumed by tools that are aware of this metadata, and the tools can then do pretty much whatever they want with it (validation, etc.).

The `tool` tags are not documented in this release of Spring as they are currently undergoing review.
If you are a third party tool vendor and you would like to contribute to this review process, then do mail the Spring mailing list.
The currently supported `tool` tags can be found in the file `'spring-tool.xsd'` in the `'src/org/springframework/beans/factory/xml'` directory of the Spring source distribution.

=== The `jdbc` schema

The `jdbc` tags allow you to quickly configure an embedded database or initialize an existing data source.
These tags are documented in &lt;&lt;jdbc-embedded-database-support&gt;&gt; and &lt;&lt;jdbc-intializing-datasource&gt;&gt; respectively.

To use the tags in the `jdbc` schema, you need to have the following preamble at the top of your Spring XML configuration file; the text in the following snippet references the correct schema so that the tags in the `jdbc` namespace are available to you.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jdbc="http://www.springframework.org/schema/jdbc"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/jdbc">http://www.springframework.org/schema/jdbc</a> <a href="http://www.springframework.org/schema/jdbc/spring-jdbc.xsd"&gt;">http://www.springframework.org/schema/jdbc/spring-jdbc.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== The `cache` schema

The `cache` tags can be used to enable support for Spring's [interface]`@CacheEvict`, [interface]`@CachePut` and [interface]`@Caching` annotations.
It it also supports declarative XML-based caching.
See  &lt;&lt;cache-annotation-enable&gt;&gt; and &lt;&lt;cache-declarative-xml&gt;&gt; for details.

To use the tags in the `cache` schema, you need to have the following preamble at the top of your Spring XML configuration file; the text in the following snippet references the correct schema so that the tags in the `cache` namespace are available to you.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jdbc="http://www.springframework.org/schema/cache"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.springframework.org/schema/cache">http://www.springframework.org/schema/cache</a> <a href="http://www.springframework.org/schema/jdbc/spring-cache.xsd"&gt;">http://www.springframework.org/schema/jdbc/spring-cache.xsd"&gt;</a></p>
</div>
<div class="paragraph">
<p>&lt;!-- bean definitions here -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== The `beans` schema

Last but not least we have the tags in the `beans` schema.
These are the same tags that have been in Spring since the very dawn of the framework.
Examples of the various tags in the `beans` schema are not shown here because they are quite comprehensively covered in &lt;&lt;beans-factory-properties-detailed&gt;&gt; (and indeed in that entire &lt;&lt;beans,chapter&gt;&gt;).

One thing that is new to the beans tags themselves in Spring 2.0 is the idea of arbitrary bean metadata.
In Spring 2.0 it is now possible to add zero or more key / value pairs to `&lt;bean/&gt;` XML definitions.
What, if anything, is done with this extra metadata is totally up to your own custom logic (and so is typically only of use if you are writing your own custom tags as described in the appendix entitled &lt;&lt;extensible-xml&gt;&gt;).

Find below an example of the `&lt;meta/&gt;` tag in the context of a surrounding `&lt;bean/&gt;` (please note that without any logic to interpret it the metadata is effectively useless as-is).

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;">http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="foo" class="x.y.Foo"&gt;
    &lt;meta key="cacheName" value="foo"/&gt;
    &lt;property name="name" value="Rick"/&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
In the case of the above example, you would assume that there is some logic that will consume the bean definition and set up some caching infrastructure using the supplied metadata.

:numbered:


:numbered!:

[appendix]
= Extensible XML authoring

== Introduction

Since version 2.0, Spring has featured a mechanism for schema-based extensions to the basic Spring XML format for defining and configuring beans.
This section is devoted to detailing how you would go about writing your own custom XML bean definition parsers and integrating such parsers into the Spring IoC container.

To facilitate the authoring of configuration files using a schema-aware XML editor, Spring's extensible XML configuration mechanism is based on XML Schema.
If you are not familiar with Spring's current XML configuration extensions that come with the standard Spring distribution, please first read the appendix entitled &lt;&lt;xsd-config&gt;&gt;.

Creating new XML configuration extensions can be done by following these (relatively) simple steps:



. &lt;&lt;extensible-xml-schema,Authoring&gt;&gt; an XML schema to describe your custom element(s).
. &lt;&lt;extensible-xml-namespacehandler,Coding&gt;&gt; a custom [interface]`NamespaceHandler` implementation (this is an easy step, don't worry).
. &lt;&lt;extensible-xml-parser,Coding&gt;&gt; one or more [interface]`BeanDefinitionParser` implementations (this is where the real work is done).
. &lt;&lt;extensible-xml-registration,Registering&gt;&gt; the above artifacts with Spring (this too is an easy step).

What follows is a description of each of these steps.
For the example, we will create an XML extension (a custom XML element) that allows us to configure objects of the type [class]`SimpleDateFormat` (from the `java.text` package) in an easy manner.
When we are done, we will be able to define bean definitions of type [class]`SimpleDateFormat` like this:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;myns:dateformat id="dateFormat"
    pattern="yyyy-MM-dd HH:mm"
    lenient="true"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
_(Don't worry about the fact that this example is very simple; much more
        detailed examples follow afterwards. The intent in this first simple example is to walk
        you through the basic steps involved.)_

== Authoring the schema

Creating an XML configuration extension for use with Spring's IoC container starts with authoring an XML Schema to describe the extension.
What follows is the schema we'll use to configure [class]`SimpleDateFormat` objects.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!-- myns.xsd (inside package org/springframework/samples/xml) -&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsd:schema xmlns="http://www.mycompany.com/schema/myns"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:beans="http://www.springframework.org/schema/beans"
    targetNamespace="http://www.mycompany.com/schema/myns"
    elementFormDefault="qualified"
    attributeFormDefault="unqualified"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;xsd:import namespace="http://www.springframework.org/schema/beans"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;xsd:element name="dateformat"&gt;
   &lt;xsd:complexType&gt;
      &lt;xsd:complexContent&gt;
         &lt;xsd:extension base="beans:identifiedType"&gt;
            &lt;xsd:attribute name="lenient" type="xsd:boolean"/&gt;
            &lt;xsd:attribute name="pattern" type="xsd:string" use="required"/&gt;
         &lt;/xsd:extension&gt;
      &lt;/xsd:complexContent&gt;
   &lt;/xsd:complexType&gt;
&lt;/xsd:element&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/xsd:schema&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
(The emphasized line contains an extension base for all tags that will be identifiable (meaning they have an `id` attribute that will be used as the bean identifier in the container).
We are able to use this attribute because we imported the Spring-provided `'beans'` namespace.)

The above schema will be used to configure [class]`SimpleDateFormat` objects, directly in an XML application context file using the `&lt;myns:dateformat/&gt;` element.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;myns:dateformat id="dateFormat"
    pattern="yyyy-MM-dd HH:mm"
    lenient="true"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Note that after we've created the infrastructure classes, the above snippet of XML will essentially be exactly the same as the following XML snippet.
In other words, we're just creating a bean in the container, identified by the name `'dateFormat'` of type [class]`SimpleDateFormat`, with a couple of properties set.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="dateFormat" class="java.text.SimpleDateFormat"&gt;
    &lt;constructor-arg value="yyyy-HH-dd HH:mm"/&gt;
    &lt;property name="lenient" value="true"/&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
NOTE: The schema-based approach to creating configuration format allows for tight integration with an IDE that has a schema-aware XML editor.
Using a properly authored schema, you can use autocompletion to have a user choose between several configuration options defined in the enumeration.

== Coding a [interface]`NamespaceHandler`

In addition to the schema, we need a [interface]`NamespaceHandler` that will parse all elements of this specific namespace Spring encounters while parsing configuration files.
The [interface]`NamespaceHandler` should in our case take care of the parsing of the `myns:dateformat` element.

The [interface]`NamespaceHandler` interface is pretty simple in that it features just three methods:

* [method]`init()` - allows for initialization of the [interface]`NamespaceHandler` and will be called by Spring before the handler is used
* [method]`BeanDefinition parse(Element, ParserContext)` - called when Spring encounters a top-level element (not nested inside a bean definition or a different namespace).
  This method can register bean definitions itself and/or return a bean definition.
* [method]`BeanDefinitionHolder decorate(Node, BeanDefinitionHolder, ParserContext)` - called when Spring encounters an attribute or nested element of a different namespace.
  The decoration of one or more bean definitions is used for example with the &lt;&lt;beans-factory-scopes,out-of-the-box	scopes Spring 2.0 supports&gt;&gt;.
  We'll start by highlighting a simple example, without using decoration, after which we will	show decoration in a somewhat more advanced example.

Although it is perfectly possible to code your own [interface]`NamespaceHandler` for the entire namespace (and hence provide code that parses each and every element in the namespace), it is often the case that each top-level XML element in a Spring XML configuration file results in a single bean definition (as in our case, where a single `&lt;myns:dateformat/&gt;` element results in a single [class]`SimpleDateFormat` bean definition).
Spring features a number of convenience classes that support this scenario.
In this example, we'll make use the [class]`NamespaceHandlerSupport` class:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.samples.xml;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.xml.NamespaceHandlerSupport;</p>
</div>
<div class="paragraph">
<p>public class MyNamespaceHandler extends NamespaceHandlerSupport {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void init() {
        registerBeanDefinitionParser("dateformat", new SimpleDateFormatBeanDefinitionParser());
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The observant reader will notice that there isn't actually a whole lot of parsing logic in this class.
Indeed...
the [class]`NamespaceHandlerSupport` class has a built in notion of delegation.
It supports the registration of any number of [interface]`BeanDefinitionParser` instances, to which it will delegate to when it needs to parse an element in its namespace.
This clean separation of concerns allows a [interface]`NamespaceHandler` to handle the orchestration of the parsing of _all_ of the custom elements in its namespace, while delegating to `BeanDefinitionParsers` to do the grunt work of the XML parsing; this means that each [interface]`BeanDefinitionParser` will contain just the logic for parsing a single custom element, as we can see in the next step

== Coding a [interface]`BeanDefinitionParser`

A [interface]`BeanDefinitionParser` will be used if the [interface]`NamespaceHandler` encounters an XML element of the type that has been mapped to the specific bean definition parser (which is `'dateformat'` in this case).
In other words, the [interface]`BeanDefinitionParser` is responsible for parsing _one_ distinct top-level XML element defined in the schema.
In the parser, we'll have access to the XML element (and thus its subelements too) so that we can parse our custom XML content, as can be seen in the following example:

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package org.springframework.samples.xml;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.support.BeanDefinitionBuilder;
import org.springframework.beans.factory.xml.AbstractSingleBeanDefinitionParser;
import org.springframework.util.StringUtils;
import org.w3c.dom.Element;</p>
</div>
<div class="paragraph">
<p>import java.text.SimpleDateFormat;</p>
</div>
<div class="paragraph">
<p>public class SimpleDateFormatBeanDefinitionParser extends AbstractSingleBeanDefinitionParser {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>protected Class getBeanClass(Element element) {
   return SimpleDateFormat.class;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>protected void doParse(Element element, BeanDefinitionBuilder bean) {
   // this will never be null since the schema explicitly requires that a value be supplied
   String pattern = element.getAttribute("pattern");
   bean.addConstructorArg(pattern);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>      // this however is an optional property
      String lenient = element.getAttribute("lenient");
      if (StringUtils.hasText(lenient)) {
         bean.addPropertyValue("lenient", Boolean.valueOf(lenient));
      }
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
In this simple case, this is all that we need to do.
The creation of our single [interface]`BeanDefinition` is handled by the [class]`AbstractSingleBeanDefinitionParser` superclass, as is the extraction and setting of the bean definition's unique identifier.

== Registering the handler and the schema

The coding is finished! All that remains to be done is to somehow make the Spring XML parsing infrastructure aware of our custom element; we do this by registering our custom [interface]`namespaceHandler` and custom XSD file in two special purpose properties files.
These properties files are both placed in a [file]`'META-INF'` directory in your application, and can, for example, be distributed alongside your binary classes in a JAR file.
The Spring XML parsing infrastructure will automatically pick up your new extension by consuming these special properties files, the formats of which are detailed below.

=== [file]`'META-INF/spring.handlers'`

The properties file called [file]`'spring.handlers'` contains a mapping of XML Schema URIs to namespace handler classes.
So for our example, we need to write the following:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>http\://www.mycompany.com/schema/myns=org.springframework.samples.xml.MyNamespaceHandler</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
_(The `':'` character is a valid delimiter in the Java properties format,
            and so the `':'` character in the URI needs to be escaped with a backslash.)_

The first part (the key) of the key-value pair is the URI associated with your custom namespace extension, and needs to _match exactly_ the value of the `'targetNamespace'` attribute as specified in your custom XSD schema.

=== [file]`'META-INF/spring.schemas'`

The properties file called [file]`'spring.schemas'` contains a mapping of XML Schema locations (referred to along with the schema declaration in XML files that use the schema as part of the `'xsi:schemaLocation'` attribute) to _classpath_ resources.
This file is needed to prevent Spring from absolutely having to use a default [interface]`EntityResolver` that requires Internet access to retrieve the schema file.
If you specify the mapping in this properties file, Spring will search for the schema on the classpath (in this case `'myns.xsd'` in the `'org.springframework.samples.xml'` package):

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>http\://www.mycompany.com/schema/myns/myns.xsd=org/springframework/samples/xml/myns.xsd</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The upshot of this is that you are encouraged to deploy your XSD file(s) right alongside the [interface]`NamespaceHandler` and [interface]`BeanDefinitionParser` classes on the classpath.

== Using a custom extension in your Spring XML configuration

Using a custom extension that you yourself have implemented is no different from using one of the 'custom' extensions that Spring provides straight out of the box.
Find below an example of using the custom `&lt;dateformat/&gt;` element developed in the previous steps in a Spring XML configuration file.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:myns="http://www.mycompany.com/schema/myns"
      xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.mycompany.com/schema/myns">http://www.mycompany.com/schema/myns</a> <a href="http://www.mycompany.com/schema/myns/myns.xsd"&gt;">http://www.mycompany.com/schema/myns/myns.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- as a top-level bean --&gt;
&lt;myns:dateformat id="defaultDateFormat" pattern="yyyy-MM-dd HH:mm" lenient="true"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="jobDetailTemplate" abstract="true"&gt;
   &lt;property name="dateFormat"&gt;
      &lt;!-- as an inner bean --&gt;
      &lt;myns:dateformat pattern="HH:mm MM-dd-yyyy"/&gt;
   &lt;/property&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Meatier examples

Find below some much meatier examples of custom XML extensions.

=== Nesting custom tags within custom tags

This example illustrates how you might go about writing the various artifacts required to satisfy a target of the following configuration:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:foo="http://www.foo.com/schema/component"
      xsi:schemaLocation="
<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
<a href="http://www.foo.com/schema/component">http://www.foo.com/schema/component</a> <a href="http://www.foo.com/schema/component/component.xsd"&gt;">http://www.foo.com/schema/component/component.xsd"&gt;</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;foo:component id="bionic-family" name="Bionic-1"&gt;
   &lt;foo:component name="Mother-1"&gt;
     &lt;foo:component name="Karate-1"/&gt;
     &lt;foo:component name="Sport-1"/&gt;
   &lt;/foo:component&gt;
   &lt;foo:component name="Rock-1"/&gt;
&lt;/foo:component&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
The above configuration actually nests custom extensions within each other.
The class that is actually configured by the above `&lt;foo:component/&gt;` element is the [class]`Component` class (shown directly below).
Notice how the [class]`Component` class does _not_ expose a setter method for the `'components'` property; this makes it hard (or rather impossible) to configure a bean definition for the [class]`Component` class using setter injection.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.foo;</p>
</div>
<div class="paragraph">
<p>import java.util.ArrayList;
import java.util.List;</p>
</div>
<div class="paragraph">
<p>public class Component {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private String name;
private List&lt;Component&gt; components = new ArrayList&lt;Component&gt; ();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// mmm, there is no setter method for the 'components'
public void addComponent(Component component) {
   this.components.add(component);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public List&lt;Component&gt; getComponents() {
   return components;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public String getName() {
   return name;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>   public void setName(String name) {
      this.name = name;
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
The typical solution to this issue is to create a custom [interface]`FactoryBean` that exposes a setter property for the `'components'` property.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.foo;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.FactoryBean;</p>
</div>
<div class="paragraph">
<p>import java.util.List;</p>
</div>
<div class="paragraph">
<p>public class ComponentFactoryBean implements FactoryBean&lt;Component&gt; {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private Component parent;
private List&lt;Component&gt; children;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setParent(Component parent) {
   this.parent = parent;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setChildren(List&lt;Component&gt; children) {
   this.children = children;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Component getObject() throws Exception {
   if (this.children != null &amp;&amp; this.children.size() &gt; 0) {
      for (Component child : children) {
         this.parent.addComponent(child);
      }
   }
   return this.parent;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Class&lt;Component&gt; getObjectType() {
   return Component.class;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>   public boolean isSingleton() {
      return true;
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
This is all very well, and does work nicely, but exposes a lot of Spring plumbing to the end user.
What we are going to do is write a custom extension that hides away all of this Spring plumbing.
If we stick to &lt;&lt;extensible-xml-introduction,the steps described
            previously&gt;&gt;, we'll start off by creating the XSD schema to define the structure of our custom tag.

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</p>
</div>
<div class="paragraph">
<p>&lt;xsd:schema xmlns="http://www.foo.com/schema/component"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema"
         targetNamespace="http://www.foo.com/schema/component"
         elementFormDefault="qualified"
         attributeFormDefault="unqualified"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;xsd:element name="component"&gt;
   &lt;xsd:complexType&gt;
      &lt;xsd:choice minOccurs="0" maxOccurs="unbounded"&gt;
         &lt;xsd:element ref="component"/&gt;
      &lt;/xsd:choice&gt;
      &lt;xsd:attribute name="id" type="xsd:ID"/&gt;
      &lt;xsd:attribute name="name" use="required" type="xsd:string"/&gt;
   &lt;/xsd:complexType&gt;
&lt;/xsd:element&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/xsd:schema&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
We'll then create a custom [interface]`NamespaceHandler`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.foo;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.xml.NamespaceHandlerSupport;</p>
</div>
<div class="paragraph">
<p>public class ComponentNamespaceHandler extends NamespaceHandlerSupport {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   public void init() {
      registerBeanDefinitionParser("component", new ComponentBeanDefinitionParser());
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Next up is the custom [interface]`BeanDefinitionParser`.
Remember that what we are creating is a [interface]`BeanDefinition` describing a [class]`ComponentFactoryBean`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.foo;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.beans.factory.support.AbstractBeanDefinition;
import org.springframework.beans.factory.support.BeanDefinitionBuilder;
import org.springframework.beans.factory.support.ManagedList;
import org.springframework.beans.factory.xml.AbstractBeanDefinitionParser;
import org.springframework.beans.factory.xml.ParserContext;
import org.springframework.util.xml.DomUtils;
import org.w3c.dom.Element;</p>
</div>
<div class="paragraph">
<p>import java.util.List;</p>
</div>
<div class="paragraph">
<p>public class ComponentBeanDefinitionParser extends AbstractBeanDefinitionParser {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>protected AbstractBeanDefinition parseInternal(Element element, ParserContext parserContext) {
   return parseComponentElement(element);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private static AbstractBeanDefinition parseComponentElement(Element element) {
   BeanDefinitionBuilder factory = BeanDefinitionBuilder.rootBeanDefinition(ComponentFactoryBean.class);
   factory.addPropertyValue("parent", parseComponent(element));</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>List&lt;Element&gt; childElements = DomUtils.getChildElementsByTagName(element, "component");
if (childElements != null &amp;&amp; childElements.size() &gt; 0) {
   parseChildComponents(childElements, factory);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>   return factory.getBeanDefinition();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private static BeanDefinition parseComponent(Element element) {
   BeanDefinitionBuilder component = BeanDefinitionBuilder.rootBeanDefinition(Component.class);
   component.addPropertyValue("name", element.getAttribute("name"));
   return component.getBeanDefinition();
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private static void parseChildComponents(List&lt;Element&gt; childElements, BeanDefinitionBuilder factory) {
   ManagedList&lt;BeanDefinition&gt; children = new ManagedList&lt;BeanDefinition&gt;(childElements.size());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>for (Element element : childElements) {
   children.add(parseComponentElement(element));
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>      factory.addPropertyValue("children", children);
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Lastly, the various artifacts need to be registered with the Spring XML infrastructure.

[source]</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="in-em-meta-inf-spring-handlers-em" class="sect0"><a class="anchor" href="#in-em-meta-inf-spring-handlers-em"></a>in <em>META-INF/spring.handlers</em></h1>
<div class="paragraph">
<p>http\://www.foo.com/schema/component=com.foo.ComponentNamespaceHandler</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source]</pre>
</div>
</div>
<h1 id="in-em-meta-inf-spring-schemas-em" class="sect0"><a class="anchor" href="#in-em-meta-inf-spring-schemas-em"></a>in <em>META-INF/spring.schemas</em></h1>
<div class="paragraph">
<p>http\://www.foo.com/schema/component/component.xsd=com/foo/component.xsd</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
=== Custom attributes on 'normal' elements

Writing your own custom parser and the associated artifacts isn't hard, but sometimes it is not the right thing to do.
Consider the scenario where you need to add metadata to already existing bean definitions.
In this case you certainly don't want to have to go off and write your own entire custom extension; rather you just want to add an additional attribute to the existing bean definition element.

By way of another example, let's say that the service class that you are defining a bean definition for a service object that will (unknown to it) be accessing a clustered &lt;&lt;,JCache&gt;&gt;, and you want to ensure that the named JCache instance is eagerly started within the surrounding cluster:

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="checkingAccountService" class="com.foo.DefaultCheckingAccountService"
      jcache:cache-name="checking.account"&gt;
   &lt;!-- other dependencies here&#8230; -&#8594;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
What we are going to do here is create another [interface]`BeanDefinition` when the `'jcache:cache-name'` attribute is parsed; this [interface]`BeanDefinition` will then initialize the named JCache for us.
We will also modify the existing [interface]`BeanDefinition` for the `'checkingAccountService'` so that it will have a dependency on this new JCache-initializing [interface]`BeanDefinition`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.foo;</p>
</div>
<div class="paragraph">
<p>public class JCacheInitializer {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private String name;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public JCacheInitializer(String name) {
   this.name = name;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>   public void initialize() {
      // lots of JCache API calls to initialize the named cache...
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Now onto the custom extension.
Firstly, the authoring of the XSD schema describing the custom attribute (quite easy in this case).

[source,xml]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</p>
</div>
<div class="paragraph">
<p>&lt;xsd:schema xmlns="http://www.foo.com/schema/jcache"
            xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            targetNamespace="http://www.foo.com/schema/jcache"
            elementFormDefault="qualified"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;xsd:attribute name="cache-name" type="xsd:string"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/xsd:schema&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
Next, the associated [interface]`NamespaceHandler`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.foo;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.xml.NamespaceHandlerSupport;</p>
</div>
<div class="paragraph">
<p>public class JCacheNamespaceHandler extends NamespaceHandlerSupport {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   public void init() {
      super.registerBeanDefinitionDecoratorForAttribute("cache-name",
            new JCacheInitializingBeanDefinitionDecorator());
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Next, the parser.
Note that in this case, because we are going to be parsing an XML attribute, we write a [interface]`BeanDefinitionDecorator` rather than a [interface]`BeanDefinitionParser`.

[source,java]</pre>
</div>
</div>
<div class="paragraph">
<p>package com.foo;</p>
</div>
<div class="paragraph">
<p>import org.springframework.beans.factory.config.BeanDefinitionHolder;
import org.springframework.beans.factory.support.AbstractBeanDefinition;
import org.springframework.beans.factory.support.BeanDefinitionBuilder;
import org.springframework.beans.factory.xml.BeanDefinitionDecorator;
import org.springframework.beans.factory.xml.ParserContext;
import org.w3c.dom.Attr;
import org.w3c.dom.Node;</p>
</div>
<div class="paragraph">
<p>import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;</p>
</div>
<div class="paragraph">
<p>public class JCacheInitializingBeanDefinitionDecorator implements BeanDefinitionDecorator {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private static final String[] EMPTY_STRING_ARRAY = new String[0];</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public BeanDefinitionHolder decorate(
      Node source, BeanDefinitionHolder holder, ParserContext ctx) {
   String initializerBeanName = registerJCacheInitializer(source, ctx);
   createDependencyOnJCacheInitializer(holder, initializerBeanName);
   return holder;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private void createDependencyOnJCacheInitializer(BeanDefinitionHolder holder, String initializerBeanName) {
   AbstractBeanDefinition definition = ((AbstractBeanDefinition) holder.getBeanDefinition());
   String[] dependsOn = definition.getDependsOn();
   if (dependsOn == null) {
      dependsOn = new String[]{initializerBeanName};
   } else {
      List dependencies = new ArrayList(Arrays.asList(dependsOn));
      dependencies.add(initializerBeanName);
      dependsOn = (String[]) dependencies.toArray(EMPTY_STRING_ARRAY);
   }
   definition.setDependsOn(dependsOn);
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>   private String registerJCacheInitializer(Node source, ParserContext ctx) {
      String cacheName = ((Attr) source).getValue();
      String beanName = cacheName + "-initializer";
      if (!ctx.getRegistry().containsBeanDefinition(beanName)) {
         BeanDefinitionBuilder initializer = BeanDefinitionBuilder.rootBeanDefinition(JCacheInitializer.class);
         initializer.addConstructorArg(cacheName);
         ctx.getRegistry().registerBeanDefinition(beanName, initializer.getBeanDefinition());
      }
      return beanName;
   }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>
Lastly, the various artifacts need to be registered with the Spring XML infrastructure.

[source]</pre>
</div>
</div>
<h1 id="in-em-meta-inf-spring-handlers-em-2" class="sect0"><a class="anchor" href="#in-em-meta-inf-spring-handlers-em-2"></a>in <em>META-INF/spring.handlers</em></h1>
<div class="paragraph">
<p>http\://www.foo.com/schema/jcache=com.foo.JCacheNamespaceHandler</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
[source]</pre>
</div>
</div>
<h1 id="in-em-meta-inf-spring-schemas-em-2" class="sect0"><a class="anchor" href="#in-em-meta-inf-spring-schemas-em-2"></a>in <em>META-INF/spring.schemas</em></h1>
<div class="paragraph">
<p>http\://www.foo.com/schema/jcache/jcache.xsd=com/foo/jcache.xsd</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
== Further Resources

Find below links to further resources concerning XML Schema and the extensible XML support described in this chapter.

* The &lt;&lt;,XML Schema Part 1: Structures Second Edition&gt;&gt;
* The &lt;&lt;,XML Schema Part 2: Datatypes Second Edition&gt;&gt;

:numbered:


:numbered!:

[appendix]
= spring.tld

== Introduction

One of the view technologies you can use with the Spring Framework is Java Server Pages (JSPs).
To help you implement views using Java Server Pages the Spring Framework provides you with some tags for evaluating errors, setting themes and outputting internationalized messages.

Please note that the various tags generated by this form tag library are compliant with the &lt;&lt;,XHTML-1.0-Strict specification&gt;&gt; and attendant &lt;&lt;,DTD&gt;&gt;.

This appendix describes the `spring.tld` tag library.


== The `bind` tag

 Provides BindStatus object for the given bind path.
The HTML escaping flag participates in a page-wide or application-wide setting (i.e.
by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     htmlEscape

|
                     false

|
                     true

|
                     Set HTML escaping for this tag, as boolean value. Overrides
            the default HTML escaping setting for the current page.


|
                     ignoreNestedPath

|
                     false

|
                     true

|
                     Set whether to ignore a nested path, if any. Default is to not ignore.


|
                     path

|
                     true

|
                     true

|
                     The path to the bean or bean property to bind status
            information for. For instance account.name, company.address.zipCode
            or just employee. The status object will exported to the page scope,
            specifically for this bean or bean property

|===

== The `escapeBody` tag

 Escapes its enclosed body content, applying HTML escaping and/or JavaScript escaping.
The HTML escaping flag participates in a page-wide or application-wide setting (i.e.
by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     htmlEscape

|
                     false

|
                     true

|
                     Set HTML escaping for this tag, as boolean value. Overrides the
            default HTML escaping setting for the current page.


|
                     javaScriptEscape

|
                     false

|
                     true

|
                     Set JavaScript escaping for this tag, as boolean value.
            Default is false.

|===

== The `hasBindErrors` tag

 Provides Errors instance in case of bind errors.
The HTML escaping flag participates in a page-wide or application-wide setting (i.e.
by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     htmlEscape

|
                     false

|
                     true

|
                     Set HTML escaping for this tag, as boolean value.
            Overrides the default HTML escaping setting for the current page.


|
                     name

|
                     true

|
                     true

|
                     The name of the bean in the request, that needs to be
            inspected for errors. If errors are available for this bean, they
            will be bound under the 'errors' key.

|===

== The `htmlEscape` tag

 Sets default HTML escape value for the current page.
Overrides a "defaultHtmlEscape" context-param in web.xml, if any.


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     defaultHtmlEscape

|
                     true

|
                     true

|
                     Set the default value for HTML escaping, to be put
                into the current PageContext.

|===

== The `message` tag

 Retrieves the message with the given code, or text if code isn't resolvable.
The HTML escaping flag participates in a page-wide or application-wide setting (i.e.
by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     arguments

|
                     false

|
                     true

|
                     Set optional message arguments for this tag, as a
            (comma-)delimited String (each String argument can contain JSP EL),
            an Object array (used as argument array), or a single Object (used
            as single argument).


|
                     argumentSeparator

|
                     false

|
                     true

|
                     The separator character to be used for splitting the
            arguments string value; defaults to a 'comma' (',').


|
                     code

|
                     false

|
                     true

|
                     The code (key) to use when looking up the message.
            If code is not provided, the text attribute will be used.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Set HTML escaping for this tag, as boolean value.
            Overrides the default HTML escaping setting for the current page.


|
                     javaScriptEscape

|
                     false

|
                     true

|
                     Set JavaScript escaping for this tag, as boolean value. Default is false.


|
                     message

|
                     false

|
                     true

|
                     A MessageSourceResolvable argument (direct or through JSP EL).
                Fits nicely when used in conjunction with Spring's own validation error
                classes which all implement the MessageSourceResolvable interface. For
                example, this allows you to iterate over all of the errors in a form,
                passing each error (using a runtime expression) as the value of this
                'message' attribute, thus effecting the easy display of such error
                messages.


|
                     scope

|
                     false

|
                     true

|
                     The scope to use when exporting the result to a variable.
            This attribute is only used when var is also set. Possible values are
            page, request, session and application.


|
                     text

|
                     false

|
                     true

|
                     Default text to output when a message for the given code
            could not be found. If both text and code are not set, the tag will
            output null.


|
                     var

|
                     false

|
                     true

|
                     The string to use when binding the result to the page,
            request, session or application scope. If not specified, the result
            gets outputted to the writer (i.e. typically directly to the JSP).

|===

== The `nestedPath` tag

 Sets a nested path to be used by the bind tag's path.


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     path

|
                     true

|
                     true

|
                     Set the path that this tag should apply. E.g. 'customer'
            to allow bind paths like 'address.street' rather than
            'customer.address.street'.

|===

== The `theme` tag

 Retrieves the theme message with the given code, or text if code isn't resolvable.
The HTML escaping flag participates in a page-wide or application-wide setting (i.e.
by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     arguments

|
                     false

|
                     true

|
                     Set optional message arguments for this tag, as a
            (comma-)delimited String (each String argument can contain JSP EL),
            an Object array (used as argument array), or a single Object (used
            as single argument).


|
                     argumentSeparator

|
                     false

|
                     true

|
                     The separator character to be used for splitting the
            arguments string value; defaults to a 'comma' (',').


|
                     code

|
                     false

|
                     true

|
                     The code (key) to use when looking up the message.
            If code is not provided, the text attribute will be used.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Set HTML escaping for this tag, as boolean value.
            Overrides the default HTML escaping setting for the current page.


|
                     javaScriptEscape

|
                     false

|
                     true

|
                     Set JavaScript escaping for this tag, as boolean value. Default is false.


|
                     message

|
                     false

|
                     true

|
                     A MessageSourceResolvable argument (direct or through JSP EL).


|
                     scope

|
                     false

|
                     true

|
                     The scope to use when exporting the result to a variable.
            This attribute is only used when var is also set. Possible values are
            page, request, session and application.


|
                     text

|
                     false

|
                     true

|
                     Default text to output when a message for the given code
            could not be found. If both text and code are not set, the tag will
            output null.


|
                     var

|
                     false

|
                     true

|
                     The string to use when binding the result to the page,
            request, session or application scope. If not specified, the result
            gets outputted to the writer (i.e. typically directly to the JSP).

|===

== The `transform` tag

 Provides transformation of variables to Strings, using an appropriate custom PropertyEditor from BindTag (can only be used inside BindTag).
The HTML escaping flag participates in a page-wide or application-wide setting (i.e.
by HtmlEscapeTag or a 'defaultHtmlEscape' context-param in web.xml).


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     htmlEscape

|
                     false

|
                     true

|
                     Set HTML escaping for this tag, as boolean value. Overrides
            the default HTML escaping setting for the current page.


|
                     scope

|
                     false

|
                     true

|
                     The scope to use when exported the result to a variable.
            This attribute is only used when var is also set. Possible values are
            page, request, session and application.


|
                     value

|
                     true

|
                     true

|
                     The value to transform. This is the actual object you want
            to have transformed (for instance a Date). Using the PropertyEditor that
            is currently in use by the 'spring:bind' tag.


|
                     var

|
                     false

|
                     true

|
                     The string to use when binding the result to the page,
            request, session or application scope. If not specified, the result gets
            outputted to the writer (i.e. typically directly to the JSP).

|===

== The `url` tag

 Creates URLs with support for URI template variables, HTML/XML escaping, and Javascript escaping.
Modeled after the JSTL c:url tag with backwards compatibility in mind.


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     url

|
                     true

|
                     true

|
                     The URL to build. This value can include template {placeholders}
            that are replaced with the URL encoded value of the named parameter.  Parameters
            must be defined using the param tag inside the body of this tag.


|
                     context

|
                     false

|
                     true

|
                     Specifies a remote application context path.  The default is the
            current application context path.


|
                     var

|
                     false

|
                     true

|
                     The name of the variable to export the URL value to.
                     If not specified the URL is written as output.


|
                     scope

|
                     false

|
                     true

|
                     The scope for the var.  'application', 'session', 'request' and
            'page' scopes are supported.  Defaults to page scope.  This attribute has no
            effect unless the var attribute is also defined.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Set HTML escaping for this tag, as a boolean value. Overrides the
            default HTML escaping setting for the current page.


|
                     javaScriptEscape

|
                     false

|
                     true

|
                     Set JavaScript escaping for this tag, as a boolean value.
            Default is false.

|===

== The `eval` tag

 Evaluates a Spring expression (SpEL) and either prints the result or assigns it to a variable.


.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     expression

|
                     true

|
                     true

|
                     The expression to evaluate.


|
                     var

|
                     false

|
                     true

|
                     The name of the variable to export the evaluation result to.
                     If not specified the evaluation result is converted to a String and written as output.


|
                     scope

|
                     false

|
                     true

|
                     The scope for the var.  'application', 'session', 'request' and
            'page' scopes are supported.  Defaults to page scope.  This attribute has no
            effect unless the var attribute is also defined.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Set HTML escaping for this tag, as a boolean value. Overrides the
            default HTML escaping setting for the current page.


|
                     javaScriptEscape

|
                     false

|
                     true

|
                     Set JavaScript escaping for this tag, as a boolean value.
            Default is false.

|===

:numbered:


:numbered!:

[appendix]
= spring-form.tld

== Introduction

One of the view technologies you can use with the Spring Framework is Java Server Pages (JSPs).
To help you implement views using Java Server Pages the Spring Framework provides you with some tags for evaluating errors, setting themes and outputting internationalized messages.

Please note that the various tags generated by this form tag library are compliant with the &lt;&lt;,XHTML-1.0-Strict specification&gt;&gt; and attendant &lt;&lt;,DTD&gt;&gt;.

This appendix describes the `spring-form.tld` tag library.


== The `checkbox` tag

Renders an HTML 'input' tag with type 'checkbox'.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     accesskey

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     label

|
                     false

|
                     true

|
                     Value to be displayed as part of the tag


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     onblur

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onchange

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onfocus

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to property for data binding


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     value

|
                     false

|
                     true

|
                     HTML Optional Attribute

|===

== The `checkboxes` tag

Renders multiple HTML 'input' tags with type 'checkbox'.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     accesskey

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     delimiter

|
                     false

|
                     true

|
                     Delimiter to use between each 'input' tag with type 'checkbox'. There is no delimiter by default.


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     element

|
                     false

|
                     true

|
                     Specifies the HTML element that is used to enclose each 'input' tag with type 'checkbox'.  Defaults to 'span'.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     itemLabel

|
                     false

|
                     true

|
                     Value to be displayed as part of the 'input' tags with type 'checkbox'


|
                     items

|
                     true

|
                     true

|
                     The Collection, Map or array of objects used to generate the 'input' tags with type 'checkbox'


|
                     itemValue

|
                     false

|
                     true

|
                     Name of the property mapped to 'value' attribute of the 'input' tags with type 'checkbox'


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     onblur

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onchange

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onfocus

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to property for data binding


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

== The `errors` tag

Renders field errors in an HTML 'span' tag.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     delimiter

|
                     false

|
                     true

|
                     Delimiter for displaying multiple error messages. Defaults to the br tag.


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     element

|
                     false

|
                     true

|
                     Specifies the HTML element that is used to render the enclosing errors.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     false

|
                     true

|
                     Path to errors object for data binding


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

== The `form` tag

Renders an HTML 'form' tag and exposes a binding path to inner tags for binding.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     acceptCharset

|
                     false

|
                     true

|
                     Specifies the list of character encodings for input data that is accepted by the server processing this form. The value is a space- and/or comma-delimited list of charset values. The client must interpret this list as an exclusive-or list, i.e., the server is able to accept any single character encoding per entity received.


|
                     action

|
                     false

|
                     true

|
                     HTML Required Attribute


|
                     commandName

|
                     false

|
                     true

|
                     Name of the model attribute under which the form object is exposed.
                Defaults to 'command'.


|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     enctype

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     method

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     modelAttribute

|
                     false

|
                     true

|
                     Name of the model attribute under which the form object is exposed.
                Defaults to 'command'.


|
                     name

|
                     false

|
                     true

|
                     HTML Standard Attribute - added for backwards compatibility cases


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onreset

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onsubmit

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     target

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

== The `hidden` tag

Renders an HTML 'input' tag with type 'hidden' using the bound value.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to property for data binding

|===

== The `input` tag

Renders an HTML 'input' tag with type 'text' using the bound value.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     accesskey

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     alt

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     autocomplete

|
                     false

|
                     true

|
                     Common Optional Attribute


|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     maxlength

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     onblur

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onchange

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onfocus

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onselect

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to property for data binding


|
                     readonly

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will make the HTML element readonly.


|
                     size

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

== The `label` tag

Renders a form field label in an HTML 'label' tag.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute.


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used only when errors are present.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     for

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to errors object for data binding


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

== The `option` tag

Renders a single HTML 'option'.
Sets 'selected' as appropriate based on bound value.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     label

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     value

|
                     true

|
                     true

|
                     HTML Optional Attribute

|===

== The `options` tag

Renders a list of HTML 'option' tags.
Sets 'selected' as appropriate based on bound value.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     itemLabel

|
                     false

|
                     true

|
                     Name of the property mapped to the inner text of the 'option' tag


|
                     items

|
                     true

|
                     true

|
                     The Collection, Map or array of objects used to generate the inner 'option' tags


|
                     itemValue

|
                     false

|
                     true

|
                     Name of the property mapped to 'value' attribute of the 'option' tag


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

== The `password` tag

Renders an HTML 'input' tag with type 'password' using the bound value.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     accesskey

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     alt

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     autocomplete

|
                     false

|
                     true

|
                     Common Optional Attribute


|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     maxlength

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     onblur

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onchange

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onfocus

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onselect

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to property for data binding


|
                     readonly

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will make the HTML element readonly.


|
                     showPassword

|
                     false

|
                     true

|
                     Is the password value to be shown? Defaults to false.


|
                     size

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

== The `radiobutton` tag

Renders an HTML 'input' tag with type 'radio'.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     accesskey

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     label

|
                     false

|
                     true

|
                     Value to be displayed as part of the tag


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     onblur

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onchange

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onfocus

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to property for data binding


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     value

|
                     false

|
                     true

|
                     HTML Optional Attribute

|===

== The `radiobuttons` tag

Renders multiple HTML 'input' tags with type 'radio'.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     accesskey

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     delimiter

|
                     false

|
                     true

|
                     Delimiter to use between each 'input' tag with type 'radio'. There is no delimiter by default.


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     element

|
                     false

|
                     true

|
                     Specifies the HTML element that is used to enclose each 'input' tag with type 'radio'.  Defaults to 'span'.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     itemLabel

|
                     false

|
                     true

|
                     Value to be displayed as part of the 'input' tags with type 'radio'


|
                     items

|
                     true

|
                     true

|
                     The Collection, Map or array of objects used to generate the 'input' tags with type 'radio'


|
                     itemValue

|
                     false

|
                     true

|
                     Name of the property mapped to 'value' attribute of the 'input' tags with type 'radio'


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     onblur

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onchange

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onfocus

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to property for data binding


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

== The `select` tag

Renders an HTML 'select' element.
Supports databinding to the selected option.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     accesskey

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     itemLabel

|
                     false

|
                     true

|
                     Name of the property mapped to the inner text of the 'option' tag


|
                     items

|
                     false

|
                     true

|
                     The Collection, Map or array of objects used to generate the inner 'option' tags


|
                     itemValue

|
                     false

|
                     true

|
                     Name of the property mapped to 'value' attribute of the 'option' tag


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     multiple

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     onblur

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onchange

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onfocus

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to property for data binding


|
                     size

|
                     false

|
                     true

|
                     HTML Optional Attribute


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

== The `textarea` tag

Renders an HTML 'textarea'.

.Attributes
[cols="1,1,1,1", options="header"]
|===
| Attribute
| Required?
| Runtime Expression?
| Description
|
                     accesskey

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     cols

|
                     false

|
                     true

|
                     HTML Required Attribute


|
                     cssClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute


|
                     cssErrorClass

|
                     false

|
                     true

|
                     Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.


|
                     cssStyle

|
                     false

|
                     true

|
                     Equivalent to "style" - HTML Optional Attribute


|
                     dir

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     disabled

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.


|
                     htmlEscape

|
                     false

|
                     true

|
                     Enable/disable HTML escaping of rendered values.


|
                     id

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     lang

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     onblur

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onchange

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     ondblclick

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onfocus

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeydown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeypress

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onkeyup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousedown

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmousemove

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseout

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseover

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onmouseup

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     onselect

|
                     false

|
                     true

|
                     HTML Event Attribute


|
                     path

|
                     true

|
                     true

|
                     Path to property for data binding


|
                     readonly

|
                     false

|
                     true

|
                     HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will make the HTML element readonly.


|
                     rows

|
                     false

|
                     true

|
                     HTML Required Attribute


|
                     tabindex

|
                     false

|
                     true

|
                     HTML Standard Attribute


|
                     title

|
                     false

|
                     true

|
                     HTML Standard Attribute

|===

:numbered:</pre>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.2.0.CI-SNAPSHOT<br>
Last updated 2013-10-04 14:51:53 CDT
</div>
</div>
</body>
</html>